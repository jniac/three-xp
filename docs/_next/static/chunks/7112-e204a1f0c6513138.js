"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7112],{17112:(e,t,s)=>{s.d(t,{O0:()=>i,XW:()=>x});var i,r=s(49797),n=s(99613),a=s(50373),o=s(64416),l=s(27491),d=s(27146),h=s(71591),c=s(28334);!function(e){e[e.Render=0]="Render",e[e.PostProcessing=1e3]="PostProcessing",e[e.GizmoRender=2e3]="GizmoRender",e[e.Outline=3e3]="Outline",e[e.Output=4e3]="Output",e[e.Antialiasing=5e3]="Antialiasing"}(i||(i={}));class p{get passes(){return this.composer.passes}sortPasses(){let e=[...this.passMap];for(let[t]of e)this.composer.removePass(t);for(let[t]of(e.sort((e,t)=>{let s=e[1],i=t[1];return s.type!==i.type?s.type-i.type:s.insertOrder-i.insertOrder}),e))this.composer.addPass(t);return this}*getPassesByType(e){for(let[t,s]of this.passMap)s.type===e&&(yield[t,s])}addPass(e){let{type:t=i.Render,insertOrder:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0===s){var r,n,a;s=(null!=(a=null==(n=[...this.getPassesByType(t)].at(-1))||null==(r=n[1])?void 0:r.insertOrder)?a:-1)+1}return this.passMap.set(e,{type:t,insertOrder:s}),this.sortPasses(),{destroy:()=>this.removePass(e)}}removePass(e){return this.passMap.has(e)?(this.passMap.delete(e),this.composer.removePass(e),!0):(console.warn("The pass is not in the pipeline."),!1)}setSize(e,t,s){this.composer.setSize(e,t),this.composer.setPixelRatio(s),this.basicPasses.fxaa.uniforms.resolution.value.set(1/s/e,1/s/t),this.basicPasses.smaa.setSize(e*s,t*s)}setScene(e){let t=this.basicPasses.mainRender.scene;for(let s of this.composer.passes)s instanceof l.A&&s.scene===t&&(s.scene=e)}render(e){this.composer.render(e.deltaTime)}getPassesInfo(){let e=["".concat(this.constructor.name," passes info:")],{composer:t,passMap:s}=this;for(let[r,n]of t.passes.entries()){let t=s.get(n);t?e.push("- ".concat(r,": ").concat(i[t.type]," (insertOrder: ").concat(t.insertOrder,") ").concat(n.constructor.name)):e.push("- ".concat(r,": NO METADATA for ").concat(n.constructor.name))}return e.join("\n")}constructor(e,t,s,p){let u=new n.s(e),f=new Map,m=new l.A(t,p);m.clearAlpha=0,f.set(m,{type:i.Render,insertOrder:0}),u.addPass(m);let b=new l.A(s,p);f.set(b,{type:i.GizmoRender,insertOrder:0}),b.clear=!1,b.clearDepth=!1,u.addPass(b);let w=new a.G(new r.I9Y,t,p);f.set(w,{type:i.GizmoRender,insertOrder:0}),u.addPass(w);let y=new o.X;f.set(y,{type:i.Output,insertOrder:0}),u.addPass(y);let g=new d.p(c.o);f.set(g,{type:i.Antialiasing,insertOrder:0}),u.addPass(g);let v=new h.I;v.enabled=!1,f.set(v,{type:i.Antialiasing,insertOrder:0}),u.addPass(v),this.composer=u,this.basicPasses={mainRender:m,gizmoRender:b,outline:w,output:y,fxaa:g,smaa:v},this.passMap=f}}var u=s(30158),f=s(17223),m=s(57165),b=s(39787),w=s(92381),y=s(17475),g=s(87381),v=s(21422),P=s(31484);class x extends v.${static current(){return this.instances[this.instances.length-1]}setScene(e){this.scene=e}useOrbitControls(){var e,t;let{position:s=null,target:i=null,element:r=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"string"==typeof r&&(r=document.querySelector(r)),null!=(e=this.internal).orbitControls||(e.orbitControls=new f.N(this.camera,r)),r&&r!==this.internal.orbitControls.domElement&&(this.internal.orbitControls.dispose(),this.internal.orbitControls=new f.N(this.camera,r)),s&&(0,w.jj)(s,this.internal.orbitControls.object.position),i&&(0,w.jj)(i,this.internal.orbitControls.target),this.internal.orbitControls.update(),this.internal.orbitControls}initialize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(this.initialized)return console.warn("ThreeWebGLContext is already initialized."),this;Object.defineProperty(this,"initialized",{value:!0,writable:!1,configurable:!1,enumerable:!1});let{onDestroy:s}=this,{domElement:i}=this.renderer;e.appendChild(i);let r=()=>{this.setSize({width:e.clientWidth,height:e.clientHeight,pixelRatio:window.devicePixelRatio})},n=new ResizeObserver(r);return n.observe(e),s(()=>{n.disconnect()}),r(),s(this.pointer.initialize(i,t,this.camera,this.ticker)),s((0,m.O)(this.ticker.requestActivation),this.ticker.onTick(e=>this.renderFrame(e))),s(()=>{var e;null==(e=this.internal.orbitControls)||e.dispose()}),this.domContainer=e,this.domElement=i,this}onSetSize(){let{size:{x:e,y:t},pixelRatio:s}=this,{renderer:i,perspectiveCamera:r,pipeline:n}=this;i.setSize(e,t),i.setPixelRatio(s),n.setSize(e,t,s),r.aspect=e/t,r.updateProjectionMatrix()}renderFrame(e){var t;null==(t=this.internal.orbitControls)||t.update(e.deltaTime),super.renderFrame(e),!1===this.skipRender&&this.pipeline.render(e)}*findAll(e,t){yield*(0,g.wV)(this.scene,e,t)}find(e){for(let t of this.findAll(e))return t;return null}isPartOfScene(e){let t=e;for(;t;){if(t===this.scene)return!0;t=t.parent}return!1}constructor(){super(P.s.WebGL),this.renderer=new u.WebGLRenderer,this.perspectiveCamera=new r.ubm,this.orthographicCamera=new r.qUd,this.camera=this.perspectiveCamera,this.gizmoScene=new r.Z58,this.pipeline=new p(this.renderer,this.scene,this.gizmoScene,this.perspectiveCamera),this.internal={size:new r.I9Y,fullSize:new r.I9Y,destroyables:[],orbitControls:null},this.onTick=this.ticker.onTick.bind(this.ticker),this.onDestroy=this.internal.destroyables.push.bind(this.internal.destroyables),this.loader=y.o.get("three"),this.initialized=!1,this.destroyed=!1,this.destroy=()=>{if(this.destroyed)return void console.warn("ThreeWebGLContext is already destroyed.");Object.defineProperty(this,"destroyed",{value:!0,writable:!1,configurable:!1,enumerable:!1}),(0,b.zr)(this.internal.destroyables),this.internal.destroyables=[],this.renderer.dispose()},this.camera.position.set(0,1,10),this.camera.lookAt(0,0,0),x.instances.push(this)}}x.instances=[]},17475:(e,t,s)=>{s.d(t,{o:()=>c});var i=s(49797),r=s(9954),n=s(17775),a=s(5832);function o(e){let t,s,i=new Promise((i,r)=>{t=()=>{i(e)},s=e=>{r(e)}});return Object.assign(e,{then:i.then.bind(i),catch:i.catch.bind(i),finally:i.finally.bind(i),resolve:t,reject:s}),e}let l=["gltf","glb"],d=["png","jpg","jpeg","hdr","exr"];class h{add(e){return this.listeners.add(e),{destroy:()=>this.listeners.delete(e)}}call(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];for(let e of this.listeners)e.apply(null,t)}constructor(){this.listeners=new Set}}class c{static current(){var e;return null!=(e=this.instances[this.instances.length-1])?e:new c}static get(e){var t;return null!=(t=this.instances.find(t=>t.name===e))?t:new c({name:e})}setPath(e){this.path=e}onAfterLoad(e){return this._onAfterLoad.add(e)}async loadGltf(e){return new Promise((t,s)=>{this.loaders.gltf.load(e,e=>{t(e),this._onAfterLoad.call()},void 0,s)})}async loadRgbe(e){let t=o(this.loaders.rgbeLoader.load(e,e=>{t.resolve(),this._onAfterLoad.call()},void 0,()=>{console.log("Failed to load RGBE: ".concat(e))}));return t}async loadExr(e){let t=o(this.loaders.exrLoader.load(e,e=>{t.resolve(),this._onAfterLoad.call()},void 0,()=>{console.log("Failed to load EXR: ".concat(e))}));return t}loadTexture(e,t){let s=new URL(this.path+e,window.location.href).href;if(this.textureCache.has(s)){let e=this.textureCache.get(s);return null==t||t(e),e}let i=o(this.loaders.texture.load(s,e=>{this.textureCache.set(s,i),null==t||t(e),i.resolve(),this._onAfterLoad.call()},void 0,()=>{console.log("Failed to load texture: ".concat(s))}));return i}async load(e){let t=e.split(".").pop();if(l.includes(t))return this.loadGltf(e);if(d.includes(t))return new Promise((t,s)=>{this.loaders.texture.load(e,e=>{t(e),this._onAfterLoad.call()},void 0,s)});throw Error("Unsupported extension: ".concat(t))}constructor({name:e}={}){this.id=c.nextId++,this.loaders={gltf:new n.B,texture:new i.Tap,rgbeLoader:new a.Y,exrLoader:new r.H},this.path="",this._onAfterLoad=new h,this.textureCache=new Map,this.name=null!=e?e:"UnifiedLoader-".concat(this.id),c.instances.push(this)}}c.nextId=0,c.instances=[]}}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5774],{15774:(t,e,r)=>{r.d(e,{Client:()=>v});var n=r(70691),a=r(49797),i=r(49617),o=r(53097),s=r(7587),l=r(50926),c=r(87381),h=r(67235),p=r(67203),u=r(9723),d=r(16008);function f(){return(0,o.yk)(function*(t){t.scene.background=new a.Q1f("#68a5d4");let e=h.Q.send("VERTIGO_CONTROLS").assertPayload();e.inputConfig,Object.assign(window,{controls:e})},[]),null}function y(){return(0,o.dB)("my-scene",function*(t){(0,c.mj)(new l.u,t).regularGrid({size:100,subdivisions:[10,10,4],color:"#ffffff",opacity:[1,.3,.1]}).circle({radius:5,quality:"ultra"},{color:"#ffffff"}),(0,c.mj)(new d.XI,t),(0,c.mj)(new a.eaF(new a.O3Y(10,.5,32,512),new u.Y),t)},[]),null}function x(t){let{size:e=100,subdivisions:r=10,...a}=t,{ref:i}=(0,s.C7)(function*(t){let n=[...t.querySelectorAll("line")],a=e/r;for(let t=0;t<=r;t++){let i=t+r+1,o=t*a-e/2;n[t].setAttribute("x1","".concat(o)),n[t].setAttribute("x2","".concat(o)),n[t].setAttribute("y1","".concat(-e/2)),n[t].setAttribute("y2","".concat(e/2)),n[i].setAttribute("x1","".concat(-e/2)),n[i].setAttribute("x2","".concat(e/2)),n[i].setAttribute("y1","".concat(o)),n[i].setAttribute("y2","".concat(o))}},"always");return(0,n.jsx)("g",{ref:i,...a,children:Array.from({length:(r+1)*2},(t,e)=>(0,n.jsx)("line",{},e))})}function g(){let[t,e]=(0,p.useState)(100),{ref:r}=(0,s.C7)(function*(t){let r=(r,n)=>{t.setAttribute("width","".concat(r)),t.setAttribute("height","".concat(n));let a=r/2,i=n/2;t.setAttribute("viewBox","-".concat(a," -").concat(i," ").concat(r," ").concat(n));let o=Math.min(r,n),[,s]=t.querySelectorAll("circle");s.setAttribute("cx","".concat(3*o/10)),s.setAttribute("cy","".concat(-(2*o)/10)),e(o)};yield(0,i.G)(window,{onSize:t=>{let{size:e}=t;r(e.x,e.y)}})},[]);return(0,n.jsx)("svg",{ref:r,xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsxs)("g",{fill:"none",stroke:"#ffff00",strokeWidth:.75,children:[(0,n.jsx)("circle",{r:5}),(0,n.jsx)("circle",{r:5}),(0,n.jsx)(x,{size:t})]})})}function v(){return(0,n.jsxs)(o.uB,{vertigoControls:{size:10,screenOffset:[3,2,0],zoom:2,inputConfig:{wheel:"zoom"}},children:[(0,n.jsxs)("div",{className:"layer thru p-4 text-[#ff0]",children:[(0,n.jsxs)("h1",{className:"text-3xl font-bold",children:["Vertigo Offset",(0,n.jsx)("br",{}),"Size: 10",(0,n.jsx)("br",{}),"Screen Offset: [3, 2, 0]"]}),(0,n.jsx)("p",{children:"When the subject is not at the center..."}),(0,n.jsx)("button",{className:"border border-[#ff0] rounded px-2 py-1 mt-2 text-[#ff0]",onClick:()=>{let t=h.Q.send("VERTIGO_CONTROLS").assertPayload();t.vertigo.perspective=+(1!==t.vertigo.perspective)},children:"Toggle perspective"})]}),(0,n.jsx)(f,{}),(0,n.jsx)(y,{}),(0,n.jsx)(g,{})]})}},16008:(t,e,r)=>{r.d(e,{Bn:()=>p,KJ:()=>s,XI:()=>f});var n=r(63126),a=r(49797),i=r(55551),o=r(38921),s=function(t){return t[t.BOX=0]="BOX",t[t.POSITIVE_X=1]="POSITIVE_X",t[t.NEGATIVE_X=2]="NEGATIVE_X",t[t.POSITIVE_Y=3]="POSITIVE_Y",t[t.NEGATIVE_Y=4]="NEGATIVE_Y",t[t.POSITIVE_Z=5]="POSITIVE_Z",t[t.NEGATIVE_Z=6]="NEGATIVE_Z",t}(s||{});function l(t,e){let r=new a.THS(new Int8Array(t.attributes.position.count).fill(e),1);t.setAttribute("aPartId",r)}function c(t,e,r){let n=new a.qFE(.2,.6000000000000001,t,r,!0).rotateZ(Math.PI).translate(0,.53,0),i=Array.from({length:e},(t,r)=>{let n=r/(e-1);return new a.I9Y(.2*n,-.05*(1-n**2))}),s=new a.nzx(i,t).rotateZ(Math.PI).translate(0,.2*3/2+.53,0);return(0,o.pP)([n,s],!1)}function h(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"low",e="high"===t?(0,o.ec)(new i.j(.3,.3,.3,4,.05)):new a.iNn(.3,.3,.3);l(e,0);let r="high"===t?c(32,8,5):c(6,2,1);l(r,3);let n=r.clone().rotateX(Math.PI);l(n,4);let s=r.clone().rotateZ(-Math.PI/2);l(s,1);let h=r.clone().rotateZ(Math.PI/2);l(h,2);let p=r.clone().rotateX(Math.PI/2);l(p,5);let u=r.clone().rotateX(-Math.PI/2);return l(u,6),[e,s,h,r,n,p,u]}let p={defaultColor:"white",xColor:"#eb1640",yColor:"#00ffb7",zColor:"#3b80e7",hoverColor:"#fffc47"};function u(t){let{defaultColor:e,xColor:r,yColor:n,zColor:i,hoverColor:o}={...p,...t},s=new a.Q1f(e),l=new a.Q1f(r),c=new a.Q1f(n),h=new a.Q1f(i),u=new a.Q1f(o),d={uSunPosition:{value:new a.Pq0(.5,.7,.3)},uLuminosity:{value:.66},uColors:{value:[s,l,s,c,s,h,s]},uHoverColor:{value:u},uOpacity:{value:[1,1,1,1,1,1,1]},uHoverOpacity:{value:[0,0,0,0,0,0,0]}};return new a.BKk({uniforms:d,vertexShader:"\nuniform vec3 uColors[7];\nuniform float uOpacity[7];\nuniform vec3 uHoverColor;\nuniform float uHoverOpacity[7];\n\nattribute float aPartId;\n\nvarying vec3 vWorldNormal;\nvarying vec3 vPosition;\nvarying vec3 vColor;\nvarying float vOpacity;\nvarying float vHoverOpacity;\n\nvoid main() {\n  vWorldNormal = mat3(modelMatrix) * normal;\n  vPosition = position;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vColor = uColors[int(aPartId)];\n  vOpacity = uOpacity[int(aPartId)];\n  vHoverOpacity = uHoverOpacity[int(aPartId)];\n}\n",fragmentShader:"\nvarying vec3 vWorldNormal;\nvarying vec3 vPosition;\nvarying vec3 vColor;\nvarying float vOpacity;\nvarying float vHoverOpacity;\n\nuniform vec3 uSunPosition;\nuniform float uLuminosity;\nuniform vec3 uHoverColor;\n\nfloat clamp01(float x) {\n  return x < 0.0 ? 0.0 : x > 1.0 ? 1.0 : x;\n}\n\nfloat inverseLerp(float a, float b, float x) {\n  return clamp01((x - a) / (b - a));\n}\n\nvoid main() {\n  vec3 lightDirection = normalize(uSunPosition);\n  float light = dot(vWorldNormal, lightDirection) * 0.5 + 0.5;\n  light = pow(light, 2.0);\n  \n  float minLuminosity = max(pow(vHoverOpacity, 1.0 / 3.0) * 0.85, uLuminosity);\n  light = mix(minLuminosity, 1.0, light);\n\n  vec3 color = vColor;\n  color = mix(color, uHoverColor, vHoverOpacity);\n  gl_FragColor = vec4(color * light, vOpacity);\n}\n",transparent:!0})}let d=new a.tBo;class f extends a.YJl{getHovered(){return this.internal.hovered}getPressed(){return this.internal.pressed}widgetUpdate(t,e,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/60,{lowMesh:o,material:s}=this.parts,l=new a.Pq0;r.getWorldDirection(l);let c=this.matrixWorld.elements,h=new a.Pq0(c[0],c[1],c[2]),p=new a.Pq0(c[4],c[5],c[6]),u=new a.Pq0(c[8],c[9],c[10]);{let t=s.uniforms.uOpacity.value,e=Math.abs(l.dot(h)),r=Math.abs(l.dot(p)),a=Math.abs(l.dot(u));t[1]=t[2]=(0,n.calculateExponentialDecay)(t[1],e<.98?1.05:-.05,1e-4,i),t[3]=t[4]=(0,n.calculateExponentialDecay)(t[3],r<.98?1.05:-.05,1e-4,i),t[5]=t[6]=(0,n.calculateExponentialDecay)(t[5],a<.98?1.05:-.05,1e-4,i)}{let t=s.uniforms.uHoverOpacity.value,e=+(0===this.internal.hovered),r=+(1===this.internal.hovered),a=+(2===this.internal.hovered),o=+(3===this.internal.hovered),l=+(4===this.internal.hovered),c=+(5===this.internal.hovered),h=+(6===this.internal.hovered);t[0]=(0,n.calculateExponentialDecay)(t[0],e,1e-4,i),t[1]=(0,n.calculateExponentialDecay)(t[1],r,1e-4,i),t[2]=(0,n.calculateExponentialDecay)(t[2],a,1e-4,i),t[3]=(0,n.calculateExponentialDecay)(t[3],o,1e-4,i),t[4]=(0,n.calculateExponentialDecay)(t[4],l,1e-4,i),t[5]=(0,n.calculateExponentialDecay)(t[5],c,1e-4,i),t[6]=(0,n.calculateExponentialDecay)(t[6],h,1e-4,i)}d.setFromCamera(t,r);let[f]=d.intersectObject(o,!0).map(t=>{let e=3*t.faceIndex;return o.geometry.groups.findIndex(t=>t.start<=e&&e<t.start+t.count)}).filter(t=>s.uniforms.uOpacity.value[t]>.5);e&&!1===this.internal.pointerDown&&(this.internal.pointerDown=!0,this.internal.pointerDownPosition.copy(t),this.internal.pressed=null!=f?f:null),e&&!1===this.internal.dragging&&this.internal.pointerDownPosition.distanceTo(t)>.01&&(this.internal.dragging=!0),!1===e&&this.internal.pointerDown&&(this.internal.pointerDown=!1,this.internal.dragging=!1,this.internal.pressed=null);let y=this.internal.dragging?null:null!=f?f:null;this.internal.hovered,this.internal.hovered=y}constructor(t){super(),this.internal={pointerPosition:new a.I9Y,pointerDownPosition:new a.I9Y,pointerDown:!1,dragging:!1,hovered:null,pressed:null};let e=u(null==t?void 0:t.material),r=h("high").map((t,r)=>{let n=new a.eaF(t,e);return n.name="vertigo-widget-mesh-".concat(r),this.add(n),n}),n=new a.eaF(function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];let n=h(...e);return(0,o.pP)(n,!0)}("low"),u(null==t?void 0:t.material));n.material.transparent=!1,n.name="vertigo-widget-low-mesh",n.visible=!1,this.add(n),this.parts={material:e,meshes:r,lowMesh:n}}}},50926:(t,e,r)=>{r.d(e,{u:()=>I,w:()=>D});var n=r(49797),a=r(96273),i=r(67840);class o{ensureKeyEntry(t,e,r){let n=this.keyMap.get(t);if(n){if(n.count!==r)throw Error("A key entry already exists with a different count. This is not allowed. Once a key is set, it cannot be changed.");return n}{let n={index:e,count:r};return this.keyMap.set(t,n),n}}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];throw Error("Not implemented!")}clear(){return this.keyMap.clear(),this}constructor(){this.keyMap=new Map,this.transformMatrix=new n.kn4}}var s=r(66066),l=r(15940),c=r(17953),h=r(81074),p=r(6726),u=r(60041);let d=new n.Pq0,f=new n.Pq0,y=new n.Pq0,x=new n.Pq0,g=new n.Pq0,v=new n.Pq0,m=new n.Pq0,w=new n.Q1f,b=new n.kn4;class A{static box(t){let[e,r,n,i,o,s,l,c]=A.boxPoints;if("min"in t||"max"in t){let{min:n=A.boxMinMaxDefaults.min,max:i=A.boxMinMaxDefaults.max}=t;(0,a.jj)(n,e),(0,a.jj)(i,r)}else if("center"in t||"size"in t){let{center:o=A.boxCenterSizeDefaults.center,size:s=A.boxCenterSizeDefaults.size}=t;(0,a.jj)(o,n),(0,a.jj)(s,i).multiplyScalar(.5),e.copy(n).sub(i),r.copy(n).add(i)}else e.copy(A.boxMinMaxDefaults.min),r.copy(A.boxMinMaxDefaults.max);t.inset&&(e.addScalar(t.inset),r.addScalar(-t.inset));let{x:h,y:p,z:u}=e,{x:d,y:f,z:y}=r;return r.set(d,p,u),n.set(d,p,y),i.set(h,p,y),o.set(h,f,u),s.set(d,f,u),l.set(d,f,y),c.set(h,f,y),t.transform&&((0,a.vl)(t.transform,b),e.applyMatrix4(b),r.applyMatrix4(b),n.applyMatrix4(b),i.applyMatrix4(b),o.applyMatrix4(b),s.applyMatrix4(b),l.applyMatrix4(b),c.applyMatrix4(b)),A}}A.boxPoints=[new n.Pq0,new n.Pq0,new n.Pq0,new n.Pq0,new n.Pq0,new n.Pq0,new n.Pq0,new n.Pq0],A.boxDefaults={inset:0,transform:void 0},A.boxMinMaxDefaults={min:new n.Pq0(-.5,-.5,-.5),max:new n.Pq0(.5,.5,.5)},A.boxCenterSizeDefaults={center:new n.Pq0(0,0,0),size:new n.Pq0(1,1,1)};let P={size:.1,proportionalSize:!1,position:"middle",skip:void 0,type:"single",scale:1},M={key:void 0,color:void 0,opacity:1,arrow:!1};var z=new WeakSet;class O extends o{static createParts(){let{nodeMaterial:t=!1,lineCount:e=2e4,defaultColor:r="white",defaultOpacity:a=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=new n.LoY,o={position:new n.THS(new Float32Array(3*e*2),3),color:new n.THS(new Float32Array(3*e*2),3),aOpacity:new n.THS(new Float32Array(2*e),1)};for(let[t,e]of Object.entries(o))i.setAttribute(t,e);let s=t?(()=>{let t=new h.e9u({vertexColors:!0,transparent:!0,depthWrite:!1}),e=(0,c.xIr)(o.aOpacity,"float",1,0);return t.opacityNode=(0,c.PCg)(e),t})():(()=>{let t=new n.mrM({vertexColors:!0,transparent:!0,depthWrite:!1});return t.onBeforeCompile=t=>u.b.with(t).varying({vOpacity:"float"}).vertex.top("\n          attribute float aOpacity;\n        ").vertex.mainAfterAll("\n          vOpacity = aOpacity;\n        ").fragment.after("color_fragment","\n          diffuseColor.a *= vOpacity;\n        "),t})(),l=new n.DXC(i,s);return l.frustumCulled=!1,{count:e,defaults:{color:r,opacity:a},geometry:i,attributes:o,lines:l}}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];this.parts.geometry.applyMatrix4((0,a.GD)(e))}clear(){return super.clear(),this.state.index=0,this.parts.geometry.setDrawRange(0,0),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,{lines:e}=this.parts;return 0!==t?(e.renderOrder=t,e.material.depthTest=!1,e.material.depthWrite=!1):(e.renderOrder=0,e.material.depthTest=!0,e.material.depthWrite=!0),this}segmentsArray(t,e){let{position:r,color:n,aOpacity:a}=this.parts.attributes,{key:i,color:o,opacity:l}={...M,...this.parts.defaults,...e},{r:c,g:h,b:p}=w.set(o),u=t.length/3,b=function(t,e){var r,n;if(!1===e||void 0===e)return new Float32Array;let a=Array.isArray(e)?e:[!0===e?{}:e],i=0;for(let t of a){let e=null!=(r=null==t?void 0:t.type)?r:P.type,a=null!=(n=null==t?void 0:t.position)?n:P.position;i+=(Array.isArray(a)?a.length:1)*("triple"===e?3:"double"===e?2:1)}let o=t.length/3/2,s=new Float32Array(o*i*12),l=0;for(let e=0;e<o;e++){let r=6*e;d.set(t[r+0],t[r+1],t[r+2]),f.set(t[r+3],t[r+4],t[r+5]),y.subVectors(f,d);let n=y.lengthSq();for(let t of a){let{size:e=P.size,proportionalSize:r=P.proportionalSize,position:a=P.position,skip:i=P.skip,type:o=P.type,scale:c=P.scale}=null!=t?t:{};if(void 0!==i){if(!0===i||"less-than-size"===i){if(n<e*e)continue}else if("number"==typeof i&&n<i*i)continue}let h=Math.sqrt(n),p=(r?h:1)*e*c;x.copy(y).divideScalar(h);let u=Math.abs(x.x),w=Math.abs(x.y),b=Math.abs(x.z);for(let t of(u>=b&&w>=b?g.set(x.y,-x.x,0).normalize():w>=u?g.set(x.z,0,-x.x).normalize():g.set(0,x.z,-x.y).normalize(),Array.isArray(a)?a:[a])){let r="triple"===o?3:"double"===o?2:1;for(let n=0;n<r;n++){let a=function(t){if("number"==typeof t)return t;switch(t){case"end":return 1;case"start":return 0;case"middle":return .5;default:throw Error("Invalid arrow position: ".concat(t))}}(t);r>1&&(a+=(n/(r-1)-a)*e/h*.8),v.lerpVectors(d,f,a),v.toArray(s,(4*l+0)*3),m.copy(v).addScaledVector(x,-p).addScaledVector(g,-p).toArray(s,(4*l+1)*3),v.toArray(s,(4*l+2)*3),m.copy(v).addScaledVector(x,-p).addScaledVector(g,p).toArray(s,(4*l+3)*3),l++}}}}return s}(t,null==e?void 0:e.arrow),A=b.length/3,O=u+A,{index:C}=void 0!==i?this.ensureKeyEntry(i,this.state.index,u):this.state;if(C+O>this.parts.count)throw console.log("Overflow Handling Not implemented",C+O,this.parts.count),Error("Overflow Handling Not implemented");this.state.index=Math.max(this.state.index,C+O);{let{transformMatrix:e}=this;for(let i=0;i<u;i++)d.fromArray(t,3*i).applyMatrix4(e).toArray(r.array,(C+i)*3),n.setXYZ(C+i,c,h,p),a.setX(C+i,l)}{let t=C+u;for(let e=0;e<A;e++)d.fromArray(b,3*e).applyMatrix4(this.transformMatrix).toArray(r.array,(t+e)*3),n.setXYZ(t+e,c,h,p),a.setX(t+e,l)}return(0,s._)(this,z,S).call(this),this}segments(t,e){let r=t.length,n=new Float32Array(3*r);for(let e=0;e<r;e++){let{x:r,y:i,z:o}=(0,a.jj)(t[e],d),s=3*e;n[s+0]=r,n[s+1]=i,n[s+2]=o}return this.segmentsArray(n,e)}line(t,e,r){return this.segments([t,e],r)}polyline(t,e){if(t.length<2)return this;let r=Array((t.length-1)*2);for(let e=1;e<t.length;e++)r[2*e-2]=t[e-1],r[2*e-1]=t[e];return this.segments(r,e)}polygon(t,e){return t.length<2||(this.polyline(t,e),this.line(t[t.length-1],t[0],e)),this}box(t,e){let[r,n,a,i,o,s,l,c]=A.box(t).boxPoints;return this.segmentsArray(new Float32Array([r.x,r.y,r.z,n.x,n.y,n.z,n.x,n.y,n.z,a.x,a.y,a.z,a.x,a.y,a.z,i.x,i.y,i.z,i.x,i.y,i.z,r.x,r.y,r.z,o.x,o.y,o.z,s.x,s.y,s.z,s.x,s.y,s.z,l.x,l.y,l.z,l.x,l.y,l.z,c.x,c.y,c.z,c.x,c.y,c.z,o.x,o.y,o.z,r.x,r.y,r.z,o.x,o.y,o.z,n.x,n.y,n.z,s.x,s.y,s.z,a.x,a.y,a.z,l.x,l.y,l.z,i.x,i.y,i.z,c.x,c.y,c.z]),e)}rect(t,e){let{minX:r,minY:n,maxX:a,maxY:i}=p.M_.from(t),{inset:o}={...O.rectDefaultOptions,...e};return r+=o,n+=o,a-=o,i-=o,this.segments([{x:r,y:n,z:0},{x:a,y:n,z:0},{x:a,y:n,z:0},{x:a,y:i,z:0},{x:a,y:i,z:0},{x:r,y:i,z:0},{x:r,y:i,z:0},{x:r,y:n,z:0}],e)}circle(){let{center:t=0,axis:e="z",radius:r=1,quality:n="medium",segments:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;null!=i||(i=O.circleQualityPresets[n]);let{x:s,y:l,z:c}=(0,a.jj)(t,d);(0,a.jj)(e,d).normalize(),f.set(d.y,d.z,d.x).cross(d).normalize(),y.crossVectors(d,f);let h=new Float32Array(3*i*2);for(let t=0;t<i;t++){let e=t/i*Math.PI*2,n=(t+1)/i*Math.PI*2,a=Math.cos(e)*r,o=Math.sin(e)*r,p=Math.cos(n)*r,u=Math.sin(n)*r,d=6*t;h[d+0]=s+a*f.x+o*y.x,h[d+1]=l+a*f.y+o*y.y,h[d+2]=c+a*f.z+o*y.z,h[d+3]=s+p*f.x+u*y.x,h[d+4]=l+p*f.y+u*y.y,h[d+5]=c+p*f.z+u*y.z}return this.segmentsArray(h,o),this}regularGrid(t){let{color:e,opacity:r,plane:n,size:a,subdivisions:i}={...O.regularGridDefaults,...t},o=i.length,l=i.map((t,e)=>i.slice(e).reduce((t,e)=>t*e,1)),c=l[0],h=new Float32Array((c+1)*12),p=new Float32Array((c+1)*12).fill(1),u=new Float32Array((c+1)*4).fill(1),d=Array.isArray(e)?e:[e],f=i.map((t,e)=>{let{r,g:n,b:a}=w.set(d[Math.min(e,d.length-1)]);return[r,n,a]}),y=Array.isArray(r)?r:[r],x=i.map((t,e)=>y[Math.min(e,y.length-1)]);for(let t=0;t<=c;t++){let e=o-1;for(;t%l[e]==0&&!(--e<=0););let[r,n,i]=f[e],s=x[e],d=t/c*a,y=12*t;h[y+0]=-a/2,h[y+1]=-a/2+d,h[y+2]=0,h[y+3]=a/2,h[y+4]=-a/2+d,h[y+5]=0,h[y+6]=-a/2+d,h[y+7]=-a/2,h[y+8]=0,h[y+9]=-a/2+d,h[y+10]=a/2,h[y+11]=0,p[y+0]=r,p[y+1]=n,p[y+2]=i,p[y+3]=r,p[y+4]=n,p[y+5]=i,p[y+6]=r,p[y+7]=n,p[y+8]=i,p[y+9]=r,p[y+10]=n,p[y+11]=i;let g=4*t;u[g+0]=s,u[g+1]=s,u[g+2]=s,u[g+3]=s}if("xz"===n)for(let t=0;t<h.length;t+=3)h[t+2]=h[t+1],h[t+1]=0;else if("yz"===n)for(let t=0;t<h.length;t+=3)h[t+2]=h[t+1],h[t+1]=h[t+0],h[t+0]=0;let{index:g}=this.state;return this.parts.attributes.position.array.set(h,3*g),this.parts.attributes.color.array.set(p,3*g),this.parts.attributes.aOpacity.array.set(u,g),this.state.index+=(c+1)*4,(0,s._)(this,z,S).call(this),this}constructor(t){super(),(0,l._)(this,z),this.state={index:0},this.parts=O.createParts(t)}}function S(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(let t of(this.parts.geometry.setDrawRange(0,this.state.index),Object.values(this.parts.attributes)))t.needsUpdate=!0;if(this.state.index>2*this.parts.count)throw Error("Not implemented!");if(t)for(let t of Object.values(this.parts.attributes))t.array.some(t=>isNaN(t))&&console.log(t.array.findIndex(t=>isNaN(t)))}O.rectDefaultOptions={inset:0},O.circleQualityPresets={low:18,medium:36,high:64,ultra:256},O.regularGridDefaults={plane:"xy",size:100,subdivisions:[10,2,5],opacity:[.2,.05,.01],color:"white"};class C extends o{static createParts(){let{pointCount:t=1e4}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new n.LoY,r={position:new n.THS(new Float32Array(3*t),3),color:new n.THS(new Float32Array(3*t),3),aScale:new n.THS(new Float32Array(t),1),aShape:new n.THS(new Float32Array(t),1)};for(let[t,n]of Object.entries(r))e.setAttribute(t,n);let a=new n.BH$({vertexColors:!0});a.onBeforeCompile=t=>u.b.with(t).varying({vShape:"float"}).vertex.top("\n        attribute float aScale;\n        attribute float aShape;\n      ").vertex.mainAfterAll("\n        gl_PointSize *= aScale;\n        vShape = aShape;\n      ").fragment.top("\n        float sdBox(in vec2 p, in vec2 b) {\n          vec2 d = abs(p) - b;\n          return length(max(d, 0.0)) + min(max(d.x, d.y), 0.0);\n        }\n      ").fragment.after("color_fragment","\n        float regular = .2;\n        float thin = .1;\n        float ultraThin = .033;\n\n        if (vShape == ".concat(C.shapes.circle,".0) {\n          float d = distance(gl_PointCoord * 2.0, vec2(1.0));\n          if (d > 1.0) discard;\n        }\n\n        if (vShape == ").concat(C.shapes.ring,".0) {\n          float d = distance(gl_PointCoord * 2.0, vec2(1.0));\n          if (d < 0.8 || d > 1.0) discard;\n        }\n\n        if (vShape == ").concat(C.shapes["ring-thin"],".0) {\n          float d = distance(gl_PointCoord * 2.0, vec2(1.0));\n          if (d < 0.9 || d > 1.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes.plus,".0) {\n          float d0 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(1.0, regular));\n          float d1 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(regular, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes["plus-thin"],".0) {\n          float d0 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(1.0, thin));\n          float d1 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(thin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes["plus-ultra-thin"],".0) {\n          float d0 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(1.0, ultraThin));\n          float d1 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(ultraThin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes.x,".0) {\n          vec2 p = gl_PointCoord * 2.0 - 1.0;\n          float c = 0.70710678;\n          p = mat2(c, -c, c, c) * p;\n          float d0 = sdBox(p, vec2(1.0, regular));\n          float d1 = sdBox(p, vec2(regular, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes["x-thin"],".0) {\n          vec2 p = gl_PointCoord * 2.0 - 1.0;\n          float c = 0.70710678;\n          p = mat2(c, -c, c, c) * p;\n          float d0 = sdBox(p, vec2(1.0, thin));\n          float d1 = sdBox(p, vec2(thin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes["x-ultra-thin"],".0) {\n          vec2 p = gl_PointCoord * 2.0 - 1.0;\n          float c = 0.70710678;\n          p = mat2(c, -c, c, c) * p;\n          float d0 = sdBox(p, vec2(1.0, ultraThin));\n          float d1 = sdBox(p, vec2(ultraThin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        // diffuseColor.rgb *= vec3(gl_PointCoord, 1.0);\n      "));let i=new n.ONl(e,a);return i.frustumCulled=!1,{count:t,geometry:e,attributes:r,points:i}}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];this.parts.geometry.applyMatrix4((0,a.GD)(e))}clear(){return super.clear(),this.state.index=0,this.parts.geometry.setDrawRange(0,0),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,{points:e}=this.parts;return 0!==t?(e.renderOrder=t,e.material.depthTest=!1,e.material.depthWrite=!1,e.material.transparent=!0):(e.renderOrder=0,e.material.depthTest=!0,e.material.depthWrite=!0,e.material.transparent=!1),this}points(t){let{key:e,size:r=.1,scale:n=1,color:i="white",shape:o="square"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{transformMatrix:s}=this,l=void 0!==e,c=t.length,{index:h}=l?this.ensureKeyEntry(e,this.state.index,c):this.state,{position:p,color:u,aScale:f,aShape:y}=this.parts.attributes,{r:x,g,b:v}=w.set(i),m=n*r,b=C.shapes[o];for(let e=0;e<c;e++){let{x:r,y:n,z:i}=(0,a.jj)(t[e],d).applyMatrix4(s),o=h+e;p.setXYZ(o,r,n,i),u.setXYZ(o,x,g,v),f.setX(o,m),y.setX(o,b)}for(let t of(this.state.index=l?Math.max(this.state.index,h+c):h+c,this.parts.geometry.setDrawRange(0,this.state.index),Object.values(this.parts.attributes)))t.needsUpdate=!0;if(this.state.index>this.parts.count)throw Error("Overflow Handling Not implemented");return this}box(t,e){let{boxPoints:r}=A.box(t);return this.points(r,e)}point(t,e){return this.points([t],e)}constructor(t){super(),this.state={index:0},this.parts=C.createParts(t)}}C.shapes=(()=>{let t=0;return{square:t++,circle:t++,ring:t++,"ring-thin":t++,plus:t++,"plus-thin":t++,"plus-ultra-thin":t++,x:t++,"x-thin":t++,"x-ultra-thin":t++}})();class T extends o{static createParts(t){let e=new i.w({textCount:2e3,...t});return{count:e.count,textHelper:e}}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];this.parts.textHelper.applyTransform(...e)}clear(){return this.state.index=0,this.parts.textHelper.clearAllText(),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.parts.textHelper.onTop(t),this}texts(t,e){let r=this.state.index,{texts:n,...i}={...T.textDefaults,...e},o="function"==typeof n?n:t=>n[t%n.length],s=0;for(let e of t){let{x:t,y:n,z:l}=(0,a.jj)(e,d);this.parts.textHelper.setTextAt(r,o(s),{...i,x:t,y:n,z:l}),r++,s++}return this.state.index=r,this}text(t,e,r){return this.texts([t],{...r,texts:[e]})}textAt(t,e,r){return this.parts.textHelper.setTextAt(t,e,{...r}),this}constructor(t){super(),this.state={index:0},this.parts=T.createParts(t)}}T.textDefaults={texts:t=>t.toString()};let j={color:void 0,size:.1,shape:"square",scale:1};class I extends n.YJl{static createParts(t,e){let{nodeMaterial:r}=null!=e?e:{},n=new C(null==e?void 0:e.points);t.add(n.parts.points);let a=new O({nodeMaterial:r,...null==e?void 0:e.lines});t.add(a.parts.lines);let i=new T({nodeMaterial:r,...null==e?void 0:e.texts});return t.add(i.parts.textHelper),{pointsManager:n,linesManager:a,textsManager:i}}points(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.pointsManager.points(...e),this}point(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.pointsManager.point(...e),this}segments(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.segments(...e),this}line(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.line(...e),this}polyline(t,e){return this.parts.linesManager.polyline(t,e),(null==e?void 0:e.points)&&this.points(t,{...j,color:e.color,...!0===e.points?{}:e.points}),this}polylines(t,e){for(let r of t)this.polyline(r,e);return this}polygon(t,e){return this.parts.linesManager.polygon(t,e),(null==e?void 0:e.points)&&this.points(t,{...j,color:e.color,...!0===e.points?{}:e.points}),this}polygons(t,e){for(let r of t)this.polygon(r,e);return this}box(t,e){return this.parts.linesManager.box(t,e),(null==e?void 0:e.points)&&this.parts.pointsManager.box(t,{...j,color:e.color,...!0===e.points?{}:e.points}),this}circle(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.circle(...e),this}rect(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.rect(...e),this}regularGrid(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.regularGrid(...e),this}texts(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.textsManager.texts(...e),this}text(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.textsManager.text(...e),this}textAt(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.textsManager.textAt(...e),this}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.pointsManager.applyTransform(...e),this.parts.linesManager.applyTransform(...e),this.parts.textsManager.applyTransform(...e),this}clear(){return this.parts.pointsManager.clear(),this.parts.linesManager.clear(),this.parts.textsManager.clear(),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.renderOrder=t,this.parts.pointsManager.onTop(t),this.parts.linesManager.onTop(t),this.parts.textsManager.onTop(t),this}globalExpose(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"debugHelper";return Object.assign(globalThis,{[t]:this}),this}addTo(t){return t?t.add(this):this.removeFromParent(),this}constructor(t){super(),this.userData={helper:!0},this.parts=I.createParts(this,t)}}let D=new I}}]);
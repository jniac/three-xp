"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1033],{51277:function(e,t,s){let r,i,a;s.d(t,{AEy:function(){return n4},Sxh:function(){return pG},jix:function(){return lu},oHn:function(){return pF}});var n=s(37186);let o=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class l{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=!0===e.object.isSkinnedMesh,this.refreshUniforms=o,this.renderId=0}firstInitialization(e){return!1===this.renderObjects.has(e)&&(this.getRenderObjectData(e),!0)}getRenderObjectData(e){let t=this.renderObjects.get(e);if(void 0===t){let{geometry:s,material:r,object:i}=e;if(t={material:this.getMaterialData(r),geometry:{attributes:this.getAttributesData(s.attributes),indexVersion:s.index?s.index.version:null,drawRange:{start:s.drawRange.start,count:s.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(t.center=i.center.clone()),i.morphTargetInfluences&&(t.morphTargetInfluences=i.morphTargetInfluences.slice()),null!==e.bundle&&(t.version=e.bundle.version),t.material.transmission>0){let{width:s,height:r}=e.context;t.bufferWidth=s,t.bufferHeight=r}this.renderObjects.set(e,t)}return t}getAttributesData(e){let t={};for(let s in e){let r=e[s];t[s]={version:r.version}}return t}containsNode(e){let t=e.material;for(let e in t)if(t[e]&&t[e].isNode)return!0;return null!==e.renderer.nodes.modelViewMatrix||null!==e.renderer.nodes.modelNormalViewMatrix}getMaterialData(e){let t={};for(let s of this.refreshUniforms){let r=e[s];null!=r&&("object"==typeof r&&void 0!==r.clone?!0===r.isTexture?t[s]={id:r.id,version:r.version}:t[s]=r.clone():t[s]=r)}return t}equals(e){let{object:t,material:s,geometry:r}=e,i=this.getRenderObjectData(e);if(!0!==i.worldMatrix.equals(t.matrixWorld))return i.worldMatrix.copy(t.matrixWorld),!1;let a=i.material;for(let e in a){let t=a[e],r=s[e];if(void 0!==t.equals){if(!1===t.equals(r))return t.copy(r),!1}else if(!0===r.isTexture){if(t.id!==r.id||t.version!==r.version)return t.id=r.id,t.version=r.version,!1}else if(t!==r)return a[e]=r,!1}if(a.transmission>0){let{width:t,height:s}=e.context;if(i.bufferWidth!==t||i.bufferHeight!==s)return i.bufferWidth=t,i.bufferHeight=s,!1}let n=i.geometry,o=r.attributes,l=n.attributes,u=Object.keys(l),d=Object.keys(o);if(u.length!==d.length)return i.geometry.attributes=this.getAttributesData(o),!1;for(let e of u){let t=l[e],s=o[e];if(void 0===s)return delete l[e],!1;if(t.version!==s.version)return t.version=s.version,!1}let p=r.index,h=n.indexVersion,c=p?p.version:null;if(h!==c)return n.indexVersion=c,!1;if(n.drawRange.start!==r.drawRange.start||n.drawRange.count!==r.drawRange.count)return n.drawRange.start=r.drawRange.start,n.drawRange.count=r.drawRange.count,!1;if(i.morphTargetInfluences){let e=!1;for(let s=0;s<i.morphTargetInfluences.length;s++)i.morphTargetInfluences[s]!==t.morphTargetInfluences[s]&&(e=!0);if(e)return!0}return i.center&&!1===i.center.equals(t.center)?i.center.copy(t.center):null!==e.bundle&&(i.version=e.bundle.version),!0}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;let{renderId:s}=t;if(this.renderId!==s)return this.renderId=s,!0;let r=!0===e.object.static,i=null!==e.bundle&&!0===e.bundle.static&&this.getRenderObjectData(e).version===e.bundle.version;return!r&&!i&&!0!==this.equals(e)}}function u(e,t=0){let s=3735928559^t,r=1103547991^t;if(e instanceof Array)for(let t=0,i;t<e.length;t++)s=Math.imul(s^(i=e[t]),2654435761),r=Math.imul(r^i,1597334677);else for(let t=0,i;t<e.length;t++)s=Math.imul(s^(i=e.charCodeAt(t)),2654435761),r=Math.imul(r^i,1597334677);return s=Math.imul(s^s>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),4294967296*(2097151&(r=Math.imul(r^r>>>16,2246822507)^Math.imul(s^s>>>13,3266489909)))+(s>>>0)}let d=e=>u(e),p=e=>u(e),h=(...e)=>u(e);function c(e,t=!1){let s=[];for(let{property:r,childNode:i}of(!0===e.isNode&&(s.push(e.id),e=e.getSelf()),m(e)))s.push(s,u(r.slice(0,-4)),i.getCacheKey(t));return u(s)}function*m(e,t=!1){for(let s in e){if(!0===s.startsWith("_"))continue;let r=e[s];if(!0===Array.isArray(r))for(let e=0;e<r.length;e++){let i=r[e];i&&(!0===i.isNode||t&&"function"==typeof i.toJSON)&&(yield{property:s,index:e,childNode:i})}else if(r&&!0===r.isNode)yield{property:s,childNode:r};else if("object"==typeof r)for(let e in r){let i=r[e];i&&(!0===i.isNode||t&&"function"==typeof i.toJSON)&&(yield{property:s,index:e,childNode:i})}}}let g=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]);function f(e){return/float|int|uint/.test(e)?1:/vec2/.test(e)?2:/vec3/.test(e)?3:/vec4/.test(e)?4:/mat3/.test(e)?9:/mat4/.test(e)?16:void console.error("THREE.TSL: Unsupported type:",e)}function y(e){if(null==e)return null;let t=typeof e;if(!0===e.isNode)return"node";if("number"===t)return"float";if("boolean"===t)return"bool";if("string"===t)return"string";if("function"===t)return"shader";if(!0===e.isVector2)return"vec2";if(!0===e.isVector3)return"vec3";else if(!0===e.isVector4)return"vec4";else if(!0===e.isMatrix3)return"mat3";else if(!0===e.isMatrix4)return"mat4";else if(!0===e.isColor)return"color";else if(e instanceof ArrayBuffer)return"ArrayBuffer";return null}function N(e,...t){let s=e?e.slice(-4):void 0;if(1===t.length&&("vec2"===s?t=[t[0],t[0]]:"vec3"===s?t=[t[0],t[0],t[0]]:"vec4"===s&&(t=[t[0],t[0],t[0],t[0]])),"color"===e)return new n.Ilk(...t);if("vec2"===s)return new n.FM8(...t);if("vec3"===s)return new n.Pa4(...t);if("vec4"===s)return new n.Ltg(...t);if("mat3"===s)return new n.Vkp(...t);if("mat4"===s)return new n.yGw(...t);if("bool"===e)return t[0]||!1;else if("float"===e||"int"===e||"uint"===e)return t[0]||0;else if("string"===e)return t[0]||"";else if("ArrayBuffer"===e)return x(t[0]);return null}function v(e){let t="",s=new Uint8Array(e);for(let e=0;e<s.length;e++)t+=String.fromCharCode(s[e]);return btoa(t)}function x(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer}let T={VERTEX:"vertex",FRAGMENT:"fragment"},b={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},w={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},_=["fragment","vertex"],V=[..._,"compute"],M=["x","y","z","w"],A=0;class S extends n.pBf{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=b.NONE,this.updateBeforeType=b.NONE,this.updateAfterType=b.NONE,this.uuid=n.M8C.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:A++})}set needsUpdate(e){!0===e&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,b.FRAME)}onRenderUpdate(e){return this.onUpdate(e,b.RENDER)}onObjectUpdate(e){return this.onUpdate(e,b.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(let{childNode:e}of m(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){for(let t of(e(this),this.getChildren()))t.traverse(e)}getCacheKey(e=!1){return(!0===(e=e||this.version!==this._cacheKeyVersion)||null===this._cacheKey)&&(this._cacheKey=c(this,e),this._cacheKeyVersion=this.version),this._cacheKey}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){let t=this.getNodeType(e);return e.getElementType(t)}getNodeType(e){let t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){let t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){let t=e.getNodeProperties(this),s=0;for(let e of this.getChildren())t["node"+s++]=e;return null}analyze(e){if(1===e.increaseUsage(this))for(let t of Object.values(e.getNodeProperties(this)))t&&!0===t.isNode&&t.build(e)}generate(e,t){let{outputNode:s}=e.getNodeProperties(this);if(s&&!0===s.isNode)return s.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){let s=this.getShared(e);if(this!==s)return s.build(e,t);e.addNode(this),e.addChain(this);let r=null,i=e.getBuildStage();if("setup"===i){this.updateReference(e);let t=e.getNodeProperties(this);if(!0!==t.initialized)for(let s of(e.stack.nodes.length,t.initialized=!0,t.outputNode=this.setup(e),null!==t.outputNode&&e.stack.nodes.length,Object.values(t)))s&&!0===s.isNode&&s.build(e)}else if("analyze"===i)this.analyze(e);else if("generate"===i){if(1===this.generate.length){let s=this.getNodeType(e),i=e.getDataFromNode(this);void 0===(r=i.snippet)?(r=this.generate(e)||"",i.snippet=r):void 0!==i.flowCodes&&void 0!==e.context.nodeBlock&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),r=e.format(r,s,t)}else r=this.generate(e,t)||""}return e.removeChain(this),e.addSequentialNode(this),r}getSerializeChildren(){return m(this)}serialize(e){let t=this.getSerializeChildren(),s={};for(let{property:r,index:i,childNode:a}of t)void 0!==i?(void 0===s[r]&&(s[r]=Number.isInteger(i)?[]:{}),s[r][i]=a.toJSON(e.meta).uuid):s[r]=a.toJSON(e.meta).uuid;Object.keys(s).length>0&&(e.inputNodes=s)}deserialize(e){if(void 0!==e.inputNodes){let t=e.meta.nodes;for(let s in e.inputNodes)if(Array.isArray(e.inputNodes[s])){let r=[];for(let i of e.inputNodes[s])r.push(t[i]);this[s]=r}else if("object"==typeof e.inputNodes[s]){let r={};for(let i in e.inputNodes[s]){let a=e.inputNodes[s][i];r[i]=t[a]}this[s]=r}else{let r=e.inputNodes[s];this[s]=t[r]}}}toJSON(e){let{uuid:t,type:s}=this,r=void 0===e||"string"==typeof e;r&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];function a(e){let t=[];for(let s in e){let r=e[s];delete r.metadata,t.push(r)}return t}if(void 0===i&&(i={uuid:t,type:s,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},!0!==r&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta),r){let t=a(e.textures),s=a(e.images),r=a(e.nodes);t.length>0&&(i.textures=t),s.length>0&&(i.images=s),r.length>0&&(i.nodes=r)}return i}}class R extends S{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){let t=this.node.build(e),s=this.indexNode.build(e,"uint");return`${t}[ ${s} ]`}}class C extends S{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){let t=this.node.getNodeType(e),s=null;for(let r of this.convertTo.split("|"))(null===s||e.getTypeLength(t)===e.getTypeLength(r))&&(s=r);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){let s=this.node,r=this.getNodeType(e),i=s.build(e,r);return e.format(i,r,t)}}class I extends S{static get type(){return"TempNode"}constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if("generate"===e.getBuildStage()){let s=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(void 0!==r.propertyName)return e.format(r.propertyName,s,t);if("void"!==s&&"void"!==t&&this.hasDependencies(e)){let i=super.build(e,s),a=e.getVarFromNode(this,null,s),n=e.getPropertyName(a);return e.addLineFlowCode(`${n} = ${i}`,this),r.snippet=i,r.propertyName=n,e.format(r.propertyName,s,t)}}return super.build(e,t)}}class E extends I{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return null!==this.nodeType?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,s)=>t+e.getTypeLength(s.getNodeType(e)),0))}generate(e,t){let s=this.getNodeType(e),r=this.nodes,i=e.getComponentType(s),a=[];for(let t of r){let s=t.build(e),r=e.getComponentType(t.getNodeType(e));r!==i&&(s=e.format(s,r,i)),a.push(s)}let n=`${e.getType(s)}( ${a.join(", ")} )`;return e.format(n,s,t)}}let L=M.join("");class O extends S{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(let t of this.components)e=Math.max(M.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){let s=this.node,r=e.getTypeLength(s.getNodeType(e)),i=null;if(r>1){let a=null;this.getVectorLength()>=r&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));let n=s.build(e,a);i=this.components.length===r&&this.components===L.slice(0,this.components.length)?e.format(n,a,t):e.format(`${n}.${this.components}`,this.getNodeType(e),t)}else i=s.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class z extends I{static get type(){return"SetNode"}constructor(e,t,s){super(),this.sourceNode=e,this.components=t,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){let{sourceNode:t,components:s,targetNode:r}=this,i=this.getNodeType(e),a=e.getTypeFromLength(s.length,r.getNodeType(e)),n=r.build(e,a),o=t.build(e,i),l=e.getTypeLength(i),u=[];for(let e=0;e<l;e++){let t=M[e];t===s[0]?(u.push(n),e+=s.length-1):u.push(o+"."+t)}return`${e.getType(i)}( ${u.join(", ")} )`}}class F extends I{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){let{components:t,sourceNode:s}=this,r=this.getNodeType(e),i=s.build(e),a=e.getVarFromNode(this),n=e.getPropertyName(a);e.addLineFlowCode(n+" = "+i,this);let o=e.getTypeLength(r),l=[],u=0;for(let e=0;e<o;e++){let s=M[e];s===t[u]?(l.push("1.0 - "+n+"."+s),u++):l.push(n+"."+s)}return`${e.getType(r)}( ${l.join(", ")} )`}}class D extends S{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return null===this.nodeType?y(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=y(this.value),e.nodeType=this.nodeType,"ArrayBuffer"===e.valueType&&(e.value=v(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?N(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}class P extends D{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){let s=this.getNodeType(e);return e.format(this.generateConst(e),s,t)}}let U=null,B=new Map;function k(e,t){if(B.has(e)){console.warn(`Redefinition of method chaining ${e}`);return}if("function"!=typeof t)throw Error(`Node element ${e} is not a function`);B.set(e,t)}let W=e=>e.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),G=e=>W(e).split("").sort().join(""),j={setup:(e,t)=>e(ec(t.shift()),...t),get(e,t,s){if("string"==typeof t&&void 0===e[t]){if(!0!==e.isStackNode&&"assign"===t)return(...e)=>(U.assign(s,...e),s);if(B.has(t)){let r=B.get(t);return e.isStackNode?(...e)=>s.add(r(...e)):(...e)=>r(s,...e)}if("self"===t)return e;if(t.endsWith("Assign")&&B.has(t.slice(0,t.length-6))){let r=B.get(t.slice(0,t.length-6));return e.isStackNode?(...e)=>s.assign(e[0],r(...e)):(...e)=>s.assign(r(s,...e))}else if(!0===/^[xyzwrgbastpq]{1,4}$/.test(t))return eh(new O(s,t=W(t)));else if(!0===/^set[XYZWRGBASTPQ]{1,4}$/.test(t))return t=G(t.slice(3).toLowerCase()),s=>eh(new z(e,t,s));else if(!0===/^flip[XYZWRGBASTPQ]{1,4}$/.test(t))return t=G(t.slice(4).toLowerCase()),()=>eh(new F(eh(e),t));else if("width"===t||"height"===t||"depth"===t)return"width"===t?t="x":"height"===t?t="y":"depth"===t&&(t="z"),eh(new O(e,t));else if(!0===/^\d+$/.test(t))return eh(new R(s,new P(Number(t),"uint")))}return Reflect.get(e,t,s)},set:(e,t,s,r)=>"string"==typeof t&&void 0===e[t]&&(!0===/^[xyzwrgbastpq]{1,4}$/.test(t)||"width"===t||"height"===t||"depth"===t||!0===/^\d+$/.test(t))?(r[t].assign(s),!0):Reflect.set(e,t,s,r)},H=new WeakMap,q=new WeakMap,$=function(e,t=null){let s=y(e);if("node"===s){let t=H.get(e);return void 0===t&&(t=new Proxy(e,j),H.set(e,t),H.set(t,t)),t}return null===t&&("float"===s||"boolean"===s)||s&&"shader"!==s&&"string"!==s?eh(en(e,t)):"shader"===s?ey(e):e},X=function(e,t=null){for(let s in e)e[s]=eh(e[s],t);return e},Y=function(e,t=null){let s=e.length;for(let r=0;r<s;r++)e[r]=eh(e[r],t);return e},Z=function(e,t=null,s=null,r=null){let i=e=>eh(null!==r?Object.assign(e,r):e);return null===t?(...t)=>i(new e(...em(t))):null!==s?(s=eh(s),(...r)=>i(new e(t,...em(r),s))):(...s)=>i(new e(t,...em(s)))},K=function(e,...t){return eh(new e(...em(t)))};class J extends S{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}call(e){let{shaderNode:t,inputNodes:s}=this,r=e.getNodeProperties(t);if(r.onceOutput)return r.onceOutput;let i=null;if(t.layout){let r=q.get(e.constructor);void 0===r&&(r=new WeakMap,q.set(e.constructor,r));let a=r.get(t);void 0===a&&(a=eh(e.buildFunctionNode(t)),r.set(t,a)),null!==e.currentFunctionNode&&e.currentFunctionNode.includes.push(a),i=eh(a.call(s))}else{let r=t.jsFunc;i=eh(null!==s?r(s,e):r(e))}return t.once&&(r.onceOutput=i),i}getOutputNode(e){let t=e.getNodeProperties(this);return null===t.outputNode&&(t.outputNode=this.setupOutput(e)),t.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){return this.getOutputNode(e).build(e,t)}}class Q extends S{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return ec(e),eh(new J(this,e))}setup(){return this.call()}}let ee=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],et=new Map;for(let e of[!1,!0])et.set(e,new P(e));let es=new Map;for(let e of[0,1,2,3])es.set(e,new P(e,"uint"));let er=new Map([...es].map(e=>new P(e.value,"int")));for(let e of[-1,-2])er.set(e,new P(e,"int"));let ei=new Map([...er].map(e=>new P(e.value)));for(let e of ee)ei.set(e,new P(e));for(let e of ee)ei.set(-e,new P(-e));let ea=new Map([...et,...ei]),en=(e,t)=>ea.has(e)?ea.get(e):!0===e.isNode?e:new P(e,t),eo=e=>{try{return e.getNodeType()}catch(e){return}},el=function(e,t=null){return(...s)=>{if((0===s.length||!["bool","float","int","uint"].includes(e)&&s.every(e=>"object"!=typeof e))&&(s=[N(e,...s)]),1===s.length&&null!==t&&t.has(s[0]))return eh(t.get(s[0]));if(1===s.length){let t=en(s[0],e);return eo(t)===e?eh(t):eh(new C(t,e))}return eh(new E(s.map(e=>en(e)),e))}},eu=e=>"object"==typeof e&&null!==e?e.value:e,ed=e=>null!=e?e.nodeType||e.convertTo||("string"==typeof e?e:null):null;function ep(e,t){return new Proxy(new Q(e,t),j)}let eh=(e,t=null)=>$(e,t),ec=(e,t=null)=>new X(e,t),em=(e,t=null)=>new Y(e,t),eg=(...e)=>new Z(...e),ef=(...e)=>new K(...e),ey=(e,t)=>{let s=new ep(e,t),r=(...e)=>{let t;return ec(e),t=e[0]&&e[0].isNode?[...e]:e[0],s.call(t)};return r.shaderNode=s,r.setLayout=e=>(s.setLayout(e),r),r.once=()=>(s.once=!0,r),r};k("toGlobal",e=>(e.global=!0,e));let eN=e=>{U=e},ev=()=>U,ex=(...e)=>U.If(...e);function eT(e){return U&&U.add(e),e}k("append",eT);let eb=new el("color"),ew=new el("float",ei),e_=new el("int",er),eV=new el("uint",es),eM=new el("bool",et),eA=new el("vec2"),eS=new el("ivec2"),eR=new el("uvec2"),eC=new el("bvec2"),eI=new el("vec3"),eE=new el("ivec3"),eL=new el("uvec3"),eO=new el("bvec3"),ez=new el("vec4"),eF=new el("ivec4"),eD=new el("uvec4"),eP=new el("bvec4"),eU=new el("mat2"),eB=new el("mat3"),ek=new el("mat4");k("toColor",eb),k("toFloat",ew),k("toInt",e_),k("toUint",eV),k("toBool",eM),k("toVec2",eA),k("toIVec2",eS),k("toUVec2",eR),k("toBVec2",eC),k("toVec3",eI),k("toIVec3",eE),k("toUVec3",eL),k("toBVec3",eO),k("toVec4",ez),k("toIVec4",eF),k("toUVec4",eD),k("toBVec4",eP),k("toMat2",eU),k("toMat3",eB),k("toMat4",ek);let eW=eg(R),eG=(e,t)=>eh(new C(eh(e),t));k("element",eW),k("convert",eG);class ej extends S{static get type(){return"UniformGroupNode"}constructor(e,t=!1,s=1){super("string"),this.name=e,this.version=0,this.shared=t,this.order=s,this.isUniformGroup=!0}set needsUpdate(e){!0===e&&this.version++}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}let eH=e=>new ej(e),eq=(e,t=0)=>new ej(e,!0,t),e$=eq("frame"),eX=eq("render"),eY=eH("object");class eZ extends D{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=eY}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){let s=this.getSelf();return e=e.bind(s),super.onUpdate(t=>{let r=e(t,s);void 0!==r&&(this.value=r)},t)}generate(e,t){let s=this.getNodeType(e),r=this.getUniformHash(e),i=e.getNodeFromHash(r);void 0===i&&(e.setHashNode(this,r),i=this);let a=i.getInputType(e),n=e.getUniformFromNode(i,a,e.shaderStage,this.name||e.context.label),o=e.getPropertyName(n);return void 0!==e.context.label&&delete e.context.label,e.format(o,s,t)}}let eK=(e,t)=>{let s=ed(t||e);return eh(new eZ(e&&!0===e.isNode?e.node&&e.node.value||e.value:e,s))};class eJ extends S{static get type(){return"PropertyNode"}constructor(e,t=null,s=!1){super(e),this.name=t,this.varying=s,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return!0===this.varying?(t=e.getVaryingFromNode(this,this.name)).needsInterpolation=!0:t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}let eQ=(e,t)=>eh(new eJ(e,t)),e0=(e,t)=>eh(new eJ(e,t,!0)),e1=ef(eJ,"vec4","DiffuseColor"),e2=ef(eJ,"vec3","EmissiveColor"),e3=ef(eJ,"float","Roughness"),e4=ef(eJ,"float","Metalness"),e5=ef(eJ,"float","Clearcoat"),e6=ef(eJ,"float","ClearcoatRoughness"),e9=ef(eJ,"vec3","Sheen"),e8=ef(eJ,"float","SheenRoughness"),e7=ef(eJ,"float","Iridescence"),te=ef(eJ,"float","IridescenceIOR"),tt=ef(eJ,"float","IridescenceThickness"),ts=ef(eJ,"float","AlphaT"),tr=ef(eJ,"float","Anisotropy"),ti=ef(eJ,"vec3","AnisotropyT"),ta=ef(eJ,"vec3","AnisotropyB"),tn=ef(eJ,"color","SpecularColor"),to=ef(eJ,"float","SpecularF90"),tl=ef(eJ,"float","Shininess"),tu=ef(eJ,"vec4","Output"),td=ef(eJ,"float","dashSize"),tp=ef(eJ,"float","gapSize"),th=ef(eJ,"float","pointWidth"),tc=ef(eJ,"float","IOR"),tm=ef(eJ,"float","Transmission"),tg=ef(eJ,"float","Thickness"),tf=ef(eJ,"float","AttenuationDistance"),ty=ef(eJ,"color","AttenuationColor"),tN=ef(eJ,"float","Dispersion");class tv extends I{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return"void"!==t?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){let{targetNode:t}=this;if(!1===e.isAvailable("swizzleAssign")&&t.isSplitNode&&t.components.length>1){let s=e.getTypeLength(t.node.getNodeType(e));return M.join("").slice(0,s)!==t.components}return!1}generate(e,t){let s;let{targetNode:r,sourceNode:i}=this,a=this.needsSplitAssign(e),n=r.getNodeType(e),o=r.context({assign:!0}).build(e),l=i.build(e,n),u=i.getNodeType(e),d=e.getDataFromNode(this);if(!0===d.initialized)"void"!==t&&(s=o);else if(a){let i=e.getVarFromNode(this,null,n),a=e.getPropertyName(i);e.addLineFlowCode(`${a} = ${l}`,this);let u=r.node.context({assign:!0}).build(e);for(let t=0;t<r.components.length;t++){let s=r.components[t];e.addLineFlowCode(`${u}.${s} = ${a}[ ${t} ]`,this)}"void"!==t&&(s=o)}else s=`${o} = ${l}`,("void"===t||"void"===u)&&(e.addLineFlowCode(s,this),"void"!==t&&(s=o));return d.initialized=!0,e.format(s,n,t)}}let tx=eg(tv);k("assign",tx);class tT extends I{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){let t=[],s=this.functionNode,r=s.getInputs(e),i=this.parameters,a=(t,s)=>{let r=s.type;return"pointer"===r?"&"+t.build(e):t.build(e,r)};if(Array.isArray(i))for(let e=0;e<i.length;e++)t.push(a(i[e],r[e]));else for(let e of r){let s=i[e.name];if(void 0!==s)t.push(a(s,e));else throw Error(`FunctionCallNode: Input '${e.name}' not found in FunctionNode.`)}let n=s.build(e,"property");return`${n}( ${t.join(", ")} )`}}let tb=(e,...t)=>(t=t.length>1||t[0]&&!0===t[0].isNode?em(t):ec(t[0]),eh(new tT(eh(e),t)));k("call",tb);class tw extends I{static get type(){return"OperatorNode"}constructor(e,t,s,...r){if(super(),r.length>0){let i=new tw(e,t,s);for(let t=0;t<r.length-1;t++)i=new tw(e,i,r[t]);t=i,s=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=s}getNodeType(e,t){let s=this.op,r=this.aNode,i=this.bNode,a=r.getNodeType(e),n=void 0!==i?i.getNodeType(e):null;if("void"===a||"void"===n)return"void";if("%"===s)return a;if("~"===s||"&"===s||"|"===s||"^"===s||">>"===s||"<<"===s)return e.getIntegerType(a);if("!"===s||"=="===s||"&&"===s||"||"===s||"^^"===s)return"bool";if("<"===s||">"===s||"<="===s||">="===s){let s=t?e.getTypeLength(t):Math.max(e.getTypeLength(a),e.getTypeLength(n));return s>1?`bvec${s}`:"bool"}return"float"===a&&e.isMatrix(n)?n:e.isMatrix(a)&&e.isVector(n)?e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(n)?e.getVectorFromMatrix(n):e.getTypeLength(n)>e.getTypeLength(a)?n:a}generate(e,t){let s=this.op,r=this.aNode,i=this.bNode,a=this.getNodeType(e,t),n=null,o=null;"void"!==a?(n=r.getNodeType(e),o=void 0!==i?i.getNodeType(e):null,"<"===s||">"===s||"<="===s||">="===s||"=="===s?e.isVector(n)?o=n:n!==o&&(n=o="float"):">>"===s||"<<"===s?(n=a,o=e.changeComponentType(o,"uint")):e.isMatrix(n)&&e.isVector(o)?o=e.getVectorFromMatrix(n):n=e.isVector(n)&&e.isMatrix(o)?e.getVectorFromMatrix(o):o=a):n=o=a;let l=r.build(e,n),u=void 0!==i?i.build(e,o):null,d=e.getTypeLength(t),p=e.getFunctionOperator(s);if("void"!==t){if("<"===s&&d>1)return e.useComparisonMethod?e.format(`${e.getMethod("lessThan",t)}( ${l}, ${u} )`,a,t):e.format(`( ${l} < ${u} )`,a,t);if("<="===s&&d>1)return e.useComparisonMethod?e.format(`${e.getMethod("lessThanEqual",t)}( ${l}, ${u} )`,a,t):e.format(`( ${l} <= ${u} )`,a,t);if(">"===s&&d>1)return e.useComparisonMethod?e.format(`${e.getMethod("greaterThan",t)}( ${l}, ${u} )`,a,t):e.format(`( ${l} > ${u} )`,a,t);if(">="===s&&d>1)return e.useComparisonMethod?e.format(`${e.getMethod("greaterThanEqual",t)}( ${l}, ${u} )`,a,t):e.format(`( ${l} >= ${u} )`,a,t);else if("!"===s||"~"===s)return e.format(`(${s}${l})`,n,t);else if(p)return e.format(`${p}( ${l}, ${u} )`,a,t);else return e.format(`( ${l} ${s} ${u} )`,a,t)}if("void"!==n)return p?e.format(`${p}( ${l}, ${u} )`,a,t):e.format(`${l} ${s} ${u}`,a,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}let t_=eg(tw,"+"),tV=eg(tw,"-"),tM=eg(tw,"*"),tA=eg(tw,"/"),tS=eg(tw,"%"),tR=eg(tw,"=="),tC=eg(tw,"!="),tI=eg(tw,"<"),tE=eg(tw,">"),tL=eg(tw,"<="),tO=eg(tw,">="),tz=eg(tw,"&&"),tF=eg(tw,"||"),tD=eg(tw,"!"),tP=eg(tw,"^^"),tU=eg(tw,"&"),tB=eg(tw,"~"),tk=eg(tw,"|"),tW=eg(tw,"^"),tG=eg(tw,"<<"),tj=eg(tw,">>");k("add",t_),k("sub",tV),k("mul",tM),k("div",tA),k("modInt",tS),k("equal",tR),k("notEqual",tC),k("lessThan",tI),k("greaterThan",tE),k("lessThanEqual",tL),k("greaterThanEqual",tO),k("and",tz),k("or",tF),k("not",tD),k("xor",tP),k("bitAnd",tU),k("bitNot",tB),k("bitOr",tk),k("bitXor",tW),k("shiftLeft",tG),k("shiftRight",tj);let tH=(...e)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),tS(...e));k("remainder",tH);class tq extends I{static get type(){return"MathNode"}constructor(e,t,s=null,r=null){super(),this.method=e,this.aNode=t,this.bNode=s,this.cNode=r}getInputType(e){let t=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(s)?0:e.getTypeLength(s),n=e.isMatrix(r)?0:e.getTypeLength(r);if(i>a&&i>n);else if(a>n)return s;else if(n>i)return r;return t}getNodeType(e){let t=this.method;return t===tq.LENGTH||t===tq.DISTANCE||t===tq.DOT?"float":t===tq.CROSS?"vec3":t===tq.ALL?"bool":t===tq.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):t===tq.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,t){let s=this.method,r=this.getNodeType(e),i=this.getInputType(e),a=this.aNode,n=this.bNode,o=this.cNode,l=!0===e.renderer.isWebGLRenderer;if(s===tq.TRANSFORM_DIRECTION){let s=a,r=n;return e.isMatrix(s.getNodeType(e))?r=ez(eI(r),0):s=ez(eI(s),0),se(tM(s,r).xyz).build(e,t)}if(s===tq.NEGATE)return e.format("( - "+a.build(e,i)+" )",r,t);if(s===tq.ONE_MINUS)return tV(1,a).build(e,t);{if(s===tq.RECIPROCAL)return tA(1,a).build(e,t);if(s===tq.DIFFERENCE)return sl(tV(a,n)).build(e,t);let u=[];return s===tq.CROSS||s===tq.MOD?u.push(a.build(e,r),n.build(e,r)):l&&s===tq.STEP?u.push(a.build(e,1===e.getTypeLength(a.getNodeType(e))?"float":i),n.build(e,i)):l&&(s===tq.MIN||s===tq.MAX)||s===tq.MOD?u.push(a.build(e,i),n.build(e,1===e.getTypeLength(n.getNodeType(e))?"float":i)):s===tq.REFRACT?u.push(a.build(e,i),n.build(e,i),o.build(e,"float")):s===tq.MIX?u.push(a.build(e,i),n.build(e,i),o.build(e,1===e.getTypeLength(o.getNodeType(e))?"float":i)):(u.push(a.build(e,i)),null!==n&&u.push(n.build(e,i)),null!==o&&u.push(o.build(e,i))),e.format(`${e.getMethod(s,r)}( ${u.join(", ")} )`,r,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}tq.ALL="all",tq.ANY="any",tq.EQUALS="equals",tq.RADIANS="radians",tq.DEGREES="degrees",tq.EXP="exp",tq.EXP2="exp2",tq.LOG="log",tq.LOG2="log2",tq.SQRT="sqrt",tq.INVERSE_SQRT="inversesqrt",tq.FLOOR="floor",tq.CEIL="ceil",tq.NORMALIZE="normalize",tq.FRACT="fract",tq.SIN="sin",tq.COS="cos",tq.TAN="tan",tq.ASIN="asin",tq.ACOS="acos",tq.ATAN="atan",tq.ABS="abs",tq.SIGN="sign",tq.LENGTH="length",tq.NEGATE="negate",tq.ONE_MINUS="oneMinus",tq.DFDX="dFdx",tq.DFDY="dFdy",tq.ROUND="round",tq.RECIPROCAL="reciprocal",tq.TRUNC="trunc",tq.FWIDTH="fwidth",tq.BITCAST="bitcast",tq.TRANSPOSE="transpose",tq.ATAN2="atan2",tq.MIN="min",tq.MAX="max",tq.MOD="mod",tq.STEP="step",tq.REFLECT="reflect",tq.DISTANCE="distance",tq.DIFFERENCE="difference",tq.DOT="dot",tq.CROSS="cross",tq.POW="pow",tq.TRANSFORM_DIRECTION="transformDirection",tq.MIX="mix",tq.CLAMP="clamp",tq.REFRACT="refract",tq.SMOOTHSTEP="smoothstep",tq.FACEFORWARD="faceforward";let t$=ew(1e-6),tX=ew(1e6),tY=ew(Math.PI),tZ=ew(2*Math.PI),tK=eg(tq,tq.ALL),tJ=eg(tq,tq.ANY),tQ=eg(tq,tq.EQUALS),t0=eg(tq,tq.RADIANS),t1=eg(tq,tq.DEGREES),t2=eg(tq,tq.EXP),t3=eg(tq,tq.EXP2),t4=eg(tq,tq.LOG),t5=eg(tq,tq.LOG2),t6=eg(tq,tq.SQRT),t9=eg(tq,tq.INVERSE_SQRT),t8=eg(tq,tq.FLOOR),t7=eg(tq,tq.CEIL),se=eg(tq,tq.NORMALIZE),st=eg(tq,tq.FRACT),ss=eg(tq,tq.SIN),sr=eg(tq,tq.COS),si=eg(tq,tq.TAN),sa=eg(tq,tq.ASIN),sn=eg(tq,tq.ACOS),so=eg(tq,tq.ATAN),sl=eg(tq,tq.ABS),su=eg(tq,tq.SIGN),sd=eg(tq,tq.LENGTH),sp=eg(tq,tq.NEGATE),sh=eg(tq,tq.ONE_MINUS),sc=eg(tq,tq.DFDX),sm=eg(tq,tq.DFDY),sg=eg(tq,tq.ROUND),sf=eg(tq,tq.RECIPROCAL),sy=eg(tq,tq.TRUNC),sN=eg(tq,tq.FWIDTH),sv=eg(tq,tq.BITCAST),sx=eg(tq,tq.TRANSPOSE),sT=eg(tq,tq.ATAN2),sb=eg(tq,tq.MIN),sw=eg(tq,tq.MAX),s_=eg(tq,tq.MOD),sV=eg(tq,tq.STEP),sM=eg(tq,tq.REFLECT),sA=eg(tq,tq.DISTANCE),sS=eg(tq,tq.DIFFERENCE),sR=eg(tq,tq.DOT),sC=eg(tq,tq.CROSS),sI=eg(tq,tq.POW),sE=eg(tq,tq.POW,2),sL=eg(tq,tq.POW,3),sO=eg(tq,tq.POW,4),sz=eg(tq,tq.TRANSFORM_DIRECTION),sF=e=>tM(su(e),sI(sl(e),1/3)),sD=e=>sR(e,e),sP=eg(tq,tq.MIX),sU=(e,t=0,s=1)=>eh(new tq(tq.CLAMP,eh(e),eh(t),eh(s))),sB=e=>sU(e),sk=eg(tq,tq.REFRACT),sW=eg(tq,tq.SMOOTHSTEP),sG=eg(tq,tq.FACEFORWARD),sj=ey(([e])=>st(ss(s_(sR(e.xy,eA(12.9898,78.233)),tY)).mul(43758.5453))),sH=(e,t,s)=>sP(t,s,e),sq=(e,t,s)=>sW(t,s,e);k("all",tK),k("any",tJ),k("equals",tQ),k("radians",t0),k("degrees",t1),k("exp",t2),k("exp2",t3),k("log",t4),k("log2",t5),k("sqrt",t6),k("inverseSqrt",t9),k("floor",t8),k("ceil",t7),k("normalize",se),k("fract",st),k("sin",ss),k("cos",sr),k("tan",si),k("asin",sa),k("acos",sn),k("atan",so),k("abs",sl),k("sign",su),k("length",sd),k("lengthSq",sD),k("negate",sp),k("oneMinus",sh),k("dFdx",sc),k("dFdy",sm),k("round",sg),k("reciprocal",sf),k("trunc",sy),k("fwidth",sN),k("atan2",sT),k("min",sb),k("max",sw),k("mod",s_),k("step",sV),k("reflect",sM),k("distance",sA),k("dot",sR),k("cross",sC),k("pow",sI),k("pow2",sE),k("pow3",sL),k("pow4",sO),k("transformDirection",sz),k("mix",sH),k("clamp",sU),k("refract",sk),k("smoothstep",sq),k("faceForward",sG),k("difference",sS),k("saturate",sB),k("cbrt",sF),k("transpose",sx),k("rand",sj);class s$ extends S{static get type(){return"ConditionalNode"}constructor(e,t,s=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=s}getNodeType(e){let t=this.ifNode.getNodeType(e);if(null!==this.elseNode){let s=this.elseNode.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(t))return s}return t}setup(e){let t=this.condNode.cache(),s=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,i=e.context.nodeBlock;e.getDataFromNode(s).parentNodeBlock=i,null!==r&&(e.getDataFromNode(r).parentNodeBlock=i);let a=e.getNodeProperties(this);a.condNode=t,a.ifNode=s.context({nodeBlock:s}),a.elseNode=r?r.context({nodeBlock:r}):null}generate(e,t){let s=this.getNodeType(e),r=e.getDataFromNode(this);if(void 0!==r.nodeProperty)return r.nodeProperty;let{condNode:i,ifNode:a,elseNode:n}=e.getNodeProperties(this),o="void"!==t,l=o?eQ(s).build(e):"";r.nodeProperty=l;let u=i.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${u} ) {

`).addFlowTab();let d=a.build(e,s);if(d&&(d=o?l+" = "+d+";":"return "+d+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+d+"\n\n"+e.tab+"}"),null!==n){e.addFlowCode(" else {\n\n").addFlowTab();let t=n.build(e,s);t&&(t=o?l+" = "+t+";":"return "+t+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+t+"\n\n"+e.tab+"}\n\n")}else e.addFlowCode("\n\n");return e.format(l,s,t)}}let sX=eg(s$);k("select",sX);let sY=(...e)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),sX(...e));k("cond",sY);class sZ extends S{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){let t=e.getContext();e.setContext({...e.context,...this.value});let s=this.node.build(e);return e.setContext(t),s}generate(e,t){let s=e.getContext();e.setContext({...e.context,...this.value});let r=this.node.build(e,t);return e.setContext(s),r}}let sK=eg(sZ),sJ=(e,t)=>sK(e,{label:t});k("context",sK),k("label",sJ);class sQ extends S{static get type(){return"VarNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){let{node:t,name:s}=this,r=e.getVarFromNode(this,s,e.getVectorType(this.getNodeType(e))),i=e.getPropertyName(r),a=t.build(e,r.type);return e.addLineFlowCode(`${i} = ${a}`,this),i}}let s0=eg(sQ);k("toVar",(...e)=>s0(...e).append());let s1=e=>(console.warn('TSL: "temp" is deprecated. Use ".toVar()" instead.'),s0(e));k("temp",s1);class s2 extends S{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){let t=e.getNodeProperties(this),s=t.varying;if(void 0===s){let r=this.name,i=this.getNodeType(e);t.varying=s=e.getVaryingFromNode(this,r,i),t.node=this.node}return s.needsInterpolation||(s.needsInterpolation="fragment"===e.shaderStage),s}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){let t=e.getNodeProperties(this),s=this.setupVarying(e);if(void 0===t.propertyName){let r=this.getNodeType(e),i=e.getPropertyName(s,T.VERTEX);e.flowNodeFromShaderStage(T.VERTEX,this.node,r,i),t.propertyName=i}return e.getPropertyName(s)}}let s3=eg(s2);k("varying",s3);let s4=ey(([e])=>sP(e.mul(.9478672986).add(.0521327014).pow(2.4),e.mul(.0773993808),e.lessThanEqual(.04045))).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),s5=ey(([e])=>sP(e.pow(.41666).mul(1.055).sub(.055),e.mul(12.92),e.lessThanEqual(.0031308))).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),s6="WorkingColorSpace",s9="OutputColorSpace";class s8 extends I{static get type(){return"ColorSpaceNode"}constructor(e,t,s){super("vec4"),this.colorNode=e,this.source=t,this.target=s}resolveColorSpace(e,t){return t===s6?n.epp.workingColorSpace:t===s9?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){let{colorNode:t}=this,s=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target),i=t;return!1!==n.epp.enabled&&s!==r&&s&&r&&(n.epp.getTransfer(s)===n.j17&&(i=ez(s4(i.rgb),i.a)),n.epp.getPrimaries(s)!==n.epp.getPrimaries(r)&&(i=ez(eB(n.epp._getMatrix(new n.Vkp,s,r)).mul(i.rgb),i.a)),n.epp.getTransfer(r)===n.j17&&(i=ez(s5(i.rgb),i.a))),i}}let s7=e=>eh(new s8(eh(e),s6,s9)),re=e=>eh(new s8(eh(e),s9,s6)),rt=(e,t)=>eh(new s8(eh(e),s6,t)),rs=(e,t)=>eh(new s8(eh(e),t,s6));k("toOutputColorSpace",s7),k("toWorkingColorSpace",re),k("workingToColorSpace",rt),k("colorSpaceToWorking",rs);let rr=class extends R{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){let t=super.generate(e),s=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,s,r)}};class ri extends S{static get type(){return"ReferenceBaseNode"}constructor(e,t,s=null,r=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=r,this.properties=e.split("."),this.reference=s,this.node=null,this.group=null,this.updateType=b.OBJECT}setGroup(e){return this.group=e,this}element(e){return eh(new rr(this,eh(e)))}setNodeType(e){let t=eK(null,e).getSelf();null!==this.group&&t.setGroup(this.group),this.node=t}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){let{properties:t}=this,s=e[t[0]];for(let e=1;e<t.length;e++)s=s[t[e]];return s}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);let e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}class ra extends ri{static get type(){return"RendererReferenceNode"}constructor(e,t,s=null){super(e,t,s),this.renderer=s,this.setGroup(eX)}updateReference(e){return this.reference=null!==this.renderer?this.renderer:e.renderer,this.reference}}let rn=(e,t,s)=>eh(new ra(e,t,s));class ro extends I{static get type(){return"ToneMappingNode"}constructor(e,t=ru,s=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=s}getCacheKey(){return h(super.getCacheKey(),this.toneMapping)}setup(e){let t=this.colorNode||e.context.color,s=this.toneMapping;if(s===n.uL9)return t;let r=null,i=e.renderer.library.getToneMappingFunction(s);return null!==i?r=ez(i(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),r=t),r}}let rl=(e,t,s)=>eh(new ro(e,eh(t),eh(s))),ru=rn("toneMappingExposure","float");k("toneMapping",(e,t,s)=>rl(t,s,e));class rd extends D{static get type(){return"BufferAttributeNode"}constructor(e,t=null,s=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=s,this.bufferOffset=r,this.usage=n.W2J,this.instanced=!1,this.attribute=null,this.global=!0,e&&!0===e.isBufferAttribute&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(0===this.bufferStride&&0===this.bufferOffset){let t=e.globalCache.getData(this.value);return void 0===t&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return null===this.bufferType&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(null!==this.attribute)return;let t=this.getNodeType(e),s=this.value,r=e.getTypeLength(t),i=this.bufferStride||r,a=this.bufferOffset,o=!0===s.isInterleavedBuffer?s:new n.vpT(s,i),l=new n.kB5(o,r,a);o.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){let t=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(s),i=null;return"vertex"===e.shaderStage||"compute"===e.shaderStage?(this.name=r,i=r):i=s3(this).build(e,t),i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}let rp=(e,t,s,r)=>eh(new rd(e,t,s,r)),rh=(e,t,s,r)=>rp(e,t,s,r).setUsage(n.dj0),rc=(e,t,s,r)=>rp(e,t,s,r).setInstanced(!0),rm=(e,t,s,r)=>rh(e,t,s,r).setInstanced(!0);k("toAttribute",e=>rp(e.value));class rg extends S{static get type(){return"ComputeNode"}constructor(e,t,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=b.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}updateDispatchCount(){let{count:e,workgroupSize:t}=this,s=t[0];for(let e=1;e<t.length;e++)s*=t[e];this.dispatchCount=Math.ceil(e/s)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}generate(e){let{shaderStage:t}=e;if("compute"===t){let t=this.computeNode.build(e,"void");""!==t&&e.addLineFlowCode(t,this)}}}let rf=(e,t,s)=>eh(new rg(eh(e),t,s));k("compute",rf);class ry extends S{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){return this.node.getNodeType(e)}build(e,...t){let s=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);let i=this.node.build(e,...t);return e.setCache(s),i}}let rN=(e,...t)=>eh(new ry(eh(e),...t));k("cache",rN);class rv extends S{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){let t=this.callNode.build(e,"void");return""!==t&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}let rx=eg(rv);k("bypass",rx);class rT extends S{static get type(){return"RemapNode"}constructor(e,t,s,r=ew(0),i=ew(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=s,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){let{node:e,inLowNode:t,inHighNode:s,outLowNode:r,outHighNode:i,doClamp:a}=this,n=e.sub(t).div(s.sub(t));return!0===a&&(n=n.clamp()),n.mul(i.sub(r)).add(r)}}let rb=eg(rT,null,null,{doClamp:!1}),rw=eg(rT);k("remap",rb),k("remapClamp",rw);class r_ extends S{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){let s=this.getNodeType(e),r=this.snippet;if("void"!==s)return e.format(`( ${r} )`,s,t);e.addLineFlowCode(r,this)}}let rV=eg(r_),rM=e=>(e?sX(e,rV("discard")):rV("discard")).append();k("discard",rM);class rA extends I{static get type(){return"RenderOutputNode"}constructor(e,t,s){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=s,this.isRenderOutput=!0}setup({context:e}){let t=this.colorNode||e.color,s=(null!==this.toneMapping?this.toneMapping:e.toneMapping)||n.uL9,r=(null!==this.outputColorSpace?this.outputColorSpace:e.outputColorSpace)||n.aCh;return s!==n.uL9&&(t=t.toneMapping(s)),r!==n.aCh&&r!==n.epp.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}let rS=(e,t=null,s=null)=>eh(new rA(eh(e),t,s));k("renderOutput",rS);class rR extends S{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(null===t){let s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){let r=e.geometry.getAttribute(s);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){let t=this.getAttributeName(e),s=this.getNodeType(e);if(!0!==e.hasGeometryAttribute(t))return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(s);{let r=e.geometry.getAttribute(t),i=e.getTypeFromAttribute(r),a=e.getAttribute(t,i);return"vertex"===e.shaderStage?e.format(a.name,i,s):s3(this).build(e,s)}}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}let rC=(e,t)=>eh(new rR(e,t)),rI=e=>rC("uv"+(e>0?e:""),"vec2");class rE extends S{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){let s=this.textureNode.build(e,"property"),r=null===this.levelNode?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${r} )`,this.getNodeType(e),t)}}let rL=eg(rE);class rO extends eZ{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=b.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){let e=this.texture,t=e.images,s=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(s&&void 0!==s.width){let{width:e,height:t}=s;this.value=Math.log2(Math.max(e,t))}}}let rz=eg(rO);class rF extends eZ{static get type(){return"TextureNode"}constructor(e,t=null,s=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=s,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=b.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(null===t)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":this.value.type===n.JQ4?"uvec4":this.value.type===n.Kz5?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return rI(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return null===this._matrixUniform&&(this._matrixUniform=eK(this.value.matrix)),this._matrixUniform.mul(eI(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?b.FRAME:b.NONE,this}setupUV(e,t){let s=this.value;return e.isFlipY()&&(s.image instanceof ImageBitmap&&!0===s.flipY||!0===s.isRenderTargetTexture||!0===s.isFramebufferTexture||!0===s.isDepthTexture)&&(t=this.sampler?t.flipY():t.setY(e_(rL(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){let t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;let s=this.uvNode;(null===s||!0===e.context.forceUVContext)&&e.context.getUV&&(s=e.context.getUV(this)),s||(s=this.getDefaultUV()),!0===this.updateMatrix&&(s=this.getTransformedUV(s)),s=this.setupUV(e,s);let r=this.levelNode;null===r&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),t.uvNode=s,t.levelNode=r,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,!0===this.sampler?"vec2":"ivec2")}generateSnippet(e,t,s,r,i,a,n,o){let l=this.value;return r?e.generateTextureLevel(l,t,s,r,a):i?e.generateTextureBias(l,t,s,i,a):o?e.generateTextureGrad(l,t,s,o,a):n?e.generateTextureCompare(l,t,s,n,a):!1===this.sampler?e.generateTextureLoad(l,t,s,a):e.generateTexture(l,t,s,a)}generate(e,t){let s=e.getNodeProperties(this),r=this.value;if(!r||!0!==r.isTexture)throw Error("TextureNode: Need a three.js texture.");let i=super.generate(e,"property");if("sampler"===t)return i+"_sampler";if(e.isReference(t))return i;{let a=e.getDataFromNode(this),n=a.propertyName;if(void 0===n){let{uvNode:t,levelNode:r,biasNode:o,compareNode:l,depthNode:u,gradNode:d}=s,p=this.generateUV(e,t),h=r?r.build(e,"float"):null,c=o?o.build(e,"float"):null,m=u?u.build(e,"int"):null,g=l?l.build(e,"float"):null,f=d?[d[0].build(e,"vec2"),d[1].build(e,"vec2")]:null,y=e.getVarFromNode(this);n=e.getPropertyName(y);let N=this.generateSnippet(e,i,p,h,c,m,g,f);e.addLineFlowCode(`${n} = ${N}`,this),a.snippet=N,a.propertyName=n}let o=n,l=this.getNodeType(e);return e.needsToWorkingColorSpace(r)&&(o=rs(rV(o,l),r.colorSpace).setup(e).build(e,l)),e.format(o,l,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){let t=this.clone();return t.uvNode=eh(e),t.referenceNode=this.getSelf(),eh(t)}blur(e){let t=this.clone();return t.biasNode=eh(e).mul(rz(t)),t.referenceNode=this.getSelf(),eh(t)}level(e){let t=this.clone();return t.levelNode=eh(e),t.referenceNode=this.getSelf(),eh(t)}size(e){return rL(this,e)}bias(e){let t=this.clone();return t.biasNode=eh(e),t.referenceNode=this.getSelf(),eh(t)}compare(e){let t=this.clone();return t.compareNode=eh(e),t.referenceNode=this.getSelf(),eh(t)}grad(e,t){let s=this.clone();return s.gradNode=[eh(e),eh(t)],s.referenceNode=this.getSelf(),eh(s)}depth(e){let t=this.clone();return t.depthNode=eh(e),t.referenceNode=this.getSelf(),eh(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){let e=this.value,t=this._matrixUniform;null!==t&&(t.value=e.matrix),!0===e.matrixAutoUpdate&&e.updateMatrix()}clone(){let e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}let rD=eg(rF),rP=(...e)=>rD(...e).setSampler(!1),rU=eK("float").label("cameraNear").setGroup(eX).onRenderUpdate(({camera:e})=>e.near),rB=eK("float").label("cameraFar").setGroup(eX).onRenderUpdate(({camera:e})=>e.far),rk=eK("mat4").label("cameraProjectionMatrix").setGroup(eX).onRenderUpdate(({camera:e})=>e.projectionMatrix),rW=eK("mat4").label("cameraProjectionMatrixInverse").setGroup(eX).onRenderUpdate(({camera:e})=>e.projectionMatrixInverse),rG=eK("mat4").label("cameraViewMatrix").setGroup(eX).onRenderUpdate(({camera:e})=>e.matrixWorldInverse),rj=eK("mat4").label("cameraWorldMatrix").setGroup(eX).onRenderUpdate(({camera:e})=>e.matrixWorld),rH=eK("mat3").label("cameraNormalMatrix").setGroup(eX).onRenderUpdate(({camera:e})=>e.normalMatrix),rq=eK(new n.Pa4).label("cameraPosition").setGroup(eX).onRenderUpdate(({camera:e},t)=>t.value.setFromMatrixPosition(e.matrixWorld));class r$ extends S{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=b.OBJECT,this._uniformNode=new eZ(null)}getNodeType(){let e=this.scope;return e===r$.WORLD_MATRIX?"mat4":e===r$.POSITION||e===r$.VIEW_POSITION||e===r$.DIRECTION||e===r$.SCALE?"vec3":void 0}update(e){let t=this.object3d,s=this._uniformNode,r=this.scope;if(r===r$.WORLD_MATRIX)s.value=t.matrixWorld;else if(r===r$.POSITION)s.value=s.value||new n.Pa4,s.value.setFromMatrixPosition(t.matrixWorld);else if(r===r$.SCALE)s.value=s.value||new n.Pa4,s.value.setFromMatrixScale(t.matrixWorld);else if(r===r$.DIRECTION)s.value=s.value||new n.Pa4,t.getWorldDirection(s.value);else if(r===r$.VIEW_POSITION){let r=e.camera;s.value=s.value||new n.Pa4,s.value.setFromMatrixPosition(t.matrixWorld),s.value.applyMatrix4(r.matrixWorldInverse)}}generate(e){let t=this.scope;return t===r$.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(t===r$.POSITION||t===r$.VIEW_POSITION||t===r$.DIRECTION||t===r$.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}r$.WORLD_MATRIX="worldMatrix",r$.POSITION="position",r$.SCALE="scale",r$.VIEW_POSITION="viewPosition",r$.DIRECTION="direction";let rX=eg(r$,r$.DIRECTION),rY=eg(r$,r$.WORLD_MATRIX),rZ=eg(r$,r$.POSITION),rK=eg(r$,r$.SCALE),rJ=eg(r$,r$.VIEW_POSITION);class rQ extends r${static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}let r0=ef(rQ,rQ.DIRECTION),r1=ef(rQ,rQ.WORLD_MATRIX),r2=ef(rQ,rQ.POSITION),r3=ef(rQ,rQ.SCALE),r4=ef(rQ,rQ.VIEW_POSITION),r5=eK(new n.Vkp).onObjectUpdate(({object:e},t)=>t.value.getNormalMatrix(e.matrixWorld)),r6=eK(new n.yGw).onObjectUpdate(({object:e},t)=>t.value.copy(e.matrixWorld).invert()),r9=rG.mul(r1).toVar("modelViewMatrix"),r8=ey(e=>(e.context.isHighPrecisionModelViewMatrix=!0,eK("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highPrecisionModelViewMatrix"),r7=ey(e=>{let t=e.context.isHighPrecisionModelViewMatrix;return eK("mat3").onObjectUpdate(({object:e,camera:s})=>(!0!==t&&e.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix)))}).once()().toVar("highPrecisionModelNormalMatrix"),ie=rC("position","vec3"),it=ie.varying("positionLocal"),is=ie.varying("positionPrevious"),ir=r1.mul(it).xyz.varying("v_positionWorld"),ii=it.transformDirection(r1).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),ia=r9.mul(it).xyz.varying("v_positionView"),io=ia.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class il extends S{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){let{renderer:t,material:s}=e;return t.coordinateSystem===n._RZ&&s.side===n._Li?"false":e.getFrontFacing()}}let iu=ef(il),id=ew(iu).mul(2).sub(1),ip=rC("normal","vec3"),ih=ey(e=>!1===e.geometry.hasAttribute("normal")?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),eI(0,1,0)):ip,"vec3").once()().toVar("normalLocal"),ic=ia.dFdx().cross(ia.dFdy()).normalize().toVar("normalFlat"),im=ey(e=>!0===e.material.flatShading?ic:s3(iT(ih),"v_normalView").normalize(),"vec3").once()().toVar("normalView"),ig=s3(im.transformDirection(rG),"v_normalWorld").normalize().toVar("normalWorld"),iy=ey(e=>e.context.setupNormal(),"vec3").once()().mul(id).toVar("transformedNormalView"),iN=iy.transformDirection(rG).toVar("transformedNormalWorld"),iv=ey(e=>e.context.setupClearcoatNormal(),"vec3").once()().mul(id).toVar("transformedClearcoatNormalView"),ix=ey(([e,t=r1])=>{let s=eB(t),r=e.div(eI(s[0].dot(s[0]),s[1].dot(s[1]),s[2].dot(s[2])));return s.mul(r).xyz}),iT=ey(([e],t)=>{let s=t.renderer.nodes.modelNormalViewMatrix;if(null!==s)return s.transformDirection(e);let r=r5.mul(e);return rG.transformDirection(r)}),ib=eK(0).onReference(({material:e})=>e).onRenderUpdate(({material:e})=>e.refractionRatio),iw=io.negate().reflect(iy),i_=io.negate().refract(iy,ib),iV=iw.transformDirection(rG).toVar("reflectVector"),iM=i_.transformDirection(rG).toVar("reflectVector");class iA extends rF{static get type(){return"CubeTextureNode"}constructor(e,t=null,s=null,r=null){super(e,t,s,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){let e=this.value;return e.mapping===n.fY$?iV:e.mapping===n.vxC?iM:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),eI(0,0,0))}setUpdateMatrix(){}setupUV(e,t){let s=this.value;return e.renderer.coordinateSystem!==n.JCZ&&s.isRenderTargetTexture?t:eI(t.x.negate(),t.yz)}generateUV(e,t){return t.build(e,"vec3")}}let iS=eg(iA);class iR extends eZ{static get type(){return"BufferNode"}constructor(e,t,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=s}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}let iC=(e,t,s)=>eh(new iR(e,t,s));class iI extends R{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){let t=super.generate(e),s=this.getNodeType();return e.format(t,"vec4",s)}}class iE extends iR{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null,"vec4"),this.array=e,this.elementType=t,this._elementType=null,this._elementLength=0,this.updateType=b.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){let{array:e,value:t}=this,s=this.getElementLength(),r=this.getElementType();if(1===s)for(let s=0;s<e.length;s++)t[4*s]=e[s];else if("color"===r)for(let s=0;s<e.length;s++){let r=4*s,i=e[s];t[r]=i.r,t[r+1]=i.g,t[r+2]=i.b||0}else for(let s=0;s<e.length;s++){let r=4*s,i=e[s];t[r]=i.x,t[r+1]=i.y,t[r+2]=i.z||0,t[r+3]=i.w||0}}setup(e){let t=this.array.length;this._elementType=null===this.elementType?y(this.array[0]):this.elementType,this._elementLength=e.getTypeLength(this._elementType);let s=Float32Array;return"i"===this._elementType.charAt(0)?s=Int32Array:"u"===this._elementType.charAt(0)&&(s=Uint32Array),this.value=new s(4*t),this.bufferCount=t,this.bufferType=e.changeComponentType("vec4",e.getComponentType(this._elementType)),super.setup(e)}element(e){return eh(new iI(this,eh(e)))}}let iL=(e,t)=>eh(new iE(e,t));class iO extends R{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){let t=super.generate(e),s=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,s,r)}}class iz extends S{static get type(){return"ReferenceNode"}constructor(e,t,s=null,r=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=r,this.properties=e.split("."),this.reference=s,this.node=null,this.group=null,this.name=null,this.updateType=b.OBJECT}element(e){return eh(new iO(this,eh(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;t=null!==this.count?iC(null,e,this.count):Array.isArray(this.getValueFromReference())?iL(null,e):"texture"===e?rD(null):"cubeTexture"===e?iS(null):eK(null,e),null!==this.group&&t.setGroup(this.group),null!==this.name&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){let{properties:t}=this,s=e[t[0]];for(let e=1;e<t.length;e++)s=s[t[e]];return s}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);let e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}let iF=(e,t,s)=>eh(new iz(e,t,s)),iD=(e,t,s,r)=>eh(new iz(e,t,r,s));class iP extends iz{static get type(){return"MaterialReferenceNode"}constructor(e,t,s=null){super(e,t,s),this.material=s,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=null!==this.material?this.material:e.material,this.reference}}let iU=(e,t,s)=>eh(new iP(e,t,s)),iB=ey(e=>(!1===e.geometry.hasAttribute("tangent")&&e.geometry.computeTangents(),rC("tangent","vec4")))(),ik=iB.xyz.toVar("tangentLocal"),iW=r9.mul(ez(ik,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),iG=iW.transformDirection(rG).varying("v_tangentWorld").normalize().toVar("tangentWorld"),ij=iW.toVar("transformedTangentView"),iH=ij.transformDirection(rG).normalize().toVar("transformedTangentWorld"),iq=s3(ip.cross(iB).mul(iB.w).xyz,"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),i$=s3(ih.cross(ik).mul(iB.w).xyz,"v_bitangentLocal").normalize().toVar("bitangentLocal"),iX=s3(im.cross(iW).mul(iB.w).xyz,"v_bitangentView").normalize().toVar("bitangentView"),iY=s3(ig.cross(iG).mul(iB.w).xyz,"v_bitangentWorld").normalize().toVar("bitangentWorld"),iZ=(0,iy.cross(ij).mul(iB.w).xyz).normalize().toVar("transformedBitangentView"),iK=iZ.transformDirection(rG).normalize().toVar("transformedBitangentWorld"),iJ=eB(iW,iX,im),iQ=io.mul(iJ),i0=sP(ta.cross(io).cross(ta).normalize(),iy,tr.mul(e3.oneMinus()).oneMinus().pow2().pow2()).normalize(),i1=ey(e=>{let{eye_pos:t,surf_norm:s,mapN:r,uv:i}=e,a=t.dFdx(),n=t.dFdy(),o=i.dFdx(),l=i.dFdy(),u=n.cross(s),d=s.cross(a),p=u.mul(o.x).add(d.mul(l.x)),h=u.mul(o.y).add(d.mul(l.y)),c=p.dot(p).max(h.dot(h)),m=id.mul(c.inverseSqrt());return t_(p.mul(r.x,m),h.mul(r.y,m),s.mul(r.z)).normalize()});class i2 extends I{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=n.IOt}setup(e){let{normalMapType:t,scaleNode:s}=this,r=this.node.mul(2).sub(1);null!==s&&(r=eI(r.xy.mul(s),r.z));let i=null;return t===n.PA7?i=iT(r):t===n.IOt&&(i=!0===e.hasGeometryAttribute("tangent")?iJ.mul(r).normalize():i1({eye_pos:ia,surf_norm:im,mapN:r,uv:rI()})),i}}let i3=eg(i2),i4=ey(({textureNode:e,bumpScale:t})=>{let s=t=>e.cache().context({getUV:e=>t(e.uvNode||rI()),forceUVContext:!0}),r=ew(s(e=>e));return eA(ew(s(e=>e.add(e.dFdx()))).sub(r),ew(s(e=>e.add(e.dFdy()))).sub(r)).mul(t)}),i5=ey(e=>{let{surf_pos:t,surf_norm:s,dHdxy:r}=e,i=t.dFdx().normalize(),a=t.dFdy().normalize().cross(s),n=s.cross(i),o=i.dot(a).mul(id),l=o.sign().mul(r.x.mul(a).add(r.y.mul(n)));return o.abs().mul(s).sub(l).normalize()});class i6 extends I{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){let e=null!==this.scaleNode?this.scaleNode:1;return i5({surf_pos:ia,surf_norm:im,dHdxy:i4({textureNode:this.textureNode,bumpScale:e})})}}let i9=eg(i6),i8=new Map;class i7 extends S{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let s=i8.get(e);return void 0===s&&(s=iU(e,t),i8.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache("map"===e?"map":e+"Map","texture")}setup(e){let t=e.context.material,s=this.scope,r=null;if(s===i7.COLOR){let e=void 0!==t.color?this.getColor(s):eI();r=t.map&&!0===t.map.isTexture?e.mul(this.getTexture("map")):e}else if(s===i7.OPACITY){let e=this.getFloat(s);r=t.alphaMap&&!0===t.alphaMap.isTexture?e.mul(this.getTexture("alpha")):e}else if(s===i7.SPECULAR_STRENGTH)r=t.specularMap&&!0===t.specularMap.isTexture?this.getTexture("specular").r:ew(1);else if(s===i7.SPECULAR_INTENSITY){let e=this.getFloat(s);r=t.specularMap?e.mul(this.getTexture(s).a):e}else if(s===i7.SPECULAR_COLOR){let e=this.getColor(s);r=t.specularColorMap&&!0===t.specularColorMap.isTexture?e.mul(this.getTexture(s).rgb):e}else if(s===i7.ROUGHNESS){let e=this.getFloat(s);r=t.roughnessMap&&!0===t.roughnessMap.isTexture?e.mul(this.getTexture(s).g):e}else if(s===i7.METALNESS){let e=this.getFloat(s);r=t.metalnessMap&&!0===t.metalnessMap.isTexture?e.mul(this.getTexture(s).b):e}else if(s===i7.EMISSIVE){let e=this.getFloat("emissiveIntensity"),i=this.getColor(s).mul(e);r=t.emissiveMap&&!0===t.emissiveMap.isTexture?i.mul(this.getTexture(s)):i}else if(s===i7.NORMAL)t.normalMap?(r=i3(this.getTexture("normal"),this.getCache("normalScale","vec2"))).normalMapType=t.normalMapType:r=t.bumpMap?i9(this.getTexture("bump").r,this.getFloat("bumpScale")):im;else if(s===i7.CLEARCOAT){let e=this.getFloat(s);r=t.clearcoatMap&&!0===t.clearcoatMap.isTexture?e.mul(this.getTexture(s).r):e}else if(s===i7.CLEARCOAT_ROUGHNESS){let e=this.getFloat(s);r=t.clearcoatRoughnessMap&&!0===t.clearcoatRoughnessMap.isTexture?e.mul(this.getTexture(s).r):e}else if(s===i7.CLEARCOAT_NORMAL)r=t.clearcoatNormalMap?i3(this.getTexture(s),this.getCache(s+"Scale","vec2")):im;else if(s===i7.SHEEN){let e=this.getColor("sheenColor").mul(this.getFloat("sheen"));r=t.sheenColorMap&&!0===t.sheenColorMap.isTexture?e.mul(this.getTexture("sheenColor").rgb):e}else if(s===i7.SHEEN_ROUGHNESS){let e=this.getFloat(s);r=(r=t.sheenRoughnessMap&&!0===t.sheenRoughnessMap.isTexture?e.mul(this.getTexture(s).a):e).clamp(.07,1)}else if(s===i7.ANISOTROPY){if(t.anisotropyMap&&!0===t.anisotropyMap.isTexture){let e=this.getTexture(s);r=eU(aD.x,aD.y,aD.y.negate(),aD.x).mul(e.rg.mul(2).sub(eA(1)).normalize().mul(e.b))}else r=aD}else if(s===i7.IRIDESCENCE_THICKNESS){let e=iF("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){let i=iF("0","float",t.iridescenceThicknessRange);r=e.sub(i).mul(this.getTexture(s).g).add(i)}else r=e}else if(s===i7.TRANSMISSION){let e=this.getFloat(s);r=t.transmissionMap?e.mul(this.getTexture(s).r):e}else if(s===i7.THICKNESS){let e=this.getFloat(s);r=t.thicknessMap?e.mul(this.getTexture(s).g):e}else if(s===i7.IOR)r=this.getFloat(s);else if(s===i7.LIGHT_MAP)r=this.getTexture(s).rgb.mul(this.getFloat("lightMapIntensity"));else if(s===i7.AO_MAP)r=this.getTexture(s).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{let t=this.getNodeType(e);r=this.getCache(s,t)}return r}}i7.ALPHA_TEST="alphaTest",i7.COLOR="color",i7.OPACITY="opacity",i7.SHININESS="shininess",i7.SPECULAR="specular",i7.SPECULAR_STRENGTH="specularStrength",i7.SPECULAR_INTENSITY="specularIntensity",i7.SPECULAR_COLOR="specularColor",i7.REFLECTIVITY="reflectivity",i7.ROUGHNESS="roughness",i7.METALNESS="metalness",i7.NORMAL="normal",i7.CLEARCOAT="clearcoat",i7.CLEARCOAT_ROUGHNESS="clearcoatRoughness",i7.CLEARCOAT_NORMAL="clearcoatNormal",i7.EMISSIVE="emissive",i7.ROTATION="rotation",i7.SHEEN="sheen",i7.SHEEN_ROUGHNESS="sheenRoughness",i7.ANISOTROPY="anisotropy",i7.IRIDESCENCE="iridescence",i7.IRIDESCENCE_IOR="iridescenceIOR",i7.IRIDESCENCE_THICKNESS="iridescenceThickness",i7.IOR="ior",i7.TRANSMISSION="transmission",i7.THICKNESS="thickness",i7.ATTENUATION_DISTANCE="attenuationDistance",i7.ATTENUATION_COLOR="attenuationColor",i7.LINE_SCALE="scale",i7.LINE_DASH_SIZE="dashSize",i7.LINE_GAP_SIZE="gapSize",i7.LINE_WIDTH="linewidth",i7.LINE_DASH_OFFSET="dashOffset",i7.POINT_WIDTH="pointWidth",i7.DISPERSION="dispersion",i7.LIGHT_MAP="light",i7.AO_MAP="ao";let ae=ef(i7,i7.ALPHA_TEST),at=ef(i7,i7.COLOR),as=ef(i7,i7.SHININESS),ar=ef(i7,i7.EMISSIVE),ai=ef(i7,i7.OPACITY),aa=ef(i7,i7.SPECULAR),an=ef(i7,i7.SPECULAR_INTENSITY),ao=ef(i7,i7.SPECULAR_COLOR),al=ef(i7,i7.SPECULAR_STRENGTH),au=ef(i7,i7.REFLECTIVITY),ad=ef(i7,i7.ROUGHNESS),ap=ef(i7,i7.METALNESS),ah=ef(i7,i7.NORMAL).context({getUV:null}),ac=ef(i7,i7.CLEARCOAT),am=ef(i7,i7.CLEARCOAT_ROUGHNESS),ag=ef(i7,i7.CLEARCOAT_NORMAL).context({getUV:null}),af=ef(i7,i7.ROTATION),ay=ef(i7,i7.SHEEN),aN=ef(i7,i7.SHEEN_ROUGHNESS),av=ef(i7,i7.ANISOTROPY),ax=ef(i7,i7.IRIDESCENCE),aT=ef(i7,i7.IRIDESCENCE_IOR),ab=ef(i7,i7.IRIDESCENCE_THICKNESS),aw=ef(i7,i7.TRANSMISSION),a_=ef(i7,i7.THICKNESS),aV=ef(i7,i7.IOR),aM=ef(i7,i7.ATTENUATION_DISTANCE),aA=ef(i7,i7.ATTENUATION_COLOR),aS=ef(i7,i7.LINE_SCALE),aR=ef(i7,i7.LINE_DASH_SIZE),aC=ef(i7,i7.LINE_GAP_SIZE),aI=ef(i7,i7.LINE_WIDTH),aE=ef(i7,i7.LINE_DASH_OFFSET),aL=ef(i7,i7.POINT_WIDTH),aO=ef(i7,i7.DISPERSION),az=ef(i7,i7.LIGHT_MAP),aF=ef(i7,i7.AO_MAP),aD=eK(new n.FM8).onReference(function(e){return e.material}).onRenderUpdate(function({material:e}){this.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation))});class aP extends I{static get type(){return"ModelViewProjectionNode"}constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if("fragment"===e.shaderStage)return s3(e.context.mvp);let t=this.positionNode||it,s=e.renderer.nodes.modelViewMatrix||r9;return rk.mul(s).mul(t)}}let aU=eg(aP);class aB extends S{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){let t;let s=this.getNodeType(e),r=this.scope;if(r===aB.VERTEX)t=e.getVertexIndex();else if(r===aB.INSTANCE)t=e.getInstanceIndex();else if(r===aB.DRAW)t=e.getDrawIndex();else if(r===aB.INVOCATION_LOCAL)t=e.getInvocationLocalIndex();else if(r===aB.INVOCATION_SUBGROUP)t=e.getInvocationSubgroupIndex();else if(r===aB.SUBGROUP)t=e.getSubgroupIndex();else throw Error("THREE.IndexNode: Unknown scope: "+r);return"vertex"===e.shaderStage||"compute"===e.shaderStage?t:s3(this).build(e,s)}}aB.VERTEX="vertex",aB.INSTANCE="instance",aB.SUBGROUP="subgroup",aB.INVOCATION_LOCAL="invocationLocal",aB.INVOCATION_SUBGROUP="invocationSubgroup",aB.DRAW="draw";let ak=ef(aB,aB.VERTEX),aW=ef(aB,aB.INSTANCE),aG=ef(aB,aB.SUBGROUP),aj=ef(aB,aB.INVOCATION_SUBGROUP),aH=ef(aB,aB.INVOCATION_LOCAL),aq=ef(aB,aB.DRAW);class a$ extends S{static get type(){return"InstanceNode"}constructor(e,t,s){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=s,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=b.FRAME,this.buffer=null,this.bufferColor=null}setup(e){let{count:t,instanceMatrix:s,instanceColor:r}=this,{instanceMatrixNode:i,instanceColorNode:a}=this;if(null===i){if(t<=1e3)i=iC(s.array,"mat4",Math.max(t,1)).element(aW);else{let e=new n.$TI(s.array,16,1);this.buffer=e;let t=s.usage===n.dj0?rm:rc;i=ek(t(e,"vec4",16,0),t(e,"vec4",16,4),t(e,"vec4",16,8),t(e,"vec4",16,12))}this.instanceMatrixNode=i}if(r&&null===a){let e=new n.lb7(r.array,3),t=r.usage===n.dj0?rm:rc;this.bufferColor=e,a=eI(t(e,"vec3",3,0)),this.instanceColorNode=a}let o=i.mul(it).xyz;if(it.assign(o),e.hasGeometryAttribute("normal")){let e=ix(ih,i);ih.assign(e)}null!==this.instanceColorNode&&e0("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==n.dj0&&null!=this.buffer&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==n.dj0&&null!=this.bufferColor&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}let aX=eg(a$);class aY extends a${static get type(){return"InstancedMeshNode"}constructor(e){let{count:t,instanceMatrix:s,instanceColor:r}=e;super(t,s,r),this.instanceMesh=e}}let aZ=eg(aY);class aK extends S{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){null===this.batchingIdNode&&(null===e.getDrawIndex()?this.batchingIdNode=aW:this.batchingIdNode=aq);let t=ey(([e])=>{let t=rL(rP(this.batchMesh._indirectTexture),0),s=e_(e).modInt(e_(t)),r=e_(e).div(e_(t));return rP(this.batchMesh._indirectTexture,eS(s,r)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(e_(this.batchingIdNode)),s=this.batchMesh._matricesTexture,r=rL(rP(s),0),i=ew(t).mul(4).toInt().toVar(),a=i.modInt(r),n=i.div(e_(r)),o=ek(rP(s,eS(a,n)),rP(s,eS(a.add(1),n)),rP(s,eS(a.add(2),n)),rP(s,eS(a.add(3),n))),l=this.batchMesh._colorsTexture;if(null!==l){let e=ey(([e])=>{let t=rL(rP(l),0).x;return rP(l,eS(e.modInt(t),e.div(t))).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(t);e0("vec3","vBatchColor").assign(e)}let u=eB(o);it.assign(o.mul(it));let d=ih.div(eI(u[0].dot(u[0]),u[1].dot(u[1]),u[2].dot(u[2]))),p=u.mul(d).xyz;ih.assign(p),e.hasGeometryAttribute("tangent")&&ik.mulAssign(u)}}let aJ=eg(aK),aQ=new WeakMap;class a0 extends S{static get type(){return"SkinningNode"}constructor(e,t=!1){let s,r,i;super("void"),this.skinnedMesh=e,this.useReference=t,this.updateType=b.OBJECT,this.skinIndexNode=rC("skinIndex","uvec4"),this.skinWeightNode=rC("skinWeight","vec4"),t?(s=iF("bindMatrix","mat4"),r=iF("bindMatrixInverse","mat4"),i=iD("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(s=eK(e.bindMatrix,"mat4"),r=eK(e.bindMatrixInverse,"mat4"),i=iC(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=s,this.bindMatrixInverseNode=r,this.boneMatricesNode=i,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=it){let{skinIndexNode:s,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:a}=this,n=e.element(s.x),o=e.element(s.y),l=e.element(s.z),u=e.element(s.w),d=i.mul(t),p=t_(n.mul(r.x).mul(d),o.mul(r.y).mul(d),l.mul(r.z).mul(d),u.mul(r.w).mul(d));return a.mul(p).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=ih){let{skinIndexNode:s,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:a}=this,n=e.element(s.x),o=e.element(s.y),l=e.element(s.z),u=e.element(s.w),d=t_(r.x.mul(n),r.y.mul(o),r.z.mul(l),r.w.mul(u));return(d=a.mul(d).mul(i)).transformDirection(t).xyz}getPreviousSkinnedPosition(e){let t=e.object;return null===this.previousBoneMatricesNode&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=iD("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,is)}needsPreviousBoneMatrices(e){let t=e.renderer.getMRT();return t&&t.has("velocity")}setup(e){this.needsPreviousBoneMatrices(e)&&is.assign(this.getPreviousSkinnedPosition(e));let t=this.getSkinnedPosition();if(it.assign(t),e.hasGeometryAttribute("normal")){let t=this.getSkinnedNormal();ih.assign(t),e.hasGeometryAttribute("tangent")&&ik.assign(t)}}generate(e,t){if("void"!==t)return it.build(e,t)}update(e){let t=(this.useReference?e.object:this.skinnedMesh).skeleton;aQ.get(t)!==e.frameId&&(aQ.set(t,e.frameId),null!==this.previousBoneMatricesNode&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}let a1=e=>eh(new a0(e,!0));class a2 extends S{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt()+e)}getProperties(e){let t=e.getNodeProperties(this);if(void 0!==t.stackNode)return t;let s={};for(let e=0,t=this.params.length-1;e<t;e++){let t=this.params[e],r=!0!==t.isNode&&t.name||this.getVarName(e),i=!0!==t.isNode&&t.type||"int";s[r]=rV(r,i)}let r=e.addStack();return t.returnsNode=this.params[this.params.length-1](s,r,e),t.stackNode=r,e.removeStack(),t}getNodeType(e){let{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){let t=this.getProperties(e),s=this.params,r=t.stackNode;for(let t=0,r=s.length-1;t<r;t++){let r=s[t],i=null,a=null,n=null,o=null,l=null,u=null;r.isNode?(o="int",n=this.getVarName(t),i="0",a=r.build(e,o),l="<"):(o=r.type||"int",n=r.name||this.getVarName(t),i=r.start,a=r.end,l=r.condition,u=r.update,"number"==typeof i?i=e.generateConst(o,i):i&&i.isNode&&(i=i.build(e,o)),"number"==typeof a?a=e.generateConst(o,a):a&&a.isNode&&(a=a.build(e,o)),void 0!==i&&void 0===a?(i+=" - 1",a="0",l=">="):void 0!==a&&void 0===i&&(i="0",l="<"),void 0===l&&(l=Number(i)>Number(a)?">=":"<"));let d={start:i,end:a},p=d.start,h=d.end,c="",m="",g="";u||(u="int"===o||"uint"===o?l.includes("<")?"++":"--":l.includes("<")?"+= 1.":"-= 1."),c+=e.getVar(o,n)+" = "+p,m+=n+" "+l+" "+h,g+=n+" "+u;let f=`for ( ${c}; ${m}; ${g} )`;e.addFlowCode((0===t?"\n":"")+e.tab+f+" {\n\n").addFlowTab()}let i=r.build(e,"void"),a=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode("\n"+e.tab+i);for(let t=0,s=this.params.length-1;t<s;t++)e.addFlowCode((0===t?"":e.tab)+"}\n\n").removeFlowTab();return e.addFlowTab(),a}}let a3=(...e)=>eh(new a2(em(e,"int"))).append(),a4=()=>rV("break").append(),a5=new WeakMap,a6=new n.Ltg,a9=ey(({bufferMap:e,influence:t,stride:s,width:r,depth:i,offset:a})=>{let n=e_(ak).mul(s).add(a),o=n.div(r);return rP(e,eS(n.sub(o.mul(r)),o)).depth(i).mul(t)});class a8 extends S{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=eK(1),this.updateType=b.OBJECT}setup(e){let{geometry:t}=e,s=void 0!==t.morphAttributes.position,r=t.hasAttribute("normal")&&void 0!==t.morphAttributes.normal,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,a=void 0!==i?i.length:0,{texture:o,stride:l,size:u}=function(e){let t=void 0!==e.morphAttributes.position,s=void 0!==e.morphAttributes.normal,r=void 0!==e.morphAttributes.color,i=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,a=void 0!==i?i.length:0,o=a5.get(e);if(void 0===o||o.count!==a){void 0!==o&&o.texture.dispose();let i=e.morphAttributes.position||[],l=e.morphAttributes.normal||[],u=e.morphAttributes.color||[],d=0;!0===t&&(d=1),!0===s&&(d=2),!0===r&&(d=3);let p=e.attributes.position.count*d,h=1;p>4096&&(h=Math.ceil(p/4096),p=4096);let c=new Float32Array(p*h*4*a),m=new n.p3g(c,p,h,a);m.type=n.VzW,m.needsUpdate=!0;let g=4*d;for(let e=0;e<a;e++){let a=i[e],n=l[e],o=u[e],d=p*h*4*e;for(let e=0;e<a.count;e++){let i=e*g;!0===t&&(a6.fromBufferAttribute(a,e),c[d+i+0]=a6.x,c[d+i+1]=a6.y,c[d+i+2]=a6.z,c[d+i+3]=0),!0===s&&(a6.fromBufferAttribute(n,e),c[d+i+4]=a6.x,c[d+i+5]=a6.y,c[d+i+6]=a6.z,c[d+i+7]=0),!0===r&&(a6.fromBufferAttribute(o,e),c[d+i+8]=a6.x,c[d+i+9]=a6.y,c[d+i+10]=a6.z,c[d+i+11]=4===o.itemSize?a6.w:1)}}o={count:a,texture:m,stride:d,size:new n.FM8(p,h)},a5.set(e,o),e.addEventListener("dispose",function t(){m.dispose(),a5.delete(e),e.removeEventListener("dispose",t)})}return o}(t);!0===s&&it.mulAssign(this.morphBaseInfluence),!0===r&&ih.mulAssign(this.morphBaseInfluence);let d=e_(u.width);a3(a,({i:e})=>{let t=ew(0).toVar();this.mesh.count>1&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?t.assign(rP(this.mesh.morphTexture,eS(e_(e).add(1),e_(aW))).r):t.assign(iF("morphTargetInfluences","float").element(e).toVar()),!0===s&&it.addAssign(a9({bufferMap:o,influence:t,stride:l,width:d,depth:e,offset:e_(0)})),!0===r&&ih.addAssign(a9({bufferMap:o,influence:t,stride:l,width:d,depth:e,offset:e_(1)}))})}update(){let e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((e,t)=>e+t,0)}}let a7=eg(a8);class ne extends S{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}generate(){console.warn("Abstract function.")}}class nt extends ne{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class ns extends sZ{static get type(){return"LightingContextNode"}constructor(e,t=null,s=null,r=null){super(e),this.lightingModel=t,this.backdropNode=s,this.backdropAlphaNode=r,this._value=null}getContext(){let{backdropNode:e,backdropAlphaNode:t}=this,s=eI().toVar("directDiffuse"),r=eI().toVar("directSpecular"),i=eI().toVar("indirectDiffuse"),a=eI().toVar("indirectSpecular");return{radiance:eI().toVar("radiance"),irradiance:eI().toVar("irradiance"),iblIrradiance:eI().toVar("iblIrradiance"),ambientOcclusion:ew(1).toVar("ambientOcclusion"),reflectedLight:{directDiffuse:s,directSpecular:r,indirectDiffuse:i,indirectSpecular:a},backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}let nr=eg(ns);class ni extends ne{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}class na extends S{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===na.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=b.NONE;return(this.scope===na.SIZE||this.scope===na.VIEWPORT)&&(e=b.RENDER),this.updateType=e,e}update({renderer:e}){let t=e.getRenderTarget();this.scope===na.VIEWPORT?null!==t?i.copy(t.viewport):(e.getViewport(i),i.multiplyScalar(e.getPixelRatio())):null!==t?(r.width=t.width,r.height=t.height):e.getDrawingBufferSize(r)}setup(){let e=this.scope;return e===na.SIZE?eK(r||(r=new n.FM8)):e===na.VIEWPORT?eK(i||(i=new n.Ltg)):eA(nl.div(no))}generate(e){if(this.scope===na.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){let s=e.getNodeProperties(no).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${s}.y - ${t}.y )`}return t}return super.generate(e)}}na.COORDINATE="coordinate",na.VIEWPORT="viewport",na.SIZE="size",na.UV="uv";let nn=ef(na,na.UV),no=ef(na,na.SIZE),nl=ef(na,na.COORDINATE),nu=ef(na,na.VIEWPORT),nd=nu.zw,np=nl.sub(nu.xy),nh=np.div(nd),nc=ey(()=>(console.warn('TSL.ViewportNode: "viewportResolution" is deprecated. Use "screenSize" instead.'),no),"vec2").once()(),nm=ey(()=>(console.warn('TSL.ViewportNode: "viewportTopLeft" is deprecated. Use "screenUV" instead.'),nn),"vec2").once()(),ng=ey(()=>(console.warn('TSL.ViewportNode: "viewportBottomLeft" is deprecated. Use "screenUV.flipY()" instead.'),nn.flipY()),"vec2").once()(),nf=new n.FM8;class ny extends rF{static get type(){return"ViewportTextureNode"}constructor(e=nn,t=null,s=null){null===s&&((s=new n.Wzm).minFilter=n.D1R),super(s,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=b.FRAME}updateBefore(e){let t=e.renderer;t.getDrawingBufferSize(nf);let s=this.value;(s.image.width!==nf.width||s.image.height!==nf.height)&&(s.image.width=nf.width,s.image.height=nf.height,s.needsUpdate=!0);let r=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=r}clone(){let e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}let nN=eg(ny),nv=eg(ny,null,null,{generateMipmaps:!0}),nx=null;class nT extends ny{static get type(){return"ViewportDepthTextureNode"}constructor(e=nn,t=null){null===nx&&(nx=new n.$YQ),super(e,t,nx)}}let nb=eg(nT);class nw extends S{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){let{scope:t}=this;return t===nw.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){let{scope:t}=this,s=this.valueNode,r=null;return t===nw.DEPTH_BASE?null!==s&&(r=nS().assign(s)):t===nw.DEPTH?r=e.isPerspectiveCamera?nV(ia.z,rU,rB):n_(ia.z,rU,rB):t===nw.LINEAR_DEPTH&&(r=null!==s?e.isPerspectiveCamera?n_(nM(s,rU,rB),rU,rB):s:n_(ia.z,rU,rB)),r}}nw.DEPTH_BASE="depthBase",nw.DEPTH="depth",nw.LINEAR_DEPTH="linearDepth";let n_=(e,t,s)=>e.add(t).div(t.sub(s)),nV=(e,t,s)=>t.add(e).mul(s).div(s.sub(t).mul(e)),nM=(e,t,s)=>t.mul(s).div(s.sub(t).mul(e).sub(s)),nA=(e,t,s)=>{t=t.max(1e-6).toVar();let r=t5(e.negate().div(t)),i=t5(s.div(t));return r.div(i)},nS=eg(nw,nw.DEPTH_BASE),nR=ef(nw,nw.DEPTH),nC=eg(nw,nw.LINEAR_DEPTH),nI=nC(nb());nR.assign=e=>nS(e);class nE extends S{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}let nL=eg(nE);class nO extends S{static get type(){return"ClippingNode"}constructor(e=nO.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);let{intersectionPlanes:t,unionPlanes:s}=e.clippingContext;return(this.hardwareClipping=e.material.hardwareClipping,this.scope===nO.ALPHA_TO_COVERAGE)?this.setupAlphaToCoverage(t,s):this.scope===nO.HARDWARE?this.setupHardwareClipping(s,e):this.setupDefault(t,s)}setupAlphaToCoverage(e,t){return ey(()=>{let s=ew().toVar("distanceToPlane"),r=ew().toVar("distanceToGradient"),i=ew(1).toVar("clipOpacity"),a=t.length;if(!this.hardwareClipping&&a>0){let e=iL(t);a3(a,({i:t})=>{let a=e.element(t);s.assign(ia.dot(a.xyz).negate().add(a.w)),r.assign(s.fwidth().div(2)),i.mulAssign(sW(r.negate(),r,s))})}let n=e.length;if(n>0){let t=iL(e),a=ew(1).toVar("intersectionClipOpacity");a3(n,({i:e})=>{let i=t.element(e);s.assign(ia.dot(i.xyz).negate().add(i.w)),r.assign(s.fwidth().div(2)),a.mulAssign(sW(r.negate(),r,s).oneMinus())}),i.mulAssign(a.oneMinus())}e1.a.mulAssign(i),e1.a.equal(0).discard()})()}setupDefault(e,t){return ey(()=>{let s=t.length;if(!this.hardwareClipping&&s>0){let e=iL(t);a3(s,({i:t})=>{let s=e.element(t);ia.dot(s.xyz).greaterThan(s.w).discard()})}let r=e.length;if(r>0){let t=iL(e),s=eM(!0).toVar("clipped");a3(r,({i:e})=>{let r=t.element(e);s.assign(ia.dot(r.xyz).greaterThan(r.w).and(s))}),s.discard()}})()}setupHardwareClipping(e,t){let s=e.length;return t.enableHardwareClipping(s),ey(()=>{let r=iL(e),i=nL(t.getClipDistance());a3(s,({i:e})=>{let t=r.element(e),s=ia.dot(t.xyz).sub(t.w).negate();i.element(e).assign(s)})})()}}nO.ALPHA_TO_COVERAGE="alphaToCoverage",nO.DEFAULT="default",nO.HARDWARE="hardware";let nz=()=>eh(new nO),nF=()=>eh(new nO(nO.ALPHA_TO_COVERAGE)),nD=()=>eh(new nO(nO.HARDWARE)),nP=ey(([e])=>st(tM(1e4,ss(tM(17,e.x).add(tM(.1,e.y)))).mul(t_(.1,sl(ss(tM(13,e.y).add(e.x))))))),nU=ey(([e])=>nP(eA(nP(e.xy),e.z))),nB=ey(([e])=>{let t=sw(sd(sc(e.xyz)),sd(sm(e.xyz))),s=ew(1).div(ew(.05).mul(t)).toVar("pixScale"),r=eA(t3(t8(t5(s))),t3(t7(t5(s)))),i=eA(nU(t8(r.x.mul(e.xyz))),nU(t8(r.y.mul(e.xyz)))),a=st(t5(s)),n=t_(tM(a.oneMinus(),i.x),tM(a,i.y)),o=sb(a,a.oneMinus()),l=eI(n.mul(n).div(tM(2,o).mul(tV(1,o))),n.sub(tM(.5,o)).div(tV(1,o)),tV(1,tV(1,n).mul(tV(1,n)).div(tM(2,o).mul(tV(1,o)))));return sU(n.lessThan(o.oneMinus()).select(n.lessThan(o).select(l.x,l.y),l.z),1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class nk extends n.F5T{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.forceSinglePass=!1,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+c(this)}build(e){this.setup(e)}setupObserver(e){return new l(e)}setup(e){let t;e.context.setupNormal=()=>this.setupNormal(e);let s=e.renderer,r=s.getRenderTarget();e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),null!==this.geometryNode&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let i=this.setupClipping(e);if(!0===this.depthWrite&&(null!==r?!0===r.depthBuffer&&this.setupDepth(e):!0===s.depth&&this.setupDepth(e)),null===this.fragmentNode){this.setupDiffuseColor(e),this.setupVariants(e);let a=this.setupLighting(e);null!==i&&e.stack.add(i);let n=ez(a,e1.a).max(0);if(t=this.setupOutput(e,n),tu.assign(t),null!==this.outputNode&&(t=this.outputNode),null!==r){let e=s.getMRT(),r=this.mrtNode;null!==e?(t=e,null!==r&&(t=e.merge(r))):null!==r&&(t=r)}}else{let s=this.fragmentNode;!0!==s.isOutputStructNode&&(s=ez(s)),t=this.setupOutput(e,s)}e.stack.outputNode=t,e.addFlow("fragment",e.removeStack()),e.monitor=this.setupObserver(e)}setupClipping(e){if(null===e.clippingContext)return null;let{unionPlanes:t,intersectionPlanes:s}=e.clippingContext,r=null;if(t.length>0||s.length>0){let t=e.renderer.samples;this.alphaToCoverage&&t>1?r=nF():e.stack.add(nz())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,null===e.clippingContext)return;let t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(nD()),this.hardwareClipping=!0)}setupDepth(e){let{renderer:t,camera:s}=e,r=this.depthNode;if(null===r){let e=t.getMRT();e&&e.has("depth")?r=e.get("depth"):!0===t.logarithmicDepthBuffer&&(r=s.isPerspectiveCamera?nA(ia.z,rU,rB):n_(ia.z,rU,rB))}null!==r&&nR.assign(r).append()}setupPosition(e){let{object:t}=e,s=t.geometry;if(e.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&a7(t).append(),!0===t.isSkinnedMesh&&a1(t).append(),this.displacementMap){let e=iU("displacementMap","texture"),t=iU("displacementScale","float"),s=iU("displacementBias","float");it.addAssign(ih.normalize().mul(e.x.mul(t).add(s)))}t.isBatchedMesh&&aJ(t).append(),t.isInstancedMesh&&t.instanceMatrix&&!0===t.instanceMatrix.isInstancedBufferAttribute&&aZ(t).append(),null!==this.positionNode&&it.assign(this.positionNode),this.setupHardwareClipping(e);let r=aU();return e.context.vertex=e.removeStack(),e.context.mvp=r,r}setupDiffuseColor({object:e,geometry:t}){let s=this.colorNode?ez(this.colorNode):at;!0===this.vertexColors&&t.hasAttribute("color")&&(s=ez(s.xyz.mul(rC("color","vec3")),s.a)),e.instanceColor&&(s=e0("vec3","vInstanceColor").mul(s)),e.isBatchedMesh&&e._colorsTexture&&(s=e0("vec3","vBatchColor").mul(s)),e1.assign(s);let r=this.opacityNode?ew(this.opacityNode):ai;if(e1.a.assign(e1.a.mul(r)),null!==this.alphaTestNode||this.alphaTest>0){let e=null!==this.alphaTestNode?ew(this.alphaTestNode):ae;e1.a.lessThanEqual(e).discard()}!0===this.alphaHash&&e1.a.lessThan(nB(it)).discard(),!1===this.transparent&&this.blending===n.bdR&&!1===this.alphaToCoverage&&e1.a.assign(1)}setupVariants(){}setupOutgoingLight(){return!0===this.lights?eI(0):e1.rgb}setupNormal(){return this.normalNode?eI(this.normalNode):ah}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?iU("envMap","cubeTexture"):iU("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new ni(az)),t}setupLights(e){let t=[],s=this.setupEnvironment(e);s&&s.isLightingNode&&t.push(s);let r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),null!==this.aoNode||e.material.aoMap){let e=null!==this.aoNode?this.aoNode:aF;t.push(new nt(e))}let i=this.lightsNode||e.lightsNode;return t.length>0&&(i=e.renderer.lighting.createNode([...i.getLights(),...t])),i}setupLightingModel(){}setupLighting(e){let{material:t}=e,{backdropNode:s,backdropAlphaNode:r,emissiveNode:i}=this,a=!0===this.lights||null!==this.lightsNode?this.setupLights(e):null,n=this.setupOutgoingLight(e);return a&&a.getScope().hasLights?n=nr(a,this.setupLightingModel(e),s,r):null!==s&&(n=eI(null!==r?sP(n,s,r):s)),(i&&!0===i.isNode||t.emissive&&!0===t.emissive.isColor)&&(e2.assign(eI(i||ar)),n=n.add(e2)),n}setupOutput(e,t){if(!0===this.fog){let s=e.fogNode;s&&(t=ez(s.mix(t.rgb,s.colorNode),t.a))}return t}setDefaultValues(e){for(let t in e){let s=e[t];void 0===this[t]&&(this[t]=s,s&&s.clone&&(this[t]=s.clone()))}let t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(let e in t)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,e)&&void 0!==t[e].get&&Object.defineProperty(this.constructor.prototype,e,t[e])}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{},nodes:{}});let s=n.F5T.prototype.toJSON.call(this,e),r=m(this);for(let{property:t,childNode:i}of(s.inputNodes={},r))s.inputNodes[t]=i.toJSON(e).uuid;function i(e){let t=[];for(let s in e){let r=e[s];delete r.metadata,t.push(r)}return t}if(t){let t=i(e.textures),r=i(e.images),a=i(e.nodes);t.length>0&&(s.textures=t),r.length>0&&(s.images=r),a.length>0&&(s.nodes=a)}return s}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowPositionNode=e.shadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}let nW=null;class nG extends ny{static get type(){return"ViewportSharedTextureNode"}constructor(e=nn,t=null){null===nW&&(nW=new n.Wzm),super(e,t,nW)}updateReference(){return this}}let nj=eg(nG);class nH extends I{static get type(){return"EquirectUVNode"}constructor(e=ii){super("vec2"),this.dirNode=e}setup(){let e=this.dirNode;return eA(e.z.atan2(e.x).mul(1/(2*Math.PI)).add(.5),e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5))}}let nq=eg(nH);class n$ extends n.oAp{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){let s=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i=new n.DvJ(5,5,5),a=nq(ii),o=new nk;o.colorNode=rD(t,a,0),o.side=n._Li,o.blending=n.jFi;let l=new n.Kj0(i,o),u=new n.xsS;u.add(l),t.minFilter===n.D1R&&(t.minFilter=n.wem);let d=new n._am(1,10,this),p=e.getMRT();return e.setMRT(null),d.update(e,u),e.setMRT(p),t.minFilter=s,t.currentGenerateMipmaps=r,l.geometry.dispose(),l.material.dispose(),this}}let nX=new WeakMap;class nY extends I{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=iS();let t=new n.BtG;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=b.RENDER}updateBefore(e){let{renderer:t,material:s}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){let e=r.isTextureNode?r.value:s[r.property];if(e&&e.isTexture){let s=e.mapping;if(s===n.dSO||s===n.Bf4){if(nX.has(e)){let t=nX.get(e);nK(t,e.mapping),this._cubeTexture=t}else{let s=e.image;if(null!=s&&s.height>0){let r=new n$(s.height);r.fromEquirectangularTexture(t,e),nK(r.texture,e.mapping),this._cubeTexture=r.texture,nX.set(e,r.texture),e.addEventListener("dispose",nZ)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function nZ(e){let t=e.target;t.removeEventListener("dispose",nZ);let s=nX.get(t);void 0!==s&&(nX.delete(t),s.dispose())}function nK(e,t){t===n.dSO?e.mapping=n.fY$:t===n.Bf4&&(e.mapping=n.vxC)}let nJ=eg(nY);class nQ extends ne{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=nJ(this.envNode)}}class n0 extends ne{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){let t=ew(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class n1{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class n2 extends n1{constructor(){super()}indirect(e,t,s){let r=e.ambientOcclusion,i=e.reflectedLight,a=s.context.irradianceLightMap;i.indirectDiffuse.assign(ez(0)),a?i.indirectDiffuse.addAssign(a):i.indirectDiffuse.addAssign(ez(1,1,1,0)),i.indirectDiffuse.mulAssign(r),i.indirectDiffuse.mulAssign(e1.rgb)}finish(e,t,s){let r=s.material,i=e.outgoingLight,a=s.context.environment;if(a)switch(r.combine){case n.Ns1:i.rgb.assign(sP(i.rgb,i.rgb.mul(a.rgb),al.mul(au)));break;case n.qhX:i.rgb.assign(sP(i.rgb,a.rgb,al.mul(au)));break;case n.NDo:i.rgb.addAssign(a.rgb.mul(al.mul(au)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",r.combine)}}}let n3=new n.vBJ;class n4 extends nk{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(n3),this.setValues(e)}setupNormal(){return im}setupEnvironment(e){let t=super.setupEnvironment(e);return t?new nQ(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new n0(az)),t}setupOutgoingLight(){return e1.rgb}setupLightingModel(){return new n2}}let n5=ey(({f0:e,f90:t,dotVH:s})=>{let r=s.mul(-5.55473).sub(6.98316).mul(s).exp2();return e.mul(r.oneMinus()).add(t.mul(r))}),n6=ey(e=>e.diffuseColor.mul(1/Math.PI)),n9=(({dotNH:e})=>tl.mul(ew(.5)).add(1).mul(ew(1/Math.PI)).mul(e.pow(tl)),ey(e=>{if(!1===e.geometry.hasAttribute("normal"))return ew(0);let t=im.dFdx().abs().max(im.dFdy().abs());return t.x.max(t.y).max(t.z)})),n8=ey(e=>{let{roughness:t}=e,s=n9(),r=t.max(.0525);return(r=r.add(s)).min(1)}),n7=ey(({alpha:e,dotNL:t,dotNV:s})=>{let r=e.pow2(),i=t.mul(r.add(r.oneMinus().mul(s.pow2())).sqrt()),a=s.mul(r.add(r.oneMinus().mul(t.pow2())).sqrt());return tA(.5,i.add(a).max(t$))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),oe=ey(({alphaT:e,alphaB:t,dotTV:s,dotBV:r,dotTL:i,dotBL:a,dotNV:n,dotNL:o})=>{let l=o.mul(eI(e.mul(s),t.mul(r),n).length()),u=n.mul(eI(e.mul(i),t.mul(a),o).length());return tA(.5,l.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),ot=ey(({alpha:e,dotNH:t})=>{let s=e.pow2(),r=t.pow2().mul(s.oneMinus()).oneMinus();return s.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),os=ew(1/Math.PI),or=ey(({alphaT:e,alphaB:t,dotNH:s,dotTH:r,dotBH:i})=>{let a=e.mul(t),n=eI(t.mul(r),e.mul(i),a.mul(s)),o=n.dot(n),l=a.div(o);return os.mul(a.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),oi=ey(e=>{let t,s;let{lightDirection:r,f0:i,f90:a,roughness:n,f:o,USE_IRIDESCENCE:l,USE_ANISOTROPY:u}=e,d=e.normalView||iy,p=n.pow2(),h=r.add(io).normalize(),c=d.dot(r).clamp(),m=d.dot(io).clamp(),g=d.dot(h).clamp(),f=n5({f0:i,f90:a,dotVH:io.dot(h).clamp()});if(eu(l)&&(f=e7.mix(f,o)),eu(u)){let e=ti.dot(r),i=ti.dot(io),a=ti.dot(h),n=ta.dot(r),o=ta.dot(io),l=ta.dot(h);t=oe({alphaT:ts,alphaB:p,dotTV:i,dotBV:o,dotTL:e,dotBL:n,dotNV:m,dotNL:c}),s=or({alphaT:ts,alphaB:p,dotNH:g,dotTH:a,dotBH:l})}else t=n7({alpha:p,dotNL:c,dotNV:m}),s=ot({alpha:p,dotNH:g});return f.mul(t).mul(s)}),oa=ey(({roughness:e,dotNV:t})=>{let s=ez(-1,-.0275,-.572,.022),r=ez(1,.0425,1.04,-.04),i=e.mul(s).add(r),a=i.x.mul(i.x).min(t.mul(-9.28).exp2()).mul(i.x).add(i.y);return eA(-1.04,1.04).mul(a).add(i.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),on=ey(e=>{let{dotNV:t,specularColor:s,specularF90:r,roughness:i}=e,a=oa({dotNV:t,roughness:i});return s.mul(a.x).add(r.mul(a.y))}),oo=ey(({f:e,f90:t,dotVH:s})=>{let r=s.oneMinus().saturate(),i=r.mul(r),a=r.mul(i,i).clamp(0,.9999);return e.sub(eI(t).mul(a)).div(a.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),ol=ey(({roughness:e,dotNH:t})=>{let s=e.pow2(),r=ew(1).div(s),i=t.pow2().oneMinus().max(.0078125);return ew(2).add(r).mul(i.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),ou=ey(({dotNV:e,dotNL:t})=>ew(1).div(ew(4).mul(t.add(e).sub(t.mul(e))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),od=ey(({lightDirection:e})=>{let t=e.add(io).normalize(),s=iy.dot(e).clamp(),r=iy.dot(io).clamp(),i=ol({roughness:e8,dotNH:iy.dot(t).clamp()}),a=ou({dotNV:r,dotNL:s});return e9.mul(i).mul(a)}),op=ey(({N:e,V:t,roughness:s})=>{let r=eA(s,e.dot(t).saturate().oneMinus().sqrt());return r.assign(r.mul(.984375).add(.0078125)),r}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),oh=ey(({f:e})=>{let t=e.length();return sw(t.mul(t).add(e.z).div(t.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),oc=ey(({v1:e,v2:t})=>{let s=e.dot(t),r=s.abs().toVar(),i=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),a=r.add(4.1616724).mul(r).add(3.417594).toVar(),n=i.div(a),o=s.greaterThan(0).select(n,sw(s.mul(s).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(n));return e.cross(t).mul(o)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),om=ey(({N:e,V:t,P:s,mInv:r,p0:i,p1:a,p2:n,p3:o})=>{let l=a.sub(i).toVar(),u=o.sub(i).toVar(),d=l.cross(u),p=eI().toVar();return ex(d.dot(s.sub(i)).greaterThanEqual(0),()=>{let l=t.sub(e.mul(t.dot(e))).normalize(),u=e.cross(l).negate(),d=r.mul(eB(l,u,e).transpose()).toVar(),h=d.mul(i.sub(s)).normalize().toVar(),c=d.mul(a.sub(s)).normalize().toVar(),m=d.mul(n.sub(s)).normalize().toVar(),g=d.mul(o.sub(s)).normalize().toVar(),f=eI(0).toVar();f.addAssign(oc({v1:h,v2:c})),f.addAssign(oc({v1:c,v2:m})),f.addAssign(oc({v1:m,v2:g})),f.addAssign(oc({v1:g,v2:h})),p.assign(eI(oh({f:f})))}),p}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),og=1/6,of=e=>tM(og,tM(e,tM(e,e.negate().add(3)).sub(3)).add(1)),oy=e=>tM(og,tM(e,tM(e,tM(3,e).sub(6))).add(4)),oN=e=>tM(og,tM(e,tM(e,tM(-3,e).add(3)).add(3)).add(1)),ov=e=>tM(og,sI(e,3)),ox=e=>of(e).add(oy(e)),oT=e=>oN(e).add(ov(e)),ob=e=>t_(-1,oy(e).div(of(e).add(oy(e)))),ow=e=>t_(1,ov(e).div(oN(e).add(ov(e)))),o_=(e,t,s)=>{let r=tM(e.uvNode,t.zw).add(.5),i=t8(r),a=st(r),n=ox(a.x),o=oT(a.x),l=ob(a.x),u=ow(a.x),d=ob(a.y),p=ow(a.y),h=eA(i.x.add(l),i.y.add(d)).sub(.5).mul(t.xy),c=eA(i.x.add(u),i.y.add(d)).sub(.5).mul(t.xy),m=eA(i.x.add(l),i.y.add(p)).sub(.5).mul(t.xy),g=eA(i.x.add(u),i.y.add(p)).sub(.5).mul(t.xy),f=ox(a.y).mul(t_(n.mul(e.uv(h).level(s)),o.mul(e.uv(c).level(s)))),y=oT(a.y).mul(t_(n.mul(e.uv(m).level(s)),o.mul(e.uv(g).level(s))));return f.add(y)},oV=ey(([e,t=ew(3)])=>{let s=eA(e.size(e_(t))),r=eA(e.size(e_(t.add(1)))),i=tA(1,s),a=tA(1,r),n=o_(e,ez(i,s),t8(t)),o=o_(e,ez(a,r),t7(t));return st(t).mix(n,o)}),oM=ey(([e,t,s,r,i])=>{let a=eI(sk(t.negate(),se(e),tA(1,r))),n=eI(sd(i[0].xyz),sd(i[1].xyz),sd(i[2].xyz));return se(a).mul(s.mul(n))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),oA=ey(([e,t])=>e.mul(sU(t.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),oS=nv(),oR=nv(),oC=ey(([e,t,s],{material:r})=>oV((r.side==n._Li?oS:oR).uv(e),t5(no.x).mul(oA(t,s)))),oI=ey(([e,t,s])=>(ex(s.notEqual(0),()=>t2(t4(t).negate().div(s).negate().mul(e))),eI(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),oE=ey(([e,t,s,r,i,a,n,o,l,u,d,p,h,c,m])=>{let g,f;if(m){g=ez().toVar(),f=eI().toVar();let i=d.sub(1).mul(m.mul(.025)),a=eI(d.sub(i),d,d.add(i));a3({start:0,end:3},({i})=>{let d=a.element(i),m=oM(e,t,p,d,o),y=n.add(m),N=u.mul(l.mul(ez(y,1))),v=eA(N.xy.div(N.w)).toVar();v.addAssign(1),v.divAssign(2),v.assign(eA(v.x,v.y.oneMinus()));let x=oC(v,s,d);g.element(i).assign(x.element(i)),g.a.addAssign(x.a),f.element(i).assign(r.element(i).mul(oI(sd(m),h,c).element(i)))}),g.a.divAssign(3)}else{let i=oM(e,t,p,d,o),a=n.add(i),m=u.mul(l.mul(ez(a,1))),y=eA(m.xy.div(m.w)).toVar();y.addAssign(1),y.divAssign(2),y.assign(eA(y.x,y.y.oneMinus())),g=oC(y,s,d),f=r.mul(oI(sd(i),h,c))}let y=f.rgb.mul(g.rgb),N=eI(on({dotNV:e.dot(t).clamp(),specularColor:i,specularF90:a,roughness:s})),v=f.r.add(f.g,f.b).div(3);return ez(N.oneMinus().mul(y),g.a.oneMinus().mul(v).oneMinus())}),oL=eB(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),oO=e=>{let t=e.sqrt();return eI(1).add(t).div(eI(1).sub(t))},oz=(e,t)=>e.sub(t).div(e.add(t)).pow2(),oF=(e,t)=>{let s=e.mul(2*Math.PI*1e-9),r=eI(54856e-17,44201e-17,52481e-17),i=eI(1681e3,1795300,2208400),a=eI(43278e5,93046e5,66121e5),n=ew(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(s.mul(2239900).add(t.x).cos()).mul(s.pow2().mul(-45282e5).exp()),o=r.mul(a.mul(2*Math.PI).sqrt()).mul(i.mul(s).add(t).cos()).mul(s.pow2().negate().mul(a).exp());return o=eI(o.x.add(n),o.y,o.z).div(10685e-11),oL.mul(o)},oD=ey(({outsideIOR:e,eta2:t,cosTheta1:s,thinFilmThickness:r,baseF0:i})=>{let a=sP(e,t,sW(0,.03,r)),n=e.div(a).pow2().mul(s.pow2().oneMinus()).oneMinus();ex(n.lessThan(0),()=>eI(1));let o=n.sqrt(),l=n5({f0:oz(a,e),f90:1,dotVH:s}),u=l.oneMinus(),d=a.lessThan(e).select(Math.PI,0),p=ew(Math.PI).sub(d),h=oO(i.clamp(0,.9999)),c=n5({f0:oz(h,a.toVec3()),f90:1,dotVH:o}),m=eI(h.x.lessThan(a).select(Math.PI,0),h.y.lessThan(a).select(Math.PI,0),h.z.lessThan(a).select(Math.PI,0)),g=a.mul(r,o,2),f=eI(p).add(m),y=l.mul(c).clamp(1e-5,.9999),N=y.sqrt(),v=u.pow2().mul(c).div(eI(1).sub(y)),x=l.add(v).toVar(),T=v.sub(u).toVar();return a3({start:1,end:2,condition:"<=",name:"m"},({m:e})=>{T.mulAssign(N);let t=oF(ew(e).mul(g),ew(e).mul(f)).mul(2);x.addAssign(T.mul(t))}),x.max(eI(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),oP=ey(({normal:e,viewDir:t,roughness:s})=>{let r=e.dot(t).saturate(),i=s.pow2(),a=sX(s.lessThan(.25),ew(-339.2).mul(i).add(ew(161.4).mul(s)).sub(25.9),ew(-8.48).mul(i).add(ew(14.3).mul(s)).sub(9.95)),n=sX(s.lessThan(.25),ew(44).mul(i).sub(ew(23.7).mul(s)).add(3.26),ew(1.97).mul(i).sub(ew(3.27).mul(s)).add(.72));return sX(s.lessThan(.25),0,ew(.1).mul(s).sub(.025)).add(a.mul(r).add(n).exp()).mul(1/Math.PI).saturate()}),oU=eI(.04),oB=ew(1);class ok extends n1{constructor(e=!1,t=!1,s=!1,r=!1,i=!1,a=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=s,this.anisotropy=r,this.transmission=i,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(!0===this.clearcoat&&(this.clearcoatRadiance=eI().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=eI().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=eI().toVar("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=eI().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=eI().toVar("sheenSpecularIndirect")),!0===this.iridescence){let e=iy.dot(io).clamp();this.iridescenceFresnel=oD({outsideIOR:ew(1),eta2:te,cosTheta1:e,thinFilmThickness:tt,baseF0:tn}),this.iridescenceF0=oo({f:this.iridescenceFresnel,f90:1,dotVH:e})}if(!0===this.transmission){let t=rq.sub(ir).normalize();e.backdrop=oE(iN,t,e3,e1,tn,to,ir,r1,rG,rk,tc,tg,ty,tf,this.dispersion?tN:null),e.backdropAlpha=tm,e1.a.mulAssign(sP(1,e.backdrop.a,tm))}}computeMultiscattering(e,t,s){let r=oa({roughness:e3,dotNV:iy.dot(io).clamp()}),i=(this.iridescenceF0?e7.mix(tn,this.iridescenceF0):tn).mul(r.x).add(s.mul(r.y)),a=r.x.add(r.y).oneMinus(),n=tn.add(tn.oneMinus().mul(.047619)),o=i.mul(n).div(a.mul(n).oneMinus());e.addAssign(i),t.addAssign(o.mul(a))}direct({lightDirection:e,lightColor:t,reflectedLight:s}){let r=iy.dot(e).clamp().mul(t);if(!0===this.sheen&&this.sheenSpecularDirect.addAssign(r.mul(od({lightDirection:e}))),!0===this.clearcoat){let s=iv.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(s.mul(oi({lightDirection:e,f0:oU,f90:oB,roughness:e6,normalView:iv})))}s.directDiffuse.addAssign(r.mul(n6({diffuseColor:e1.rgb}))),s.directSpecular.addAssign(r.mul(oi({lightDirection:e,f0:tn,f90:1,roughness:e3,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:s,halfHeight:r,reflectedLight:i,ltc_1:a,ltc_2:n}){let o=t.add(s).sub(r),l=t.sub(s).sub(r),u=t.sub(s).add(r),d=t.add(s).add(r),p=ia.toVar(),h=op({N:iy,V:io,roughness:e3}),c=a.uv(h).toVar(),m=n.uv(h).toVar(),g=eB(eI(c.x,0,c.y),eI(0,1,0),eI(c.z,0,c.w)).toVar(),f=tn.mul(m.x).add(tn.oneMinus().mul(m.y)).toVar();i.directSpecular.addAssign(e.mul(f).mul(om({N:iy,V:io,P:p,mInv:g,p0:o,p1:l,p2:u,p3:d}))),i.directDiffuse.addAssign(e.mul(e1).mul(om({N:iy,V:io,P:p,mInv:eB(1,0,0,0,1,0,0,0,1),p0:o,p1:l,p2:u,p3:d})))}indirect(e,t,s){this.indirectDiffuse(e,t,s),this.indirectSpecular(e,t,s),this.ambientOcclusion(e,t,s)}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(n6({diffuseColor:e1})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:s}){if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(t.mul(e9,oP({normal:iy,viewDir:io,roughness:e8}))),!0===this.clearcoat){let e=on({dotNV:iv.dot(io).clamp(),specularColor:oU,specularF90:oB,roughness:e6});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(e))}let r=eI().toVar("singleScattering"),i=eI().toVar("multiScattering"),a=t.mul(1/Math.PI);this.computeMultiscattering(r,i,to);let n=r.add(i),o=e1.mul(n.r.max(n.g).max(n.b).oneMinus());s.indirectSpecular.addAssign(e.mul(r)),s.indirectSpecular.addAssign(i.mul(a)),s.indirectDiffuse.addAssign(o.mul(a))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){let s=iy.dot(io).clamp().add(e),r=e3.mul(-16).oneMinus().negate().exp2(),i=e.sub(s.pow(r).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(e),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(e),t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(i)}finish(e){let{outgoingLight:t}=e;if(!0===this.clearcoat){let e=n5({dotVH:iv.dot(io).clamp(),f0:oU,f90:oB}),s=t.mul(e5.mul(e).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(e5));t.assign(s)}if(!0===this.sheen){let e=e9.r.max(e9.g).max(e9.b).mul(.157).oneMinus(),s=t.mul(e).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(s)}}}let oW=ew(1),oG=ew(-2),oj=ew(.8),oH=ew(-1),oq=ew(.4),o$=ew(2),oX=ew(.305),oY=ew(3),oZ=ew(.21),oK=ew(4),oJ=ew(4),oQ=ew(16),o0=ey(([e])=>{let t=eI(sl(e)).toVar(),s=ew(-1).toVar();return ex(t.x.greaterThan(t.z),()=>{ex(t.x.greaterThan(t.y),()=>{s.assign(sX(e.x.greaterThan(0),0,3))}).Else(()=>{s.assign(sX(e.y.greaterThan(0),1,4))})}).Else(()=>{ex(t.z.greaterThan(t.y),()=>{s.assign(sX(e.z.greaterThan(0),2,5))}).Else(()=>{s.assign(sX(e.y.greaterThan(0),1,4))})}),s}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),o1=ey(([e,t])=>{let s=eA().toVar();return ex(t.equal(0),()=>{s.assign(eA(e.z,e.y).div(sl(e.x)))}).ElseIf(t.equal(1),()=>{s.assign(eA(e.x.negate(),e.z.negate()).div(sl(e.y)))}).ElseIf(t.equal(2),()=>{s.assign(eA(e.x.negate(),e.y).div(sl(e.z)))}).ElseIf(t.equal(3),()=>{s.assign(eA(e.z.negate(),e.y).div(sl(e.x)))}).ElseIf(t.equal(4),()=>{s.assign(eA(e.x.negate(),e.z).div(sl(e.y)))}).Else(()=>{s.assign(eA(e.x,e.y).div(sl(e.z)))}),tM(.5,s.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),o2=ey(([e])=>{let t=ew(0).toVar();return ex(e.greaterThanEqual(oj),()=>{t.assign(oW.sub(e).mul(oH.sub(oG)).div(oW.sub(oj)).add(oG))}).ElseIf(e.greaterThanEqual(oq),()=>{t.assign(oj.sub(e).mul(o$.sub(oH)).div(oj.sub(oq)).add(oH))}).ElseIf(e.greaterThanEqual(oX),()=>{t.assign(oq.sub(e).mul(oY.sub(o$)).div(oq.sub(oX)).add(o$))}).ElseIf(e.greaterThanEqual(oZ),()=>{t.assign(oX.sub(e).mul(oK.sub(oY)).div(oX.sub(oZ)).add(oY))}).Else(()=>{t.assign(ew(-2).mul(t5(tM(1.16,e))))}),t}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),o3=ey(([e,t])=>{let s=e.toVar();s.assign(tM(2,s).sub(1));let r=eI(s,1).toVar();return ex(t.equal(0),()=>{r.assign(r.zyx)}).ElseIf(t.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).ElseIf(t.equal(2),()=>{r.x.mulAssign(-1)}).ElseIf(t.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).ElseIf(t.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).ElseIf(t.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),o4=ey(([e,t,s,r,i,a])=>{let n=ew(s),o=eI(t),l=sU(o2(n),oG,a),u=st(l),d=t8(l),p=eI(o5(e,o,d,r,i,a)).toVar();return ex(u.notEqual(0),()=>{let t=eI(o5(e,o,d.add(1),r,i,a)).toVar();p.assign(sP(p,t,u))}),p}),o5=ey(([e,t,s,r,i,a])=>{let n=ew(s).toVar(),o=eI(t),l=ew(o0(o)).toVar(),u=ew(sw(oJ.sub(n),0)).toVar();n.assign(sw(n,oJ));let d=ew(t3(n)).toVar(),p=eA(o1(o,l).mul(d.sub(2)).add(1)).toVar();return ex(l.greaterThan(2),()=>{p.y.addAssign(d),l.subAssign(3)}),p.x.addAssign(l.mul(d)),p.x.addAssign(u.mul(tM(3,oQ))),p.y.addAssign(tM(4,t3(a).sub(d))),p.x.mulAssign(r),p.y.mulAssign(i),e.uv(p).grad(eA(),eA())}),o6=ey(({envMap:e,mipInt:t,outputDirection:s,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:n,CUBEUV_MAX_MIP:o})=>{let l=sr(r);return o5(e,s.mul(l).add(i.cross(s).mul(ss(r))).add(i.mul(i.dot(s).mul(l.oneMinus()))),t,a,n,o)}),o9=ey(({n:e,latitudinal:t,poleAxis:s,outputDirection:r,weights:i,samples:a,dTheta:n,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p})=>{let h=eI(sX(t,s,sC(s,r))).toVar();ex(tK(h.equals(eI(0))),()=>{h.assign(eI(r.z,0,r.x.negate()))}),h.assign(se(h));let c=eI().toVar();return c.addAssign(i.element(e_(0)).mul(o6({theta:0,axis:h,outputDirection:r,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p}))),a3({start:e_(1),end:e},({i:e})=>{ex(e.greaterThanEqual(a),()=>{a4()});let t=ew(n.mul(ew(e))).toVar();c.addAssign(i.element(e).mul(o6({theta:t.mul(-1),axis:h,outputDirection:r,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p}))),c.addAssign(i.element(e).mul(o6({theta:t,axis:h,outputDirection:r,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p})))}),ez(c,1)}),o8=null,o7=new WeakMap;class le extends I{static get type(){return"PMREMNode"}constructor(e,t=null,s=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=s,this._generator=null;let r=new n.xEZ;r.isRenderTargetTexture=!0,this._texture=rD(r),this._width=eK(0),this._height=eK(0),this._maxMip=eK(0),this.updateBeforeType=b.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){let t=function(e){let t=Math.log2(e)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:1/e,maxMip:t}}(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(){let e=this._pmrem,t=e?e.pmremVersion:-1,s=this._value;t!==s.pmremVersion&&null!==(e=!0===s.isPMREMTexture?s:function(e){let t=o7.get(e);if((void 0!==t?t.pmremVersion:-1)!==e.pmremVersion){let s=e.image;if(e.isCubeTexture){if(!function(e){if(null==e)return!1;let t=0;for(let s=0;s<6;s++)void 0!==e[s]&&t++;return 6===t}(s))return null;t=o8.fromCubemap(e,t)}else{if(!(null!=s&&s.height>0))return null;t=o8.fromEquirectangular(e,t)}t.pmremVersion=e.pmremVersion,o7.set(e,t)}return t.texture}(s))&&(this._pmrem=e,this.updateFromTexture(e))}setup(e){null===o8&&(o8=e.createPMREMGenerator()),this.updateBefore(e);let t=this.uvNode;null===t&&e.context.getUV&&(t=e.context.getUV(this));let s=this.value;e.renderer.coordinateSystem===n._RZ&&!0!==s.isPMREMTexture&&!0===s.isRenderTargetTexture&&(t=eI(t.x.negate(),t.yz));let r=this.levelNode;return null===r&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),o4(this._texture,t,r,this._width,this._height,this._maxMip)}}let lt=eg(le),ls=new WeakMap;class lr extends ne{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){let{material:t}=e,s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){let e=s.isTextureNode?s.value:t[s.property],r=ls.get(e);void 0===r&&(r=lt(e),ls.set(e,r)),s=r}let r=t.envMap?iF("envMapIntensity","float",e.material):iF("environmentIntensity","float",e.scene),i=!0===t.useAnisotropy||t.anisotropy>0?i0:iy,a=s.context(li(e3,i)).mul(r),n=s.context(la(iN)).mul(Math.PI).mul(r),o=rN(a),l=rN(n);e.context.radiance.addAssign(o),e.context.iblIrradiance.addAssign(l);let u=e.context.lightingModel.clearcoatRadiance;if(u){let e=rN(s.context(li(e6,iv)).mul(r));u.addAssign(e)}}}let li=(e,t)=>{let s=null;return{getUV:()=>(null===s&&(s=io.negate().reflect(t),s=(s=e.mul(e).mix(s,t).normalize()).transformDirection(rG)),s),getTextureLevel:()=>e}},la=e=>({getUV:()=>e,getTextureLevel:()=>ew(1)}),ln=new n.Wid;class lo extends nk{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(ln),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return null===t&&e.environmentNode&&(t=e.environmentNode),t?new lr(t):null}setupLightingModel(){return new ok}setupSpecular(){let e=sP(eI(.04),e1.rgb,e4);tn.assign(e),to.assign(1)}setupVariants(){let e=this.metalnessNode?ew(this.metalnessNode):ap;e4.assign(e);let t=this.roughnessNode?ew(this.roughnessNode):ad;t=n8({roughness:t}),e3.assign(t),this.setupSpecular(),e1.assign(ez(e1.rgb.mul(e.oneMinus()),e1.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}let ll=new n.EJi;class lu extends lo{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(ll),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||null!==this.clearcoatNode}get useIridescence(){return this.iridescence>0||null!==this.iridescenceNode}get useSheen(){return this.sheen>0||null!==this.sheenNode}get useAnisotropy(){return this.anisotropy>0||null!==this.anisotropyNode}get useTransmission(){return this.transmission>0||null!==this.transmissionNode}get useDispersion(){return this.dispersion>0||null!==this.dispersionNode}setupSpecular(){let e=this.iorNode?ew(this.iorNode):aV;tc.assign(e),tn.assign(sP(sb(sE(tc.sub(1).div(tc.add(1))).mul(ao),eI(1)).mul(an),e1.rgb,e4)),to.assign(sP(an,1,e4))}setupLightingModel(){return new ok(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){let e=this.clearcoatNode?ew(this.clearcoatNode):ac,t=this.clearcoatRoughnessNode?ew(this.clearcoatRoughnessNode):am;e5.assign(e),e6.assign(n8({roughness:t}))}if(this.useSheen){let e=this.sheenNode?eI(this.sheenNode):ay,t=this.sheenRoughnessNode?ew(this.sheenRoughnessNode):aN;e9.assign(e),e8.assign(t)}if(this.useIridescence){let e=this.iridescenceNode?ew(this.iridescenceNode):ax,t=this.iridescenceIORNode?ew(this.iridescenceIORNode):aT,s=this.iridescenceThicknessNode?ew(this.iridescenceThicknessNode):ab;e7.assign(e),te.assign(t),tt.assign(s)}if(this.useAnisotropy){let e=(this.anisotropyNode?eA(this.anisotropyNode):av).toVar();tr.assign(e.length()),ex(tr.equal(0),()=>{e.assign(eA(1,0))}).Else(()=>{e.divAssign(eA(tr)),tr.assign(tr.saturate())}),ts.assign(tr.pow2().mix(e3.pow2(),1)),ti.assign(iJ[0].mul(e.x).add(iJ[1].mul(e.y))),ta.assign(iJ[1].mul(e.x).sub(iJ[0].mul(e.y)))}if(this.useTransmission){let e=this.transmissionNode?ew(this.transmissionNode):aw,t=this.thicknessNode?ew(this.thicknessNode):a_,s=this.attenuationDistanceNode?ew(this.attenuationDistanceNode):aM,r=this.attenuationColorNode?eI(this.attenuationColorNode):aA;if(tm.assign(e),tg.assign(t),tf.assign(s),ty.assign(r),this.useDispersion){let e=this.dispersionNode?ew(this.dispersionNode):aO;tN.assign(e)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?eI(this.clearcoatNormalNode):ag}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}class ld extends I{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){let e=eI(io.z,0,io.x.negate()).normalize(),t=io.cross(e);return eA(e.dot(iy),t.dot(iy)).mul(.495).add(.5)}}let lp=ef(ld);class lh extends I{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){let{rotationNode:t,positionNode:s}=this;if("vec2"===this.getNodeType(e)){let e=t.cos(),r=t.sin();return eU(e,r,r.negate(),e).mul(s)}{let e=ek(ez(1,0,0,0),ez(0,sr(t.x),ss(t.x).negate(),0),ez(0,ss(t.x),sr(t.x),0),ez(0,0,0,1)),r=ek(ez(sr(t.y),0,ss(t.y),0),ez(0,1,0,0),ez(ss(t.y).negate(),0,sr(t.y),0),ez(0,0,0,1)),i=ek(ez(sr(t.z),ss(t.z).negate(),0,0),ez(ss(t.z),sr(t.z),0,0),ez(0,0,1,0),ez(0,0,0,1));return e.mul(r).mul(i).mul(ez(s,1)).xyz}}}let lc=eg(lh),lm=ey(({texture:e,uv:t})=>{let s=eI().toVar();return ex(t.x.lessThan(1e-4),()=>{s.assign(eI(1,0,0))}).ElseIf(t.y.lessThan(1e-4),()=>{s.assign(eI(0,1,0))}).ElseIf(t.z.lessThan(1e-4),()=>{s.assign(eI(0,0,1))}).ElseIf(t.x.greaterThan(.9999),()=>{s.assign(eI(-1,0,0))}).ElseIf(t.y.greaterThan(.9999),()=>{s.assign(eI(0,-1,0))}).ElseIf(t.z.greaterThan(.9999),()=>{s.assign(eI(0,0,-1))}).Else(()=>{let r=e.uv(t.add(eI(-.01,0,0))).r.sub(e.uv(t.add(eI(.01,0,0))).r),i=e.uv(t.add(eI(0,-.01,0))).r.sub(e.uv(t.add(eI(0,.01,0))).r),a=e.uv(t.add(eI(0,0,-.01))).r.sub(e.uv(t.add(eI(0,0,.01))).r);s.assign(eI(r,i,a))}),s.normalize()});class lg extends rF{static get type(){return"Texture3DNode"}constructor(e,t=null,s=null){super(e,t,s),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return eI(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){return t}generateUV(e,t){return t.build(e,"vec3")}normal(e){return lm({texture:this,uv:e})}}let lf=eg(lg);n.Ilk;class ly extends eJ{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class lN extends S{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}If(e,t){let s=new ep(t);return this._currentCond=sX(e,s),this.add(this._currentCond)}ElseIf(e,t){let s=sX(e,new ep(t));return this._currentCond.elseNode=s,this._currentCond=s,this}Else(e){return this._currentCond.elseNode=new ep(e),this}build(e,...t){let s=ev();for(let t of(eN(this),this.nodes))t.build(e,"void");return eN(s),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}let lv=eg(lN);class lx extends S{static get type(){return"StructTypeNode"}constructor(e){super(),this.types=e,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}class lT extends S{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}setup(e){super.setup(e);let t=this.members,s=[];for(let r=0;r<t.length;r++)s.push(t[r].getNodeType(e));this.nodeType=e.getStructTypeFromNode(new lx(s)).name}generate(e,t){let s=e.getOutputStructName(),r=this.members,i=""!==s?s+".":"";for(let s=0;s<r.length;s++){let a=r[s].build(e,t);e.addLineFlowCode(`${i}m${s} = ${a}`,this)}return s}}let lb=eg(lT);function lw(e,t){for(let s=0;s<e.length;s++)if(e[s].name===t)return s;return -1}class l_ extends lT{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return void 0!==this.outputNodes[e]}get(e){return this.outputNodes[e]}merge(e){return lV({...this.outputNodes,...e.outputNodes})}setup(e){let t=this.outputNodes,s=e.renderer.getRenderTarget(),r=[],i=s.textures;for(let e in t)r[lw(i,e)]=ez(t[e]);return this.members=r,super.setup(e)}}let lV=eg(l_),lM=ey(([e])=>{let t=e.toUint().mul(747796405).add(2891336453),s=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return s.shiftRight(22).bitXor(s).toFloat().mul(1/4294967296)}),lA=(e,t)=>sI(tM(4,e.mul(tV(1,e))),t),lS=ey(([e])=>e.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),lR=ey(([e])=>eI(lS(e.z.add(lS(e.y.mul(1)))),lS(e.z.add(lS(e.x.mul(1)))),lS(e.y.add(lS(e.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),lC=ey(([e,t,s])=>{let r=eI(e).toVar(),i=ew(1.4).toVar(),a=ew(0).toVar(),n=eI(r).toVar();return a3({start:ew(0),end:ew(3),type:"float",condition:"<="},()=>{let e=eI(lR(n.mul(2))).toVar();r.addAssign(e.add(s.mul(ew(.1).mul(t)))),n.mulAssign(1.8),i.mulAssign(1.5),r.mulAssign(1.2);let o=ew(lS(r.z.add(lS(r.x.add(lS(r.y)))))).toVar();a.addAssign(o.div(i)),n.addAssign(.14)}),a}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]});class lI extends S{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null,this.global=!0}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){let t=this.parametersNodes,s=this._candidateFnCall;if(null===s){let r=null,i=-1;for(let s of this.functionNodes){let a=s.shaderNode.layout;if(null===a)throw Error("FunctionOverloadingNode: FunctionNode must be a layout.");let n=a.inputs;if(t.length===n.length){let a=0;for(let s=0;s<t.length;s++){let r=t[s],i=n[s];r.getNodeType(e)===i.type?a++:a=0}a>i&&(r=s,i=a)}}this._candidateFnCall=s=r(...t)}return s}}let lE=eg(lI),lL=e=>(...t)=>lE(e,...t),lO=eK(0).setGroup(eX).onRenderUpdate(e=>e.time),lz=eK(0).setGroup(eX).onRenderUpdate(e=>e.deltaTime),lF=eK(0,"uint").setGroup(eX).onRenderUpdate(e=>e.frameId),lD=ey(([e,t,s=eA(.5)])=>lc(e.sub(s),t).add(s)),lP=ey(([e,t,s=eA(.5)])=>{let r=e.sub(s),i=r.dot(r),a=i.mul(i).mul(t);return e.add(r.mul(a))}),lU=ey(({position:e=null,horizontal:t=!0,vertical:s=!1})=>{let r;null!==e?((r=r1.toVar())[3][0]=e.x,r[3][1]=e.y,r[3][2]=e.z):r=r1;let i=rG.mul(r);return eu(t)&&(i[0][0]=r1[0].length(),i[0][1]=0,i[0][2]=0),eu(s)&&(i[1][0]=0,i[1][1]=r1[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,rk.mul(i).mul(it)}),lB=ey(([e=null])=>{let t=nC();return nC(nb(e)).sub(t).lessThan(0).select(nn,e)});class lk extends S{static get type(){return"SpriteSheetUVNode"}constructor(e,t=rI(),s=ew(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=s}setup(){let{frameNode:e,uvNode:t,countNode:s}=this,{width:r,height:i}=s,a=e.mod(r.mul(i)).floor(),n=a.mod(r),o=i.sub(a.add(1).div(r).ceil()),l=s.reciprocal(),u=eA(n,o);return t.add(u).mul(l)}}let lW=eg(lk);class lG extends S{static get type(){return"TriplanarTexturesNode"}constructor(e,t=null,s=null,r=ew(1),i=it,a=ih){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=s,this.scaleNode=r,this.positionNode=i,this.normalNode=a}setup(){let{textureXNode:e,textureYNode:t,textureZNode:s,scaleNode:r,positionNode:i,normalNode:a}=this,n=a.abs().normalize();n=n.div(n.dot(eI(1)));let o=i.yz.mul(r),l=i.zx.mul(r),u=i.xy.mul(r),d=e.value,p=null!==t?t.value:d,h=null!==s?s.value:d;return t_(rD(d,o).mul(n.x),rD(p,l).mul(n.y),rD(h,u).mul(n.z))}}let lj=eg(lG),lH=new n.JOQ,lq=new n.Pa4,l$=new n.Pa4,lX=new n.Pa4,lY=new n.yGw,lZ=new n.Pa4(0,0,-1),lK=new n.Ltg,lJ=new n.Pa4,lQ=new n.Pa4,l0=new n.Ltg,l1=new n.FM8,l2=new n.ACn,l3=nn.flipX();l2.depthTexture=new n.$YQ(1,1);let l4=!1;class l5 extends rF{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||l2.texture,l3),this._reflectorBaseNode=e.reflector||new l6(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(null===this._depthNode){if(!0!==this._reflectorBaseNode.depth)throw Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=eh(new l5({defaultTexture:l2.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){let e=new this.constructor(this.reflectorNode);return e._reflectorBaseNode=this._reflectorBaseNode,e}}class l6 extends S{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();let{target:s=new n.Tme,resolution:r=1,generateMipmaps:i=!1,bounces:a=!0,depth:o=!1}=t;this.textureNode=e,this.target=s,this.resolution=r,this.generateMipmaps=i,this.bounces=a,this.depth=o,this.updateBeforeType=a?b.RENDER:b.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new WeakMap}_updateResolution(e,t){let s=this.resolution;t.getDrawingBufferSize(l1),e.setSize(Math.round(l1.width*s),Math.round(l1.height*s))}setup(e){return this._updateResolution(l2,e.renderer),super.setup(e)}getVirtualCamera(e){let t=this.virtualCameras.get(e);return void 0===t&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return void 0===t&&(t=new n.ACn(0,0,{type:n.cLu}),!0===this.generateMipmaps&&(t.texture.minFilter=n.FDw,t.texture.generateMipmaps=!0),!0===this.depth&&(t.depthTexture=new n.$YQ),this.renderTargets.set(e,t)),t}updateBefore(e){if(!1===this.bounces&&l4)return;l4=!0;let{scene:t,camera:s,renderer:r,material:i}=e,{target:a}=this,o=this.getVirtualCamera(s),l=this.getRenderTarget(o);if(r.getDrawingBufferSize(l1),this._updateResolution(l,r),l$.setFromMatrixPosition(a.matrixWorld),lX.setFromMatrixPosition(s.matrixWorld),lY.extractRotation(a.matrixWorld),lq.set(0,0,1),lq.applyMatrix4(lY),lJ.subVectors(l$,lX),lJ.dot(lq)>0)return;lJ.reflect(lq).negate(),lJ.add(l$),lY.extractRotation(s.matrixWorld),lZ.set(0,0,-1),lZ.applyMatrix4(lY),lZ.add(lX),lQ.subVectors(l$,lZ),lQ.reflect(lq).negate(),lQ.add(l$),o.coordinateSystem=s.coordinateSystem,o.position.copy(lJ),o.up.set(0,1,0),o.up.applyMatrix4(lY),o.up.reflect(lq),o.lookAt(lQ),o.near=s.near,o.far=s.far,o.updateMatrixWorld(),o.projectionMatrix.copy(s.projectionMatrix),lH.setFromNormalAndCoplanarPoint(lq,l$),lH.applyMatrix4(o.matrixWorldInverse),lK.set(lH.normal.x,lH.normal.y,lH.normal.z,lH.constant);let u=o.projectionMatrix;l0.x=(Math.sign(lK.x)+u.elements[8])/u.elements[0],l0.y=(Math.sign(lK.y)+u.elements[9])/u.elements[5],l0.z=-1,l0.w=(1+u.elements[10])/u.elements[14],lK.multiplyScalar(1/lK.dot(l0)),u.elements[2]=lK.x,u.elements[6]=lK.y,u.elements[10]=r.coordinateSystem===n.JCZ?lK.z-0:lK.z+1-0,u.elements[14]=lK.w,this.textureNode.value=l.texture,!0===this.depth&&(this.textureNode.getDepthNode().value=l.depthTexture),i.visible=!1;let d=r.getRenderTarget(),p=r.getMRT();r.setMRT(null),r.setRenderTarget(l),r.render(t,o),r.setMRT(p),r.setRenderTarget(d),i.visible=!0,l4=!1}}let l9=new n.iKG(-1,1,1,-1,0,1);class l8 extends n.u9r{constructor(e=!1){super(),this.setAttribute("position",new n.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new n.a$l(!1===e?[0,-1,0,1,2,1]:[0,2,0,0,2,0],2))}}let l7=new l8;class ue extends n.Kj0{constructor(e=null){super(l7,e),this.camera=l9,this.isQuadMesh=!0}renderAsync(e){return e.renderAsync(this,l9)}render(e){e.render(this,l9)}}let ut=new n.FM8;class us extends rF{static get type(){return"RTTNode"}constructor(e,t=null,s=null,r={type:n.cLu}){let i=new n.ACn(t,s,r);super(i.texture,rI()),this.node=e,this.width=t,this.height=s,this.renderTarget=i,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this.updateMap=new WeakMap,this._rttNode=null,this._quadMesh=new ue(new nk),this.updateBeforeType=b.RENDER}get autoSize(){return null===this.width}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;let s=e*this.pixelRatio,r=t*this.pixelRatio;this.renderTarget.setSize(s,r),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(!1===this.textureNeedsUpdate&&!1===this.autoUpdate)return;if(this.textureNeedsUpdate=!1,!0===this.autoSize){this.pixelRatio=e.getPixelRatio();let t=e.getSize(ut);this.setSize(t.width,t.height)}this._quadMesh.material.fragmentNode=this._rttNode;let t=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(t)}clone(){let e=new rF(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}let ur=(e,...t)=>eh(new us(eh(e),...t)),ui=ey(([e,t,s],r)=>{let i;i=r.renderer.coordinateSystem===n.JCZ?ez(eI(e=eA(e.x,e.y.oneMinus()).mul(2).sub(1),t),1):ez(eI(e.x,e.y.oneMinus(),t).mul(2).sub(1),1);let a=ez(s.mul(i));return a.xyz.div(a.w)}),ua=ey(([e,t])=>{let s=t.mul(ez(e,1)),r=s.xy.div(s.w).mul(.5).add(.5).toVar();return eA(r.x,r.y.oneMinus())}),un=ey(([e,t,s])=>{let r=rL(rP(t)),i=eS(e.mul(r)).toVar(),a=rP(t,i).toVar(),n=rP(t,i.sub(eS(2,0))).toVar(),o=rP(t,i.sub(eS(1,0))).toVar(),l=rP(t,i.add(eS(1,0))).toVar(),u=rP(t,i.add(eS(2,0))).toVar(),d=rP(t,i.add(eS(0,2))).toVar(),p=rP(t,i.add(eS(0,1))).toVar(),h=rP(t,i.sub(eS(0,1))).toVar(),c=rP(t,i.sub(eS(0,2))).toVar(),m=sl(tV(ew(2).mul(o).sub(n),a)).toVar(),g=sl(tV(ew(2).mul(l).sub(u),a)).toVar(),f=sl(tV(ew(2).mul(p).sub(d),a)).toVar(),y=sl(tV(ew(2).mul(h).sub(c),a)).toVar(),N=ui(e,a,s).toVar();return se(sC(m.lessThan(g).select(N.sub(ui(e.sub(eA(ew(1).div(r.x),0)),o,s)),N.negate().add(ui(e.add(eA(ew(1).div(r.x),0)),l,s))),f.lessThan(y).select(N.sub(ui(e.add(eA(0,ew(1).div(r.y))),p,s)),N.negate().add(ui(e.sub(eA(0,ew(1).div(r.y))),h,s)))))});class uo extends n.lb7{constructor(e,t,s=Float32Array){!1===ArrayBuffer.isView(e)&&(e=new s(e*t)),super(e,t),this.isStorageInstancedBufferAttribute=!0}}class ul extends n.TlE{constructor(e,t,s=Float32Array){!1===ArrayBuffer.isView(e)&&(e=new s(e*t)),super(e,t),this.isStorageBufferAttribute=!0}}class uu extends R{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}setup(e){return!1===e.isAvailable("storageBuffer")&&!0===this.node.isPBO&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let s;let r=e.context.assign;if(s=!1===e.isAvailable("storageBuffer")?!0===this.node.isPBO&&!0!==r&&(this.node.value.isInstancedBufferAttribute||"compute"!==e.shaderStage)?e.generatePBO(this):this.node.build(e):super.generate(e),!0!==r){let r=this.getNodeType(e);s=e.format(s,r,t)}return s}}let ud=eg(uu);class up extends iR{static get type(){return"StorageBufferNode"}constructor(e,t=null,s=0){if(null===t&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)){var r;r=e.itemSize,t=g.get(r),s=e.count}super(e,t,s),this.isStorageBufferNode=!0,this.access=w.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this.bufferCount=s,this._attribute=null,this._varying=null,this.global=!0,!0!==e.isStorageBufferAttribute&&!0!==e.isStorageInstancedBufferAttribute&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(0===this.bufferCount){let t=e.globalCache.getData(this.value);return void 0===t&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return ud(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(w.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return null===this._attribute&&(this._attribute=rp(this.value),this._varying=s3(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);let{attribute:t}=this.getAttributeData();return t.getNodeType(e)}generate(e){if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);let{attribute:t,varying:s}=this.getAttributeData(),r=s.build(e);return e.registerTransform(r,t),r}}let uh=(e,t,s)=>eh(new up(e,t,s));class uc extends rR{static get type(){return"VertexColorNode"}constructor(e=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){let e=this.index;return"color"+(e>0?e:"")}generate(e){let t=this.getAttributeName(e);return!0===e.hasGeometryAttribute(t)?super.generate(e):e.generateConst(this.nodeType,new n.Ltg(1,1,1,1))}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}class um extends S{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}let ug=ef(um),uf=new n.USm,uy=new n.yGw;class uN extends S{static get type(){return"SceneNode"}constructor(e=uN.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){let t;let s=this.scope,r=null!==this.scene?this.scene:e.scene;return s===uN.BACKGROUND_BLURRINESS?t=iF("backgroundBlurriness","float",r):s===uN.BACKGROUND_INTENSITY?t=iF("backgroundIntensity","float",r):s===uN.BACKGROUND_ROTATION?t=eK("mat4").label("backgroundRotation").setGroup(eX).onRenderUpdate(()=>{let e=r.background;return null!==e&&e.isTexture&&e.mapping!==n.xfE?(uf.copy(r.backgroundRotation),uf.x*=-1,uf.y*=-1,uf.z*=-1,uy.makeRotationFromEuler(uf)):uy.identity(),uy}):console.error("THREE.SceneNode: Unknown scope:",s),t}}uN.BACKGROUND_BLURRINESS="backgroundBlurriness",uN.BACKGROUND_INTENSITY="backgroundIntensity",uN.BACKGROUND_ROTATION="backgroundRotation";let uv=ef(uN,uN.BACKGROUND_BLURRINESS),ux=ef(uN,uN.BACKGROUND_INTENSITY),uT=ef(uN,uN.BACKGROUND_ROTATION);class ub extends rF{static get type(){return"StorageTextureNode"}constructor(e,t,s=null){super(e,t),this.storeNode=s,this.isStorageTextureNode=!0,this.access=w.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e),e.getNodeProperties(this).storeNode=this.storeNode}setAccess(e){return this.access=e,this}generate(e,t){return null!==this.storeNode?this.generateStore(e):super.generate(e,t)}toReadWrite(){return this.setAccess(w.READ_WRITE)}toReadOnly(){return this.setAccess(w.READ_ONLY)}toWriteOnly(){return this.setAccess(w.WRITE_ONLY)}generateStore(e){let{uvNode:t,storeNode:s}=e.getNodeProperties(this),r=super.generate(e,"property"),i=t.build(e,"uvec2"),a=s.build(e,"vec4"),n=e.generateTextureStore(e,r,i,a);e.addLineFlowCode(n,this)}}let uw=eg(ub);class u_ extends iz{static get type(){return"UserDataNode"}constructor(e,t,s=null){super(e,t,s),this.userData=s}updateReference(e){return this.reference=null!==this.userData?this.userData:e.object.userData,this.reference}}let uV=new WeakMap;class uM extends I{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=b.OBJECT,this.updateAfterType=b.OBJECT,this.previousModelWorldMatrix=eK(new n.yGw),this.previousProjectionMatrix=eK(new n.yGw).setGroup(eX),this.previousCameraViewMatrix=eK(new n.yGw)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:s}){let r=uS(s);this.previousModelWorldMatrix.value.copy(r);let i=uA(t);i.frameId!==e&&(i.frameId=e,void 0===i.previousProjectionMatrix?(i.previousProjectionMatrix=new n.yGw,i.previousCameraViewMatrix=new n.yGw,i.currentProjectionMatrix=new n.yGw,i.currentCameraViewMatrix=new n.yGw,i.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),i.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(i.previousProjectionMatrix.copy(i.currentProjectionMatrix),i.previousCameraViewMatrix.copy(i.currentCameraViewMatrix)),i.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),i.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(i.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(i.previousCameraViewMatrix))}updateAfter({object:e}){uS(e).copy(e.matrixWorld)}setup(){let e=null===this.projectionMatrix?rk:eK(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),s=e.mul(r9).mul(it),r=this.previousProjectionMatrix.mul(t).mul(is);return tV(s.xy.div(s.w),r.xy.div(r.w))}}function uA(e){let t=uV.get(e);return void 0===t&&(t={},uV.set(e,t)),t}function uS(e,t=0){let s=uA(e),r=s[t];return void 0===r&&(s[t]=r=new n.yGw),r}let uR=ef(uM),uC=ey(([e,t])=>sb(1,e.oneMinus().div(t)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),uI=ey(([e,t])=>sb(e.div(t.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),uE=ey(([e,t])=>e.oneMinus().mul(t.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),uL=ey(([e,t])=>sP(e.mul(2).mul(t),e.oneMinus().mul(2).mul(t.oneMinus()).oneMinus(),sV(.5,e))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),uO=ey(([e,t])=>{let s=t.a.add(e.a.mul(t.a.oneMinus()));return ez(t.rgb.mul(t.a).add(e.rgb.mul(e.a).mul(t.a.oneMinus())).div(s),s)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),uz=ey(([e])=>uU(e.rgb)),uF=ey(([e,t=ew(1)])=>t.mix(uU(e.rgb),e.rgb)),uD=ey(([e,t=ew(1)])=>{let s=t_(e.r,e.g,e.b).div(3),r=e.r.max(e.g.max(e.b)),i=r.sub(s).mul(t).mul(-3);return sP(e.rgb,r,i)}),uP=ey(([e,t=ew(1)])=>{let s=eI(.57735,.57735,.57735),r=t.cos();return eI(e.rgb.mul(r).add(s.cross(e.rgb).mul(t.sin()).add(s.mul(sR(s,e.rgb).mul(r.oneMinus())))))}),uU=(e,t=eI(n.epp.getLuminanceCoefficients(new n.Pa4)))=>sR(e,t),uB=ey(([e,t=eI(1),s=eI(0),r=eI(1),i=ew(1),a=eI(n.epp.getLuminanceCoefficients(new n.Pa4,n.GUF))])=>{let o=e.rgb.dot(eI(a)),l=sw(e.rgb.mul(t).add(s),0).toVar(),u=l.pow(r).toVar();return ex(l.r.greaterThan(0),()=>{l.r.assign(u.r)}),ex(l.g.greaterThan(0),()=>{l.g.assign(u.g)}),ex(l.b.greaterThan(0),()=>{l.b.assign(u.b)}),l.assign(o.add(l.sub(o).mul(i))),ez(l.rgb,e.a)});class uk extends I{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){let{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}let uW=eg(uk),uG=new n.FM8;class uj extends rF{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class uH extends uj{static get type(){return"PassMultipleTextureNode"}constructor(e,t,s=!1){super(e,null),this.textureName=t,this.previousTexture=s}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class uq extends I{static get type(){return"PassNode"}constructor(e,t,s,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=s,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;let i=new n.$YQ;i.isRenderTargetTexture=!0,i.name="depth";let a=new n.ACn(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:n.cLu,...r});a.texture.name="output",a.depthTexture=i,this.renderTarget=a,this.updateBeforeType=b.FRAME,this._textures={output:a.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=eK(0),this._cameraFar=eK(0),this._mrt=null,this.isPassNode=!0}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let t=this._textures[e];return void 0===t&&((t=this.renderTarget.texture.clone()).isRenderTargetTexture=!0,t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return void 0===t&&((t=this.getTexture(e).clone()).isRenderTargetTexture=!0,this._previousTextures[e]=t),t}toggleTexture(e){let t=this._previousTextures[e];if(void 0!==t){let s=this._textures[e],r=this.renderTarget.textures.indexOf(s);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=s,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return void 0===t&&((t=eh(new uH(this,e))).updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return void 0===t&&(void 0===this._textureNodes[e]&&this.getTextureNode(e),(t=eh(new uH(this,e,!0))).updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(void 0===t){let s=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=nM(this.getTextureNode(e),s,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(void 0===t){let s=this._cameraNear,r=this._cameraFar,i=this.getViewZNode(e);this._linearDepthNodes[e]=t=n_(i,s,r)}return t}setup({renderer:e}){return this.renderTarget.samples=void 0===this.options.samples?e.samples:this.options.samples,!0===e.backend.isWebGLBackend&&(this.renderTarget.samples=0),this.renderTarget.depthTexture.isMultisampleRenderTargetTexture=this.renderTarget.samples>1,this.scope===uq.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){let{renderer:t}=e,{scene:s,camera:r}=this;this._pixelRatio=t.getPixelRatio();let i=t.getSize(uG);this.setSize(i.width,i.height);let a=t.getRenderTarget(),n=t.getMRT();for(let e in this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._previousTextures)this.toggleTexture(e);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(s,r),t.setRenderTarget(a),t.setMRT(n)}setSize(e,t){this._width=e,this._height=t;let s=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget.setSize(s,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}uq.COLOR="color",uq.DEPTH="depth";class u$ extends uq{static get type(){return"ToonOutlinePassNode"}constructor(e,t,s,r,i){super(uq.COLOR,e,t),this.colorNode=s,this.thicknessNode=r,this.alphaNode=i,this._materialCache=new WeakMap}updateBefore(e){let{renderer:t}=e,s=t.getRenderObjectFunction();t.setRenderObjectFunction((e,s,r,i,a,n,o,l)=>{if((a.isMeshToonMaterial||a.isMeshToonNodeMaterial)&&!1===a.wireframe){let u=this._getOutlineMaterial(a);t.renderObject(e,s,r,i,u,n,o,l)}t.renderObject(e,s,r,i,a,n,o,l)}),super.updateBefore(e),t.setRenderObjectFunction(s)}_createMaterial(){let e=new nk;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=n._Li;let t=ih.negate(),s=rk.mul(r9),r=ew(1),i=s.mul(ez(it,1)),a=s.mul(ez(it.add(t),1)),o=se(i.sub(a));return e.vertexNode=i.add(o.mul(this.thicknessNode).mul(i.w).mul(r)),e.colorNode=ez(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return void 0===t&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}let uX=ey(([e,t])=>e.mul(t).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),uY=ey(([e,t])=>(e=e.mul(t)).div(e.add(1)).clamp()).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),uZ=ey(([e,t])=>{let s=(e=(e=e.mul(t)).sub(.004).max(0)).mul(e.mul(6.2).add(.5)),r=e.mul(e.mul(6.2).add(1.7)).add(.06);return s.div(r).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),uK=ey(([e])=>{let t=e.mul(e.add(.0245786)).sub(90537e-9),s=e.mul(e.add(.432951).mul(.983729)).add(.238081);return t.div(s)}),uJ=ey(([e,t])=>{let s=eB(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=eB(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return e=e.mul(t).div(.6),e=uK(e=s.mul(e)),(e=r.mul(e)).clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),uQ=eB(eI(1.6605,-.1246,-.0182),eI(-.5876,1.1329,-.1006),eI(-.0728,-.0083,1.1187)),u0=eB(eI(.6274,.0691,.0164),eI(.3293,.9195,.088),eI(.0433,.0113,.8956)),u1=ey(([e])=>{let t=eI(e).toVar(),s=eI(t.mul(t)).toVar(),r=eI(s.mul(s)).toVar();return ew(15.5).mul(r.mul(s)).sub(tM(40.14,r.mul(t))).add(tM(31.96,r).sub(tM(6.868,s.mul(t))).add(tM(.4298,s).add(tM(.1191,t).sub(.00232))))}),u2=ey(([e,t])=>{let s=eI(e).toVar(),r=eB(eI(.856627153315983,.137318972929847,.11189821299995),eI(.0951212405381588,.761241990602591,.0767994186031903),eI(.0482516061458583,.101439036467562,.811302368396859)),i=eB(eI(1.1271005818144368,-.1413297634984383,-.14132976349843826),eI(-.11060664309660323,1.157823702216272,-.11060664309660294),eI(-.016493938717834573,-.016493938717834257,1.2519364065950405)),a=ew(-12.47393),n=ew(4.026069);return s.mulAssign(t),s.assign(u0.mul(s)),s.assign(r.mul(s)),s.assign(sw(s,1e-10)),s.assign(t5(s)),s.assign(s.sub(a).div(n.sub(a))),s.assign(sU(s,0,1)),s.assign(u1(s)),s.assign(i.mul(s)),s.assign(sI(sw(eI(0),s),eI(2.2))),s.assign(uQ.mul(s)),s.assign(sU(s,0,1)),s}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),u3=ey(([e,t])=>{let s=ew(.76),r=ew(.15),i=sb((e=e.mul(t)).r,sb(e.g,e.b)),a=sX(i.lessThan(.08),i.sub(tM(6.25,i.mul(i))),.04);e.subAssign(a);let n=sw(e.r,sw(e.g,e.b));ex(n.lessThan(s),()=>e);let o=tV(1,s),l=tV(1,o.mul(o).div(n.add(o.sub(s))));e.mulAssign(l.div(n));let u=tV(1,tA(1,r.mul(n.sub(l)).add(1)));return sP(e,eI(l),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class u4 extends S{static get type(){return"CodeNode"}constructor(e="",t=[],s=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=s,this.includes=t}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){for(let t of this.getIncludes(e))t.build(e);let t=e.getCodeFromNode(this,this.getNodeType(e));return t.code=this.code,t.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}let u5=eg(u4);class u6 extends u4{static get type(){return"FunctionNode"}constructor(e="",t=[],s=""){super(e,t,s)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){let t=e.getDataFromNode(this),s=t.nodeFunction;return void 0===s&&(s=e.parser.parseFunction(this.code),t.nodeFunction=s),s}generate(e,t){super.generate(e);let s=this.getNodeFunction(e),r=s.name,i=s.type,a=e.getCodeFromNode(this,i);""!==r&&(a.name=r);let n=e.getPropertyName(a),o=this.getNodeFunction(e).getCode(n);return(a.code=o+"\n","property"===t)?n:e.format(`${n}()`,i,t)}}let u9=(e,t=[],s="")=>{for(let e=0;e<t.length;e++){let s=t[e];"function"==typeof s&&(t[e]=s.functionNode)}let r=eh(new u6(e,t,s)),i=(...e)=>r.call(...e);return i.functionNode=r,i};class u8 extends S{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new n.pBf,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return null!==this.outputType}set value(e){this._value!==e&&(this._cache&&"URL"===this.inputType&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){let e=this.value;if(e&&null===this._cache&&"URL"===this.inputType&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&null!==e.value&&void 0!==e.value&&(("URL"===this.inputType||"String"===this.inputType)&&"string"==typeof e.value||"Number"===this.inputType&&"number"==typeof e.value||"Vector2"===this.inputType&&e.value.isVector2||"Vector3"===this.inputType&&e.value.isVector3||"Vector4"===this.inputType&&e.value.isVector4||"Color"===this.inputType&&e.value.isColor||"Matrix3"===this.inputType&&e.value.isMatrix3||"Matrix4"===this.inputType&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:ew()}serialize(e){super.serialize(e),null!==this.value?"ArrayBuffer"===this.inputType?e.value=v(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;null!==e.value&&(t="ArrayBuffer"===e.inputType?x(e.value):"Texture"===e.inputType?e.meta.textures[e.value]:e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}let u7=eg(u8);class de extends Map{get(e,t=null,...s){if(this.has(e))return super.get(e);if(null!==t){let r=t(...s);return this.set(e,r),r}}}class dt{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){let t=this.parameters[e];return t?t.getValue():null}}let ds=new de;class dr extends S{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new de,this._output=u7(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(let t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(let t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){let s=this._outputs;return void 0===s[e]?s[e]=u7(t):s[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){let s=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),s[e]=t,s[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),s[e]=t,s[e].events.addEventListener("refresh",this.onRefresh)):void 0===s[e]?(s[e]=u7(t),s[e].events.addEventListener("refresh",this.onRefresh)):s[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(let e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){let s=this.getObject()[e];if("function"==typeof s)return s(...t)}async callAsync(e,...t){let s=this.getObject()[e];if("function"==typeof s)return"AsyncFunction"===s.constructor.name?await s(...t):s(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){null!==e?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),null!==this._object)return this._object;let e=new dt(this),t=ds.get("THREE"),s=ds.get("TSL"),r=this.getMethod(this.codeNode),i=[e,this._local,ds,()=>this.refresh(),(e,t)=>this.setOutput(e,t),t,s];this._object=r(...i);let a=this._object.layout;if(a&&(!1===a.cache&&this._local.clear(),this._output.outputType=a.outputType||null,Array.isArray(a.elements)))for(let e of a.elements){let t=e.id||e.name;e.inputType&&(void 0===this.getParameter(t)&&this.setParameter(t,null),this.getParameter(t).inputType=e.inputType),e.outputType&&(void 0===this.getOutput(t)&&this.setOutput(t,null),this.getOutput(t).outputType=e.outputType)}return this._object}deserialize(e){for(let t in super.deserialize(e),this.parameters){let e=this.parameters[t];e.isScriptableNode&&(e=e.getDefaultOutput()),e.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){let e=this.getDefaultOutput().value;return e&&e.isNode?e:ew()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),null!==this._method)return this._method;let e="layout, init, main, dispose",t="var "+e+"; var output = {};\n"+this.codeNode.code+"\nreturn { ...output, "+e+" };";return this._method=Function("parameters","local","global","refresh","setOutput","THREE","TSL",t),this._method}dispose(){null!==this._method&&(this._object&&"function"==typeof this._object.dispose&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){let t=[d(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(let s in this.parameters)t.push(this.parameters[s].getCacheKey(e));return p(t)}set needsUpdate(e){!0===e&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return null===this.codeNode||(!0===this._needsOutputUpdate&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value),this}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}let di=eg(dr);class da extends S{static get type(){return"FogNode"}constructor(e,t){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=t}getViewZNode(e){let t;let s=e.context.getViewZ;return void 0!==s&&(t=s(this)),(t||ia.z).negate()}setup(){return this.factorNode}}let dn=eg(da);class dl extends da{static get type(){return"FogRangeNode"}constructor(e,t,s){super(e),this.isFogRangeNode=!0,this.nearNode=t,this.farNode=s}setup(e){let t=this.getViewZNode(e);return sW(this.nearNode,this.farNode,t)}}let du=eg(dl);class dd extends da{static get type(){return"FogExp2Node"}constructor(e,t){super(e),this.isFogExp2Node=!0,this.densityNode=t}setup(e){let t=this.getViewZNode(e),s=this.densityNode;return s.mul(s,t,t).negate().exp().oneMinus()}}let dp=eg(dd),dh=null,dc=null;class dm extends S{static get type(){return"RangeNode"}constructor(e=ew(),t=ew()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){let t=e.getTypeLength(y(this.minNode.value)),s=e.getTypeLength(y(this.maxNode.value));return t>s?t:s}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){let t=e.object,s=null;if(t.count>1){let r=this.minNode.value,i=this.maxNode.value,a=e.getTypeLength(y(r)),o=e.getTypeLength(y(i));dh=dh||new n.Ltg,dc=dc||new n.Ltg,dh.setScalar(0),dc.setScalar(0),1===a?dh.setScalar(r):r.isColor?dh.set(r.r,r.g,r.b):dh.set(r.x,r.y,r.z||0,r.w||0),1===o?dc.setScalar(i):i.isColor?dc.set(i.r,i.g,i.b):dc.set(i.x,i.y,i.z||0,i.w||0);let l=4*t.count,u=new Float32Array(l);for(let e=0;e<l;e++){let t=e%4,s=dh.getComponent(t),r=dc.getComponent(t);u[e]=n.M8C.lerp(s,r,Math.random())}let d=this.getNodeType(e);if(t.count<=4096)s=iC(u,"vec4",t.count).element(aW).convert(d);else{let t=new n.lb7(u,4);e.geometry.setAttribute("__range"+this.id,t),s=rc(t).convert(d)}}else s=ew(0);return s}}let dg=eg(dm);class df extends S{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){e.hasBuiltin(this._builtinName)}generate(e,t){let s=this.getBuiltinName(e),r=this.getNodeType(e);return"compute"===e.shaderStage?e.format(s,r,t):(console.warn(`ComputeBuiltinNode: Compute built-in value ${s} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(r))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}let dy=(e,t)=>eh(new df(e,t)),dN=dy("numWorkgroups","uvec3"),dv=dy("workgroupId","uvec3"),dx=dy("localId","uvec3"),dT=dy("subgroupSize","uint");class db extends S{constructor(e){super(),this.scope=e}generate(e){let{scope:t}=this,{renderer:s}=e;!0===s.backend.isWebGLBackend?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}let dw=eg(db);class d_ extends R{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let s;let r=e.context.assign;if(s=super.generate(e),!0!==r){let r=this.getNodeType(e);s=e.format(s,r,t)}return s}}class dV extends S{constructor(e,t,s=0){super(t),this.bufferType=t,this.bufferCount=s,this.isWorkgroupInfoNode=!0,this.scope=e}label(e){return this.name=e,this}getHash(){return this.uuid}setScope(e){return this.scope=e,this}getInputType(){return`${this.scope}Array`}element(e){return eh(new d_(this,e))}generate(e){return e.getScopedArray(this.name||`${this.scope}Array_${this.id}`,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}class dM extends I{static get type(){return"AtomicFunctionNode"}constructor(e,t,s,r=null){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=s,this.storeNode=r}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){let t=this.method,s=this.getNodeType(e),r=this.getInputType(e),i=this.pointerNode,a=this.valueNode,n=[];n.push(`&${i.build(e,r)}`),n.push(a.build(e,r));let o=`${e.getMethod(t,s)}( ${n.join(", ")} )`;if(null!==this.storeNode){let t=this.storeNode.build(e,r);e.addLineFlowCode(`${t} = ${o}`,this)}else e.addLineFlowCode(o,this)}}dM.ATOMIC_LOAD="atomicLoad",dM.ATOMIC_STORE="atomicStore",dM.ATOMIC_ADD="atomicAdd",dM.ATOMIC_SUB="atomicSub",dM.ATOMIC_MAX="atomicMax",dM.ATOMIC_MIN="atomicMin",dM.ATOMIC_AND="atomicAnd",dM.ATOMIC_OR="atomicOr",dM.ATOMIC_XOR="atomicXor";let dA=eg(dM),dS=(e,t,s,r)=>{let i=dA(e,t,s,r);return i.append(),i};function dR(e){let t=(a=a||new WeakMap).get(e);return void 0===t&&a.set(e,t={}),t}function dC(e){let t=dR(e);return t.shadowMatrix||(t.shadowMatrix=eK("mat4").setGroup(eX).onRenderUpdate(()=>(e.shadow.updateMatrices(e),e.shadow.matrix)))}function dI(e){let t=dR(e);return t.position||(t.position=eK(new n.Pa4).setGroup(eX).onRenderUpdate((t,s)=>s.value.setFromMatrixPosition(e.matrixWorld)))}function dE(e){let t=dR(e);return t.targetPosition||(t.targetPosition=eK(new n.Pa4).setGroup(eX).onRenderUpdate((t,s)=>s.value.setFromMatrixPosition(e.target.matrixWorld)))}let dL=e=>e.sort((e,t)=>e.id-t.id),dO=(e,t)=>{for(let s of t)if(s.isAnalyticLightNode&&s.light.id===e)return s;return null},dz=new WeakMap;class dF extends S{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=eI().toVar("totalDiffuse"),this.totalSpecularNode=eI().toVar("totalSpecular"),this.outgoingLightNode=eI().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}getHash(e){if(null===this._lightNodesHash){null===this._lightNodes&&this.setupLightsNode(e);let t=[];for(let e of this._lightNodes)t.push(e.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){for(let t of e.getDataFromNode(this).nodes)t.build(e)}setupLightsNode(e){let t=[],s=this._lightNodes,r=dL(this._lights),i=e.renderer.library;for(let e of r)if(e.isNode)t.push(eh(e));else{let r=null;if(null!==s&&(r=dO(e.id,s)),null===r){let s=i.getLightNodeClass(e.constructor);if(null===s){console.warn(`LightsNode.setupNodeLights: Light node not found for ${e.constructor.name}`);continue}let r=null;dz.has(e)?r=dz.get(e):(r=eh(new s(e)),dz.set(e,r)),t.push(r)}}this._lightNodes=t}setupLights(e,t){for(let s of t)s.build(e)}setup(e){null===this._lightNodes&&this.setupLightsNode(e);let t=e.context,s=t.lightingModel,r=this.outgoingLightNode;if(s){let{_lightNodes:i,totalDiffuseNode:a,totalSpecularNode:n}=this;t.outgoingLight=r;let o=e.addStack();e.getDataFromNode(this).nodes=o.nodes,s.start(t,o,e),this.setupLights(e,i),s.indirect(t,o,e);let{backdrop:l,backdropAlpha:u}=t,{directDiffuse:d,directSpecular:p,indirectDiffuse:h,indirectSpecular:c}=t.reflectedLight,m=d.add(h);null!==l&&(m=null!==u?eI(u.mix(m,l)):eI(l),t.material.transparent=!0),a.assign(m),n.assign(p.add(c)),r.assign(a.add(n)),s.finish(t,o,e),r=r.bypass(e.removeStack())}return r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}let dD=new WeakMap,dP=eI().toVar("shadowWorldPosition"),dU=ey(([e,t,s])=>{let r=ir.sub(e).length();return(r=r.sub(t).div(s.sub(t))).saturate()}),dB=e=>{let t=e.shadow.camera,s=iF("near","float",t).setGroup(eX),r=iF("far","float",t).setGroup(eX);return dU(rZ(e),s,r)},dk=e=>{let t=dD.get(e);if(void 0===t){let s=e.isPointLight?dB(e):null;(t=new nk).colorNode=ez(0,0,0,1),t.depthNode=s,t.isShadowNodeMaterial=!0,t.blending=n.jFi,t.name="ShadowMaterial",dD.set(e,t)}return t},dW=ey(({depthTexture:e,shadowCoord:t})=>rD(e,t.xy).compare(t.z)),dG=ey(({depthTexture:e,shadowCoord:t,shadow:s})=>{let r=(t,s)=>rD(e,t).compare(s),i=iF("mapSize","vec2",s).setGroup(eX),a=iF("radius","float",s).setGroup(eX),n=eA(1).div(i),o=n.x.negate().mul(a),l=n.y.negate().mul(a),u=n.x.mul(a),d=n.y.mul(a),p=o.div(2),h=l.div(2),c=u.div(2),m=d.div(2);return t_(r(t.xy.add(eA(o,l)),t.z),r(t.xy.add(eA(0,l)),t.z),r(t.xy.add(eA(u,l)),t.z),r(t.xy.add(eA(p,h)),t.z),r(t.xy.add(eA(0,h)),t.z),r(t.xy.add(eA(c,h)),t.z),r(t.xy.add(eA(o,0)),t.z),r(t.xy.add(eA(p,0)),t.z),r(t.xy,t.z),r(t.xy.add(eA(c,0)),t.z),r(t.xy.add(eA(u,0)),t.z),r(t.xy.add(eA(p,m)),t.z),r(t.xy.add(eA(0,m)),t.z),r(t.xy.add(eA(c,m)),t.z),r(t.xy.add(eA(o,d)),t.z),r(t.xy.add(eA(0,d)),t.z),r(t.xy.add(eA(u,d)),t.z)).mul(1/17)}),dj=ey(({depthTexture:e,shadowCoord:t,shadow:s})=>{let r=(t,s)=>rD(e,t).compare(s),i=iF("mapSize","vec2",s).setGroup(eX),a=eA(1).div(i),n=a.x,o=a.y,l=t.xy,u=st(l.mul(i).add(.5));return l.subAssign(u.mul(a)),t_(r(l,t.z),r(l.add(eA(n,0)),t.z),r(l.add(eA(0,o)),t.z),r(l.add(a),t.z),sP(r(l.add(eA(n.negate(),0)),t.z),r(l.add(eA(n.mul(2),0)),t.z),u.x),sP(r(l.add(eA(n.negate(),o)),t.z),r(l.add(eA(n.mul(2),o)),t.z),u.x),sP(r(l.add(eA(0,o.negate())),t.z),r(l.add(eA(0,o.mul(2))),t.z),u.y),sP(r(l.add(eA(n,o.negate())),t.z),r(l.add(eA(n,o.mul(2))),t.z),u.y),sP(sP(r(l.add(eA(n.negate(),o.negate())),t.z),r(l.add(eA(n.mul(2),o.negate())),t.z),u.x),sP(r(l.add(eA(n.negate(),o.mul(2))),t.z),r(l.add(eA(n.mul(2),o.mul(2))),t.z),u.x),u.y)).mul(1/9)}),dH=ey(({depthTexture:e,shadowCoord:t})=>{let s=ew(1).toVar(),r=rD(e).uv(t.xy).rg,i=sV(t.z,r.x);return ex(i.notEqual(ew(1)),()=>{let e=t.z.sub(r.x),a=sw(0,r.y.mul(r.y)),n=a.div(a.add(e.mul(e)));n=sU(tV(n,.3).div(.95-.3)),s.assign(sU(sw(i,n)))}),s}),dq=ey(({samples:e,radius:t,size:s,shadowPass:r})=>{let i=ew(0).toVar(),a=ew(0).toVar(),n=e.lessThanEqual(ew(1)).select(ew(0),ew(2).div(e.sub(1))),o=e.lessThanEqual(ew(1)).select(ew(0),ew(-1));a3({start:e_(0),end:e_(e),type:"int",condition:"<"},({i:e})=>{let l=o.add(ew(e).mul(n)),u=r.uv(t_(nl.xy,eA(0,l).mul(t)).div(s)).x;i.addAssign(u),a.addAssign(u.mul(u))}),i.divAssign(e),a.divAssign(e);let l=t6(a.sub(i.mul(i)));return eA(i,l)}),d$=ey(({samples:e,radius:t,size:s,shadowPass:r})=>{let i=ew(0).toVar(),a=ew(0).toVar(),n=e.lessThanEqual(ew(1)).select(ew(0),ew(2).div(e.sub(1))),o=e.lessThanEqual(ew(1)).select(ew(0),ew(-1));a3({start:e_(0),end:e_(e),type:"int",condition:"<"},({i:e})=>{let l=o.add(ew(e).mul(n)),u=r.uv(t_(nl.xy,eA(l,0).mul(t)).div(s));i.addAssign(u.x),a.addAssign(t_(u.y.mul(u.y),u.x.mul(u.x)))}),i.divAssign(e),a.divAssign(e);let l=t6(a.sub(i.mul(i)));return eA(i,l)}),dX=[dW,dG,dj,dH],dY=new ue;class dZ extends S{static get type(){return"ShadowNode"}constructor(e,t=null){super(),this.light=e,this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this.updateBeforeType=b.RENDER,this._node=null,this.isShadowNode=!0}setupShadowFilter(e,{filterFn:t,depthTexture:s,shadowCoord:r,shadow:i}){let a=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),n=t({depthTexture:s,shadowCoord:r,shadow:i});return a.select(n,ew(1))}setupShadowCoord(e,t){let s;let{shadow:r}=this,{renderer:i}=e,a=iF("bias","float",r).setGroup(eX),o=t;if(r.camera.isOrthographicCamera||!0!==i.logarithmicDepthBuffer)s=(o=o.xyz.div(o.w)).z,i.coordinateSystem===n.JCZ&&(s=s.mul(2).sub(1));else{let e=o.w;o=o.xy.div(e);let t=iF("near","float",r.camera).setGroup(eX),i=iF("far","float",r.camera).setGroup(eX);s=nA(e.negate(),t,i)}return eI(o.x,o.y.oneMinus(),s.add(a))}getShadowFilterFn(e){return dX[e]}setupShadow(e){let{renderer:t}=e,{light:s,shadow:r}=this,i=t.shadowMap.type,a=new n.$YQ(r.mapSize.width,r.mapSize.height);a.compareFunction=n.D67;let o=e.createRenderTarget(r.mapSize.width,r.mapSize.height);if(o.depthTexture=a,r.camera.updateProjectionMatrix(),i===n.dwk){a.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:n.av9,type:n.cLu}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:n.av9,type:n.cLu});let t=rD(a),s=rD(this.vsmShadowMapVertical.texture),i=iF("blurSamples","float",r).setGroup(eX),o=iF("radius","float",r).setGroup(eX),l=iF("mapSize","vec2",r).setGroup(eX),u=this.vsmMaterialVertical||(this.vsmMaterialVertical=new nk);u.fragmentNode=dq({samples:i,radius:o,size:l,shadowPass:t}).context(e.getSharedContext()),u.name="VSMVertical",(u=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new nk)).fragmentNode=d$({samples:i,radius:o,size:l,shadowPass:s}).context(e.getSharedContext()),u.name="VSMHorizontal"}let l=iF("intensity","float",r).setGroup(eX),u=iF("normalBias","float",r).setGroup(eX),d=dC(s).mul(dP.add(iN.mul(u))),p=this.setupShadowCoord(e,d),h=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(null===h)throw Error("THREE.WebGPURenderer: Shadow map type not supported yet.");let c=i===n.dwk?this.vsmShadowMapHorizontal.texture:a,m=this.setupShadowFilter(e,{filterFn:h,shadowTexture:o.texture,depthTexture:c,shadowCoord:p,shadow:r}),g=rD(o.texture,p),f=sP(1,m.rgb.mix(g,1),l.mul(g.a)).toVar();return this.shadowMap=o,this.shadow.map=o,f}setup(e){if(!1!==e.renderer.shadowMap.enabled)return ey(({material:t})=>{dP.assign(t.shadowPositionNode||ir);let s=this._node;return null===s&&(this._node=s=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(s=e.material.receivedShadowNode(s)),s})()}renderShadow(e){let{shadow:t,shadowMap:s}=this,{renderer:r,scene:i}=e;s.setSize(t.mapSize.width,t.mapSize.height),r.render(i,t.camera)}updateShadow(e){let{shadowMap:t,light:s,shadow:r}=this,{renderer:i,scene:a,camera:o}=e,l=i.shadowMap.type,u=t.depthTexture.version;this._depthVersionCached=u;let d=a.overrideMaterial;a.overrideMaterial=dk(s),r.camera.layers.mask=o.layers.mask;let p=i.getRenderTarget(),h=i.getRenderObjectFunction(),c=i.getMRT();i.setMRT(null),i.setRenderObjectFunction((e,...t)=>{(!0===e.castShadow||e.receiveShadow&&l===n.dwk)&&i.renderObject(e,...t)}),i.setRenderTarget(t),this.renderShadow(e),i.setRenderObjectFunction(h),!0!==s.isPointLight&&l===n.dwk&&this.vsmPass(i),i.setRenderTarget(p),i.setMRT(c),a.overrideMaterial=d}vsmPass(e){let{shadow:t}=this;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),dY.material=this.vsmMaterialVertical,dY.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),dY.material=this.vsmMaterialHorizontal,dY.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,null!==this.vsmShadowMapVertical&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),null!==this.vsmShadowMapHorizontal&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),this.updateBeforeType=b.NONE}updateBefore(e){let{shadow:t}=this;(t.needsUpdate||t.autoUpdate)&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}let dK=ey(e=>{let{lightDistance:t,cutoffDistance:s,decayExponent:r}=e,i=t.pow(r).max(.01).reciprocal();return s.greaterThan(0).select(i.mul(t.div(s).pow4().oneMinus().clamp().pow2()),i)}),dJ=ey(({color:e,lightViewPosition:t,cutoffDistance:s,decayExponent:r},i)=>{let a=i.context.lightingModel,n=t.sub(ia),o=n.normalize(),l=dK({lightDistance:n.length(),cutoffDistance:s,decayExponent:r}),u=e.mul(l),d=i.context.reflectedLight;a.direct({lightDirection:o,lightColor:u,reflectedLight:d},i.stack,i)}),dQ=ey(([e=rI()])=>{let t=e.mul(2),s=t.x.floor(),r=t.y.floor();return s.add(r).mod(2).sign()}),d0=ey(([e,t,s])=>{let r=ew(s).toVar(),i=ew(t).toVar();return sX(eM(e).toVar(),i,r)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),d1=ey(([e,t])=>{let s=eM(t).toVar(),r=ew(e).toVar();return sX(s,r.negate(),r)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),d2=ey(([e])=>e_(t8(ew(e).toVar()))).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),d3=ey(([e,t])=>{let s=ew(e).toVar();return t.assign(d2(s)),s.sub(ew(t))}),d4=lL([ey(([e,t,s,r,i,a])=>{let n=ew(a).toVar(),o=ew(i).toVar(),l=ew(r).toVar(),u=ew(s).toVar(),d=ew(t).toVar(),p=ew(e).toVar(),h=ew(tV(1,o)).toVar();return tV(1,n).mul(p.mul(h).add(d.mul(o))).add(n.mul(u.mul(h).add(l.mul(o))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),ey(([e,t,s,r,i,a])=>{let n=ew(a).toVar(),o=ew(i).toVar(),l=eI(r).toVar(),u=eI(s).toVar(),d=eI(t).toVar(),p=eI(e).toVar(),h=ew(tV(1,o)).toVar();return tV(1,n).mul(p.mul(h).add(d.mul(o))).add(n.mul(u.mul(h).add(l.mul(o))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]})]),d5=lL([ey(([e,t,s,r,i,a,n,o,l,u,d])=>{let p=ew(d).toVar(),h=ew(u).toVar(),c=ew(l).toVar(),m=ew(o).toVar(),g=ew(n).toVar(),f=ew(a).toVar(),y=ew(i).toVar(),N=ew(r).toVar(),v=ew(s).toVar(),x=ew(t).toVar(),T=ew(e).toVar(),b=ew(tV(1,c)).toVar(),w=ew(tV(1,h)).toVar();return ew(tV(1,p)).toVar().mul(w.mul(T.mul(b).add(x.mul(c))).add(h.mul(v.mul(b).add(N.mul(c))))).add(p.mul(w.mul(y.mul(b).add(f.mul(c))).add(h.mul(g.mul(b).add(m.mul(c))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),ey(([e,t,s,r,i,a,n,o,l,u,d])=>{let p=ew(d).toVar(),h=ew(u).toVar(),c=ew(l).toVar(),m=eI(o).toVar(),g=eI(n).toVar(),f=eI(a).toVar(),y=eI(i).toVar(),N=eI(r).toVar(),v=eI(s).toVar(),x=eI(t).toVar(),T=eI(e).toVar(),b=ew(tV(1,c)).toVar(),w=ew(tV(1,h)).toVar();return ew(tV(1,p)).toVar().mul(w.mul(T.mul(b).add(x.mul(c))).add(h.mul(v.mul(b).add(N.mul(c))))).add(p.mul(w.mul(y.mul(b).add(f.mul(c))).add(h.mul(g.mul(b).add(m.mul(c))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]})]),d6=lL([ey(([e,t,s])=>{let r=ew(s).toVar(),i=ew(t).toVar(),a=eV(e).toVar(),n=eV(a.bitAnd(eV(7))).toVar(),o=ew(d0(n.lessThan(eV(4)),i,r)).toVar(),l=ew(tM(2,d0(n.lessThan(eV(4)),r,i))).toVar();return d1(o,eM(n.bitAnd(eV(1)))).add(d1(l,eM(n.bitAnd(eV(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),ey(([e,t,s,r])=>{let i=ew(r).toVar(),a=ew(s).toVar(),n=ew(t).toVar(),o=eV(e).toVar(),l=eV(o.bitAnd(eV(15))).toVar(),u=ew(d0(l.lessThan(eV(8)),n,a)).toVar(),d=ew(d0(l.lessThan(eV(4)),a,d0(l.equal(eV(12)).or(l.equal(eV(14))),n,i))).toVar();return d1(u,eM(l.bitAnd(eV(1)))).add(d1(d,eM(l.bitAnd(eV(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]})]),d9=lL([ey(([e,t,s])=>{let r=ew(s).toVar(),i=ew(t).toVar(),a=eL(e).toVar();return eI(d6(a.x,i,r),d6(a.y,i,r),d6(a.z,i,r))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),ey(([e,t,s,r])=>{let i=ew(r).toVar(),a=ew(s).toVar(),n=ew(t).toVar(),o=eL(e).toVar();return eI(d6(o.x,n,a,i),d6(o.y,n,a,i),d6(o.z,n,a,i))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]})]),d8=ey(([e])=>tM(.6616,ew(e).toVar())).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),d7=ey(([e])=>tM(.982,ew(e).toVar())).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),pe=lL([d8,ey(([e])=>tM(.6616,eI(e).toVar())).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]})]),pt=lL([d7,ey(([e])=>tM(.982,eI(e).toVar())).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]})]),ps=ey(([e,t])=>{let s=e_(t).toVar(),r=eV(e).toVar();return r.shiftLeft(s).bitOr(r.shiftRight(e_(32).sub(s)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),pr=ey(([e,t,s])=>{e.subAssign(s),e.bitXorAssign(ps(s,e_(4))),s.addAssign(t),t.subAssign(e),t.bitXorAssign(ps(e,e_(6))),e.addAssign(s),s.subAssign(t),s.bitXorAssign(ps(t,e_(8))),t.addAssign(e),e.subAssign(s),e.bitXorAssign(ps(s,e_(16))),s.addAssign(t),t.subAssign(e),t.bitXorAssign(ps(e,e_(19))),e.addAssign(s),s.subAssign(t),s.bitXorAssign(ps(t,e_(4))),t.addAssign(e)}),pi=ey(([e,t,s])=>{let r=eV(s).toVar(),i=eV(t).toVar(),a=eV(e).toVar();return r.bitXorAssign(i),r.subAssign(ps(i,e_(14))),a.bitXorAssign(r),a.subAssign(ps(r,e_(11))),i.bitXorAssign(a),i.subAssign(ps(a,e_(25))),r.bitXorAssign(i),r.subAssign(ps(i,e_(16))),a.bitXorAssign(r),a.subAssign(ps(r,e_(4))),i.bitXorAssign(a),i.subAssign(ps(a,e_(14))),r.bitXorAssign(i),r.subAssign(ps(i,e_(24))),r}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),pa=ey(([e])=>ew(eV(e).toVar()).div(ew(eV(e_(4294967295))))).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),pn=ey(([e])=>{let t=ew(e).toVar();return t.mul(t).mul(t).mul(t.mul(t.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),po=ey(([e])=>{let t=e_(e).toVar(),s=eV(eV(1)).toVar(),r=eV(eV(e_(3735928559)).add(s.shiftLeft(eV(2))).add(eV(13))).toVar();return pi(r.add(eV(t)),r,r)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),pl=ey(([e,t])=>{let s=e_(t).toVar(),r=e_(e).toVar(),i=eV(eV(2)).toVar(),a=eV().toVar(),n=eV().toVar(),o=eV().toVar();return a.assign(n.assign(o.assign(eV(e_(3735928559)).add(i.shiftLeft(eV(2))).add(eV(13))))),a.addAssign(eV(r)),n.addAssign(eV(s)),pi(a,n,o)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),pu=lL([po,pl,ey(([e,t,s])=>{let r=e_(s).toVar(),i=e_(t).toVar(),a=e_(e).toVar(),n=eV(eV(3)).toVar(),o=eV().toVar(),l=eV().toVar(),u=eV().toVar();return o.assign(l.assign(u.assign(eV(e_(3735928559)).add(n.shiftLeft(eV(2))).add(eV(13))))),o.addAssign(eV(a)),l.addAssign(eV(i)),u.addAssign(eV(r)),pi(o,l,u)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),ey(([e,t,s,r])=>{let i=e_(r).toVar(),a=e_(s).toVar(),n=e_(t).toVar(),o=e_(e).toVar(),l=eV(eV(4)).toVar(),u=eV().toVar(),d=eV().toVar(),p=eV().toVar();return u.assign(d.assign(p.assign(eV(e_(3735928559)).add(l.shiftLeft(eV(2))).add(eV(13))))),u.addAssign(eV(o)),d.addAssign(eV(n)),p.addAssign(eV(a)),pr(u,d,p),u.addAssign(eV(i)),pi(u,d,p)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),ey(([e,t,s,r,i])=>{let a=e_(i).toVar(),n=e_(r).toVar(),o=e_(s).toVar(),l=e_(t).toVar(),u=e_(e).toVar(),d=eV(eV(5)).toVar(),p=eV().toVar(),h=eV().toVar(),c=eV().toVar();return p.assign(h.assign(c.assign(eV(e_(3735928559)).add(d.shiftLeft(eV(2))).add(eV(13))))),p.addAssign(eV(u)),h.addAssign(eV(l)),c.addAssign(eV(o)),pr(p,h,c),p.addAssign(eV(n)),h.addAssign(eV(a)),pi(p,h,c)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]})]),pd=lL([ey(([e,t])=>{let s=e_(t).toVar(),r=eV(pu(e_(e).toVar(),s)).toVar(),i=eL().toVar();return i.x.assign(r.bitAnd(e_(255))),i.y.assign(r.shiftRight(e_(8)).bitAnd(e_(255))),i.z.assign(r.shiftRight(e_(16)).bitAnd(e_(255))),i}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),ey(([e,t,s])=>{let r=e_(s).toVar(),i=e_(t).toVar(),a=eV(pu(e_(e).toVar(),i,r)).toVar(),n=eL().toVar();return n.x.assign(a.bitAnd(e_(255))),n.y.assign(a.shiftRight(e_(8)).bitAnd(e_(255))),n.z.assign(a.shiftRight(e_(16)).bitAnd(e_(255))),n}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]})]),pp=lL([ey(([e])=>{let t=eA(e).toVar(),s=e_().toVar(),r=e_().toVar(),i=ew(d3(t.x,s)).toVar(),a=ew(d3(t.y,r)).toVar(),n=ew(pn(i)).toVar(),o=ew(pn(a)).toVar();return pe(ew(d4(d6(pu(s,r),i,a),d6(pu(s.add(e_(1)),r),i.sub(1),a),d6(pu(s,r.add(e_(1))),i,a.sub(1)),d6(pu(s.add(e_(1)),r.add(e_(1))),i.sub(1),a.sub(1)),n,o)).toVar())}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),ey(([e])=>{let t=eI(e).toVar(),s=e_().toVar(),r=e_().toVar(),i=e_().toVar(),a=ew(d3(t.x,s)).toVar(),n=ew(d3(t.y,r)).toVar(),o=ew(d3(t.z,i)).toVar(),l=ew(pn(a)).toVar(),u=ew(pn(n)).toVar(),d=ew(pn(o)).toVar();return pt(ew(d5(d6(pu(s,r,i),a,n,o),d6(pu(s.add(e_(1)),r,i),a.sub(1),n,o),d6(pu(s,r.add(e_(1)),i),a,n.sub(1),o),d6(pu(s.add(e_(1)),r.add(e_(1)),i),a.sub(1),n.sub(1),o),d6(pu(s,r,i.add(e_(1))),a,n,o.sub(1)),d6(pu(s.add(e_(1)),r,i.add(e_(1))),a.sub(1),n,o.sub(1)),d6(pu(s,r.add(e_(1)),i.add(e_(1))),a,n.sub(1),o.sub(1)),d6(pu(s.add(e_(1)),r.add(e_(1)),i.add(e_(1))),a.sub(1),n.sub(1),o.sub(1)),l,u,d)).toVar())}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]})]),ph=lL([ey(([e])=>{let t=eA(e).toVar(),s=e_().toVar(),r=e_().toVar(),i=ew(d3(t.x,s)).toVar(),a=ew(d3(t.y,r)).toVar(),n=ew(pn(i)).toVar(),o=ew(pn(a)).toVar();return pe(eI(d4(d9(pd(s,r),i,a),d9(pd(s.add(e_(1)),r),i.sub(1),a),d9(pd(s,r.add(e_(1))),i,a.sub(1)),d9(pd(s.add(e_(1)),r.add(e_(1))),i.sub(1),a.sub(1)),n,o)).toVar())}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),ey(([e])=>{let t=eI(e).toVar(),s=e_().toVar(),r=e_().toVar(),i=e_().toVar(),a=ew(d3(t.x,s)).toVar(),n=ew(d3(t.y,r)).toVar(),o=ew(d3(t.z,i)).toVar(),l=ew(pn(a)).toVar(),u=ew(pn(n)).toVar(),d=ew(pn(o)).toVar();return pt(eI(d5(d9(pd(s,r,i),a,n,o),d9(pd(s.add(e_(1)),r,i),a.sub(1),n,o),d9(pd(s,r.add(e_(1)),i),a,n.sub(1),o),d9(pd(s.add(e_(1)),r.add(e_(1)),i),a.sub(1),n.sub(1),o),d9(pd(s,r,i.add(e_(1))),a,n,o.sub(1)),d9(pd(s.add(e_(1)),r,i.add(e_(1))),a.sub(1),n,o.sub(1)),d9(pd(s,r.add(e_(1)),i.add(e_(1))),a,n.sub(1),o.sub(1)),d9(pd(s.add(e_(1)),r.add(e_(1)),i.add(e_(1))),a.sub(1),n.sub(1),o.sub(1)),l,u,d)).toVar())}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]})]),pc=ey(([e])=>pa(pu(e_(d2(ew(e).toVar())).toVar()))).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),pm=lL([pc,ey(([e])=>{let t=eA(e).toVar();return pa(pu(e_(d2(t.x)).toVar(),e_(d2(t.y)).toVar()))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),ey(([e])=>{let t=eI(e).toVar();return pa(pu(e_(d2(t.x)).toVar(),e_(d2(t.y)).toVar(),e_(d2(t.z)).toVar()))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),ey(([e])=>{let t=ez(e).toVar(),s=e_(d2(t.x)).toVar();return pa(pu(s,e_(d2(t.y)).toVar(),e_(d2(t.z)).toVar(),e_(d2(t.w)).toVar()))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]})]),pg=ey(([e])=>{let t=e_(d2(ew(e).toVar())).toVar();return eI(pa(pu(t,e_(0))),pa(pu(t,e_(1))),pa(pu(t,e_(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),pf=lL([pg,ey(([e])=>{let t=eA(e).toVar(),s=e_(d2(t.x)).toVar(),r=e_(d2(t.y)).toVar();return eI(pa(pu(s,r,e_(0))),pa(pu(s,r,e_(1))),pa(pu(s,r,e_(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),ey(([e])=>{let t=eI(e).toVar(),s=e_(d2(t.x)).toVar(),r=e_(d2(t.y)).toVar(),i=e_(d2(t.z)).toVar();return eI(pa(pu(s,r,i,e_(0))),pa(pu(s,r,i,e_(1))),pa(pu(s,r,i,e_(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),ey(([e])=>{let t=ez(e).toVar(),s=e_(d2(t.x)).toVar(),r=e_(d2(t.y)).toVar(),i=e_(d2(t.z)).toVar(),a=e_(d2(t.w)).toVar();return eI(pa(pu(s,r,i,a,e_(0))),pa(pu(s,r,i,a,e_(1))),pa(pu(s,r,i,a,e_(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]})]),py=ey(([e,t,s,r])=>{let i=ew(r).toVar(),a=ew(s).toVar(),n=e_(t).toVar(),o=eI(e).toVar(),l=ew(0).toVar(),u=ew(1).toVar();return a3(n,()=>{l.addAssign(u.mul(pp(o))),u.mulAssign(i),o.mulAssign(a)}),l}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),pN=ey(([e,t,s,r])=>{let i=ew(r).toVar(),a=ew(s).toVar(),n=e_(t).toVar(),o=eI(e).toVar(),l=eI(0).toVar(),u=ew(1).toVar();return a3(n,()=>{l.addAssign(u.mul(ph(o))),u.mulAssign(i),o.mulAssign(a)}),l}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),pv=ey(([e,t,s,r])=>{let i=ew(r).toVar(),a=ew(s).toVar(),n=e_(t).toVar(),o=eI(e).toVar();return eA(py(o,n,a,i),py(o.add(eI(e_(19),e_(193),e_(17))),n,a,i))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),px=ey(([e,t,s,r])=>{let i=ew(r).toVar(),a=ew(s).toVar(),n=e_(t).toVar(),o=eI(e).toVar();return ez(eI(pN(o,n,a,i)).toVar(),ew(py(o.add(eI(e_(19),e_(193),e_(17))),n,a,i)).toVar())}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),pT=lL([ey(([e,t,s,r,i,a,n])=>{let o=e_(n).toVar(),l=ew(a).toVar(),u=e_(i).toVar(),d=e_(r).toVar(),p=e_(s).toVar(),h=e_(t).toVar(),c=eA(e).toVar(),m=eI(pf(eA(h.add(d),p.add(u)))).toVar(),g=eA(m.x,m.y).toVar();g.subAssign(.5),g.mulAssign(l),g.addAssign(.5);let f=eA(eA(ew(h),ew(p)).add(g)).toVar(),y=eA(f.sub(c)).toVar();return ex(o.equal(e_(2)),()=>sl(y.x).add(sl(y.y))),ex(o.equal(e_(3)),()=>sw(sl(y.x),sl(y.y))),sR(y,y)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),ey(([e,t,s,r,i,a,n,o,l])=>{let u=e_(l).toVar(),d=ew(o).toVar(),p=e_(n).toVar(),h=e_(a).toVar(),c=e_(i).toVar(),m=e_(r).toVar(),g=e_(s).toVar(),f=e_(t).toVar(),y=eI(e).toVar(),N=eI(pf(eI(f.add(c),g.add(h),m.add(p)))).toVar();N.subAssign(.5),N.mulAssign(d),N.addAssign(.5);let v=eI(eI(ew(f),ew(g),ew(m)).add(N)).toVar(),x=eI(v.sub(y)).toVar();return ex(u.equal(e_(2)),()=>sl(x.x).add(sl(x.y)).add(sl(x.z))),ex(u.equal(e_(3)),()=>sw(sw(sl(x.x),sl(x.y)),sl(x.z))),sR(x,x)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),pb=ey(([e,t,s])=>{let r=e_(s).toVar(),i=ew(t).toVar(),a=eA(e).toVar(),n=e_().toVar(),o=e_().toVar(),l=eA(d3(a.x,n),d3(a.y,o)).toVar(),u=ew(1e6).toVar();return a3({start:-1,end:e_(1),name:"x",condition:"<="},({x:e})=>{a3({start:-1,end:e_(1),name:"y",condition:"<="},({y:t})=>{let s=ew(pT(l,e,t,n,o,i,r)).toVar();u.assign(sb(u,s))})}),ex(r.equal(e_(0)),()=>{u.assign(t6(u))}),u}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),pw=ey(([e,t,s])=>{let r=e_(s).toVar(),i=ew(t).toVar(),a=eA(e).toVar(),n=e_().toVar(),o=e_().toVar(),l=eA(d3(a.x,n),d3(a.y,o)).toVar(),u=eA(1e6,1e6).toVar();return a3({start:-1,end:e_(1),name:"x",condition:"<="},({x:e})=>{a3({start:-1,end:e_(1),name:"y",condition:"<="},({y:t})=>{let s=ew(pT(l,e,t,n,o,i,r)).toVar();ex(s.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(s)}).ElseIf(s.lessThan(u.y),()=>{u.y.assign(s)})})}),ex(r.equal(e_(0)),()=>{u.assign(t6(u))}),u}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),p_=ey(([e,t,s])=>{let r=e_(s).toVar(),i=ew(t).toVar(),a=eA(e).toVar(),n=e_().toVar(),o=e_().toVar(),l=eA(d3(a.x,n),d3(a.y,o)).toVar(),u=eI(1e6,1e6,1e6).toVar();return a3({start:-1,end:e_(1),name:"x",condition:"<="},({x:e})=>{a3({start:-1,end:e_(1),name:"y",condition:"<="},({y:t})=>{let s=ew(pT(l,e,t,n,o,i,r)).toVar();ex(s.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(s)}).ElseIf(s.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(s)}).ElseIf(s.lessThan(u.z),()=>{u.z.assign(s)})})}),ex(r.equal(e_(0)),()=>{u.assign(t6(u))}),u}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),pV=lL([pb,ey(([e,t,s])=>{let r=e_(s).toVar(),i=ew(t).toVar(),a=eI(e).toVar(),n=e_().toVar(),o=e_().toVar(),l=e_().toVar(),u=eI(d3(a.x,n),d3(a.y,o),d3(a.z,l)).toVar(),d=ew(1e6).toVar();return a3({start:-1,end:e_(1),name:"x",condition:"<="},({x:e})=>{a3({start:-1,end:e_(1),name:"y",condition:"<="},({y:t})=>{a3({start:-1,end:e_(1),name:"z",condition:"<="},({z:s})=>{let a=ew(pT(u,e,t,s,n,o,l,i,r)).toVar();d.assign(sb(d,a))})})}),ex(r.equal(e_(0)),()=>{d.assign(t6(d))}),d}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),pM=lL([pw,ey(([e,t,s])=>{let r=e_(s).toVar(),i=ew(t).toVar(),a=eI(e).toVar(),n=e_().toVar(),o=e_().toVar(),l=e_().toVar(),u=eI(d3(a.x,n),d3(a.y,o),d3(a.z,l)).toVar(),d=eA(1e6,1e6).toVar();return a3({start:-1,end:e_(1),name:"x",condition:"<="},({x:e})=>{a3({start:-1,end:e_(1),name:"y",condition:"<="},({y:t})=>{a3({start:-1,end:e_(1),name:"z",condition:"<="},({z:s})=>{let a=ew(pT(u,e,t,s,n,o,l,i,r)).toVar();ex(a.lessThan(d.x),()=>{d.y.assign(d.x),d.x.assign(a)}).ElseIf(a.lessThan(d.y),()=>{d.y.assign(a)})})})}),ex(r.equal(e_(0)),()=>{d.assign(t6(d))}),d}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),pA=lL([p_,ey(([e,t,s])=>{let r=e_(s).toVar(),i=ew(t).toVar(),a=eI(e).toVar(),n=e_().toVar(),o=e_().toVar(),l=e_().toVar(),u=eI(d3(a.x,n),d3(a.y,o),d3(a.z,l)).toVar(),d=eI(1e6,1e6,1e6).toVar();return a3({start:-1,end:e_(1),name:"x",condition:"<="},({x:e})=>{a3({start:-1,end:e_(1),name:"y",condition:"<="},({y:t})=>{a3({start:-1,end:e_(1),name:"z",condition:"<="},({z:s})=>{let a=ew(pT(u,e,t,s,n,o,l,i,r)).toVar();ex(a.lessThan(d.x),()=>{d.z.assign(d.y),d.y.assign(d.x),d.x.assign(a)}).ElseIf(a.lessThan(d.y),()=>{d.z.assign(d.y),d.y.assign(a)}).ElseIf(a.lessThan(d.z),()=>{d.z.assign(a)})})})}),ex(r.equal(e_(0)),()=>{d.assign(t6(d))}),d}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),pS=ey(([e])=>{let t=e.y,s=e.z,r=eI().toVar();return ex(t.lessThan(1e-4),()=>{r.assign(eI(s,s,s))}).Else(()=>{let i=e.x,a=e_(sy(i=i.sub(t8(i)).mul(6).toVar())),n=i.sub(ew(a)),o=s.mul(t.oneMinus()),l=s.mul(t.mul(n).oneMinus()),u=s.mul(t.mul(n.oneMinus()).oneMinus());ex(a.equal(e_(0)),()=>{r.assign(eI(s,u,o))}).ElseIf(a.equal(e_(1)),()=>{r.assign(eI(l,s,o))}).ElseIf(a.equal(e_(2)),()=>{r.assign(eI(o,s,u))}).ElseIf(a.equal(e_(3)),()=>{r.assign(eI(o,l,s))}).ElseIf(a.equal(e_(4)),()=>{r.assign(eI(u,o,s))}).Else(()=>{r.assign(eI(s,o,l))})}),r}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),pR=ey(([e])=>{let t=eI(e).toVar(),s=ew(t.x).toVar(),r=ew(t.y).toVar(),i=ew(t.z).toVar(),a=ew(sb(s,sb(r,i))).toVar(),n=ew(sw(s,sw(r,i))).toVar(),o=ew(n.sub(a)).toVar(),l=ew().toVar(),u=ew().toVar(),d=ew().toVar();return d.assign(n),ex(n.greaterThan(0),()=>{u.assign(o.div(n))}).Else(()=>{u.assign(0)}),ex(u.lessThanEqual(0),()=>{l.assign(0)}).Else(()=>{ex(s.greaterThanEqual(n),()=>{l.assign(r.sub(i).div(o))}).ElseIf(r.greaterThanEqual(n),()=>{l.assign(t_(2,i.sub(s).div(o)))}).Else(()=>{l.assign(t_(4,s.sub(r).div(o)))}),l.mulAssign(1/6),ex(l.lessThan(0),()=>{l.addAssign(1)})}),eI(l,u,d)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),pC=ey(([e])=>{let t=eI(e).toVar(),s=eO(tE(t,eI(.04045))).toVar();return sP(eI(t.div(12.92)).toVar(),eI(sI(sw(t.add(eI(.055)),eI(0)).div(1.055),eI(2.4))).toVar(),s)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),pI=(e,t)=>{e=ew(e);let s=eA((t=ew(t)).dFdx(),t.dFdy()).length().mul(.7071067811865476);return sW(e.sub(s),e.add(s),t)},pE=(e,t,s,r)=>sP(e,t,s[r].clamp()),pL=(e,t,s,r,i)=>sP(e,t,pI(s,r[i])),pO=ey(([e,t,s])=>{let r=se(e).toVar("nDir"),i=tV(ew(.5).mul(t.sub(s)),ir).div(r).toVar("rbmax"),a=tV(ew(-.5).mul(t.sub(s)),ir).div(r).toVar("rbmin"),n=eI().toVar("rbminmax");n.x=r.x.greaterThan(ew(0)).select(i.x,a.x),n.y=r.y.greaterThan(ew(0)).select(i.y,a.y),n.z=r.z.greaterThan(ew(0)).select(i.z,a.z);let o=sb(sb(n.x,n.y),n.z).toVar("correction");return ir.add(r.mul(o)).toVar("boxIntersection").sub(s)}),pz=ey(([e,t])=>{let s=e.x,r=e.y,i=e.z,a=t.element(0).mul(.886227);return(a=(a=(a=(a=(a=(a=(a=a.add(t.element(1).mul(1.023328).mul(r))).add(t.element(2).mul(1.023328).mul(i))).add(t.element(3).mul(1.023328).mul(s))).add(t.element(4).mul(.858086).mul(s).mul(r))).add(t.element(5).mul(.858086).mul(r).mul(i))).add(t.element(6).mul(i.mul(i).mul(.743125).sub(.247708)))).add(t.element(7).mul(.858086).mul(s).mul(i))).add(t.element(8).mul(.429043).mul(tM(s,s).sub(tM(r,r))))});var pF=Object.freeze({__proto__:null,BRDF_GGX:oi,BRDF_Lambert:n6,BasicShadowFilter:dW,Break:a4,Continue:()=>rV("continue").append(),DFGApprox:oa,D_GGX:ot,Discard:rM,EPSILON:t$,F_Schlick:n5,Fn:ey,INFINITY:tX,If:ex,Loop:a3,NodeAccess:w,NodeShaderStage:T,NodeType:{BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},NodeUpdateType:b,PCFShadowFilter:dG,PCFSoftShadowFilter:dj,PI:tY,PI2:tZ,Return:()=>rV("return").append(),Schlick_to_F0:oo,ScriptableNodeResources:ds,ShaderNode:ep,TBNViewMatrix:iJ,VSMShadowFilter:dH,V_GGX_SmithCorrelated:n7,abs:sl,acesFilmicToneMapping:uJ,acos:sn,add:t_,addMethodChaining:k,addNodeElement:function(e){console.warn("THREE.TSLBase: AddNodeElement has been removed in favor of tree-shaking. Trying add",e)},agxToneMapping:u2,all:tK,alphaT:ts,and:tz,anisotropy:tr,anisotropyB:ta,anisotropyT:ti,any:tJ,append:eT,arrayBuffer:e=>eh(new P(e,"ArrayBuffer")),asin:sa,assign:tx,atan:so,atan2:sT,atomicAdd:(e,t,s=null)=>dS(dM.ATOMIC_ADD,e,t,s),atomicAnd:(e,t,s=null)=>dS(dM.ATOMIC_AND,e,t,s),atomicFunc:dS,atomicMax:(e,t,s=null)=>dS(dM.ATOMIC_MAX,e,t,s),atomicMin:(e,t,s=null)=>dS(dM.ATOMIC_MIN,e,t,s),atomicOr:(e,t,s=null)=>dS(dM.ATOMIC_OR,e,t,s),atomicStore:(e,t,s=null)=>dS(dM.ATOMIC_STORE,e,t,s),atomicSub:(e,t,s=null)=>dS(dM.ATOMIC_SUB,e,t,s),atomicXor:(e,t,s=null)=>dS(dM.ATOMIC_XOR,e,t,s),attenuationColor:ty,attenuationDistance:tf,attribute:rC,attributeArray:(e,t="float")=>uh(new ul(e,f(t)),t,e),backgroundBlurriness:uv,backgroundIntensity:ux,backgroundRotation:uT,batch:aJ,billboarding:lU,bitAnd:tU,bitNot:tB,bitOr:tk,bitXor:tW,bitangentGeometry:iq,bitangentLocal:i$,bitangentView:iX,bitangentWorld:iY,bitcast:sv,blendBurn:uC,blendColor:uO,blendDodge:uI,blendOverlay:uL,blendScreen:uE,blur:o9,bool:eM,buffer:iC,bufferAttribute:rp,bumpMap:i9,burn:(...e)=>(console.warn('THREE.TSL: "burn" has been renamed. Use "blendBurn" instead.'),uC(e)),bvec2:eC,bvec3:eO,bvec4:eP,bypass:rx,cache:rN,call:tb,cameraFar:rB,cameraNear:rU,cameraNormalMatrix:rH,cameraPosition:rq,cameraProjectionMatrix:rk,cameraProjectionMatrixInverse:rW,cameraViewMatrix:rG,cameraWorldMatrix:rj,cbrt:sF,cdl:uB,ceil:t7,checker:dQ,cineonToneMapping:uZ,clamp:sU,clearcoat:e5,clearcoatRoughness:e6,code:u5,color:eb,colorSpaceToWorking:rs,colorToDirection:e=>eh(e).mul(2).sub(1),compute:rf,cond:sY,context:sK,convert:eG,convertColorSpace:(e,t,s)=>eh(new s8(eh(e),t,s)),convertToTexture:(e,...t)=>e.isTextureNode?e:e.isPassNode?e.getTextureNode():ur(e,...t),cos:sr,cross:sC,cubeTexture:iS,dFdx:sc,dFdy:sm,dashSize:td,defaultBuildStages:["setup","analyze","generate"],defaultShaderStages:_,defined:eu,degrees:t1,deltaTime:lz,densityFog:dp,depth:nR,depthPass:(e,t)=>eh(new uq(uq.DEPTH,e,t)),difference:sS,diffuseColor:e1,directPointLight:dJ,directionToColor:e=>eh(e).mul(.5).add(.5),dispersion:tN,distance:sA,div:tA,dodge:(...e)=>(console.warn('THREE.TSL: "dodge" has been renamed. Use "blendDodge" instead.'),uI(e)),dot:sR,drawIndex:aq,dynamicBufferAttribute:rh,element:eW,emissive:e2,equal:tR,equals:tQ,equirectUV:nq,exp:t2,exp2:t3,expression:rV,faceDirection:id,faceForward:sG,float:ew,floor:t8,fog:dn,fract:st,frameGroup:e$,frameId:lF,frontFacing:iu,fwidth:sN,gain:(e,t)=>e.lessThan(.5)?lA(e.mul(2),t).div(2):tV(1,lA(tM(tV(1,e),2),t).div(2)),gapSize:tp,getConstNodeType:ed,getCurrentStack:ev,getDirection:o3,getDistanceAttenuation:dK,getGeometryRoughness:n9,getNormalFromDepth:un,getParallaxCorrectNormal:pO,getRoughness:n8,getScreenPosition:ua,getShIrradianceAt:pz,getTextureIndex:lw,getViewPosition:ui,glsl:(e,t)=>u5(e,t,"glsl"),glslFn:(e,t)=>u9(e,t,"glsl"),grayscale:uz,greaterThan:tE,greaterThanEqual:tO,hash:lM,highPrecisionModelNormalViewMatrix:r7,highPrecisionModelViewMatrix:r8,hue:uP,instance:aX,instanceIndex:aW,instancedArray:(e,t="float")=>uh(new uo(e,f(t)),t,e),instancedBufferAttribute:rc,instancedDynamicBufferAttribute:rm,instancedMesh:aZ,int:e_,inverseSqrt:t9,invocationLocalIndex:aH,invocationSubgroupIndex:aj,ior:tc,iridescence:e7,iridescenceIOR:te,iridescenceThickness:tt,ivec2:eS,ivec3:eE,ivec4:eF,js:(e,t)=>u5(e,t,"js"),label:sJ,length:sd,lengthSq:sD,lessThan:tI,lessThanEqual:tL,lightPosition:dI,lightProjectionUV:function(e){let t=dR(e);if(void 0===t.projectionUV){let s=dC(e).mul(ir);t.projectionUV=s.xyz.div(s.w)}return t.projectionUV},lightShadowMatrix:dC,lightTargetDirection:e=>rG.transformDirection(dI(e).sub(dE(e))),lightTargetPosition:dE,lightViewPosition:function(e){let t=dR(e);return t.viewPosition||(t.viewPosition=eK(new n.Pa4).setGroup(eX).onRenderUpdate(({camera:t},s)=>{s.value=s.value||new n.Pa4,s.value.setFromMatrixPosition(e.matrixWorld),s.value.applyMatrix4(t.matrixWorldInverse)}))},lightingContext:nr,lights:(e=[])=>eh(new dF).setLights(e),linearDepth:nC,linearToneMapping:uX,localId:dx,log:t4,log2:t5,logarithmicDepthToViewZ:(e,t,s)=>{let r=e.mul(t4(s.div(t)));return ew(Math.E).pow(r).mul(t).negate()},loop:(...e)=>(console.warn("TSL.LoopNode: loop() has been renamed to Loop()."),a3(...e)),luminance:uU,mat2:eU,mat3:eB,mat4:ek,matcapUV:lp,materialAOMap:aF,materialAlphaTest:ae,materialAnisotropy:av,materialAnisotropyVector:aD,materialAttenuationColor:aA,materialAttenuationDistance:aM,materialClearcoat:ac,materialClearcoatNormal:ag,materialClearcoatRoughness:am,materialColor:at,materialDispersion:aO,materialEmissive:ar,materialIOR:aV,materialIridescence:ax,materialIridescenceIOR:aT,materialIridescenceThickness:ab,materialLightMap:az,materialLineDashOffset:aE,materialLineDashSize:aR,materialLineGapSize:aC,materialLineScale:aS,materialLineWidth:aI,materialMetalness:ap,materialNormal:ah,materialOpacity:ai,materialPointWidth:aL,materialReference:iU,materialReflectivity:au,materialRefractionRatio:ib,materialRotation:af,materialRoughness:ad,materialSheen:ay,materialSheenRoughness:aN,materialShininess:as,materialSpecular:aa,materialSpecularColor:ao,materialSpecularIntensity:an,materialSpecularStrength:al,materialThickness:a_,materialTransmission:aw,max:sw,maxMipLevel:rz,metalness:e4,min:sb,mix:sP,mixElement:sH,mod:s_,modInt:tS,modelDirection:r0,modelNormalMatrix:r5,modelPosition:r2,modelScale:r3,modelViewMatrix:r9,modelViewPosition:r4,modelViewProjection:aU,modelWorldMatrix:r1,modelWorldMatrixInverse:r6,morphReference:a7,mrt:lV,mul:tM,mx_aastep:pI,mx_cell_noise_float:(e=rI())=>pm(e.convert("vec2|vec3")),mx_contrast:(e,t=1,s=.5)=>ew(e).sub(s).mul(t).add(s),mx_fractal_noise_float:(e=rI(),t=3,s=2,r=.5,i=1)=>py(e,e_(t),s,r).mul(i),mx_fractal_noise_vec2:(e=rI(),t=3,s=2,r=.5,i=1)=>pv(e,e_(t),s,r).mul(i),mx_fractal_noise_vec3:(e=rI(),t=3,s=2,r=.5,i=1)=>pN(e,e_(t),s,r).mul(i),mx_fractal_noise_vec4:(e=rI(),t=3,s=2,r=.5,i=1)=>px(e,e_(t),s,r).mul(i),mx_hsvtorgb:pS,mx_noise_float:(e=rI(),t=1,s=0)=>pp(e.convert("vec2|vec3")).mul(t).add(s),mx_noise_vec3:(e=rI(),t=1,s=0)=>ph(e.convert("vec2|vec3")).mul(t).add(s),mx_noise_vec4:(e=rI(),t=1,s=0)=>ez(ph(e=e.convert("vec2|vec3")),pp(e.add(eA(19,73)))).mul(t).add(s),mx_ramplr:(e,t,s=rI())=>pE(e,t,s,"x"),mx_ramptb:(e,t,s=rI())=>pE(e,t,s,"y"),mx_rgbtohsv:pR,mx_safepower:(e,t=1)=>(e=ew(e)).abs().pow(t).mul(e.sign()),mx_splitlr:(e,t,s,r=rI())=>pL(e,t,s,r,"x"),mx_splittb:(e,t,s,r=rI())=>pL(e,t,s,r,"y"),mx_srgb_texture_to_lin_rec709:pC,mx_transform_uv:(e=1,t=0,s=rI())=>s.mul(e).add(t),mx_worley_noise_float:(e=rI(),t=1)=>pV(e.convert("vec2|vec3"),t,e_(1)),mx_worley_noise_vec2:(e=rI(),t=1)=>pM(e.convert("vec2|vec3"),t,e_(1)),mx_worley_noise_vec3:(e=rI(),t=1)=>pA(e.convert("vec2|vec3"),t,e_(1)),negate:sp,neutralToneMapping:u3,nodeArray:em,nodeImmutable:ef,nodeObject:eh,nodeObjects:ec,nodeProxy:eg,normalFlat:ic,normalGeometry:ip,normalLocal:ih,normalMap:i3,normalView:im,normalWorld:ig,normalize:se,not:tD,notEqual:tC,numWorkgroups:dN,objectDirection:rX,objectGroup:eY,objectPosition:rZ,objectScale:rK,objectViewPosition:rJ,objectWorldMatrix:rY,oneMinus:sh,or:tF,orthographicDepthToViewZ:(e,t,s)=>t.sub(s).mul(e).sub(t),oscSawtooth:(e=lO)=>e.fract(),oscSine:(e=lO)=>e.add(.75).mul(2*Math.PI).sin().mul(.5).add(.5),oscSquare:(e=lO)=>e.fract().round(),oscTriangle:(e=lO)=>e.add(.5).fract().mul(2).sub(1).abs(),output:tu,outputStruct:lb,overlay:(...e)=>(console.warn('THREE.TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),uL(e)),overloadingFn:lL,parabola:lA,parallaxDirection:iQ,parallaxUV:(e,t)=>e.sub(iQ.mul(t)),parameter:(e,t)=>eh(new ly(e,t)),pass:(e,t,s)=>eh(new uq(uq.COLOR,e,t,s)),passTexture:(e,t)=>eh(new uj(e,t)),pcurve:(e,t,s)=>sI(tA(sI(e,t),t_(sI(e,t),sI(tV(1,e),s))),1/t),perspectiveDepthToViewZ:nM,pmremTexture:lt,pointUV:ug,pointWidth:th,positionGeometry:ie,positionLocal:it,positionPrevious:is,positionView:ia,positionViewDirection:io,positionWorld:ir,positionWorldDirection:ii,posterize:uW,pow:sI,pow2:sE,pow3:sL,pow4:sO,property:eQ,radians:t0,rand:sj,range:dg,rangeFog:du,reciprocal:sf,reference:iF,referenceBuffer:iD,reflect:sM,reflectVector:iV,reflectView:iw,reflector:e=>eh(new l5(e)),refract:sk,refractVector:iM,refractView:i_,reinhardToneMapping:uY,remainder:tH,remap:rb,remapClamp:rw,renderGroup:eX,renderOutput:rS,rendererReference:rn,rotate:lc,rotateUV:lD,roughness:e3,round:sg,rtt:ur,sRGBTransferEOTF:s4,sRGBTransferOETF:s5,sampler:e=>(!0===e.isNode?e:rD(e)).convert("sampler"),saturate:sB,saturation:uF,screen:(...e)=>(console.warn('THREE.TSL: "screen" has been renamed. Use "blendScreen" instead.'),uE(e)),screenCoordinate:nl,screenSize:no,screenUV:nn,scriptable:di,scriptableValue:u7,select:sX,setCurrentStack:eN,shaderStages:V,shadow:(e,t)=>eh(new dZ(e,t)),sharedUniformGroup:eq,sheen:e9,sheenRoughness:e8,shiftLeft:tG,shiftRight:tj,shininess:tl,sign:su,sin:ss,sinc:(e,t)=>ss(tY.mul(t.mul(e).sub(1))).div(tY.mul(t.mul(e).sub(1))),skinning:e=>eh(new a0(e)),skinningReference:a1,smoothstep:sW,smoothstepElement:sq,specularColor:tn,specularF90:to,spherizeUV:lP,split:(e,t)=>eh(new O(eh(e),t)),spritesheetUV:lW,sqrt:t6,stack:lv,step:sV,storage:uh,storageBarrier:()=>dw("storage").append(),storageObject:(e,t,s)=>(console.warn('THREE.TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),uh(e,t,s).setPBO(!0)),storageTexture:uw,string:(e="")=>eh(new P(e,"string")),sub:tV,subgroupIndex:aG,subgroupSize:dT,tan:si,tangentGeometry:iB,tangentLocal:ik,tangentView:iW,tangentWorld:iG,temp:s1,texture:rD,texture3D:lf,textureBarrier:()=>dw("texture").append(),textureBicubic:oV,textureCubeUV:o4,textureLoad:rP,textureSize:rL,textureStore:(e,t,s)=>{let r=uw(e,t,s);return null!==s&&r.append(),r},thickness:tg,threshold:(e,t)=>sP(eI(0),e,uU(e).sub(t).max(0)),time:lO,timerDelta:(e=1)=>(console.warn('TSL: timerDelta() is deprecated. Use "deltaTime" instead.'),lz.mul(e)),timerGlobal:(e=1)=>(console.warn('TSL: timerGlobal() is deprecated. Use "time" instead.'),lO.mul(e)),timerLocal:(e=1)=>(console.warn('TSL: timerLocal() is deprecated. Use "time" instead.'),lO.mul(e)),toOutputColorSpace:s7,toWorkingColorSpace:re,toneMapping:rl,toneMappingExposure:ru,toonOutlinePass:(e,t,s=new n.Ilk(0,0,0),r=.003,i=1)=>eh(new u$(e,t,eh(s),eh(r),eh(i))),transformDirection:sz,transformNormal:ix,transformNormalToView:iT,transformedBentNormalView:i0,transformedBitangentView:iZ,transformedBitangentWorld:iK,transformedClearcoatNormalView:iv,transformedNormalView:iy,transformedNormalWorld:iN,transformedTangentView:ij,transformedTangentWorld:iH,transmission:tm,transpose:sx,tri:lS,tri3:lR,triNoise3D:lC,triplanarTexture:(...e)=>lj(...e),triplanarTextures:lj,trunc:sy,tslFn:(...e)=>(console.warn("TSL.ShaderNode: tslFn() has been renamed to Fn()."),ey(...e)),uint:eV,uniform:eK,uniformArray:iL,uniformGroup:eH,uniforms:(e,t)=>(console.warn("TSL.UniformArrayNode: uniforms() has been renamed to uniformArray()."),eh(new iE(e,t))),userData:(e,t,s)=>eh(new u_(e,t,s)),uv:rI,uvec2:eR,uvec3:eL,uvec4:eD,varying:s3,varyingProperty:e0,vec2:eA,vec3:eI,vec4:ez,vectorComponents:M,velocity:uR,vertexColor:(...e)=>eh(new uc(...e)),vertexIndex:ak,vibrance:uD,viewZToLogarithmicDepth:nA,viewZToOrthographicDepth:n_,viewZToPerspectiveDepth:nV,viewport:nu,viewportBottomLeft:ng,viewportCoordinate:np,viewportDepthTexture:nb,viewportLinearDepth:nI,viewportMipTexture:nv,viewportResolution:nc,viewportSafeUV:lB,viewportSharedTexture:nj,viewportSize:nd,viewportTexture:nN,viewportTopLeft:nm,viewportUV:nh,wgsl:(e,t)=>u5(e,t,"wgsl"),wgslFn:(e,t)=>u9(e,t,"wgsl"),workgroupArray:(e,t)=>eh(new dV("Workgroup",e,t)),workgroupBarrier:()=>dw("workgroup").append(),workgroupId:dv,workingToColorSpace:rt,xor:tP});let pD=o3(rI(),rC("faceIndex")).normalize();eI(pD.x,pD.y.negate(),pD.z),new WeakMap,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Float32Array;class pP{constructor(e,t,s=null,r="",i=!1){this.type=e,this.name=t,this.count=s,this.qualifier=r,this.isConst=i}}pP.isNodeFunctionInput=!0;class pU{constructor(e,t,s="",r=""){this.type=e,this.inputs=t,this.name=s,this.precision=r}getCode(){console.warn("Abstract function.")}}pU.isNodeFunction=!0,new WeakMap,n.xoQ,n.D67,n.F1y,n.M$G,n.Zen,n.Jjb,n.T6w,n.O78;let pB="undefined"!=typeof self?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4};w.READ_ONLY,w.WRITE_ONLY,w.READ_WRITE,n.rpg,n.uWy,n.OoA,pB&&pB.VERTEX,pB&&pB.FRAGMENT,pB&&pB.COMPUTE;let pk={tsl_xor:new u4("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new u4("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new u4("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new u4("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new u4("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new u4("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new u4("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new u4("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new u4("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new u4("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new u4("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new u4("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new u4(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},pW={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};"undefined"!=typeof navigator&&/Windows/g.test(navigator.userAgent)&&(pk.pow_float=new u4("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),pk.pow_vec2=new u4("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[pk.pow_float]),pk.pow_vec3=new u4("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[pk.pow_float]),pk.pow_vec4=new u4("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[pk.pow_float]),pW.pow_float="tsl_pow_float",pW.pow_vec2="tsl_pow_vec2",pW.pow_vec3="tsl_pow_vec3",pW.pow_vec4="tsl_pow_vec4"),"undefined"!=typeof navigator&&/Firefox|Deno/g.test(navigator.userAgent),Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,n.e62,Int32Array,Int16Array,Uint32Array,Uint16Array,Float32Array;class pG extends n.xEZ{constructor(e=1,t=1){super(),this.image={width:e,height:t},this.magFilter=n.wem,this.minFilter=n.wem,this.isStorageTexture=!0}}}}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8301],{14277:(t,e,r)=>{"use strict";r.d(e,{D:()=>i});var n=r(67203);function i(){let[t,e]=(0,n.useState)(!1);return(0,n.useLayoutEffect)(()=>{e(!0)},[]),t}},25499:t=>{t.exports={Client:"client_Client__Zi5zI"}},28301:(t,e,r)=>{"use strict";r.d(e,{Client:()=>G});var n=r(70691),i=r(49797),a=r(9723),s=r(87381),l=r(33855),o=r(67203),h=r(50926);function c(t){let{plane:e="xz",size:r=100,subdivisions:n=[10,10],opacity:i=[.1,.01]}=t;return(0,l.dB)("grid",function*(t){new h.u().regularGrid({plane:e,size:r,subdivisions:n,opacity:i}).addTo(t)}),null}var u=r(96273);function f(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6329;return(t=Math.imul(t,r))<<e|t>>>32-e}let d=new Float64Array(1),p=new Int32Array(d.buffer);function y(t,e){d[0]=t;let r=p[0],n=p[1];d[0]=e;let i=p[0],a=p[1];return 0x131e63bd^(f(r,3,48271)^f(n,17,0x85ebca77)^(f(i,13,0xc2b2ae3d)^f(a,27,0x27d4eb2f)))}function x(t,e,r){d[0]=t;let n=p[0],i=p[1];d[0]=e;let a=p[0],s=p[1];d[0]=r;let l=p[0],o=p[1];return 0x9a586057^(f(n,3,48271)^f(i,17,0x85ebca77)^(f(a,13,0xc2b2ae3d)^f(s,27,0x27d4eb2f))^(f(l,5,0x165667b1)^f(o,19,0x9e3779b1)))}function g(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];switch(1===e.length&&"object"==typeof e[0]&&(e=Object.values(e[0]).filter(t=>"number"==typeof t)),e.length){case 2:return y(e[0],e[1]);case 3:return x(e[0],e[1],e[2]);default:return function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];let n=0x96d50edf,i=0;for(;i<e.length-1;i+=2)n=x(n,e[i],e[i+1]);for(;i<e.length;i++)n=y(n,e[i]);return n}(...e)}}var m=r(28535),w=r(76999),M=r(57368),b=r(44138);function z(t,e){var r=(0,b._)(t,e,"update");if(r.set){if(!r.get)throw TypeError("attempted to read set only private field");return"__destrWrapper"in r||(r.__destrWrapper={set value(v){r.set.call(t,v)},get value(){return r.get.call(t)}}),r.__destrWrapper}if(!r.writable)throw TypeError("attempted to set read only private field");return r}class A{insert(t,e,r){let n=this;for(;;){if(n.x===t&&n.y===e){n.value=r;return}if(n.next)n=n.next;else{n.next=new A(t,e,r);return}}}remove(t,e){let r=this;for(;r.next;){if(r.next.x===t&&r.next.y===e)return r.next=r.next.next,!0;r=r.next}return!1}constructor(t,e,r){this.x=t,this.y=e,this.value=r}}function*_(t){if(void 0!==t)if(t instanceof A){let e=t;for(;e;)yield[e.x,e.y,e.value],e=e.next}else yield[t.x,t.y,t.value]}var S=new WeakMap,P=new WeakMap,j=new WeakMap,C=new WeakMap;class T{clear(){(0,m._)(this,S).clear(),(0,M._)(this,P,0)}hasCell(t,e){return(0,m._)(this,S).has((0,m._)(this,C).call(this,t,e))}has(t,e){return void 0!==this.get(t,e)}get(t,e){let r=(0,m._)(this,C).call(this,t,e),n=(0,m._)(this,S).get(r);if(void 0!==n)if(!(n instanceof A))return n.x===t&&n.y===e?n.value:void 0;else{let r=n;for(;r;){if(r.x===t&&r.y===e)return r.value;r=r.next}return}}set(t,e,r){if(void 0===r)return void this.delete(t,e);let n=(0,m._)(this,C).call(this,t,e),i=(0,m._)(this,S).get(n);if(void 0===i)(0,m._)(this,S).set(n,{x:t,y:e,value:r}),z(this,P).value++;else if(i instanceof A)i.insert(t,e,r),z(this,P).value++;else if(i.x===t&&i.y===e)i.value=r;else{let a=new A(i.x,i.y,i.value);a.insert(t,e,r),(0,m._)(this,S).set(n,a),z(this,P).value++}}delete(t,e){let r=(0,m._)(this,C).call(this,t,e),n=(0,m._)(this,S).get(r);if(void 0===n)return!1;if(n instanceof A)if(n.x===t&&n.y===e)return n.next?(0,m._)(this,S).set(r,n.next):(0,m._)(this,S).delete(r),z(this,P).value--,!0;else return z(this,P).value--,n.remove(t,e);return n.x===t&&n.y===e&&((0,m._)(this,S).delete(r),z(this,P).value--,!0)}*cellEntries(t,e){let r=(0,m._)(this,S).get((0,m._)(this,C).call(this,t,e));yield*_(r)}cellFirstEntry(t,e){let r=(0,m._)(this,S).get((0,m._)(this,C).call(this,t,e));return r&&[r.x,r.y,r.value]}*cellNeighborEntries(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=(0,m._)(this,S),i=(0,m._)(this,C),a=(0,m._)(this,j);for(let s=-r;s<=r;s++)for(let l=-r;l<=r;l++){let r=t+s*a,o=e+l*a,h=n.get(i(r,o));yield*_(h)}}*entries(){for(let t of(0,m._)(this,S).values())yield*_(t)}*cellValues(t,e){for(let[,,r]of this.cellEntries(t,e))yield r}*values(){for(let[,,t]of this.entries())yield t}mapEntries(t){let e=[];for(let[r,n,i]of this.entries())e.push(t(r,n,i));return e}*query(t,e,r){let n=r*r;for(let[i,a,s]of this.cellNeighborEntries(t,e,Math.ceil(r/(0,m._)(this,j)))){let r=i-t,l=a-e;r*r+l*l<=n&&(yield[i,a,s])}}queryFirst(t,e,r){for(let[n,i,a]of this.query(t,e,r))return[n,i,a]}queryNearest(t,e,r){let n,i=1/0;for(let[a,s,l]of this.query(t,e,r)){let r=a-t,o=s-e,h=r*r+o*o;h<i&&(i=h,n=[a,s,l])}return n}get cellCount(){return(0,m._)(this,S).size}get valueCount(){return(0,m._)(this,P)}get cellSize(){return(0,m._)(this,j)}get cellHash(){return(0,m._)(this,C)}floor(t){return Math.floor(t/(0,m._)(this,j))*(0,m._)(this,j)}ceil(t){return Math.ceil(t/(0,m._)(this,j))*(0,m._)(this,j)}round(t){return Math.round(t/(0,m._)(this,j))*(0,m._)(this,j)}computeMaxValueCountPerCell(){let t=0;for(let e of(0,m._)(this,S).values())if(e instanceof A){let r=0,n=e;for(;n;)r++,n=n.next;r>t&&(t=r)}else t=Math.max(t,1);return t}constructor(t=0){(0,w._)(this,S,{writable:!0,value:void 0}),(0,w._)(this,P,{writable:!0,value:void 0}),(0,w._)(this,j,{writable:!0,value:void 0}),(0,w._)(this,C,{writable:!0,value:void 0}),(0,M._)(this,S,new Map),(0,M._)(this,P,0),(0,M._)(this,j,t),(0,M._)(this,C,0===t?y:(e,r)=>y(Math.floor(e/t),Math.floor(r/t)))}}function*q(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,n=0;for(;n++<r;){yield t;let r=e.get(t);if(void 0===r)break;if(t=r,n>1e3)throw console.log(n),Error("Infinite loop?")}}class k{next(){var t,e,r,n,i,a,s;let l;if(0===this.openSet.size)return null;let o=1/0;for(let e of this.openSet){let r=null!=(t=this.fScore.get(e))?t:1/0;r<o&&(l=e,o=r)}if(!l)return null;if(this.current=l,this.current===this.params.goal){return s=this.cameFrom,[...q(this.current,s)].reverse()}for(let{node:t,cost:s}of(this.openSet.delete(this.current),this.params.getNeighbors(this.current))){this.neighbor=t;let l=null!=(n=null==(e=(r=this.params).customNeighborHeuristic)?void 0:e.call(r,this))?n:s,o=(null!=(i=this.gScore.get(this.current))?i:1/0)+l;o<(null!=(a=this.gScore.get(this.neighbor))?a:1/0)&&(this.cameFrom.set(this.neighbor,this.current),this.gScore.set(this.neighbor,o),this.fScore.set(this.neighbor,o+this.params.heuristic(this.neighbor,this.params.goal)),this.openSet.add(this.neighbor))}return null}findPath(){let{openSet:t}=this;for(;t.size>0;){let t=this.next();if(t)return t}return[]}solve(){return this.findPath()}constructor(t){var e=this;this.openSet=new Set,this.cameFrom=new Map,this.gScore=new Map,this.fScore=new Map,this.params=t;let{start:r,goal:n,heuristic:i}=t;this.current=r,this.neighbor=r,this.openSet.add(r),this.gScore.set(r,0),this.fScore.set(r,i(r,n)),this.start=r,this.goal=n,this.wayback=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;return q(e.current,e.cameFrom,t)}}}var E=r(44694);let F={radius:1,radiusRatioMax:1,maxCount:1e3,random:Math.random,start:[0,0],isValid:(t,e)=>!0,maxAttempts:23};var N=r(79285),D=r(79105);let O=function t(){let e=Math.random,r=()=>{};function n(t){if(0===t.length)throw Error("Weights array is empty");let r=t.reduce((t,e)=>t+e,0),n=e()*r,i=0;for(let e=0;e<t.length;e++)if(n<(i+=t[e]))return e;return t.length-1}let i={new:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t().setRandom(...r)},setRandom:function(){for(var t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];let[s,l=0]=n;if("parkmiller"===s){let t=D.Ts(l);e=()=>(t=D.K2(t),D.Tj(t)),r=e=>{t=D.Ts(e)}}else{if(void 0!==s&&"function"!=typeof s)throw Error("Invalid random function");e=null!=s?s:Math.random,r=()=>{}}return r(l),i},seed:function(t){return r("reset"===t?0:null!=t?t:0),i},get random(){return e},chance:function(t){return e()<t},number:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];if(0===r.length)return e();if(1===r.length)return e()*r[0];if(2===r.length)return e()*(r[1]-r[0])+r[0];throw Error("Invalid arguments")},int:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];if(1===r.length)return Math.floor(e()*r[0]);if(2===r.length)return Math.floor(e()*(r[1]-r[0]))+r[0];throw Error("Invalid arguments")},hexColor:function(){let t=Math.floor(0xffffff*e());return"#".concat(t.toString(16).padStart(6,"0"))},pickIndex:n,pick:function(t,r){if(0===t.length)throw Error("Array is empty");if(r)return t[n(r)];let i=Math.floor(e()*t.length);return t[i]},direction2:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},r=e()*Math.PI*2;return t.x=Math.cos(r),t.y=Math.sin(r),t},direction3:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},r=e(),n=e(),i=2*Math.PI*r,a=Math.acos(1-2*n);return t.x=Math.sin(a)*Math.cos(i),t.y=Math.sin(a)*Math.sin(i),t.z=Math.cos(a),t}};return i}(),B=["#ffcc33","#33ccff","#cc66ff"];function H(t){let{title:e="Info title",description:r="Info description"}=t;return r=r.trim().split("\n").map(t=>t.trim()).filter(t=>t.length>0).join("\n"),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:".125em"},children:[(0,n.jsx)("div",{children:e}),(0,n.jsx)("div",{style:{fontSize:".75em",color:"#fff9",textAlign:"left",whiteSpace:"pre-wrap",overflowY:"auto",maxHeight:"10em",paddingLeft:"2em"},children:r})]})}function I(){return(0,l.dB)("random-scene",function*(t){h.w.clear().addTo(t);let e=new T(.5);e.set(.5,.3,"#ffcc00"),e.set(2.2,3.1,"#00ffcc"),e.set(2.5,3.5,"#00b7ff"),O.setRandom("parkmiller").seed("reset");for(let t=0;t<300;t++){let t=O.number(-10,10),r=O.number(-10,10),n=O.pick(B);e.set(t,r,n)}let r=new Map;for(let[t,n,i]of e.entries()){h.w.point([t,n],{color:i,size:1,shape:"plus-thin"});let a=g(t,n),s=r.get(a);void 0===s?r.set(a,{x:e.floor(t),y:e.floor(n),count:1}):s.count++}for(let[t,r,n]of e.cellEntries(3.5,-2.5))h.w.point([t,r],{color:n,size:2,shape:"ring-thin"});for(let[t,r,n]of(h.w.box({center:[5+.5*e.cellSize,4+.5*e.cellSize],size:[5*e.cellSize,5*e.cellSize]}),e.cellNeighborEntries(5,4,2)))h.w.point([t,r],{color:n,size:2,shape:"ring-thin"});for(let[,{x:t,y:n,count:i}]of r.entries())h.w.text([t+e.cellSize/2,n+e.cellSize/2],"(".concat(t,",").concat(n,")\n"),{color:"white",size:.25}).text([t+e.cellSize/2,n+e.cellSize/2],"\n".concat(i),{color:"white",size:.5});for(let[t,r,n]of e.query(-5,-2,4))h.w.point([t,r],{size:1.5,shape:"ring",color:n});h.w.circle({center:[-5,-2],radius:4,quality:"ultra"})},[]),(0,n.jsx)(H,{title:"Hash-Grid 2D",description:"\n        grid.cellEntries(x, y) - query all items in a cell\n        grid.cellNeighborEntries(x, y, manhattanRadius) - query all items in a cell and its neighbors\n        grid.query(x, y, radius) - query all items in a circle\n      "})}function W(){let[t,e]=(0,o.useState)("");return(0,l.dB)("poisson-scene",function*(t){let r=[],n=new h.u({points:{pointCount:1e5}}).clear().addTo(t);O.setRandom("parkmiller").seed("reset");let a=performance.now(),s=new i.I9Y(20.5,.15),l=function(t){let e={...F,...t},{radius:r,radiusRatioMax:n,maxCount:i,random:a,start:s,isValid:l,maxAttempts:o}=e;if(r<=0)throw Error("Radius must be greater than 0");if(n<1)throw Error("Radius ratio max must be greater than or equal to 1");let h=new T(r/Math.sqrt(2)),c=(0,E.wX)(s);if(!l(c.x,c.y))throw Error("First sample is not valid");let u=[c];h.set(c.x,c.y,0);let f=[c];for(;u.length>0&&f.length<i;){let t=Math.floor(a()*u.length),e=u[t],i=!1,s=a()*Math.PI*2;for(let t=0;t<o;t++){let c=s+t/o*Math.PI*2,d=r+a()*(n-r),p=e.x+Math.cos(c)*d,y=e.y+Math.sin(c)*d;if(!l(p,y)||h.hasCell(p,y))continue;let x=!0;for(let[t,e,n]of h.cellNeighborEntries(p,y,2)){let n=p-t,i=y-e;if(Math.sqrt(n*n+i*i)<r){x=!1;break}}if(!1===x)continue;i=!0;let g={x:p,y};f.push(g),u.push(g),h.set(p,y,f.length-1);break}!1===i&&u.splice(t,1)}return{samples:f,grid:h,params:e}}({maxCount:1e4,isValid:(t,e)=>20>Math.hypot(t-20,e-0)&&Math.hypot(t-10,e)>(0,N.lerp)(9.25,9.5,.5*Math.sin(40*Math.atan2(e,t-10))+.5)&&Math.hypot(t-30,e)>(0,N.lerp)(9.25,9.5,.5*Math.sin(40*Math.atan2(e,t-30))+.5),start:s,random:O.random,radius:.1,radiusRatioMax:1.4}),o=performance.now()-a;for(let t of(r.push("Poisson sampling took ".concat(o.toFixed(2),"ms")),n.circle({center:s,radius:.1}),l.samples))n.point(t,{size:.2,shape:"circle",color:O.pick(B)});for(let[t,e]of l.grid.query(18,-8,1))n.point([t,e],{size:.33,shape:"ring",color:O.pick(B)});for(let[t,e]of l.grid.query(20,-10,1.5*l.params.radius))n.point([t,e],{size:.33,shape:"ring",color:O.pick(B)});{let[t,e]=l.grid.queryNearest(20,10,.2);n.point([t,e],{size:1.5,shape:"ring",color:"white"})}{let t=performance.now(),a=(0,u.wX)(l.grid.queryNearest(20,-10,.5)),s=(0,u.wX)(l.grid.queryNearest(20,10,.5)),o=new Map;o.set(g(a.x,a.y),a),o.set(g(s.x,s.y),s);let h=new k({start:a,goal:s,getNeighbors:function(t){let e=[];for(let[r,n]of l.grid.query(t.x,t.y,1.5*l.params.radius)){let t=g(r,n);if(o.has(t))e.push(o.get(t));else{let a=new i.I9Y(r,n);o.set(t,a),e.push(a)}}return e.map(t=>({node:t,cost:t.distanceTo(t)}))},heuristic:(t,e)=>t.distanceTo(e)}).findPath();n.polyline(h,{color:"white",points:{size:.2,shape:"x"}});let c=performance.now()-t;r.push("A* pathfinding took ".concat(c.toFixed(2),"ms (").concat(h.length," nodes)")),e(r.join("\n"))}},[]),(0,n.jsx)(H,{title:"Poisson sampling + A* pathfinding",description:t})}function R(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c,{plane:"xy",size:100,subdivisions:[10,10,2],opacity:[.1,.01,.004]}),(0,n.jsx)("div",{className:"layer thru flex flex-col p-8 items-start",children:(0,n.jsxs)("div",{className:"p-8 flex flex-col gap-2 backdrop-blur-xl rounded border border-white/10",children:[(0,n.jsx)(I,{}),(0,n.jsx)(W,{})]})})]})}var X=r(25499),Y=r.n(X);function V(){return(0,l.yk)(function*(t){{let e=new i.WBB(1,16),r=new a.Y,n=(0,s.mj)(new i.eaF(e,r),{parent:t.scene,scale:.5,position:[10,0,0]});yield()=>n.removeFromParent();let l=(0,s.mj)(new i.eaF(e,r),{parent:t.scene,scale:.5,position:[30,0,0]});yield()=>l.removeFromParent()}t.pipeline.basicPasses.smaa.enabled=!1,t.pipeline.basicPasses.fxaa.enabled=!1},[]),null}function G(){return(0,n.jsx)("div",{className:"layer thru ".concat(Y().Client),children:(0,n.jsxs)(l.uB,{vertigoControls:{size:24,focus:[10,0,0]},children:[(0,n.jsx)(V,{}),(0,n.jsx)(R,{})]})})}},33855:(t,e,r)=>{"use strict";r.d(e,{dB:()=>d,q:()=>p,uB:()=>g,yk:()=>f});var n=r(70691),i=r(67203),a=r(49797),s=r(7587),l=r(48083),o=r(6697),h=r(36508),c=r(14277);let u=(0,i.createContext)(null);function f(t,e){let r=(0,i.useContext)(u);return(0,s.C7)(async function*(e,n){if(t){let e=t(r,n);if(e&&"function"==typeof e.next)do{let{value:t,done:r}=await e.next();if(r)break;yield t}while(n.mounted)}},null!=e?e:"always"),r}function d(t,e,r){let n=(0,i.useMemo)(()=>new a.YJl,[]);return n.name=t,f(async function*(t,r){if(t.scene.add(n),yield()=>{n.clear(),n.removeFromParent()},e){let i=e(n,t,r);if(i&&"function"==typeof i.next)do{let{value:t,done:e}=await i.next();if(e)break;yield t}while(r.mounted)}},r),n}function p(t){let{value:e}=t,r=(0,i.useMemo)(()=>"function"==typeof e?new e:e,[e]);return f(async function*(t){if(t.scene.add(r),"initialize"in r){let e=r.initialize(t);if(e&&"function"==typeof e.next)for(;;){let{value:t,done:r}=await e.next();if(r)break;yield t}}yield()=>{if(r.removeFromParent(),"destroy"in r){var t;null==(t=r.destroy)||t.call(r)}}},[r]),null}let y={className:"",assetsPath:"/",vertigoControls:!1};function x(t){let{children:e,className:r,assetsPath:a,vertigoControls:c}={...y,...t},f=(0,i.useMemo)(()=>new o.XW,[]);f.loader.setPath(a);let{ref:d}=(0,s.IZ)({debounce:!0},function*(t,e){yield f.initialize(t.firstElementChild),e.triggerRender(),Object.assign(window,{three:f})},[]);(0,s.C7)(function*(){if(c){let t=new l.n("object"==typeof c?c:{}).initialize(d.current).start();yield t.destroy,yield(0,h.xy)("three",e=>{t.update(f.camera,f.aspect,e.deltaTime)})}},[c]);let p={position:"absolute",inset:0};return(0,n.jsx)("div",{ref:d,className:r,style:p,children:(0,n.jsxs)(u.Provider,{value:f,children:[(0,n.jsx)("div",{style:p}),(0,n.jsx)("div",{style:p,className:"thru",children:f.initialized&&e})]})})}function g(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return(0,c.D)()&&(0,n.jsx)(x,{...e[0]})}},50926:(t,e,r)=>{"use strict";r.d(e,{u:()=>k,w:()=>E});var n=r(49797),i=r(96273),a=r(67840);class s{ensureKeyEntry(t,e,r){let n=this.keyMap.get(t);if(n){if(n.count!==r)throw Error("A key entry already exists with a different count. This is not allowed. Once a key is set, it cannot be changed.");return n}{let n={index:e,count:r};return this.keyMap.set(t,n),n}}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];throw Error("Not implemented!")}clear(){return this.keyMap.clear(),this}constructor(){this.keyMap=new Map,this.transformMatrix=new n.kn4}}var l=r(66066),o=r(15940),h=r(17953),c=r(81074),u=r(6726),f=r(60041);let d=new n.Pq0,p=new n.Pq0,y=new n.Pq0,x=new n.Pq0,g=new n.Pq0,m=new n.Pq0,w=new n.Pq0,M=new n.Q1f,b=new n.kn4;class z{static box(t){let[e,r,n,a,s,l,o,h]=z.boxPoints;if("min"in t||"max"in t){let{min:n=z.boxMinMaxDefaults.min,max:a=z.boxMinMaxDefaults.max}=t;(0,i.jj)(n,e),(0,i.jj)(a,r)}else if("center"in t||"size"in t){let{center:s=z.boxCenterSizeDefaults.center,size:l=z.boxCenterSizeDefaults.size}=t;(0,i.jj)(s,n),(0,i.jj)(l,a).multiplyScalar(.5),e.copy(n).sub(a),r.copy(n).add(a)}else e.copy(z.boxMinMaxDefaults.min),r.copy(z.boxMinMaxDefaults.max);t.inset&&(e.addScalar(t.inset),r.addScalar(-t.inset));let{x:c,y:u,z:f}=e,{x:d,y:p,z:y}=r;return r.set(d,u,f),n.set(d,u,y),a.set(c,u,y),s.set(c,p,f),l.set(d,p,f),o.set(d,p,y),h.set(c,p,y),t.transform&&((0,i.vl)(t.transform,b),e.applyMatrix4(b),r.applyMatrix4(b),n.applyMatrix4(b),a.applyMatrix4(b),s.applyMatrix4(b),l.applyMatrix4(b),o.applyMatrix4(b),h.applyMatrix4(b)),z}}z.boxPoints=[new n.Pq0,new n.Pq0,new n.Pq0,new n.Pq0,new n.Pq0,new n.Pq0,new n.Pq0,new n.Pq0],z.boxDefaults={inset:0,transform:void 0},z.boxMinMaxDefaults={min:new n.Pq0(-.5,-.5,-.5),max:new n.Pq0(.5,.5,.5)},z.boxCenterSizeDefaults={center:new n.Pq0(0,0,0),size:new n.Pq0(1,1,1)};let A={size:.1,proportionalSize:!1,position:"middle",skip:void 0,type:"single",scale:1},_={key:void 0,color:void 0,opacity:1,arrow:!1};var S=new WeakSet;class P extends s{static createParts(){let{nodeMaterial:t=!1,lineCount:e=2e4,defaultColor:r="white",defaultOpacity:i=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=new n.LoY,s={position:new n.THS(new Float32Array(3*e*2),3),color:new n.THS(new Float32Array(3*e*2),3),aOpacity:new n.THS(new Float32Array(2*e),1)};for(let[t,e]of Object.entries(s))a.setAttribute(t,e);let l=t?(()=>{let t=new c.e9u({vertexColors:!0,transparent:!0,depthWrite:!1}),e=(0,h.xIr)(s.aOpacity,"float",1,0);return t.opacityNode=(0,h.PCg)(e),t})():(()=>{let t=new n.mrM({vertexColors:!0,transparent:!0,depthWrite:!1});return t.onBeforeCompile=t=>f.b.with(t).varying({vOpacity:"float"}).vertex.top("\n          attribute float aOpacity;\n        ").vertex.mainAfterAll("\n          vOpacity = aOpacity;\n        ").fragment.after("color_fragment","\n          diffuseColor.a *= vOpacity;\n        "),t})(),o=new n.DXC(a,l);return o.frustumCulled=!1,{count:e,defaults:{color:r,opacity:i},geometry:a,attributes:s,lines:o}}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];this.parts.geometry.applyMatrix4((0,i.GD)(e))}clear(){return super.clear(),this.state.index=0,this.parts.geometry.setDrawRange(0,0),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,{lines:e}=this.parts;return 0!==t?(e.renderOrder=t,e.material.depthTest=!1,e.material.depthWrite=!1):(e.renderOrder=0,e.material.depthTest=!0,e.material.depthWrite=!0),this}segmentsArray(t,e){let{position:r,color:n,aOpacity:i}=this.parts.attributes,{key:a,color:s,opacity:o}={..._,...this.parts.defaults,...e},{r:h,g:c,b:u}=M.set(s),f=t.length/3,b=function(t,e){var r,n;if(!1===e||void 0===e)return new Float32Array;let i=Array.isArray(e)?e:[!0===e?{}:e],a=0;for(let t of i){let e=null!=(r=null==t?void 0:t.type)?r:A.type,i=null!=(n=null==t?void 0:t.position)?n:A.position;a+=(Array.isArray(i)?i.length:1)*("triple"===e?3:"double"===e?2:1)}let s=t.length/3/2,l=new Float32Array(s*a*12),o=0;for(let e=0;e<s;e++){let r=6*e;d.set(t[r+0],t[r+1],t[r+2]),p.set(t[r+3],t[r+4],t[r+5]),y.subVectors(p,d);let n=y.lengthSq();for(let t of i){let{size:e=A.size,proportionalSize:r=A.proportionalSize,position:i=A.position,skip:a=A.skip,type:s=A.type,scale:h=A.scale}=null!=t?t:{};if(void 0!==a){if(!0===a||"less-than-size"===a){if(n<e*e)continue}else if("number"==typeof a&&n<a*a)continue}let c=Math.sqrt(n),u=(r?c:1)*e*h;x.copy(y).divideScalar(c);let f=Math.abs(x.x),M=Math.abs(x.y),b=Math.abs(x.z);for(let t of(f>=b&&M>=b?g.set(x.y,-x.x,0).normalize():M>=f?g.set(x.z,0,-x.x).normalize():g.set(0,x.z,-x.y).normalize(),Array.isArray(i)?i:[i])){let r="triple"===s?3:"double"===s?2:1;for(let n=0;n<r;n++){let i=function(t){if("number"==typeof t)return t;switch(t){case"end":return 1;case"start":return 0;case"middle":return .5;default:throw Error("Invalid arrow position: ".concat(t))}}(t);r>1&&(i+=(n/(r-1)-i)*e/c*.8),m.lerpVectors(d,p,i),m.toArray(l,(4*o+0)*3),w.copy(m).addScaledVector(x,-u).addScaledVector(g,-u).toArray(l,(4*o+1)*3),m.toArray(l,(4*o+2)*3),w.copy(m).addScaledVector(x,-u).addScaledVector(g,u).toArray(l,(4*o+3)*3),o++}}}}return l}(t,null==e?void 0:e.arrow),z=b.length/3,P=f+z,{index:C}=void 0!==a?this.ensureKeyEntry(a,this.state.index,f):this.state;if(C+P>this.parts.count)throw console.log("Overflow Handling Not implemented",C+P,this.parts.count),Error("Overflow Handling Not implemented");this.state.index=Math.max(this.state.index,C+P);{let{transformMatrix:e}=this;for(let a=0;a<f;a++)d.fromArray(t,3*a).applyMatrix4(e).toArray(r.array,(C+a)*3),n.setXYZ(C+a,h,c,u),i.setX(C+a,o)}{let t=C+f;for(let e=0;e<z;e++)d.fromArray(b,3*e).applyMatrix4(this.transformMatrix).toArray(r.array,(t+e)*3),n.setXYZ(t+e,h,c,u),i.setX(t+e,o)}return(0,l._)(this,S,j).call(this),this}segments(t,e){let r=t.length,n=new Float32Array(3*r);for(let e=0;e<r;e++){let{x:r,y:a,z:s}=(0,i.jj)(t[e],d),l=3*e;n[l+0]=r,n[l+1]=a,n[l+2]=s}return this.segmentsArray(n,e)}line(t,e,r){return this.segments([t,e],r)}polyline(t,e){if(t.length<2)return this;let r=Array((t.length-1)*2);for(let e=1;e<t.length;e++)r[2*e-2]=t[e-1],r[2*e-1]=t[e];return this.segments(r,e)}polygon(t,e){return t.length<2||(this.polyline(t,e),this.line(t[t.length-1],t[0],e)),this}box(t,e){let[r,n,i,a,s,l,o,h]=z.box(t).boxPoints;return this.segmentsArray(new Float32Array([r.x,r.y,r.z,n.x,n.y,n.z,n.x,n.y,n.z,i.x,i.y,i.z,i.x,i.y,i.z,a.x,a.y,a.z,a.x,a.y,a.z,r.x,r.y,r.z,s.x,s.y,s.z,l.x,l.y,l.z,l.x,l.y,l.z,o.x,o.y,o.z,o.x,o.y,o.z,h.x,h.y,h.z,h.x,h.y,h.z,s.x,s.y,s.z,r.x,r.y,r.z,s.x,s.y,s.z,n.x,n.y,n.z,l.x,l.y,l.z,i.x,i.y,i.z,o.x,o.y,o.z,a.x,a.y,a.z,h.x,h.y,h.z]),e)}rect(t,e){let{minX:r,minY:n,maxX:i,maxY:a}=u.M_.from(t),{inset:s}={...P.rectDefaultOptions,...e};return r+=s,n+=s,i-=s,a-=s,this.segments([{x:r,y:n,z:0},{x:i,y:n,z:0},{x:i,y:n,z:0},{x:i,y:a,z:0},{x:i,y:a,z:0},{x:r,y:a,z:0},{x:r,y:a,z:0},{x:r,y:n,z:0}],e)}circle(){let{center:t=0,axis:e="z",radius:r=1,quality:n="medium",segments:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;null!=a||(a=P.circleQualityPresets[n]);let{x:l,y:o,z:h}=(0,i.jj)(t,d);(0,i.jj)(e,d).normalize(),p.set(d.y,d.z,d.x).cross(d).normalize(),y.crossVectors(d,p);let c=new Float32Array(3*a*2);for(let t=0;t<a;t++){let e=t/a*Math.PI*2,n=(t+1)/a*Math.PI*2,i=Math.cos(e)*r,s=Math.sin(e)*r,u=Math.cos(n)*r,f=Math.sin(n)*r,d=6*t;c[d+0]=l+i*p.x+s*y.x,c[d+1]=o+i*p.y+s*y.y,c[d+2]=h+i*p.z+s*y.z,c[d+3]=l+u*p.x+f*y.x,c[d+4]=o+u*p.y+f*y.y,c[d+5]=h+u*p.z+f*y.z}return this.segmentsArray(c,s),this}regularGrid(t){let{color:e,opacity:r,plane:n,size:i,subdivisions:a}={...P.regularGridDefaults,...t},s=a.length,o=a.map((t,e)=>a.slice(e).reduce((t,e)=>t*e,1)),h=o[0],c=new Float32Array((h+1)*12),u=new Float32Array((h+1)*12).fill(1),f=new Float32Array((h+1)*4).fill(1),d=Array.isArray(e)?e:[e],p=a.map((t,e)=>{let{r,g:n,b:i}=M.set(d[Math.min(e,d.length-1)]);return[r,n,i]}),y=Array.isArray(r)?r:[r],x=a.map((t,e)=>y[Math.min(e,y.length-1)]);for(let t=0;t<=h;t++){let e=s-1;for(;t%o[e]==0&&!(--e<=0););let[r,n,a]=p[e],l=x[e],d=t/h*i,y=12*t;c[y+0]=-i/2,c[y+1]=-i/2+d,c[y+2]=0,c[y+3]=i/2,c[y+4]=-i/2+d,c[y+5]=0,c[y+6]=-i/2+d,c[y+7]=-i/2,c[y+8]=0,c[y+9]=-i/2+d,c[y+10]=i/2,c[y+11]=0,u[y+0]=r,u[y+1]=n,u[y+2]=a,u[y+3]=r,u[y+4]=n,u[y+5]=a,u[y+6]=r,u[y+7]=n,u[y+8]=a,u[y+9]=r,u[y+10]=n,u[y+11]=a;let g=4*t;f[g+0]=l,f[g+1]=l,f[g+2]=l,f[g+3]=l}if("xz"===n)for(let t=0;t<c.length;t+=3)c[t+2]=c[t+1],c[t+1]=0;else if("yz"===n)for(let t=0;t<c.length;t+=3)c[t+2]=c[t+1],c[t+1]=c[t+0],c[t+0]=0;let{index:g}=this.state;return this.parts.attributes.position.array.set(c,3*g),this.parts.attributes.color.array.set(u,3*g),this.parts.attributes.aOpacity.array.set(f,g),this.state.index+=(h+1)*4,(0,l._)(this,S,j).call(this),this}constructor(t){super(),(0,o._)(this,S),this.state={index:0},this.parts=P.createParts(t)}}function j(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(let t of(this.parts.geometry.setDrawRange(0,this.state.index),Object.values(this.parts.attributes)))t.needsUpdate=!0;if(this.state.index>2*this.parts.count)throw Error("Not implemented!");if(t)for(let t of Object.values(this.parts.attributes))t.array.some(t=>isNaN(t))&&console.log(t.array.findIndex(t=>isNaN(t)))}P.rectDefaultOptions={inset:0},P.circleQualityPresets={low:18,medium:36,high:64,ultra:256},P.regularGridDefaults={plane:"xy",size:100,subdivisions:[10,2,5],opacity:[.2,.05,.01],color:"white"};class C extends s{static createParts(){let{pointCount:t=1e4}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new n.LoY,r={position:new n.THS(new Float32Array(3*t),3),color:new n.THS(new Float32Array(3*t),3),aScale:new n.THS(new Float32Array(t),1),aShape:new n.THS(new Float32Array(t),1)};for(let[t,n]of Object.entries(r))e.setAttribute(t,n);let i=new n.BH$({vertexColors:!0});i.onBeforeCompile=t=>f.b.with(t).varying({vShape:"float"}).vertex.top("\n        attribute float aScale;\n        attribute float aShape;\n      ").vertex.mainAfterAll("\n        gl_PointSize *= aScale;\n        vShape = aShape;\n      ").fragment.top("\n        float sdBox(in vec2 p, in vec2 b) {\n          vec2 d = abs(p) - b;\n          return length(max(d, 0.0)) + min(max(d.x, d.y), 0.0);\n        }\n      ").fragment.after("color_fragment","\n        float regular = .2;\n        float thin = .1;\n        float ultraThin = .033;\n\n        if (vShape == ".concat(C.shapes.circle,".0) {\n          float d = distance(gl_PointCoord * 2.0, vec2(1.0));\n          if (d > 1.0) discard;\n        }\n\n        if (vShape == ").concat(C.shapes.ring,".0) {\n          float d = distance(gl_PointCoord * 2.0, vec2(1.0));\n          if (d < 0.8 || d > 1.0) discard;\n        }\n\n        if (vShape == ").concat(C.shapes["ring-thin"],".0) {\n          float d = distance(gl_PointCoord * 2.0, vec2(1.0));\n          if (d < 0.9 || d > 1.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes.plus,".0) {\n          float d0 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(1.0, regular));\n          float d1 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(regular, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes["plus-thin"],".0) {\n          float d0 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(1.0, thin));\n          float d1 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(thin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes["plus-ultra-thin"],".0) {\n          float d0 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(1.0, ultraThin));\n          float d1 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(ultraThin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes.x,".0) {\n          vec2 p = gl_PointCoord * 2.0 - 1.0;\n          float c = 0.70710678;\n          p = mat2(c, -c, c, c) * p;\n          float d0 = sdBox(p, vec2(1.0, regular));\n          float d1 = sdBox(p, vec2(regular, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes["x-thin"],".0) {\n          vec2 p = gl_PointCoord * 2.0 - 1.0;\n          float c = 0.70710678;\n          p = mat2(c, -c, c, c) * p;\n          float d0 = sdBox(p, vec2(1.0, thin));\n          float d1 = sdBox(p, vec2(thin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(C.shapes["x-ultra-thin"],".0) {\n          vec2 p = gl_PointCoord * 2.0 - 1.0;\n          float c = 0.70710678;\n          p = mat2(c, -c, c, c) * p;\n          float d0 = sdBox(p, vec2(1.0, ultraThin));\n          float d1 = sdBox(p, vec2(ultraThin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        // diffuseColor.rgb *= vec3(gl_PointCoord, 1.0);\n      "));let a=new n.ONl(e,i);return a.frustumCulled=!1,{count:t,geometry:e,attributes:r,points:a}}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];this.parts.geometry.applyMatrix4((0,i.GD)(e))}clear(){return super.clear(),this.state.index=0,this.parts.geometry.setDrawRange(0,0),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,{points:e}=this.parts;return 0!==t?(e.renderOrder=t,e.material.depthTest=!1,e.material.depthWrite=!1,e.material.transparent=!0):(e.renderOrder=0,e.material.depthTest=!0,e.material.depthWrite=!0,e.material.transparent=!1),this}points(t){let{key:e,size:r=.1,scale:n=1,color:a="white",shape:s="square"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{transformMatrix:l}=this,o=void 0!==e,h=t.length,{index:c}=o?this.ensureKeyEntry(e,this.state.index,h):this.state,{position:u,color:f,aScale:p,aShape:y}=this.parts.attributes,{r:x,g,b:m}=M.set(a),w=n*r,b=C.shapes[s];for(let e=0;e<h;e++){let{x:r,y:n,z:a}=(0,i.jj)(t[e],d).applyMatrix4(l),s=c+e;u.setXYZ(s,r,n,a),f.setXYZ(s,x,g,m),p.setX(s,w),y.setX(s,b)}for(let t of(this.state.index=o?Math.max(this.state.index,c+h):c+h,this.parts.geometry.setDrawRange(0,this.state.index),Object.values(this.parts.attributes)))t.needsUpdate=!0;if(this.state.index>this.parts.count)throw Error("Overflow Handling Not implemented");return this}box(t,e){let{boxPoints:r}=z.box(t);return this.points(r,e)}point(t,e){return this.points([t],e)}constructor(t){super(),this.state={index:0},this.parts=C.createParts(t)}}C.shapes=(()=>{let t=0;return{square:t++,circle:t++,ring:t++,"ring-thin":t++,plus:t++,"plus-thin":t++,"plus-ultra-thin":t++,x:t++,"x-thin":t++,"x-ultra-thin":t++}})();class T extends s{static createParts(t){let e=new a.w({textCount:2e3,...t});return{count:e.count,textHelper:e}}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];this.parts.textHelper.applyTransform(...e)}clear(){return this.state.index=0,this.parts.textHelper.clearAllText(),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.parts.textHelper.onTop(t),this}texts(t,e){let r=this.state.index,{texts:n,...a}={...T.textDefaults,...e},s="function"==typeof n?n:t=>n[t%n.length],l=0;for(let e of t){let{x:t,y:n,z:o}=(0,i.jj)(e,d);this.parts.textHelper.setTextAt(r,s(l),{...a,x:t,y:n,z:o}),r++,l++}return this.state.index=r,this}text(t,e,r){return this.texts([t],{...r,texts:[e]})}textAt(t,e,r){return this.parts.textHelper.setTextAt(t,e,{...r}),this}constructor(t){super(),this.state={index:0},this.parts=T.createParts(t)}}T.textDefaults={texts:t=>t.toString()};let q={color:void 0,size:.1,shape:"square",scale:1};class k extends n.YJl{static createParts(t,e){let{nodeMaterial:r}=null!=e?e:{},n=new C(null==e?void 0:e.points);t.add(n.parts.points);let i=new P({nodeMaterial:r,...null==e?void 0:e.lines});t.add(i.parts.lines);let a=new T({nodeMaterial:r,...null==e?void 0:e.texts});return t.add(a.parts.textHelper),{pointsManager:n,linesManager:i,textsManager:a}}points(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.pointsManager.points(...e),this}point(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.pointsManager.point(...e),this}segments(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.segments(...e),this}line(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.line(...e),this}polyline(t,e){return this.parts.linesManager.polyline(t,e),(null==e?void 0:e.points)&&this.points(t,{...q,color:e.color,...!0===e.points?{}:e.points}),this}polylines(t,e){for(let r of t)this.polyline(r,e);return this}polygon(t,e){return this.parts.linesManager.polygon(t,e),(null==e?void 0:e.points)&&this.points(t,{...q,color:e.color,...!0===e.points?{}:e.points}),this}polygons(t,e){for(let r of t)this.polygon(r,e);return this}box(t,e){return this.parts.linesManager.box(t,e),(null==e?void 0:e.points)&&this.parts.pointsManager.box(t,{...q,color:e.color,...!0===e.points?{}:e.points}),this}circle(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.circle(...e),this}rect(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.rect(...e),this}regularGrid(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.regularGrid(...e),this}texts(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.textsManager.texts(...e),this}text(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.textsManager.text(...e),this}textAt(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.textsManager.textAt(...e),this}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.pointsManager.applyTransform(...e),this.parts.linesManager.applyTransform(...e),this.parts.textsManager.applyTransform(...e),this}clear(){return this.parts.pointsManager.clear(),this.parts.linesManager.clear(),this.parts.textsManager.clear(),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.renderOrder=t,this.parts.pointsManager.onTop(t),this.parts.linesManager.onTop(t),this.parts.textsManager.onTop(t),this}globalExpose(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"debugHelper";return Object.assign(globalThis,{[t]:this}),this}addTo(t){return t?t.add(this):this.removeFromParent(),this}constructor(t){super(),this.userData={helper:!0},this.parts=k.createParts(this,t)}}let E=new k},87381:(t,e,r)=>{"use strict";r.d(e,{$z:()=>function* t(e,r){let{includeSelf:n}={...o,...r};for(let r of(n&&(yield e),e.children))yield*t(r,{includeSelf:!0})},DN:()=>s,mj:()=>a,rd:()=>l});var n=r(61567),i=r(90927);function a(t,e,r){return e&&((0,n.Th)(e)?e.add(t):(0,i.N)(t,e)),null==r||r(t),t}let s=a;function l(t,e){let r=e;for(;r.parent;){if(r.parent===t)return!0;r=r.parent}return!1}let o={includeSelf:!1}}}]);
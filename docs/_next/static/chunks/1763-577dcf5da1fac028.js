"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1763],{3293:(t,e,r)=>{r.d(e,{_:()=>l,w:()=>s});var i=r(49797),n=r(94065);let a=new i.kn4;function s(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;return null===t?(e.elements.fill(0),e):(0,n.vl)(t,e)}let o=new i.Q1f;function l(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;return"random"===t?(e.setHex(Math.floor(0x1000000*Math.random())),e):("string"==typeof t&&t.startsWith("#")&&(9===t.length&&(t=t.slice(0,7)),5===t.length&&(t=t.slice(0,4))),e.set(t))}},3461:(t,e,r)=>{r.d(e,{w:()=>v});var i=r(77674),n=r(49797),a=r(94065),s=r(3293),o=r(79285);function l(){return[...new Set(["�",..."abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",..."\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff",..."0123456789",..." _@#.,!?\xbf:;-+*/=%&|()[]{}<>$'’\""])].join("")}class h{constructor(){let t=l(),e=new n.I9Y(16,24),r=e.x/e.y,i=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.I9Y;return r.x=Math.ceil(Math.sqrt(t/e)),r.y=Math.ceil(t/r.x),r}(t.length,r),a=e.clone().multiplyScalar(3),s=(0,o.ceilPowerOfTwo)(a.x*i.x),h=(0,o.ceilPowerOfTwo)(a.y*i.y),c=s/(a.x*i.x),d=h/(a.y*i.y);if("undefined"==typeof document){this.canvas=null,this.texture=null,this.symbols="",this.charGrid=new n.I9Y;return}let u=document.createElement("canvas");u.width=s,u.height=h;let p=u.getContext("2d");p.font="".concat(.8*a.y,"px monospace"),p.textBaseline="top",p.fillStyle="black",p.fillRect(0,0,s,h),p.fillStyle="white",p.transform(c,0,0,d,0,0);for(let e=0;e<t.length;e++){let r=Math.floor(e/i.x),n=(e-r*i.x+.12)*a.x,s=a.y*(r+.19999999999999996);p.fillText(t[e],n,s)}this.canvas=u,this.texture=new n.GOR(u),this.symbols=t,this.charGrid=i}}h.getDefaultSymbols=l;let c={oriented:0,billboard:1},d={nodeMaterial:!1,textCount:1e3,lineLength:24,lineCount:2,charSize:new n.I9Y(.2,.3),textSize:1,textOffset:0,orientation:"billboard",textDefaults:{color:"#ff00ff",size:1}};class u{get textCount(){return this.metadata.textCount}get lineCount(){return this.metadata.lineCount}get lineLength(){return this.metadata.lineLength}get strideHeaderByteSize(){return this.metadata.strideHeaderByteSize}get strideByteSize(){return this.metadata.strideByteSize}get textureSize(){return new n.I9Y(this.metadata.textureWidth,this.metadata.textureHeight)}encode(){let t=JSON.stringify(this.metadata),e=new TextEncoder().encode(t),r=e.length,i=new Uint8Array(4);new DataView(i.buffer).setUint32(0,r,!0);let n=new Uint8Array(4+r+this.array.length);return n.set(i,0),n.set(e,4),n.set(this.array,4+r),n}static decode(t){let e=new DataView(t.buffer).getUint32(0,!0),r=t.slice(4,4+e),i=JSON.parse(new TextDecoder().decode(r)),n=new u(i.symbols,i.textCount,i.lineCount,i.lineLength),a=t.slice(4+e);return n.array.set(a),n}info(){return"data: ".concat(this.array.length," bytes, ").concat(this.textureSize.x,"x").concat(this.textureSize.y)}getTextAt(t){let{array:e}=this,{symbols:r,lineLength:i,strideByteSize:n,strideHeaderByteSize:a}=this.metadata,s=t*n,o=e[s+0],l=e[s+16],h=t=>t.toString(16).padStart(2,"0"),c="#".concat(h(e[s+4])).concat(h(e[s+4+1])).concat(h(e[s+4+2])),d=e[s+4+3],u="#".concat(h(e[s+8])).concat(h(e[s+8+1])).concat(h(e[s+8+2])),p=e[s+8+3],f=[];for(let t=0;t<o;t++){let n=s+a+t*i,o=[];for(let t=0;t<l;t++){let i=r[e[n+t]];o.push(i)}f.push(o.join(""))}return{text:f.join("\n"),textColor:c,textOpacity:d,backgroundColor:u,backgroundOpacity:p,currentLineCount:o,currentLineLength:l}}setSizeAt(t,e){let{array:r}=this,{strideByteSize:i}=this.metadata;return new DataView(r.buffer).setFloat32(t*i+12,e),this}setColorAt(t,e){let{color:r,opacity:i,textColor:n=r,textOpacity:a=i,backgroundColor:l=n,backgroundOpacity:h=+(null!=i?!!i:!!e.backgroundColor)}=e,{array:c}=this,{strideByteSize:d}=this.metadata;{let e=t*d+4;if(void 0!==n){let{r:t,g:r,b:i}=(0,s._)(n);c[e+0]=255*t,c[e+1]=255*r,c[e+2]=255*i}void 0!==a&&(c[e+3]=(0,o.toff)(a))}{let e=t*d+8;if(void 0!==l){let{r:t,g:r,b:i}=(0,s._)(l);c[e+0]=255*t,c[e+1]=255*r,c[e+2]=255*i}void 0!==h&&(c[e+3]=(0,o.toff)(h))}return this.texture.needsUpdate=!0,this}setTextAt(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{trim:i=!1,size:n=1,...a}=r;this.setColorAt(t,a),this.setSizeAt(t,n);let{array:s}=this,{symbols:o,lineCount:l,lineLength:h,strideByteSize:c,strideHeaderByteSize:d}=this.metadata,u=(i?e.trim():e).split("\n");u.length>l&&(console.warn("TextHelper: Text has more lines than ".concat(l,", truncating.")),u=u.slice(0,l)),u=u.map(t=>(i&&(t=t.trim()),t.length>h)?(console.warn("TextHelper: Line length is greater than ".concat(h," characters, clamping.")),t.slice(0,h)):t),s[t*c+0]=u.length;let p=t*c,f=u.length;for(let t=0;t<l;t++){let e=0;t<f&&(s[p+16+4*t]=u[t].length,e=u[t].length);let r=p+d+t*h;for(let i=0;i<h;i++){let n=r+i;if(t>=f||i>=e)s[n]=0;else{let e=o.indexOf(u[t].charAt(i));s[n]=-1===e?0:e}}}this.texture.needsUpdate=!0}constructor(t,e,r,i,{defaultColor:a="#ffffff",defaultTextOpacity:l=1,defaultBackgroundOpacity:h=0}={}){let c=16+4*r,d=c+4*Math.ceil(r*i/4),u=Math.ceil((c+e*d)/4),p=(0,o.ceilPowerOfTwo)(Math.sqrt(u)),f=Math.ceil(u/p);this.metadata={symbols:t,textCount:e,lineCount:r,lineLength:i,strideHeaderByteSize:c,strideByteSize:d,textureWidth:p,textureHeight:f};let x=new Uint8Array(p*f*4),{r:g,g:v,b:y}=(0,s._)(a);for(let t=0;t<e;t++){let e=t*d;x[(e+=4)+0]=255*g,x[e+1]=255*v,x[e+2]=255*y,x[e+3]=255*l,x[(e+=4)+0]=255*g,x[e+1]=255*v,x[e+2]=255*y,x[e+3]=255*h}this.array=x,this.texture=new n.GYF(x,p,f,n.GWd,n.OUM),this.texture.needsUpdate=!0}}var p=r(17953),f=r(81074),x=r(7147);let g=0;class v extends n.ZLX{setTransformMatrix(t){return this.transformMatrix.copy(t),this}resetTransformMatrix(){return this.transformMatrix.identity(),this}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];let i=(0,a.GD)(e),s=new n.kn4,o=this.instanceMatrix.array.length;for(let t=0;t<o;t+=16)s.fromArray(this.instanceMatrix.array,t).multiply(i).toArray(this.instanceMatrix.array,t);return this}addTo(t){return t?t.add(this):this.removeFromParent(),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return 0!==t?(this.renderOrder=t,this.material.depthTest=!1,this.material.depthWrite=!1,this.material.transparent=!0):(this.renderOrder=0,this.material.depthTest=!0,this.material.depthWrite=!0,this.material.transparent=!1),this}setData(t){return this.data=t,this}clearAllText(){return this.instanceMatrix.array.fill(0),this.instanceMatrix.needsUpdate=!0,this.textOffsetInstanceAttribute.array.fill(0),this.textOffsetInstanceAttribute.needsUpdate=!0,this}setTextAt(t,e){var r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.data.setTextAt(t,e,{...this.options.textDefaults,...n}),this.setMatrixAt(t,(0,s.w)(n).premultiply(this.transformMatrix)),this.instanceMatrix.needsUpdate=!0;let{v:o}=(0,i._)(v,v,y),{x:l,y:h,z:c}=(0,a.jj)(null!=(r=n.offset)?r:0,o);return this.textOffsetInstanceAttribute.setXYZ(t,l,h,c),this.textOffsetInstanceAttribute.needsUpdate=!0,this}setColorAt(t,e){this.data.setColorAt(t,{color:e})}setTextColorAt(t,e){return this.data.setColorAt(t,e),this}getDataStringView(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return function(t,e,r,i,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,o=Array.from({length:e.length/4},(t,r)=>{let i=4*r,n=e[i+0],a=e[i+1];return[n,a,e[i+2],e[i+3]]}).slice(a*r/4,s*r/4),l=[];l.push("\nData texture array (".concat(e.length," bytes):")),l.push("\ndataStride: ".concat(r," (").concat(r/4," x 4 bytes)"));let h=4+i;for(let e=0;e<o.length;e++){let a=e%(r/4);0===a&&(l.push("\npack #".concat(e/(r/4))),l.push("info:")),4===a&&l.push("lines (".concat(i,"):")),a===h&&l.push("chars (".concat(n,"):"));let[s,c,d,u]=o[e],p="".concat(e.toString().padEnd(3)," - ").concat((4*e).toString().padEnd(4),":   ").concat(s.toString().padStart(3),", ").concat(c.toString().padStart(3),", ").concat(d.toString().padStart(3),", ").concat(u.toString().padStart(3));a>=h&&(p+="     ".concat(t.symbols[s]).concat(t.symbols[c]).concat(t.symbols[d]).concat(t.symbols[u])),l.push("  "+p)}return l.join("\n")}(this.atlas,this.data.array,this.data.strideByteSize,this.options.lineCount,this.options.lineLength,t,e)}constructor(t){let e={...d,...t},r=new h,i=new u(r.symbols,e.textCount,e.lineCount,e.lineLength),s=function(t,e,r){let i={...d,...t},s=new n.I9Y(i.textSize*i.lineLength*i.charSize.x,i.textSize*i.lineCount*i.charSize.y);return{uCameraMatrix:{value:new n.kn4},uOrientation:{value:function(t){if("string"==typeof t){if(t in c)return c[t];throw Error("Invalid orientation: ".concat(t))}if(Object.values(c).includes(t))return t;throw Error("Invalid orientation: ".concat(t))}(i.orientation)},uTextOffset:{value:(0,a.jj)(i.textOffset)},uPlaneSize:{value:s},uCharSize:{value:i.charSize},uLineLength:{value:i.lineLength},uLineCount:{value:i.lineCount},uAtlasCharGrid:{value:r.charGrid},uDataStrideHeader:{value:e.strideHeaderByteSize},uDataStride:{value:e.strideByteSize/4},uDataTexture:{value:e.texture},uDataTextureSize:{value:e.textureSize},uBoxBorderWidth:{value:0}}}(e,i,r),o=new n.uWO(new Float32Array(3*e.textCount),3),l=s.uPlaneSize.value,v=new n.bdM(l.width,l.height);v.setAttribute("aTextOffset",o),super(v,e.nodeMaterial?function(t,e){let r=new f.P8l;r.name="TextHelperMaterial",r.transparent=!0,r.alphaTest=.5,r.side=n.$EB,console.warn("TextHelperMaterial is not supported in WebGPU yet, do not expect it to work.");let i=(0,p.PiW)(t.uDataTextureSize.value).onFrameUpdate(()=>t.uDataTextureSize.value),a=(0,p.PiW)(t.uDataStride.value).onFrameUpdate(()=>t.uDataStride.value);function s(e,r){let n=i.x,s=(0,p.WQq)((0,p.lKK)(e,a),r),o=(0,p.y4m)(s,n),l=(0,p.jbE)(s,(0,p.lKK)(o,n));return(0,p.wHr)(t.uDataTexture.value,(0,p.ZcS)(l,o))}(0,p.PiW)(t.uDataStrideHeader.value).onFrameUpdate(()=>t.uDataStrideHeader.value),(0,p.PiW)(t.uAtlasCharGrid.value).onFrameUpdate(()=>t.uAtlasCharGrid.value);let o=s(p.cGD,0);(0,p.PCg)((0,p.lKK)(o.r,255)),(0,p.PCg)(s(p.cGD,1)),(0,p.PCg)(s(p.cGD,2)),(0,p.fVC)(1);let l=(0,p.PiW)(1).onRenderUpdate(()=>t.uOrientation.value);return r.positionNode=(0,p.Fn)(()=>{let t=(0,p.eR5)().toVar();return(0,p.If)(l.equal(0),()=>{t.assign(p.WVU)}).Else(()=>{t.assign((0,p.w00)(p.FLB).mul(p.WVU))}),t})(),r.colorNode=(0,p.yWT)("yellow"),r}(s,0):function(t,e){let r=new n.V9B({map:e.texture,transparent:!0,alphaTest:.5,side:n.$EB});return r.name="TextHelperMaterial",r.onBeforeCompile=e=>x.bI.with(e).uniforms(t).varying({vInstanceId:"float",vTextColor:"vec4",vBackgroundColor:"vec4",vCurrentLineCount:"float"}).top("\n      vec4 getData4(int instanceId, int offset) {\n        int width = int(uDataTextureSize.x);\n        int index = instanceId * int(uDataStride) + offset;\n        int dataY = index / width;\n        int dataX = index - dataY * width;\n        return texelFetch(uDataTexture, ivec2(dataX, dataY), 0);\n      }\n      vec4 getData4(float instanceId, int offset) {\n        return getData4(int(instanceId), offset);\n      }\n        \n      vec2 getCharOffset(float instanceId, float charIndex) {\n        int p = int(uDataStrideHeader + charIndex);\n        int q = p / 4;\n        int r = p - q * 4; // p % 4;\n        vec4 charIndexes = getData4(instanceId, q);\n        float i = charIndexes[r] * 255.0;\n        float x = mod(i, uAtlasCharGrid.x);\n        float y = floor(i / uAtlasCharGrid.x);\n        return vec2(x, uAtlasCharGrid.y - y - 1.0) / uAtlasCharGrid;\n      }\n      vec2 getCharOffset(float instanceId, float line, float char) {\n        // return vec2(line * 82.0 + char, 0.0) / uAtlasCharGrid;\n        return getCharOffset(instanceId, line * uLineLength + char);\n      }\n    ").vertex.top("\n      attribute vec3 aTextOffset;\n    ").vertex.replace("project_vertex","\n      vec4 infoTexel = getData4(gl_InstanceID, 0);\n      vCurrentLineCount = infoTexel.r * 255.0;\n\n      vTextColor = getData4(gl_InstanceID, 1);\n      vBackgroundColor = getData4(gl_InstanceID, 2);\n\n      vec4 sizeBytes = getData4(gl_InstanceID, 3) * 255.0;\n      uint encoded =\n        uint(sizeBytes.x) << 24 |\n        uint(sizeBytes.y) << 16 |\n        uint(sizeBytes.z) << 8  |\n        uint(sizeBytes.w);\n      float size = uintBitsToFloat(encoded);\n\n      vec4 mvPosition = vec4(transformed * size, 1.0);\n\n      mat4 textMatrix = uOrientation < 0.5\n        ? modelMatrix * instanceMatrix\n        : mat4(\n          uCameraMatrix[0],\n          uCameraMatrix[1],\n          uCameraMatrix[2],\n          modelMatrix * vec4(instanceMatrix[3].xyz, 1.0));\n\n      mvPosition = viewMatrix * textMatrix * mvPosition;\n\n      mvPosition.xyz += uTextOffset + aTextOffset;\n\n      gl_Position = projectionMatrix * mvPosition;\n\n      vInstanceId = float(gl_InstanceID);\n    ").fragment.top("\n      float sdBox(in vec2 p, in vec2 b) {\n        vec2 d = abs(p) - b;\n        return length(max(d, 0.0)) + min(max(d.x, d.y), 0.0);\n      }\n\n      vec4 getCharColor() {\n        vec2 uv = vMapUv * vec2(uLineLength, uLineCount);\n\n        uv.y += (uLineCount - vCurrentLineCount) * 0.5;\n        float lineIndex = floor((uLineCount - uv.y));\n\n        if (lineIndex < 0.0 || lineIndex >= vCurrentLineCount)\n          discard;\n\n        float currentLineLength = getData4(vInstanceId, 4 + int(lineIndex)).r * 255.0;\n        // vec2 ddx = dFdx(uv);\n        // vec2 ddy = dFdy(uv);\n        uv.x += (uLineLength - currentLineLength) * -0.5;\n        float charIndex = floor(uv.x);\n\n        if (charIndex < 0.0 || charIndex >= currentLineLength)\n          discard;\n\n        uv = fract(uv);\n        // diffuseColor = vec4(uv, 1.0, 1.0);\n        uv /= uAtlasCharGrid;\n\n        uv += getCharOffset(vInstanceId, lineIndex, charIndex);\n        // float lod = log2(max(length(dFdx(vMapUv)), length(dFdy(vMapUv))));\n        vec4 charColor = textureLod(map, uv, 0.0);\n        // Use textureGrad for better quality, when the square texture will be used\n        // vec4 sampledDiffuseColor = textureGrad(map, uv, ddx, ddy);\n        float char = charColor.r;\n        \n        return vec4(\n          mix(vBackgroundColor.rgb, vTextColor.rgb, charColor.r),\n          mix(vBackgroundColor.a, vTextColor.a, charColor.r));\n      }\n\n      vec4 getCharColorWithBorder() {\n        if (uBoxBorderWidth > 0.0) {\n          vec2 p = (vMapUv - 0.5) * uPlaneSize;\n          float d = sdBox(p, uPlaneSize * 0.5) + uBoxBorderWidth;\n          if (d > 0.0) {\n            return vTextColor;\n          }\n        }\n        return getCharColor();\n      }\n    ").fragment.replace("map_fragment","\n      diffuseColor = getCharColorWithBorder();\n    "),r}(s,r),e.textCount),this.textHelperId=g++,this.userData={helper:!0,ignorePointer:!0},this.transformMatrix=new n.kn4,this.onBeforeRender=(t,e,r,i,n,a)=>{s.uCameraMatrix.value.copy(r.matrixWorld)},this.textOffsetInstanceAttribute=o,this.frustumCulled=!1,this.layers,this.options=e,this.atlas=r,this.data=i,this.derived={planeSize:l}}}v.defaultOptions=d,v.Atlas=h,v.Data=u;var y={writable:!0,value:{v:new n.Pq0}}},7693:(t,e,r)=>{r.d(e,{B:()=>o});var i=r(49797),n=r(28340),a=r(94065);let s={fov:"45deg",perspective:1,zoom:1,focus:[0,0,0],screenOffset:[0,0,0],size:[4,4],before:1e3,after:1e3,rotation:[0,0,0,"YXZ"],frame:"contain",allowOrthographic:!0,fovEpsilon:"1.5deg",nearMin:.1};class o{static get defaultRotationOrder(){return"YXZ"}static get default(){return l}set(t){let{perspective:e,fov:r,zoom:i,focus:n,screenOffset:s,size:o,before:l,after:h,rotation:c,frame:d,allowOrthographic:u,fovEpsilon:p,nearMin:f}=t;return void 0!==e&&(this.perspective=e),void 0!==r&&(this.fov=(0,a.ey)(r)),void 0!==i&&(this.zoom=i),void 0!==n&&(0,a.jj)(n,this.focus),void 0!==s&&(0,a.jj)(s,this.screenOffset),void 0!==o&&(0,a.wX)(o,this.size),void 0!==l&&(this.before=l),void 0!==h&&(this.after=h),void 0!==c&&(0,a.if)(c,{defaultOrder:"YXZ"},this.rotation),void 0!==d&&(this.frame="string"==typeof d?+("cover"!==d):d),void 0!==u&&(this.allowOrthographic=u),void 0!==p&&(this.fovEpsilon=(0,a.ey)(p)),void 0!==f&&(this.nearMin=f),this}copy(t){return this.perspective=t.perspective,this.fov=t.fov,this.zoom=t.zoom,this.focus.copy(t.focus),this.screenOffset.copy(t.screenOffset),this.size.copy(t.size),this.before=t.before,this.after=t.after,this.rotation.copy(t.rotation),this.frame=t.frame,this.allowOrthographic=t.allowOrthographic,this.fovEpsilon=t.fovEpsilon,this.nearMin=t.nearMin,this.update(),this}clone(){return new o().copy(this)}lerpVertigos(t,e,r){this.perspective=t.perspective+(e.perspective-t.perspective)*r,this.fov=t.fov+(e.fov-t.fov)*r;let i=Math.log(t.zoom)/Math.log(.001),n=i+(Math.log(e.zoom)/Math.log(.001)-i)*r;this.zoom=.001**n,this.focus.lerpVectors(t.focus,e.focus,r),this.screenOffset.lerpVectors(t.screenOffset,e.screenOffset,r),this.size.lerpVectors(t.size,e.size,r),this.before=t.before+(e.before-t.before)*r,this.after=t.after+(e.after-t.after)*r;let{_qa:a,_qb:s}=o.shared;return a.setFromEuler(t.rotation),s.setFromEuler(e.rotation),this.rotation.setFromQuaternion(a.slerp(s,r)),this.frame=t.frame+(e.frame-t.frame)*r,this.allowOrthographic=r<.5?t.allowOrthographic:e.allowOrthographic,this.fovEpsilon=t.fovEpsilon+(e.fovEpsilon-t.fovEpsilon)*r,this.nearMin=t.nearMin+(e.nearMin-t.nearMin)*r,this.update(),this}lerp(t,e){return this.lerpVertigos(this,t,e)}ndcToScreen(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return e.x=t.x*this.state.realSize.x*.5,e.y=t.y*this.state.realSize.y*.5,e}update(){let t,e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.aspect,i=this.size.x/this.size.y/r,n=i>1?this.frame:1-this.frame,a=this.size.y/this.zoom,s=a*(1+n*(i-1)),l=this.fovEpsilon,h=this.perspective*this.fov;!this.allowOrthographic&&h<l&&(h=l);let c=a/2/Math.tan(h/2),d=h>=l,{worldMatrix:u,worldMatrixInverse:p,projectionMatrix:f,projectionMatrixInverse:x}=this.state;u.makeRotationFromEuler(this.rotation);let g=u.elements,v=d?c:this.before+this.nearMin,{_v0:y,_v1:m}=o.shared;if(y.set(g[8],g[9],g[10]).multiplyScalar(v).add(this.focus),y.addScaledVector(m.set(g[0],g[1],g[2]),-this.screenOffset.x/this.zoom),y.addScaledVector(m.set(g[4],g[5],g[6]),-this.screenOffset.y/this.zoom),y.addScaledVector(m.set(g[8],g[9],g[10]),-this.screenOffset.z/this.zoom),g[12]=y.x,g[13]=y.y,g[14]=y.z,p.copy(u).invert(),d){t=Math.max(this.nearMin/this.zoom,c-this.before),e=c+this.after;let i=s*t/c/2,n=i*r;f.makePerspective(-n,n,i,-i,t,e)}else{t=-this.before,e=this.after+this.before;let i=s/2,n=i*r;f.makeOrthographic(-n,n,i,-i,t,e)}return x.copy(f).invert(),this.state.aspect=r,this.state.isPerspective=d,this.state.distance=c,this.state.fov=h,this.state.realSize.set(s*r,s),this.state.near=t,this.state.far=e,this}apply(t,e){this.update(e);let{isPerspective:r,fov:i,near:n,far:a,worldMatrix:s,projectionMatrix:o,projectionMatrixInverse:l}=this.state;return t.matrixAutoUpdate=!1,t.matrix.copy(s),t.updateMatrixWorld(!0),t.matrixAutoUpdate=!0,t.position.setFromMatrixPosition(s),t.quaternion.setFromRotationMatrix(s),t.rotation.setFromQuaternion(t.quaternion,"YXZ"),t.scale.set(1,1,1),t.isPerspectiveCamera=r,t.isOrthographicCamera=!r,r?t.fov=180*i/Math.PI:t.fov=0,t.near=n,t.far=a,t.aspect=e,t.projectionMatrix.copy(o),t.projectionMatrixInverse.copy(l),this}toDeclaration(){let t=[(0,a.wz)(this.rotation.x,"deg"),(0,a.wz)(this.rotation.y,"deg"),(0,a.wz)(this.rotation.z,"deg"),this.rotation.order];return{perspective:this.perspective,fov:(0,a.wz)(this.fov,"deg"),zoom:this.zoom,focus:this.focus.toArray(),size:this.size.toArray(),before:this.before,after:this.after,rotation:t,frame:this.frame,allowOrthographic:this.allowOrthographic,fovEpsilon:(0,a.wz)(this.fovEpsilon,"deg"),nearMin:this.nearMin}}get computedNdcScalar(){return console.warn("Vertigo.computedNdcScalar is deprecated. Deprecated. What's the usage?"),new i.I9Y(this.state.realSize.x/this.size.x*this.zoom,this.state.realSize.y/this.size.y*this.zoom)}get computedSize(){return console.warn("Vertigo.computedSize is deprecated, use state.realSize instead."),this.state.realSize}constructor(t){this.focus=new i.Pq0,this.screenOffset=new i.Pq0,this.size=new i.I9Y,this.rotation=new i.O9p,this.state={aspect:0,isPerspective:!0,distance:0,fov:0,near:0,far:0,realSize:new i.I9Y,worldMatrix:new i.kn4,worldMatrixInverse:new i.kn4,projectionMatrix:new i.kn4,projectionMatrixInverse:new i.kn4},this.set({...s,...t})}}o.shared={_matrix:new i.kn4,_v0:new i.Pq0,_v1:new i.Pq0,_qa:new i.PTz,_qb:new i.PTz};let l=(0,n.ol)(new o)},28062:(t,e,r)=>{r.d(e,{T:()=>d});var i=r(66066),n=r(15940),a=r(49797),s=r(77794),o=r(3293),l=r(79911);let h=(()=>{let t=[new a.Pq0(-1,-1,-1),new a.Pq0(1,-1,-1),new a.Pq0(1,1,-1),new a.Pq0(-1,1,-1),new a.Pq0(-1,-1,1),new a.Pq0(1,-1,1),new a.Pq0(1,1,1),new a.Pq0(-1,1,1)],e=t.map(t=>t.clone()),r=new a.kn4;return function(i,n){r.multiplyMatrices(n,i).invert();for(let i=0;i<t.length;i++)e[i].copy(t[i]).applyMatrix4(r);return e}})();var c=new WeakSet;class d extends a.YJl{static createParts(t){let e,r=(0,l.mj)(new a.YJl,t),i=(0,l.mj)(new a.eaF(new a.bdM(1,.25),new a.V9B({color:t.color,alphaMap:null!=e?e:e=(()=>{let t=document.createElement("canvas"),e=t.getContext("2d");t.width=1024,t.height=256,e.fillStyle="white",e.font="200px Fira Code",e.textBaseline="top",e.fillText("Vertigo",20,20);let r=new a.gPd(t);return r.needsUpdate=!0,r})(),transparent:!0,side:a.$EB})),r),n=(0,l.mj)(new s.u,t);return n.renderOrder=1e9,{plane:i,planeWrapper:r,debugHelper:n,matrix:new a.kn4}}onTick(){let{vertigo:t,color:e}=this,{x:r,y:n}=t.size,{debugHelper:a,matrix:s,plane:l,planeWrapper:d}=this.parts;if(d.position.copy(t.focus),d.rotation.copy(t.rotation),l.position.set(-r/2+.5+.1,n/2-.125-.1,0),(0,o.w)({position:t.focus,rotation:t.rotation},s),a.clear(),(0,i._)(this,c,u).call(this,r,n),1!==t.zoom){let e=r/t.zoom,a=n/t.zoom;(0,i._)(this,c,u).call(this,e,a)}let{realSize:p}=this.vertigo.state;(0,i._)(this,c,u).call(this,p.x,p.y);let[f,x,g,v,y,m,w,z]=h(t.state.worldMatrix.invert(),t.state.projectionMatrix);a.line(f,x,{color:e}).line(x,g,{color:e}).line(g,v,{color:e}).line(v,f,{color:e}).line(y,m,{color:e}).line(m,w,{color:e}).line(w,z,{color:e}).line(z,y,{color:e}).line(f,y,{color:e}).line(x,m,{color:e}).line(g,w,{color:e}).line(v,z,{color:e})}constructor(t,{color:e="#ffff00"}={}){super(),(0,n._)(this,c),this.color=e,this.vertigo=t,this.parts=d.createParts(this)}}function u(t,e){let{color:r}=this,{debugHelper:i,matrix:n}=this.parts,s=[new a.Pq0(t/2,e/2,0),new a.Pq0(-t/2,e/2,0),new a.Pq0(-t/2,-e/2,0),new a.Pq0(t/2,-e/2,0)];for(let t of s)t.applyMatrix4(n);i.polygon(s,{color:r})}},31763:(t,e,r)=>{r.d(e,{n:()=>H});var i,n,a=r(28535),s=r(76999),o=r(57368),l=r(66620),h=r(66066),c=r(15940),d=r(49797),u=r(99332),p=r(29717),f=r(79285),x=r(63126),g=r(39787),v=r(94065),y=r(7693),m=r(28062);let w=new d.PTz,z=new d.Pq0,M=new d.Pq0,S=new d.Pq0,b=new d.Zcv,A=new d.RlV,C=new d.Pq0,P=new d.Pq0;function T(t){w.setFromEuler(t),z.set(1,0,0).applyQuaternion(w),M.set(0,1,0).applyQuaternion(w),S.crossVectors(z,M)}let I=["shift","alt","control","meta"];function _(t,e){return e.every(e=>t["".concat(e,"Key")])}function D(t){return t.split("+").filter(t=>{if(""===t)return!1;let e=I.includes(t);return e||console.warn("Invalid input: ".concat(t)),e})}var O=new WeakMap,V=new WeakMap,B=new WeakSet,q=new WeakSet,j=new WeakSet,F=new WeakSet;class H{get currentVertigo(){return(0,a._)(this,O).alternativeIsActive?(0,a._)(this,O).alternativeVertigo:this.vertigo}get currentDampedVertigo(){return(0,a._)(this,O).alternativeIsActive?(0,a._)(this,O).alternativeDampedVertigo:this.dampedVertigo}get alternativeIsActive(){return(0,h._)(this,q,k).call(this)}set alternativeIsActive(t){t?(0,h._)(this,j,W).call(this):(0,h._)(this,F,L).call(this)}get alternativeHelperColor(){return(0,a._)(this,O).alternativeHelperColor}set alternativeHelperColor(t){(0,a._)(this,O).alternativeHelperColor=t}parsePanInputs(t){this.panInputs=D(t)}parseOrbitInputs(t){this.orbitInputs=D(t)}get destroyed(){return(0,a._)(this,V)}set(t){return this.currentVertigo.set(t),this.currentDampedVertigo.set(t),this}pan(t,e){T(this.currentVertigo.rotation);let r=1/this.currentVertigo.zoom;this.currentVertigo.focus.addScaledVector(z,t*r).addScaledVector(M,e*r),this.focusPlane&&this.currentVertigo===this.vertigo&&((0,v.Fx)(this.focusPlane,b),A.origin.copy(this.currentVertigo.focus),A.direction.copy(S),function(t,e,r){let{x:i,y:n,z:a}=t.origin,{x:s,y:o,z:l}=t.direction,{x:h,y:c,z:d}=e.normal,u=h*s+c*o+d*l;if(1e-6>Math.abs(u))return null;let p=-(i*h+n*c+a*d+e.constant)/u;return null!=r||(r={x:0,y:0,z:0}),r.x=i+s*p,r.y=n+o*p,r.z=a+l*p,r}(A,b,S)&&this.currentVertigo.focus.copy(S))}dolly(t){T(this.currentVertigo.rotation);let e=1/this.currentVertigo.zoom;this.currentVertigo.focus.addScaledVector(S,t*e)}orbit(t,e){this.currentVertigo.rotation.x+=t,this.currentVertigo.rotation.y+=e}rotate(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];this.orbit(...e)}zoomAt(t,e){this.currentVertigo.update(this.currentDampedVertigo.state.aspect);let r=this.currentVertigo.state.realSize.x,i=this.currentVertigo.state.realSize.y,n=this.currentVertigo.state.realSize.x/(t/this.currentVertigo.zoom),a=this.currentVertigo.state.realSize.y/(t/this.currentVertigo.zoom);T(this.currentVertigo.rotation);let{x:s,y:o}=e;this.currentVertigo.focus.addScaledVector(z,-(.5*(n-r)*s)).addScaledVector(M,-(.5*(a-i)*o)),this.currentVertigo.zoom=t}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;if("string"==typeof t&&(t=document.querySelector(t)),!(t instanceof HTMLElement))throw Error("Invalid element: ".concat(t));return this.element=t,this}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null!=(i=this.element)?i:document.body;return!1===this.started&&(this.started=!0,(0,a._)(this,O).startDestroyableInstance.onDestroy((0,h._)(this,B,E).call(this,t))),this}stop(){this.started&&(this.started=!1,(0,a._)(this,O).startDestroyableInstance.destroy(),(0,a._)(this,O).startDestroyableInstance=new g.el)}toggle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.started;t?this.start():this.stop()}update(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/60,i=(0,x.calculateExponentialDecayLerpRatio)(this.dampingDecayFactor,r);this.vertigo.update(e),(0,a._)(this,O).alternativeExiting?(this.dampedVertigo.lerp(this.vertigo,i),(0,a._)(this,O).alternativeDampedVertigo.lerp(this.vertigo,i),C.setFromMatrixPosition((0,a._)(this,O).alternativeDampedVertigo.state.worldMatrix),P.setFromMatrixPosition(this.dampedVertigo.state.worldMatrix),1e-4>C.distanceToSquared(P)&&(0,h._)(this,F,L).call(this)):this.currentDampedVertigo.lerp(this.currentVertigo,i),this.currentDampedVertigo.apply(t,e)}constructor(t={}){(0,c._)(this,B),(0,c._)(this,q),(0,c._)(this,j),(0,c._)(this,F),(0,s._)(this,O,{writable:!0,value:void 0}),(0,s._)(this,V,{writable:!0,value:void 0}),this.dampingDecayFactor=1e-4,this.vertigo=new y.B,this.dampedVertigo=new y.B,this.focusPlane=null,this.group=new d.YJl,(0,o._)(this,O,{alternativeActivationCount:0,alternativeIsActive:!1,alternativeWasStarted:!1,alternativeVertigo:new y.B,alternativeDampedVertigo:new y.B,alternativeExiting:!1,alternativeHelperColor:"red",alternativeHelper:null,startDestroyableInstance:new g.el}),this.inputConfig={wheel:"zoom"},this.actions={togglePerspective:()=>{let t=this.currentVertigo.perspective>.5?0:1;p.X5.tween({target:[this.currentVertigo,"perspective"],to:{perspective:t},duration:1,ease:"inOut3"})},focus:t=>{p.X5.tween({target:this.currentVertigo.focus,to:(0,v.jj)(t),duration:1,ease:"inOut3"})},rotate:(t,e,r)=>{let i=new d.PTz().setFromEuler(this.currentVertigo.rotation),n=new d.PTz().setFromEuler(new d.O9p(t,e,r,"YXZ")),a=new d.PTz;p.X5.during({target:[this.currentVertigo,"rotation"],duration:1}).onUpdate(t=>{let{progress:e}=t;a.slerpQuaternions(i,n,p.X5.ease("inOut3")(e)),this.currentVertigo.rotation.setFromQuaternion(a)})},enterAlternative:()=>{(0,a._)(this,O).alternativeWasStarted=this.started,this.start(),(0,h._)(this,j,W).call(this)},exitAlternative:()=>{!1===(0,a._)(this,O).alternativeWasStarted&&this.stop(),(0,a._)(this,O).alternativeExiting=!0},toggleAlternative:t=>{null!=t||(t=!(0,h._)(this,q,k).call(this)),t?this.actions.enterAlternative():this.actions.exitAlternative()},positiveXAlign:()=>{this.actions.rotate(0,Math.PI/2,0)},negativeXAlign:()=>{this.actions.rotate(0,-Math.PI/2,0)},positiveYAlign:()=>{this.actions.rotate(-Math.PI/2,0,0)},negativeYAlign:()=>{this.actions.rotate(Math.PI/2,0,0)},positiveZAlign:()=>{this.actions.rotate(0,0,0)},negativeZAlign:()=>{this.actions.rotate(0,Math.PI,0)}},this.panInputs=[],this.orbitInputs=[],(0,o._)(this,V,!1),this.destroy=()=>{(0,a._)(this,V)||((0,o._)(this,V,!0),(0,a._)(this,O).startDestroyableInstance.destroy())},this.started=!1,this.currentVertigo.set(t),this.currentDampedVertigo.set(t),this.group.name="VertigoControls-Helper"}}function*E(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null!=(n=this.element)?n:document.body;yield function(t,e){for(let[r,i]of Object.entries(e))t.addEventListener(r,i);return{destroy(){for(let[r,i]of Object.entries(e))t.removeEventListener(r,i)}}}(t,{contextmenu:t=>{t.preventDefault()}});let e=new d.I9Y;yield(0,u.s)(t,{onChange:r=>{let i=t.getBoundingClientRect(),n=(r.localPosition.x-i.x)/i.width*2-1,a=-((r.localPosition.y-i.y)/i.height*2-1);e.set(n,a)},dragButton:-1,onDrag:t=>{let e=t.altKey?.2:t.shiftKey?5:1;switch(t.button===u.m.Left&&t.touchCount<=1?"orbit":"pan"){case"orbit":_(t,this.orbitInputs)&&this.orbit(-.01*t.delta.y*e,-.01*t.delta.x*e);break;case"pan":_(t,this.panInputs)&&this.pan(-.025*t.delta.x*e,.025*t.delta.y*e)}},wheelPreventDefault:!0,onWheel:t=>{switch(this.inputConfig.wheel){case"zoom":{let r=this.currentVertigo.zoom*(1-.001*t.delta.y);if(t.event.altKey)if(t.event.shiftKey){let e=this.currentVertigo.perspective*(1-.001*t.delta.y);this.currentVertigo.perspective=(0,f.clamp)(e,0,10)}else this.zoomAt(r,e);else this.zoomAt(r,{x:0,y:0});break}case"dolly":this.dolly(.01*t.delta.y)}}})}function k(){return(0,a._)(this,O).alternativeIsActive&&!1===(0,a._)(this,O).alternativeExiting}function W(){if((0,a._)(this,O).alternativeExiting=!1,!(0,a._)(this,O).alternativeIsActive){(0,a._)(this,O).alternativeIsActive=!0,(0,a._)(this,O).alternativeDampedVertigo.copy(this.dampedVertigo);let t=new m.T(this.vertigo,{color:(0,a._)(this,O).alternativeHelperColor});this.group.add(t),(0,a._)(this,O).alternativeHelper=t,0===(0,a._)(this,O).alternativeActivationCount&&((0,a._)(this,O).alternativeVertigo.copy(this.vertigo),(0,a._)(this,O).alternativeVertigo.after*=1.5,(0,a._)(this,O).alternativeDampedVertigo.copy(this.dampedVertigo)),(0,l._)(this,O).value.alternativeActivationCount++}}function L(){(0,a._)(this,O).alternativeIsActive=!1,(0,a._)(this,O).alternativeExiting=!1,(0,a._)(this,O).alternativeHelper&&(this.group.remove((0,a._)(this,O).alternativeHelper),(0,a._)(this,O).alternativeHelper=null)}},77794:(t,e,r)=>{r.d(e,{u:()=>D,w:()=>O});var i=r(49797),n=r(6726),a=r(94065),s=r(3461);class o{ensureKeyEntry(t,e,r){let i=this.keyMap.get(t);if(i){if(i.count!==r)throw Error("A key entry already exists with a different count. This is not allowed. Once a key is set, it cannot be changed.");return i}{let i={index:e,count:r};return this.keyMap.set(t,i),i}}setTransformMatrix(t){return this.transformMatrix.copy(t),this}resetTransformMatrix(){return this.transformMatrix.identity(),this}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];throw Error("Not implemented!")}clear(){return this.keyMap.clear(),this}constructor(){this.keyMap=new Map,this.transformMatrix=new i.kn4}}var l=r(66066),h=r(15940),c=r(17953),d=r(81074),u=r(7147);let p=new i.Pq0,f=new i.Pq0,x=new i.Pq0,g=new i.Pq0,v=new i.Pq0,y=new i.Pq0,m=new i.Pq0,w=new i.Q1f,z=new i.kn4;class M{static box(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[e,r,i,n,s,o,l,h]=M.boxPoints;if("min"in t||"max"in t){let{min:i=M.boxMinMaxDefaults.min,max:n=M.boxMinMaxDefaults.max}=t;(0,a.jj)(i,e),(0,a.jj)(n,r)}else if("center"in t||"size"in t){let{center:s=M.boxCenterSizeDefaults.center,size:o=M.boxCenterSizeDefaults.size}=t;(0,a.jj)(s,i),(0,a.jj)(o,n).multiplyScalar(.5),e.copy(i).sub(n),r.copy(i).add(n)}else e.copy(M.boxMinMaxDefaults.min),r.copy(M.boxMinMaxDefaults.max);t.inset&&(e.addScalar(t.inset),r.addScalar(-t.inset));let{x:c,y:d,z:u}=e,{x:p,y:f,z:x}=r;return r.set(p,d,u),i.set(p,d,x),n.set(c,d,x),s.set(c,f,u),o.set(p,f,u),l.set(p,f,x),h.set(c,f,x),t.transform&&((0,a.vl)(t.transform,z),e.applyMatrix4(z),r.applyMatrix4(z),i.applyMatrix4(z),n.applyMatrix4(z),s.applyMatrix4(z),o.applyMatrix4(z),l.applyMatrix4(z),h.applyMatrix4(z)),M}}M.boxPoints=[new i.Pq0,new i.Pq0,new i.Pq0,new i.Pq0,new i.Pq0,new i.Pq0,new i.Pq0,new i.Pq0],M.boxDefaults={inset:0,transform:void 0},M.boxMinMaxDefaults={min:new i.Pq0(-.5,-.5,-.5),max:new i.Pq0(.5,.5,.5)},M.boxCenterSizeDefaults={center:new i.Pq0(0,0,0),size:new i.Pq0(1,1,1)};let S={size:.1,proportionalSize:!1,position:"middle",skip:void 0,type:"single",scale:1},b={key:void 0,color:void 0,opacity:1,arrow:!1};var A=new WeakSet;class C extends o{static createParts(){let{nodeMaterial:t=!1,lineCount:e=2e4,defaultColor:r="white",defaultOpacity:n=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=new i.LoY,s={position:new i.THS(new Float32Array(3*e*2),3),color:new i.THS(new Float32Array(3*e*2),3),aOpacity:new i.THS(new Float32Array(2*e),1)};for(let[t,e]of Object.entries(s))a.setAttribute(t,e);let o=t?(()=>{let t=new d.e9u({vertexColors:!0,transparent:!0,depthWrite:!1}),e=(0,c.xIr)(s.aOpacity,"float",1,0);return t.opacityNode=(0,c.PCg)(e),t})():(()=>{let t=new i.mrM({vertexColors:!0,transparent:!0,depthWrite:!1});return t.onBeforeCompile=t=>u.bI.with(t).varying({vOpacity:"float"}).vertex.top("\n          attribute float aOpacity;\n        ").vertex.mainAfterAll("\n          vOpacity = aOpacity;\n        ").fragment.after("color_fragment","\n          diffuseColor.a *= vOpacity;\n        "),t})(),l=new i.DXC(a,o);return l.frustumCulled=!1,{count:e,defaults:{color:r,opacity:n},geometry:a,attributes:s,lines:l}}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];this.parts.geometry.applyMatrix4((0,a.GD)(e))}clear(){return super.clear(),this.state.index=0,this.parts.geometry.setDrawRange(0,0),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,{lines:e}=this.parts;return 0!==t?(e.renderOrder=t,e.material.depthTest=!1,e.material.depthWrite=!1):(e.renderOrder=0,e.material.depthTest=!0,e.material.depthWrite=!0),this}segmentsArray(t,e){let{position:r,color:i,aOpacity:n}=this.parts.attributes,{key:a,color:s,opacity:o}={...b,...this.parts.defaults,...e},{r:h,g:c,b:d}=w.set(s),u=t.length/3,z=function(t,e){var r,i;if(!1===e||void 0===e)return new Float32Array;let n=Array.isArray(e)?e:[!0===e?{}:e],a=0;for(let t of n){let e=null!=(r=null==t?void 0:t.type)?r:S.type,n=null!=(i=null==t?void 0:t.position)?i:S.position;a+=(Array.isArray(n)?n.length:1)*("triple"===e?3:"double"===e?2:1)}let s=t.length/3/2,o=new Float32Array(s*a*12),l=0;for(let e=0;e<s;e++){let r=6*e;p.set(t[r+0],t[r+1],t[r+2]),f.set(t[r+3],t[r+4],t[r+5]),x.subVectors(f,p);let i=x.lengthSq();for(let t of n){let{size:e=S.size,proportionalSize:r=S.proportionalSize,position:n=S.position,skip:a=S.skip,type:s=S.type,scale:h=S.scale}=null!=t?t:{};if(void 0!==a){if(!0===a||"less-than-size"===a){if(i<e*e)continue}else if("number"==typeof a&&i<a*a)continue}let c=Math.sqrt(i),d=(r?c:1)*e*h;g.copy(x).divideScalar(c);let u=Math.abs(g.x),w=Math.abs(g.y),z=Math.abs(g.z);for(let t of(u>=z&&w>=z?v.set(g.y,-g.x,0).normalize():w>=u?v.set(g.z,0,-g.x).normalize():v.set(0,g.z,-g.y).normalize(),Array.isArray(n)?n:[n])){let r="triple"===s?3:"double"===s?2:1;for(let i=0;i<r;i++){let n=function(t){if("number"==typeof t)return t;switch(t){case"end":return 1;case"start":return 0;case"middle":return .5;default:throw Error("Invalid arrow position: ".concat(t))}}(t);r>1&&(n+=(i/(r-1)-n)*e/c*.8),y.lerpVectors(p,f,n),y.toArray(o,(4*l+0)*3),m.copy(y).addScaledVector(g,-d).addScaledVector(v,-d).toArray(o,(4*l+1)*3),y.toArray(o,(4*l+2)*3),m.copy(y).addScaledVector(g,-d).addScaledVector(v,d).toArray(o,(4*l+3)*3),l++}}}}return o}(t,null==e?void 0:e.arrow),M=z.length/3,C=u+M,{index:T}=void 0!==a?this.ensureKeyEntry(a,this.state.index,u):this.state;if(T+C>this.parts.count)throw console.log("Overflow Handling Not implemented",T+C,this.parts.count),Error("Overflow Handling Not implemented");this.state.index=Math.max(this.state.index,T+C);{let{transformMatrix:e}=this;for(let a=0;a<u;a++)p.fromArray(t,3*a).applyMatrix4(e).toArray(r.array,(T+a)*3),i.setXYZ(T+a,h,c,d),n.setX(T+a,o)}{let t=T+u;for(let e=0;e<M;e++)p.fromArray(z,3*e).applyMatrix4(this.transformMatrix).toArray(r.array,(t+e)*3),i.setXYZ(t+e,h,c,d),n.setX(t+e,o)}return(0,l._)(this,A,P).call(this),this}segments(t,e){let r=t.length,i=new Float32Array(3*r);for(let e=0;e<r;e++){let{x:r,y:n,z:s}=(0,a.jj)(t[e],p),o=3*e;i[o+0]=r,i[o+1]=n,i[o+2]=s}return this.segmentsArray(i,e)}line(t,e,r){return this.segments([t,e],r)}axes(t){let{size:e=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{x:r,y:i,z:n}=(0,a.jj)(t,p);return this.segmentsArray(new Float32Array([r,i,n,r+e,i,n]),{color:"#ff0033"}).segmentsArray(new Float32Array([r,i,n,r,i+e,n]),{color:"#00ff33"}).segmentsArray(new Float32Array([r,i,n,r,i,n+e]),{color:"#0033ff"})}polyline(t,e){if(t.length<2)return this;let r=Array((t.length-1)*2);for(let e=1;e<t.length;e++)r[2*e-2]=t[e-1],r[2*e-1]=t[e];return this.segments(r,e)}polygon(t,e){return t.length<2||(this.polyline(t,e),this.line(t[t.length-1],t[0],e)),this}box(t,e){let[r,i,n,a,s,o,l,h]=M.box(t).boxPoints;return this.segmentsArray(new Float32Array([r.x,r.y,r.z,i.x,i.y,i.z,i.x,i.y,i.z,n.x,n.y,n.z,n.x,n.y,n.z,a.x,a.y,a.z,a.x,a.y,a.z,r.x,r.y,r.z,s.x,s.y,s.z,o.x,o.y,o.z,o.x,o.y,o.z,l.x,l.y,l.z,l.x,l.y,l.z,h.x,h.y,h.z,h.x,h.y,h.z,s.x,s.y,s.z,r.x,r.y,r.z,s.x,s.y,s.z,i.x,i.y,i.z,o.x,o.y,o.z,n.x,n.y,n.z,l.x,l.y,l.z,a.x,a.y,a.z,h.x,h.y,h.z]),e)}rect(t,e){let{minX:r,minY:i,maxX:a,maxY:s}=n.M_.from(t),{inset:o,triple:l,diagonals:h}={...C.rectDefaultOptions,...e};if(r+=o,i+=o,a-=o,s-=o,h){let t="object"==typeof h?h.inset:0,n=0,o=0;if(0!==t){let e=Math.hypot(a-r,s-i);n=t*(a-r)/e,o=t*(s-i)/e}this.segments([{x:r+n,y:i+o,z:0},{x:a-n,y:s-o,z:0},{x:a-n,y:i+o,z:0},{x:r+n,y:s-o,z:0}],e)}return l&&(this.segments([{x:r+l,y:i+l,z:0},{x:a-l,y:i+l,z:0},{x:a-l,y:i+l,z:0},{x:a-l,y:s-l,z:0},{x:a-l,y:s-l,z:0},{x:r+l,y:s-l,z:0},{x:r+l,y:s-l,z:0},{x:r+l,y:i+l,z:0}],e),this.segments([{x:r-l,y:i-l,z:0},{x:a+l,y:i-l,z:0},{x:a+l,y:i-l,z:0},{x:a+l,y:s+l,z:0},{x:a+l,y:s+l,z:0},{x:r-l,y:s+l,z:0},{x:r-l,y:s+l,z:0},{x:r-l,y:i-l,z:0}],e)),this.segments([{x:r,y:i,z:0},{x:a,y:i,z:0},{x:a,y:i,z:0},{x:a,y:s,z:0},{x:a,y:s,z:0},{x:r,y:s,z:0},{x:r,y:s,z:0},{x:r,y:i,z:0}],e)}circle(){let{center:t=0,axis:e="z",radius:r=1,quality:i="medium",segments:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;null!=n||(n=C.circleQualityPresets[i]);let{x:o,y:l,z:h}=(0,a.jj)(t,p);(0,a.jj)(e,p).normalize(),f.set(p.y,p.z,p.x).cross(p).normalize(),x.crossVectors(p,f);let c=new Float32Array(3*n*2);for(let t=0;t<n;t++){let e=t/n*Math.PI*2,i=(t+1)/n*Math.PI*2,a=Math.cos(e)*r,s=Math.sin(e)*r,d=Math.cos(i)*r,u=Math.sin(i)*r,p=6*t;c[p+0]=o+a*f.x+s*x.x,c[p+1]=l+a*f.y+s*x.y,c[p+2]=h+a*f.z+s*x.z,c[p+3]=o+d*f.x+u*x.x,c[p+4]=l+d*f.y+u*x.y,c[p+5]=h+d*f.z+u*x.z}return this.segmentsArray(c,s),this}regularGrid(t){let{color:e,opacity:r,plane:i,size:n,subdivisions:a}={...C.regularGridDefaults,...t},s=a.length,o=a.map((t,e)=>a.slice(e).reduce((t,e)=>t*e,1)),h=o[0],c=new Float32Array((h+1)*12),d=new Float32Array((h+1)*12).fill(1),u=new Float32Array((h+1)*4).fill(1),p=Array.isArray(e)?e:[e],f=a.map((t,e)=>{let{r,g:i,b:n}=w.set(p[Math.min(e,p.length-1)]);return[r,i,n]}),x=Array.isArray(r)?r:[r],g=a.map((t,e)=>x[Math.min(e,x.length-1)]);for(let t=0;t<=h;t++){let e=s-1;for(;e>0&&t%o[e]==0;)e--;let[r,i,a]=f[e],l=g[e],p=t/h*n,x=12*t;c[x+0]=-n/2,c[x+1]=-n/2+p,c[x+2]=0,c[x+3]=n/2,c[x+4]=-n/2+p,c[x+5]=0,c[x+6]=-n/2+p,c[x+7]=-n/2,c[x+8]=0,c[x+9]=-n/2+p,c[x+10]=n/2,c[x+11]=0,d[x+0]=r,d[x+1]=i,d[x+2]=a,d[x+3]=r,d[x+4]=i,d[x+5]=a,d[x+6]=r,d[x+7]=i,d[x+8]=a,d[x+9]=r,d[x+10]=i,d[x+11]=a;let v=4*t;u[v+0]=l,u[v+1]=l,u[v+2]=l,u[v+3]=l}if("xz"===i)for(let t=0;t<c.length;t+=3)c[t+2]=c[t+1],c[t+1]=0;else if("yz"===i)for(let t=0;t<c.length;t+=3)c[t+2]=c[t+1],c[t+1]=c[t+0],c[t+0]=0;let{index:v}=this.state;return this.parts.attributes.position.array.set(c,3*v),this.parts.attributes.color.array.set(d,3*v),this.parts.attributes.aOpacity.array.set(u,v),this.state.index+=(h+1)*4,(0,l._)(this,A,P).call(this),this}constructor(t){super(),(0,h._)(this,A),this.state={index:0},this.parts=C.createParts(t)}}function P(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(let t of(this.parts.geometry.setDrawRange(0,this.state.index),Object.values(this.parts.attributes)))t.needsUpdate=!0;if(this.state.index>2*this.parts.count)throw Error("Not implemented!");if(t)for(let t of Object.values(this.parts.attributes))t.array.some(t=>isNaN(t))&&console.log(t.array.findIndex(t=>isNaN(t)))}C.rectDefaultOptions={inset:0,triple:void 0,diagonals:void 0},C.circleQualityPresets={low:18,medium:36,high:64,ultra:256},C.regularGridDefaults={plane:"xy",size:100,subdivisions:[10,2,5],opacity:[.2,.05,.01],color:"white"};class T extends o{static createParts(){let{pointCount:t=1e4}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new i.LoY,r={position:new i.THS(new Float32Array(3*t),3),color:new i.THS(new Float32Array(3*t),3),aScale:new i.THS(new Float32Array(t),1),aShape:new i.THS(new Float32Array(t),1)};for(let[t,i]of Object.entries(r))e.setAttribute(t,i);let n=new i.BH$({vertexColors:!0});n.onBeforeCompile=t=>u.bI.with(t).varying({vShape:"float"}).vertex.top("\n        attribute float aScale;\n        attribute float aShape;\n      ").vertex.mainAfterAll("\n        gl_PointSize *= aScale;\n        vShape = aShape;\n      ").fragment.top("\n        float sdBox(in vec2 p, in vec2 b) {\n          vec2 d = abs(p) - b;\n          return length(max(d, 0.0)) + min(max(d.x, d.y), 0.0);\n        }\n      ").fragment.after("color_fragment","\n        float regular = .2;\n        float thin = .1;\n        float ultraThin = .033;\n\n        if (vShape == ".concat(T.shapes.circle,".0) {\n          float d = distance(gl_PointCoord * 2.0, vec2(1.0));\n          if (d > 1.0) discard;\n        }\n\n        if (vShape == ").concat(T.shapes.ring,".0) {\n          float d = distance(gl_PointCoord * 2.0, vec2(1.0));\n          if (d < 0.8 || d > 1.0) discard;\n        }\n\n        if (vShape == ").concat(T.shapes["ring-thin"],".0) {\n          float d = distance(gl_PointCoord * 2.0, vec2(1.0));\n          if (d < 0.9 || d > 1.0) discard;\n        }\n\n        else if (vShape == ").concat(T.shapes.plus,".0) {\n          float d0 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(1.0, regular));\n          float d1 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(regular, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(T.shapes["plus-thin"],".0) {\n          float d0 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(1.0, thin));\n          float d1 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(thin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(T.shapes["plus-ultra-thin"],".0) {\n          float d0 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(1.0, ultraThin));\n          float d1 = sdBox(gl_PointCoord * 2.0 - 1.0, vec2(ultraThin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(T.shapes.x,".0) {\n          vec2 p = gl_PointCoord * 2.0 - 1.0;\n          float c = 0.70710678;\n          p = mat2(c, -c, c, c) * p;\n          float d0 = sdBox(p, vec2(1.0, regular));\n          float d1 = sdBox(p, vec2(regular, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(T.shapes["x-thin"],".0) {\n          vec2 p = gl_PointCoord * 2.0 - 1.0;\n          float c = 0.70710678;\n          p = mat2(c, -c, c, c) * p;\n          float d0 = sdBox(p, vec2(1.0, thin));\n          float d1 = sdBox(p, vec2(thin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        else if (vShape == ").concat(T.shapes["x-ultra-thin"],".0) {\n          vec2 p = gl_PointCoord * 2.0 - 1.0;\n          float c = 0.70710678;\n          p = mat2(c, -c, c, c) * p;\n          float d0 = sdBox(p, vec2(1.0, ultraThin));\n          float d1 = sdBox(p, vec2(ultraThin, 1.0));\n          if (d0 > 0.0 && d1 > 0.0) discard;\n        }\n\n        // diffuseColor.rgb *= vec3(gl_PointCoord, 1.0);\n      "));let a=new i.ONl(e,n);return a.frustumCulled=!1,{count:t,geometry:e,attributes:r,points:a}}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];this.parts.geometry.applyMatrix4((0,a.GD)(e))}clear(){return super.clear(),this.state.index=0,this.parts.geometry.setDrawRange(0,0),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,{points:e}=this.parts;return 0!==t?(e.renderOrder=t,e.material.depthTest=!1,e.material.depthWrite=!1,e.material.transparent=!0):(e.renderOrder=0,e.material.depthTest=!0,e.material.depthWrite=!0,e.material.transparent=!1),this}points(t){let{key:e,size:r=.1,scale:i=1,color:n="white",shape:s="square"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{transformMatrix:o}=this,l=void 0!==e,h=t.length,{index:c}=l?this.ensureKeyEntry(e,this.state.index,h):this.state,{position:d,color:u,aScale:f,aShape:x}=this.parts.attributes,{r:g,g:v,b:y}=w.set(n),m=i*r,z=T.shapes[s];for(let e=0;e<h;e++){let{x:r,y:i,z:n}=(0,a.jj)(t[e],p).applyMatrix4(o),s=c+e;d.setXYZ(s,r,i,n),u.setXYZ(s,g,v,y),f.setX(s,m),x.setX(s,z)}for(let t of(this.state.index=l?Math.max(this.state.index,c+h):c+h,this.parts.geometry.setDrawRange(0,this.state.index),Object.values(this.parts.attributes)))t.needsUpdate=!0;if(this.state.index>this.parts.count)throw Error("Overflow Handling Not implemented");return this}box(t,e){let{boxPoints:r}=M.box(t);return this.points(r,e)}point(t,e){return this.points([t],e)}constructor(t){super(),this.state={index:0},this.parts=T.createParts(t)}}T.shapes=(()=>{let t=0;return{square:t++,circle:t++,ring:t++,"ring-thin":t++,plus:t++,"plus-thin":t++,"plus-ultra-thin":t++,x:t++,"x-thin":t++,"x-ultra-thin":t++}})();class I extends o{static createParts(t){let e=new s.w({textCount:2e3,...t});return{count:e.count,textHelper:e}}setTransformMatrix(t){return this.parts.textHelper.setTransformMatrix(t),this}resetTransformMatrix(){return this.parts.textHelper.resetTransformMatrix(),this}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];this.parts.textHelper.applyTransform(...e)}clear(){return this.state.index=0,this.parts.textHelper.clearAllText(),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.parts.textHelper.onTop(t),this}texts(t,e){let r=this.state.index,{texts:i,...n}={...I.textDefaults,...e},s="function"==typeof i?i:t=>i[t%i.length],o=0;for(let e of t){let{x:t,y:i,z:l}=(0,a.jj)(e,p);this.parts.textHelper.setTextAt(r,s(o),{...n,x:t,y:i,z:l}),r++,o++}return this.state.index=r,this}text(t,e,r){return this.texts([t],{...r,texts:[e]})}textAt(t,e,r){return this.parts.textHelper.setTextAt(t,e,{...r}),this}constructor(t){super(),this.state={index:0},this.parts=I.createParts(t)}}I.textDefaults={texts:t=>t.toString()};let _={color:void 0,size:.1,shape:"square",scale:1};class D extends i.YJl{static createParts(t,e){let{nodeMaterial:r}=null!=e?e:{},i=new T({...null==e?void 0:e.points});t.add(i.parts.points);let n=new C({nodeMaterial:r,...null==e?void 0:e.lines});t.add(n.parts.lines);let a=new I({nodeMaterial:r,...null==e?void 0:e.texts});return t.add(a.parts.textHelper),{pointsManager:i,linesManager:n,textsManager:a}}points(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.pointsManager.points(...e),this}point(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.pointsManager.point(...e),this}segments(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.segments(...e),this}line(t,e,r){return this.parts.linesManager.line(t,e,r),(null==r?void 0:r.points)&&this.points([t,e],{..._,color:r.color,...!0===r.points?{}:r.points}),this}axes(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.axes(...e),this}polyline(t,e){return this.parts.linesManager.polyline(t,e),(null==e?void 0:e.points)&&this.points(t,{..._,color:e.color,...!0===e.points?{}:e.points}),this}polylines(t,e){for(let r of t)this.polyline(r,e);return this}polygon(t,e){return this.parts.linesManager.polygon(t,e),(null==e?void 0:e.points)&&this.points(t,{..._,color:e.color,...!0===e.points?{}:e.points}),this}polygons(t,e){for(let r of t)this.polygon(r,e);return this}box(t,e){return this.parts.linesManager.box(t,e),(null==e?void 0:e.points)&&this.parts.pointsManager.box(t,{..._,color:e.color,...!0===e.points?{}:e.points}),this}circle(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.circle(...e),this}rect(t,e){this.parts.linesManager.rect(t,e);let{points:r,center:i=r,corners:a=r}=null!=e?e:{};if(a||i){let r=n.M_.from(t);if(i&&this.parts.pointsManager.point(r.center,{color:null==e?void 0:e.color,...e,...(null==e?void 0:e.center)===!0?{}:null==e?void 0:e.center}),a){let{minX:t,minY:i,maxX:n,maxY:a}=r;this.parts.pointsManager.points([[t,i],[n,i],[n,a],[t,a]],{color:null==e?void 0:e.color,...e,...(null==e?void 0:e.corners)===!0?{}:null==e?void 0:e.corners})}}return this}regularGrid(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.linesManager.regularGrid(...e),this}texts(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.textsManager.texts(...e),this}text(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.textsManager.text(...e),this}textAt(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.textsManager.textAt(...e),this}setTransformMatrix(t){return this.parts.pointsManager.setTransformMatrix(t),this.parts.linesManager.setTransformMatrix(t),this.parts.textsManager.setTransformMatrix(t),this}resetTransformMatrix(){return this.parts.pointsManager.resetTransformMatrix(),this.parts.linesManager.resetTransformMatrix(),this.parts.textsManager.resetTransformMatrix(),this}applyTransform(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.parts.pointsManager.applyTransform(...e),this.parts.linesManager.applyTransform(...e),this.parts.textsManager.applyTransform(...e),this}clear(){return this.parts.pointsManager.clear(),this.parts.linesManager.clear(),this.parts.textsManager.clear(),this}onTop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.renderOrder=t,this.parts.pointsManager.onTop(t),this.parts.linesManager.onTop(t),this.parts.textsManager.onTop(t),this}globalExpose(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"debugHelper";return Object.assign(globalThis,{[t]:this}),this}addTo(t){return t?t.add(this):this.removeFromParent(),this}constructor(t){super(),this.userData={helper:!0},this.parts=D.createParts(this,t)}}let O=new D}}]);
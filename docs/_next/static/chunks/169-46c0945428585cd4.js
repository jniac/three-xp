"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[169],{8169:function(e,t,a){a.d(t,{Main:function(){return w}});var i=a(7504),s=a(3778),r=a(2288),n=a(9949),l=a(2983),o=a(3630),d=a(9925),h=a(3203),u=a(2941),p=a(767),c=a(1458),m=a(6188),f=a(8047),g=a(6829),v=a(2609),M=a(1310),x=a(8870),T=a(7174);class b extends v.w{dispose(){this.gtaoNoiseTexture.dispose(),this.pdNoiseTexture.dispose(),this.normalRenderTarget.dispose(),this.gtaoRenderTarget.dispose(),this.pdRenderTarget.dispose(),this.normalMaterial.dispose(),this.pdMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}get gtaoMap(){return this.pdRenderTarget.texture}setGBuffer(e,t){void 0!==e?(this.depthTexture=e,this.normalTexture=t,this._renderGBuffer=!1):(this.depthTexture=new l.$YQ,this.depthTexture.format=l.brP,this.depthTexture.type=l.wJv,this.normalRenderTarget=new l.dd2(this.width,this.height,{minFilter:l.TyD,magFilter:l.TyD,type:l.cLu,depthTexture:this.depthTexture}),this.normalTexture=this.normalRenderTarget.texture,this._renderGBuffer=!0);let a=this.normalTexture?1:0,i=this.depthTexture===this.normalTexture?"w":"x";this.gtaoMaterial.defines.NORMAL_VECTOR_TYPE=a,this.gtaoMaterial.defines.DEPTH_SWIZZLING=i,this.gtaoMaterial.uniforms.tNormal.value=this.normalTexture,this.gtaoMaterial.uniforms.tDepth.value=this.depthTexture,this.pdMaterial.defines.NORMAL_VECTOR_TYPE=a,this.pdMaterial.defines.DEPTH_SWIZZLING=i,this.pdMaterial.uniforms.tNormal.value=this.normalTexture,this.pdMaterial.uniforms.tDepth.value=this.depthTexture,this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture}setSceneClipBox(e){e?(this.gtaoMaterial.needsUpdate=1!==this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=1,this.gtaoMaterial.uniforms.sceneBoxMin.value.copy(e.min),this.gtaoMaterial.uniforms.sceneBoxMax.value.copy(e.max)):(this.gtaoMaterial.needsUpdate=0===this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=0)}updateGtaoMaterial(e){void 0!==e.radius&&(this.gtaoMaterial.uniforms.radius.value=e.radius),void 0!==e.distanceExponent&&(this.gtaoMaterial.uniforms.distanceExponent.value=e.distanceExponent),void 0!==e.thickness&&(this.gtaoMaterial.uniforms.thickness.value=e.thickness),void 0!==e.distanceFallOff&&(this.gtaoMaterial.uniforms.distanceFallOff.value=e.distanceFallOff,this.gtaoMaterial.needsUpdate=!0),void 0!==e.scale&&(this.gtaoMaterial.uniforms.scale.value=e.scale),void 0!==e.samples&&e.samples!==this.gtaoMaterial.defines.SAMPLES&&(this.gtaoMaterial.defines.SAMPLES=e.samples,this.gtaoMaterial.needsUpdate=!0),void 0!==e.screenSpaceRadius&&(e.screenSpaceRadius?1:0)!==this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS&&(this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS=e.screenSpaceRadius?1:0,this.gtaoMaterial.needsUpdate=!0)}updatePdMaterial(e){let t=!1;void 0!==e.lumaPhi&&(this.pdMaterial.uniforms.lumaPhi.value=e.lumaPhi),void 0!==e.depthPhi&&(this.pdMaterial.uniforms.depthPhi.value=e.depthPhi),void 0!==e.normalPhi&&(this.pdMaterial.uniforms.normalPhi.value=e.normalPhi),void 0!==e.radius&&e.radius!==this.radius&&(this.pdMaterial.uniforms.radius.value=e.radius),void 0!==e.radiusExponent&&e.radiusExponent!==this.pdRadiusExponent&&(this.pdRadiusExponent=e.radiusExponent,t=!0),void 0!==e.rings&&e.rings!==this.pdRings&&(this.pdRings=e.rings,t=!0),void 0!==e.samples&&e.samples!==this.pdSamples&&(this.pdSamples=e.samples,t=!0),t&&(this.pdMaterial.defines.SAMPLES=this.pdSamples,this.pdMaterial.defines.SAMPLE_VECTORS=(0,T.a)(this.pdSamples,this.pdRings,this.pdRadiusExponent),this.pdMaterial.needsUpdate=!0)}render(e,t,a){switch(this._renderGBuffer&&(this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.gtaoMaterial.uniforms.cameraWorldMatrix.value.copy(this.camera.matrixWorld),this.renderPass(e,this.gtaoMaterial,this.gtaoRenderTarget,16777215,1),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.renderPass(e,this.pdMaterial,this.pdRenderTarget,16777215,1),this.output){case b.OUTPUT.Off:break;case b.OUTPUT.Diffuse:this.copyMaterial.uniforms.tDiffuse.value=a.texture,this.copyMaterial.blending=l.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case b.OUTPUT.AO:this.copyMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.copyMaterial.blending=l.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case b.OUTPUT.Denoise:this.copyMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.copyMaterial.blending=l.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case b.OUTPUT.Depth:this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case b.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=l.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case b.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=a.texture,this.copyMaterial.blending=l.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blendMaterial.uniforms.intensity.value=this.blendIntensity,this.blendMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.renderPass(e,this.blendMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.GTAOPass: Unknown output type.")}}renderPass(e,t,a,i,s){e.getClearColor(this.originalClearColor);let r=e.getClearAlpha(),n=e.autoClear;e.setRenderTarget(a),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(s||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=n,e.setClearColor(this.originalClearColor),e.setClearAlpha(r)}renderOverride(e,t,a,i,s){e.getClearColor(this.originalClearColor);let r=e.getClearAlpha(),n=e.autoClear;e.setRenderTarget(a),e.autoClear=!1,i=t.clearColor||i,s=t.clearAlpha||s,null!=i&&(e.setClearColor(i),e.setClearAlpha(s||0),e.clear()),this.scene.overrideMaterial=t;let l=this.camera.layers.mask;this.camera.layers.set(0),e.render(this.scene,this.camera),this.camera.layers.mask=l,this.scene.overrideMaterial=null,e.autoClear=n,e.setClearColor(this.originalClearColor),e.setClearAlpha(r)}setSize(e,t){this.width=e,this.height=t,this.gtaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.pdRenderTarget.setSize(e,t),this.gtaoMaterial.uniforms.resolution.value.set(e,t),this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.pdMaterial.uniforms.resolution.value.set(e,t),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse)}overrideVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){let a=t.get(e);e.visible=a}),t.clear()}generateNoise(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=new g.L,a=new Uint8Array(e*e*4);for(let i=0;i<e;i++)for(let s=0;s<e;s++){let r=i,n=s;a[(i*e+s)*4]=(.5*t.noise(r,n)+.5)*255,a[(i*e+s)*4+1]=(.5*t.noise(r+e,n)+.5)*255,a[(i*e+s)*4+2]=(.5*t.noise(r,n+e)+.5)*255,a[(i*e+s)*4+3]=(.5*t.noise(r+e,n+e)+.5)*255}let i=new l.IEO(a,e,e,l.wk1,l.ywz);return i.wrapS=l.rpg,i.wrapT=l.rpg,i.needsUpdate=!0,i}constructor(e,t,a,i,s,r,n){super(),this.width=void 0!==a?a:512,this.height=void 0!==i?i:512,this.clear=!0,this.camera=t,this.scene=e,this.output=0,this._renderGBuffer=!0,this._visibilityCache=new Map,this.blendIntensity=1,this.pdRings=2,this.pdRadiusExponent=2,this.pdSamples=16,this.gtaoNoiseTexture=(0,x.mK)(),this.pdNoiseTexture=this.generateNoise(),this.gtaoRenderTarget=new l.dd2(this.width,this.height,{type:l.cLu}),this.pdRenderTarget=this.gtaoRenderTarget.clone(),this.gtaoMaterial=new l.jyz({defines:Object.assign({},x.Sp.defines),uniforms:l.rDY.clone(x.Sp.uniforms),vertexShader:x.Sp.vertexShader,fragmentShader:x.Sp.fragmentShader,blending:l.jFi,depthTest:!1,depthWrite:!1}),this.gtaoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.gtaoMaterial.uniforms.tNoise.value=this.gtaoNoiseTexture,this.gtaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.normalMaterial=new l.RSm,this.normalMaterial.blending=l.jFi,this.pdMaterial=new l.jyz({defines:Object.assign({},T.m.defines),uniforms:l.rDY.clone(T.m.uniforms),vertexShader:T.m.vertexShader,fragmentShader:T.m.fragmentShader,depthTest:!1,depthWrite:!1}),this.pdMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.pdMaterial.uniforms.tNoise.value=this.pdNoiseTexture,this.pdMaterial.uniforms.resolution.value.set(this.width,this.height),this.pdMaterial.uniforms.lumaPhi.value=10,this.pdMaterial.uniforms.depthPhi.value=2,this.pdMaterial.uniforms.normalPhi.value=3,this.pdMaterial.uniforms.radius.value=8,this.depthRenderMaterial=new l.jyz({defines:Object.assign({},x.gs.defines),uniforms:l.rDY.clone(x.gs.uniforms),vertexShader:x.gs.vertexShader,fragmentShader:x.gs.fragmentShader,blending:l.jFi}),this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new l.jyz({uniforms:l.rDY.clone(M.C.uniforms),vertexShader:M.C.vertexShader,fragmentShader:M.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:l.Vdb,blendDst:l.c8b,blendEquation:l.bGH,blendSrcAlpha:l.fSK,blendDstAlpha:l.c8b,blendEquationAlpha:l.bGH}),this.blendMaterial=new l.jyz({uniforms:l.rDY.clone(x.mF.uniforms),vertexShader:x.mF.vertexShader,fragmentShader:x.mF.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:l.Xaj,blendSrc:l.Vdb,blendDst:l.c8b,blendEquation:l.bGH,blendSrcAlpha:l.fSK,blendDstAlpha:l.c8b,blendEquationAlpha:l.bGH}),this.fsQuad=new v.T(null),this.originalClearColor=new l.Ilk,this.setGBuffer(s?s.depthTexture:void 0,s?s.normalTexture:void 0),void 0!==r&&this.updateGtaoMaterial(r),void 0!==n&&this.updatePdMaterial(n)}}b.OUTPUT={Off:-1,Default:0,Diffuse:1,Depth:2,Normal:3,AO:4,Denoise:5};var S=a(3356);class j extends u.C{render(e,t,a,i,s){var r;if(null===(r=this.onBeforeRender)||void 0===r||r.call(this),this.disableBackground){let r=this.scene.background;this.scene.background=null,super.render(e,t,a,i,s),this.scene.background=r}else super.render(e,t,a,i,s)}constructor(...e){super(...e),this.onBeforeRender=null,this.disableBackground=!1}}function y(){let{ref:e}=(0,r.sv)(function*(e){let t=function(e){let{width:t=window.innerWidth,height:a=window.innerHeight}=e,i=new l.CP7({});i.setSize(t,a),i.setPixelRatio(window.devicePixelRatio);let s=new l.cPb(75,t/a,.1,1e3);s.position.z=8,new o.z(s,i.domElement);let r=new m.v().set({activeDuration:30}),u=(0,f.s)(()=>r.requestActivation()),g=function(e){let t=new l.xsS;{let e=new l.Ox3(16777215,1);e.position.set(0,3,1),t.add(e);let a=new l.vmT("#afdbf5","#845244",1);t.add(a)}new S.x().setPath("https://threejs.org/examples/textures/equirectangular/").loadAsync("pedestrian_overpass_1k.hdr").then(e=>{e.mapping=l.dSO,t.environmentIntensity=.1,t.environment=e,t.backgroundBlurriness=.5,t.background=e});let a=new l.Kj0(new l.FE5(2,1,512,64),new l.EJi);t.add(a);let i=new l.Kj0(new l.DvJ(10,1,3),new l.EJi);t.add(i);let s=new l.Kj0(new l.DvJ(1,10,3),new l.EJi);s.position.set(5,0,0),t.add(s);let r=new l.Kj0(new l._12(10,10),new l.EJi({color:"#d1ddff",transmission:1,roughness:0,dispersion:.1,ior:2.5,opacity:1}));return r.layers.set(1),t.add(r),e.onTick(e=>{a.rotation.x+=.5*e.deltaTime,a.rotation.y+=.5*e.deltaTime}),t}(r),v=new d.x(i),M=new j(g,s);M.onBeforeRender=()=>{s.layers.enableAll()},v.addPass(M);let x=new b(g,s,t,a);v.addPass(x);let T=new h.v;v.addPass(T);let y=new p.T(c.C);y.material.uniforms.resolution.value.set(1/t,1/a),v.addPass(y),r.onTick(()=>{v.render()}),n.v.on("REQUIRE:THREE",e=>{e.payload={three:w}});let w={renderer:i,camera:s,scene:g,ticker:r,passes:{render:M,ao:x,output:T},destroy:()=>{i.domElement.remove(),r.destroy(),u.destroy()}};return w}({width:e.clientWidth,height:e.clientHeight});yield t,Object.assign(window,{three:t}),e.appendChild(t.renderer.domElement)},[]);return(0,i.jsx)("div",{ref:e,className:"absolute inset-0"})}function w(){let[e,t]=(0,s.useState)(!0);return(0,i.jsxs)("div",{className:"page",children:[(0,i.jsx)(y,{}),(0,i.jsxs)("div",{className:"absolute inset-0 p-8 flex flex-col items-start justify-start pointer-through",children:[(0,i.jsxs)("div",{className:"flex flex-col items-start justify-start pointer-through max-w-[480px]",children:[(0,i.jsx)("h1",{className:"text-4xl uppercase",children:"ao-transparent"}),(0,i.jsx)("div",{className:"mt-4"}),(0,i.jsx)("p",{children:"Handling Ambient Occlusion and transparent objects"}),(0,i.jsx)("p",{children:"The glass does not generate AO"}),(0,i.jsx)("div",{className:"mt-4"}),(0,i.jsxs)("p",{children:["This is achieved by using a fork of the ",(0,i.jsx)("a",{href:"https://github.com/mrdoob/three.js/blob/master/examples/jsm/postprocessing/GTAOPass.js",children:"GTAOPass"}),"\xa0where the camera layer mask is set to 0 (default layer) and the glass object is set to layer 1 (transparent objects)."]}),(0,i.jsx)("div",{className:"mt-4"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-xl",children:"Pros:"}),(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:"Simple (layer based)"})})]}),(0,i.jsx)("div",{className:"mt-4"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-xl",children:"Cons:"}),(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:"AO is still rendered on top of transparent objects. For semi-opaque objects, this is could be a problem."})})]})]}),(0,i.jsx)("div",{className:"mt-4"}),(0,i.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,i.jsx)("label",{htmlFor:"ao-enabled",className:"select-none",children:"Enable AO"}),(0,i.jsx)("input",{type:"checkbox",name:"ao-enabled",id:"ao-enabled",checked:e,onChange:()=>{let{payload:e}=n.v.send("REQUIRE:THREE");if(e){let{three:a}=e,{passes:i}=a,{ao:s}=i;s.enabled=!s.enabled,t(s.enabled)}}})]})]})]})}}}]);
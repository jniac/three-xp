(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7669],{96086:function(e,t,r){Promise.resolve().then(r.bind(r,97444))},97444:function(e,t,r){"use strict";r.d(t,{Main:function(){return w}});var i=r(78485),a=r(86895),n=r(37457),s=r(494),o=r(48181),l=r(87858),u=r(9710),h=r(4917),d=r(8834),c=r(85679),f=r(82446),p=r(31454),m=r(63549),g=r(38137),v=r(16573);function y(e,t,r,i,a){let n=i-e,s=a-t,o=Math.sqrt(n*n+s*s);return[e+n/o*r,t+s/o*r]}class M extends c.Group{constructor(...e){super(...e),this.parts=(()=>{(0,l.cY)(new c.Mesh(new c.TorusKnotGeometry(10,.4,512,64),new m.P),this),(0,l.cY)(new p.K,{parent:this,rotationX:"90deg"});let e=(0,l.cY)(new g.w,this),t=new c.Vector3,r=new c.Vector3;{let e=new f.z(16);for(let{x:i,y:a,z:n}of(0,v.KA)(16,16,16)){t.set(i,a,n);let[s,o]=y(8,8,16/3,i,n);r.set(s,16/6,o);let l=t.distanceTo(r)<16/6;e.getVoxelState(i,a,n).setUint8(0,l?1:0)}(0,l.cY)(new c.Mesh((0,f.eO)(e.voxelFaces()),new m.P({color:"#ffdd55"})),{parent:this,x:-16,z:-16})}{let e=new f.z(16);for(let{x:i,y:a,z:n}of(0,v.KA)(16,16,16)){t.set(i,a,n);let[s,o]=y(8,8,8,i,n);r.set(s,4,o);let l=4>t.distanceTo(r);e.getVoxelState(i,a,n).setUint8(0,l?1:0)}(0,l.cY)(new c.Mesh((0,f.eO)(e.voxelFaces()),new m.P({color:"#ff5566"})),{parent:this,x:0,z:-16})}{let e=new f.z(16);for(let{x:r,y:i,z:a}of(0,v.KA)(16,16,16)){let n=15>t.set(r,i,a).length();e.getVoxelState(r,i,a).setUint8(0,n?1:0)}(0,l.cY)(new c.Mesh((0,f.eO)(e.voxelFaces()),new m.P({color:"#55ff96"})),{parent:this,x:-32})}return{sky:e}})()}}function x(){return(0,h.Ky)(function*(e){(0,d.a)({three:e});let t=new s.F({size:10,perspective:1});yield t.start(e.renderer.domElement),u.vB.get("three").set({minActiveDuration:60}),yield(0,u.RC)("three",r=>{let{aspect:i,camera:a}=e;t.update(a,i,r.deltaTime)}),yield(0,n.p)([[{code:"Space",modifiers:"shift"},()=>{document.body.requestFullscreen()}]]);let r=new a.n(e.scene,e.camera);r.updatePdMaterial({lumaPhi:10,depthPhi:2,normalPhi:3,radius:100,radiusExponent:2,rings:2,samples:16}),e.pipeline.addPass(r,{type:o.GR.PostProcessing})},[]),null}function T(){return(0,h._v)("main",function*(e){(0,l.cY)(new M,e)},[]),null}function w(){return(0,i.jsx)("div",{children:(0,i.jsxs)(h.H7,{children:[(0,i.jsx)(x,{}),(0,i.jsx)(T,{})]})})}},96966:function(e,t,r){"use strict";r.d(t,{v:function(){return a}});let i="/three-xp/assets/",a={development:!1,assetsPath:i,assets:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(i).concat(e)}}},4917:function(e,t,r){"use strict";r.d(t,{H7:function(){return p},Ky:function(){return d},_v:function(){return c}});var i=r(78485),a=r(27275),n=r(85679),s=r(48583),o=r(48181),l=r(96966),u=r(11030);let h=(0,a.createContext)(null);function d(e,t){let r=(0,a.useContext)(h);return(0,s.sv)(async function*(t,i){if(e){let t=e(r,i);if(t&&"function"==typeof t.next)do{let{value:e,done:r}=await t.next();if(r)break;yield e}while(i.mounted)}},null!=t?t:"always"),r}function c(e,t,r){let i=(0,a.useMemo)(()=>new n.Group,[]);return i.name=e,d(async function*(e,r){if(e.scene.add(i),yield()=>{i.clear(),i.removeFromParent()},t){let a=t(i,e,r);if(a&&"function"==typeof a.next)do{let{value:e,done:t}=await a.next();if(t)break;yield e}while(r.mounted)}},r),i}function f(e){let{children:t,className:r}=e,u=(0,a.useMemo)(()=>new o.Vu,[]),{ref:d}=(0,s.sv)(function*(e){u.loader.setPath(l.v.assetsPath),yield u.initialize(e),Object.assign(window,{three:u,THREE:n})},[]);return(0,i.jsx)("div",{ref:d,className:"ThreeProvider absolute-through ".concat(null!=r?r:""),children:(0,i.jsx)(h.Provider,{value:u,children:t})})}function p(e){return(0,u.O)()&&(0,i.jsx)(f,{...e})}},11030:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});var i=r(27275);function a(){let[e,t]=(0,i.useState)(!1);return(0,i.useLayoutEffect)(()=>{t(!0)},[]),e}},8834:function(e,t,r){"use strict";r.d(t,{Leak:function(){return o},a:function(){return s}});var i=r(40855),a=r(79509),n=r(28142);function s(e){Object.assign(window,{...a,...i,...e,PRNG:n.T})}function o(e){return s(e),null}},37457:function(e,t,r){"use strict";function i(e,t){return"*"===t||("string"==typeof t?t===e:t instanceof RegExp?t.test(e):"function"==typeof t&&t(e))}r.d(t,{p:function(){return s}});let a={preventDefault:!1,strictTarget:void 0},n={key:"*",keyCaseInsensitive:!0,code:"*",noModifiers:!1,modifiers:""};function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[s,o,l]=1===t.length?[document.body,{},t[0]]:2===t.length?[t[0],{},t[1]]:t,{preventDefault:u}={...a,...o},h=e=>{var t;if((null!==(t=o.strictTarget)&&void 0!==t?!!t:s===document.body)&&e.target!==s)return;let{ctrlKey:r,altKey:a,shiftKey:h,metaKey:d}=e,c={event:e,modifiers:{ctrl:r,alt:a,shift:h,meta:d}};for(let t=0,s=l.length;t<s;t++){let[s,o]=l[t],{key:f,keyCaseInsensitive:p,code:m,noModifiers:g,modifiers:v}=function(e){let t="string"==typeof e?{...n,key:e}:{...n,...e};return t.keyCaseInsensitive&&"string"==typeof t.key&&(t.key=t.key.toLowerCase()),t}(s);Object.values({key:i(p?e.key.toLowerCase():e.key,f),code:i(e.code,m),noModifiers:!g||!1===r&&!1===a&&!1===h&&!1===d,modifiers:function(e,t){let{ctrlKey:r,altKey:i,shiftKey:a,metaKey:n}=e;if("function"==typeof t)return t({ctrl:r,alt:i,shift:a,meta:n});let{ctrl:s=!1,alt:o=!1,shift:l=!1,meta:u=!1}=Object.fromEntries(t.split("-").map(e=>[e,!0]));return s===r&&o===i&&l===a&&u===n}(e,v)}).every(Boolean)&&(u&&e.preventDefault(),o(c))}};return s.addEventListener("keydown",h,{passive:!1}),{destroy:()=>{s.removeEventListener("keydown",h)}}}},82446:function(e,t,r){"use strict";r.d(t,{z:function(){return x},eO:function(){return b}});var i,a,n,s,o,l,u=r(85679);(i=s||(s={}))[i.X=0]="X",i[i.Y=2]="Y",i[i.Z=4]="Z",(a=o||(o={}))[a.R=0]="R",a[a.L=1]="L",a[a.U=2]="U",a[a.D=3]="D",a[a.F=4]="F",a[a.B=5]="B",(n=l||(l={}))[n.None=0]="None",n[n.All=63]="All",n[n.R=1]="R",n[n.L=2]="L",n[n.U=4]="U",n[n.D=8]="D",n[n.F=16]="F",n[n.B=32]="B";let h=[5,4,0,1,0,1],d=[new u.Vector3(1,0,0),new u.Vector3(-1,0,0),new u.Vector3(0,1,0),new u.Vector3(0,-1,0),new u.Vector3(0,0,1),new u.Vector3(0,0,-1)],c=0,f=0,p=0,m=0,g=[],v={A:()=>(g[c++]=f,g[c++]=p,g[c++]=m,v),B:()=>(g[c++]=f,g[c++]=p,g[c++]=m+1,v),C:()=>(g[c++]=f,g[c++]=p+1,g[c++]=m,v),D:()=>(g[c++]=f,g[c++]=p+1,g[c++]=m+1,v),E:()=>(g[c++]=f+1,g[c++]=p,g[c++]=m,v),F:()=>(g[c++]=f+1,g[c++]=p,g[c++]=m+1,v),G:()=>(g[c++]=f+1,g[c++]=p+1,g[c++]=m,v),H:()=>(g[c++]=f+1,g[c++]=p+1,g[c++]=m+1,v)},y={R:()=>(g[c++]=1,g[c++]=0,g[c++]=0,y),L:()=>(g[c++]=-1,g[c++]=0,g[c++]=0,y),U:()=>(g[c++]=0,g[c++]=1,g[c++]=0,y),D:()=>(g[c++]=0,g[c++]=-1,g[c++]=0,y),F:()=>(g[c++]=0,g[c++]=0,g[c++]=1,y),B:()=>(g[c++]=0,g[c++]=0,g[c++]=-1,y),R6:()=>y.R().R().R().R().R().R(),L6:()=>y.L().L().L().L().L().L(),U6:()=>y.U().U().U().U().U().U(),D6:()=>y.D().D().D().D().D().D(),F6:()=>y.F().F().F().F().F().F(),B6:()=>y.B().B().B().B().B().B()};class M{positionToArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,{position:r,direction:i}=this;switch(g=e,c=t,f=r.x,p=r.y,m=r.z,i){case o.R:v.E().G().F().F().G().H();break;case o.L:v.A().B().D().A().D().C();break;case o.U:v.D().H().G().D().G().C();break;case o.D:v.A().E().F().A().F().B();break;case o.F:v.B().F().H().B().H().D();break;case o.B:v.A().C().E().E().C().G()}return e}normalToArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,{direction:r}=this;switch(g=e,c=t,r){case o.R:y.R6();break;case o.L:y.L6();break;case o.U:y.U6();break;case o.D:y.D6();break;case o.F:y.F6();break;case o.B:y.B6()}return e}constructor(e,t,r=h[t]){this.position=e,this.direction=t,this.tangent=r}}class x{getVoxelState(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[i,a,n]=1===t.length?[t[0].x,t[0].y,t[0].z]:t,{size:s,size2:o,voxelStateByteSize:l,voxelState:u}=this;if(i<0||i>=s||a<0||a>=s||n<0||n>=s)throw Error("Coordinates out of bounds: ".concat(i,", ").concat(a,", ").concat(n,", size: ").concat(s));return new DataView(u,(i+a*s+n*o)*l,l)}tryGetVoxelState(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[i,a,n]=1===t.length?[t[0].x,t[0].y,t[0].z]:t,{size:s}=this;return i<0||i>=s||a<0||a>=s||n<0||n>=s?null:this.getVoxelState(i,a,n)}*voxelFaces(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>0!==e.getUint8(0),{size:t}=this,r=new M(new u.Vector3,0);for(let i=0;i<t;i++)for(let a=0;a<t;a++)for(let n=0;n<t;n++)if(e(this.getVoxelState(i,a,n)))for(let t=0;t<6;t++){let s=d[t],o=this.tryGetVoxelState(i+s.x,a+s.y,n+s.z);o&&e(o)||(r.position.set(i,a,n),r.direction=t,yield r)}}constructor(e=16,t=4){this.worldConnection=null,this.size=e,this.size2=e*e,this.size3=e*e*e,this.voxelStateByteSize=t,this.voxelState=new ArrayBuffer(e**3*t)}}class T{ensureSize(e){if(this.array.length<e){let t=new Float32Array(1<<Math.ceil(Math.log(e)/Math.log(2)));t.set(this.array),this.array=t}return this.array}copy(e){return new Float32Array(this.array.buffer,0,e).slice()}constructor(e=0){this.array=new Float32Array(0),this.ensureSize(e)}}let w=new T(768),S=new T(768);function b(e){let{geometry:t=new u.BufferGeometry}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="function"==typeof e?e():e;w.array.fill(0),S.array.fill(0);let i=0;for(let e of r){let t=18*i;w.ensureSize(t+18),S.ensureSize(t+18),e.positionToArray(w.array,t),e.normalToArray(S.array,t),i++}return t.setAttribute("position",new u.BufferAttribute(w.copy(18*i),3)),t.setAttribute("normal",new u.BufferAttribute(S.copy(18*i),3)),t}},31454:function(e,t,r){"use strict";r.d(t,{K:function(){return s}});var i=r(85679),a=r(81796);let n={color:"white",opacity:.5,size:[8,8],step:1,frame:!0};class s extends i.LineSegments{set(e){let{color:t,opacity:r,size:s,step:o,frame:l}={...n,...e},u=(0,a.iK)(s),h=(0,a.iK)(null!=o?o:u),d=[],c=(e,t)=>d.push(new i.Vector3(e,t,0));l&&(c(-u.x/2,+u.y/2),c(+u.x/2,+u.y/2),c(+u.x/2,+u.y/2),c(+u.x/2,-u.y/2),c(+u.x/2,-u.y/2),c(-u.x/2,-u.y/2),c(-u.x/2,-u.y/2),c(-u.x/2,+u.y/2));let f=Math.ceil(-u.x/2/h.x)*h.x;f===-u.x/2&&(f+=h.x);do c(f,-u.y/2),c(f,+u.y/2),f+=h.x;while(f<u.x/2);let p=Math.ceil(-u.y/2/h.y)*h.y;p===-u.y/2&&(p+=h.y);do c(-u.x/2,p),c(+u.x/2,p),p+=h.y;while(p<u.y/2);return this.geometry.setFromPoints(d),this.material.color.set(t),this.material.opacity=r,this.material.transparent=r<1,this}constructor(e){super(),this.set(null!=e?e:n)}}},63549:function(e,t,r){"use strict";r.d(t,{P:function(){return s}});var i=r(85679),a=r(47174);let n={vertexColors:!0,luminosity:.5};class s extends i.MeshBasicMaterial{constructor(e){let{luminosity:t,vertexColors:r,...s}={...n,...e},o={uSunPosition:{value:new i.Vector3(.5,.7,.3)},uLuminosity:{value:t}};super(s),this.onBeforeCompile=e=>a.b.with(e).uniforms(o).varying({vWorldNormal:"vec3"}).vertex.mainAfterAll("\n          vWorldNormal = mat3(modelMatrix) * normal;\n      ").fragment.after("map_fragment","\n        vec3 lightDirection = normalize(uSunPosition);\n        float light = dot(vWorldNormal, lightDirection) * 0.5 + 0.5;\n        light = pow(light, 2.0);\n        light = mix(uLuminosity, 1.0, light);\n        diffuseColor *= light;\n      "),this.sunPosition=o.uSunPosition.value}}},38137:function(e,t,r){"use strict";r.d(t,{w:function(){return n}});var i=r(85679);let a=new i.IcosahedronGeometry(1,4);class n extends i.Mesh{constructor(e){super(a,new i.MeshBasicMaterial({color:"#0c529d",...e,side:i.BackSide,depthWrite:!1,depthTest:!1})),this.renderOrder=-1,this.frustumCulled=!1,this.matrixAutoUpdate=!1,this.onBeforeRender=(e,t,r)=>{let i=(r.near+r.far)/2;this.position.copy(r.position),this.scale.setScalar(i),this.updateMatrix(),this.updateMatrixWorld()}}}},40855:function(e,t,r){"use strict";function i(e,t){for(let r of e)if(t(r))return!0;return!1}function a(e,t){for(let r of e)if(!t(r))return!1;return!0}function n(e,t,r){let i=[];function a(e){let t=[];return i[e]=t,t}if(void 0!==r)for(let e=0;e<r;e++)a(e);for(let r of e){var n;let e=t(r);(null!==(n=i[e])&&void 0!==n?n:a(e)).push(r)}return i}r.r(t),r.d(t,{every:function(){return a},some:function(){return i},split:function(){return n}})},16573:function(e,t,r){"use strict";function*i(e){let t=0,r={get i(){return t},get t(){return t/e},get p(){return t/(e-1)}};for(t=0;t<e;t++)yield r}function*a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=0,a=0;2===t.length?(i=t[0],a=t[1]):Array.isArray(t[0])?(i=t[0][0],a=t[0][1]):(i=t[0].x,a=t[0].y);let n=0,s=0,o=0,l={get i(){return n},get x(){return s},get y(){return o},get tx(){return s/i},get ty(){return o/a},get px(){return s/(i-1)},get py(){return o/(a-1)}};for(o=0;o<a;o++)for(s=0;s<i;s++)yield l,n++}function*n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=0,a=0,n=0;3===t.length?(i=t[0],a=t[1],n=t[2]):Array.isArray(t[0])?(i=t[0][0],a=t[0][1],n=t[0][2]):(i=t[0].x,a=t[0].y,n=t[0].z);let s=0,o=0,l=0,u=0,h={get i(){return s},get x(){return o},get y(){return l},get z(){return u},get tx(){return o/i},get ty(){return l/a},get tz(){return u/n},get px(){return o/(i-1)},get py(){return l/(a-1)},get pz(){return u/(n-1)}};for(u=0;u<n;u++)for(l=0;l<a;l++)for(o=0;o<i;o++)yield h,s++}r.d(t,{B0:function(){return a},KA:function(){return n},VX:function(){return i}})},28142:function(e,t,r){"use strict";r.d(t,{T:function(){return u}});let i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:123456;return(e=(e=(7*e+Math.sqrt(e)+16087*Math.sin(e))%2147483647)<0?e+2147483647:e)>1?2147483647&e:0===e?345678:123456},a=e=>e=2147483647&Math.imul(e,48271),n=e=>(e-1)/2147483646,s=e=>e,o={weightsAreNormalized:!1,indexOffset:0,forbiddenItems:[]};function l(){let e=a(a(i(123456)));function t(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:123456;return"string"==typeof t&&(t=t.split("").reduce((e,t)=>7*e+t.charCodeAt(0),0)),e=a(a(i(t))),c}function r(){return n(e=a(e))}function l(e){switch(e.length){default:return[0,1,s];case 1:return[0,e[0],s];case 2:return[e[0],e[1],s];case 3:return[e[0],e[1],e[2]]}}function u(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let[a,n,s]=l(t);return a+(n-a)*s(r())}function h(){for(var e,t=arguments.length,i=Array(t),a=0;a<t;a++)i[a]=arguments[a];let[n,s,{weightsAreNormalized:l,indexOffset:u,forbiddenItems:h}]=function(e){let[t,r=null,i]=e,a={...o,...i};if(Array.isArray(t))return[t,r,a];if("object"==typeof t)return[Object.values(t),r?Object.values(r):null,a];throw Error("pick: unsupported options type")}(i);if(h.length>0){let t=new Set;for(let e of h){let r=n.indexOf(e);r>=0&&t.add(r)}if(n=n.filter((e,r)=>!t.has(r)),s=null!==(e=null==s?void 0:s.filter((e,r)=>!t.has(r)))&&void 0!==e?e:null,0===n.length)throw Error("pick: all items are forbidden")}if(null===s){let e=Math.floor(r()*n.length);return u&&(e+=u,(e%=n.length)<0&&(e+=n.length)),n[e]}if(!l){let e=s.reduce((e,t)=>e+t,0);s=s.map(t=>t/e)}let d=r(),c=0;for(let e=0;e<n.length;e++)if(d<(c+=s[e]))return n[e];throw Error("among: unreachable")}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=r(),a=r(),n=Math.sqrt(-2*Math.log(i)),s=2*Math.PI*a;return[e+t*n*Math.cos(s),e+t*n*Math.sin(s)]}let c={seed:t,seedMax:function(){return 2147483647},reset:function(){return t(123456),c},next:function(){return e=a(e),c},random:r,between:u,around:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let[a=1,n=s]=t,o=2*r();return(o>1?1:-1)*n(o>1?o-1:o)*a},int:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let[a,n,s]=l(t);return a+Math.floor(s(r())*(n-a))},chance:function(e){return r()<e},shuffle:function(e){let{mutate:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t&&Array.isArray(e)?e:[...e],a=i.length;for(let e=0;e<a;e++){let t=Math.floor(a*r()),n=i[e];i[e]=i[t],i[t]=n}return i},pick:h,createPicker:function(e){let t=e.map(e=>{let[t]=e;return t}),r=e.map(e=>{let[t,r]=e;return r}),i=r.reduce((e,t)=>e+t,0);for(let[e,t]of r.entries())r[e]=t/i;return()=>h(t,r,{weightsAreNormalized:!0})},vector:function(e,t){let[r=0,i=1]=Array.isArray(t)?t:[null==t?void 0:t.min,null==t?void 0:t.max];for(let t of Object.keys(e))e[t]=u(r,i);return e},unitVector2:function(e){let t=2*Math.PI*r();return e.x=Math.cos(t),e.y=Math.sin(t),e},unitVector3:function(e){let t=r(),i=r(),a=2*Math.PI*t,n=Math.acos(1-2*i);return e.x=Math.sin(n)*Math.cos(a),e.y=Math.sin(n)*Math.sin(a),e.z=Math.cos(n),e},normalVector:function(e){let t=Object.keys(e),r=t.length,i=Math.sqrt(r);for(let a=0;a<r;a+=2){let[n,s]=d();e[t[a]]=n/i,a+1<r&&(e[t[a+1]]=s/i)}return e},unitVector:function(e){let t=Object.keys(e),r=t.length,i=0;for(let a=0;a<r;a+=2){let[n,s]=d();e[t[a]]=n,i+=n*n,a+1<r&&(e[t[a+1]]=s,i+=s*s)}i=Math.sqrt(i);for(let a=0;a<r;a++)e[t[a]]/=i;return e},boxMuller:d};return c}let u=class{constructor(e){Object.assign(this,l().seed(e))}};Object.assign(u,l())},32717:function(e,t,r){"use strict";function i(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}r.d(t,{_:function(){return i}})},86895:function(e,t,r){"use strict";r.d(t,{n:function(){return u}});var i=r(85679),a=r(36317),n=r(66996),s=r(26626),o=r(6100),l=r(71909);class u extends a.w{constructor(e,t,r,l,u,h,d){super(),this.width=void 0!==r?r:512,this.height=void 0!==l?l:512,this.clear=!0,this.camera=t,this.scene=e,this.output=0,this._renderGBuffer=!0,this._visibilityCache=new Map,this.blendIntensity=1,this.pdRings=2,this.pdRadiusExponent=2,this.pdSamples=16,this.gtaoNoiseTexture=(0,n.mK)(),this.pdNoiseTexture=this.generateNoise(),this.gtaoRenderTarget=new i.WebGLRenderTarget(this.width,this.height,{type:i.HalfFloatType}),this.pdRenderTarget=this.gtaoRenderTarget.clone(),this.gtaoMaterial=new i.ShaderMaterial({defines:Object.assign({},n.Sp.defines),uniforms:i.UniformsUtils.clone(n.Sp.uniforms),vertexShader:n.Sp.vertexShader,fragmentShader:n.Sp.fragmentShader,blending:i.NoBlending,depthTest:!1,depthWrite:!1}),this.gtaoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.gtaoMaterial.uniforms.tNoise.value=this.gtaoNoiseTexture,this.gtaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.normalMaterial=new i.MeshNormalMaterial,this.normalMaterial.blending=i.NoBlending,this.pdMaterial=new i.ShaderMaterial({defines:Object.assign({},s.m.defines),uniforms:i.UniformsUtils.clone(s.m.uniforms),vertexShader:s.m.vertexShader,fragmentShader:s.m.fragmentShader,depthTest:!1,depthWrite:!1}),this.pdMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.pdMaterial.uniforms.tNoise.value=this.pdNoiseTexture,this.pdMaterial.uniforms.resolution.value.set(this.width,this.height),this.pdMaterial.uniforms.lumaPhi.value=10,this.pdMaterial.uniforms.depthPhi.value=2,this.pdMaterial.uniforms.normalPhi.value=3,this.pdMaterial.uniforms.radius.value=8,this.depthRenderMaterial=new i.ShaderMaterial({defines:Object.assign({},n.gs.defines),uniforms:i.UniformsUtils.clone(n.gs.uniforms),vertexShader:n.gs.vertexShader,fragmentShader:n.gs.fragmentShader,blending:i.NoBlending}),this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new i.ShaderMaterial({uniforms:i.UniformsUtils.clone(o.C.uniforms),vertexShader:o.C.vertexShader,fragmentShader:o.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:i.DstColorFactor,blendDst:i.ZeroFactor,blendEquation:i.AddEquation,blendSrcAlpha:i.DstAlphaFactor,blendDstAlpha:i.ZeroFactor,blendEquationAlpha:i.AddEquation}),this.blendMaterial=new i.ShaderMaterial({uniforms:i.UniformsUtils.clone(n.mF.uniforms),vertexShader:n.mF.vertexShader,fragmentShader:n.mF.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:i.CustomBlending,blendSrc:i.DstColorFactor,blendDst:i.ZeroFactor,blendEquation:i.AddEquation,blendSrcAlpha:i.DstAlphaFactor,blendDstAlpha:i.ZeroFactor,blendEquationAlpha:i.AddEquation}),this.fsQuad=new a.T(null),this.originalClearColor=new i.Color,this.setGBuffer(u?u.depthTexture:void 0,u?u.normalTexture:void 0),void 0!==h&&this.updateGtaoMaterial(h),void 0!==d&&this.updatePdMaterial(d)}dispose(){this.gtaoNoiseTexture.dispose(),this.pdNoiseTexture.dispose(),this.normalRenderTarget.dispose(),this.gtaoRenderTarget.dispose(),this.pdRenderTarget.dispose(),this.normalMaterial.dispose(),this.pdMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}get gtaoMap(){return this.pdRenderTarget.texture}setGBuffer(e,t){void 0!==e?(this.depthTexture=e,this.normalTexture=t,this._renderGBuffer=!1):(this.depthTexture=new i.DepthTexture,this.depthTexture.format=i.DepthStencilFormat,this.depthTexture.type=i.UnsignedInt248Type,this.normalRenderTarget=new i.WebGLRenderTarget(this.width,this.height,{minFilter:i.NearestFilter,magFilter:i.NearestFilter,type:i.HalfFloatType,depthTexture:this.depthTexture}),this.normalTexture=this.normalRenderTarget.texture,this._renderGBuffer=!0);let r=this.normalTexture?1:0,a=this.depthTexture===this.normalTexture?"w":"x";this.gtaoMaterial.defines.NORMAL_VECTOR_TYPE=r,this.gtaoMaterial.defines.DEPTH_SWIZZLING=a,this.gtaoMaterial.uniforms.tNormal.value=this.normalTexture,this.gtaoMaterial.uniforms.tDepth.value=this.depthTexture,this.pdMaterial.defines.NORMAL_VECTOR_TYPE=r,this.pdMaterial.defines.DEPTH_SWIZZLING=a,this.pdMaterial.uniforms.tNormal.value=this.normalTexture,this.pdMaterial.uniforms.tDepth.value=this.depthTexture,this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture}setSceneClipBox(e){e?(this.gtaoMaterial.needsUpdate=1!==this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=1,this.gtaoMaterial.uniforms.sceneBoxMin.value.copy(e.min),this.gtaoMaterial.uniforms.sceneBoxMax.value.copy(e.max)):(this.gtaoMaterial.needsUpdate=0===this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=0)}updateGtaoMaterial(e){void 0!==e.radius&&(this.gtaoMaterial.uniforms.radius.value=e.radius),void 0!==e.distanceExponent&&(this.gtaoMaterial.uniforms.distanceExponent.value=e.distanceExponent),void 0!==e.thickness&&(this.gtaoMaterial.uniforms.thickness.value=e.thickness),void 0!==e.distanceFallOff&&(this.gtaoMaterial.uniforms.distanceFallOff.value=e.distanceFallOff,this.gtaoMaterial.needsUpdate=!0),void 0!==e.scale&&(this.gtaoMaterial.uniforms.scale.value=e.scale),void 0!==e.samples&&e.samples!==this.gtaoMaterial.defines.SAMPLES&&(this.gtaoMaterial.defines.SAMPLES=e.samples,this.gtaoMaterial.needsUpdate=!0),void 0!==e.screenSpaceRadius&&(e.screenSpaceRadius?1:0)!==this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS&&(this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS=e.screenSpaceRadius?1:0,this.gtaoMaterial.needsUpdate=!0)}updatePdMaterial(e){let t=!1;void 0!==e.lumaPhi&&(this.pdMaterial.uniforms.lumaPhi.value=e.lumaPhi),void 0!==e.depthPhi&&(this.pdMaterial.uniforms.depthPhi.value=e.depthPhi),void 0!==e.normalPhi&&(this.pdMaterial.uniforms.normalPhi.value=e.normalPhi),void 0!==e.radius&&e.radius!==this.radius&&(this.pdMaterial.uniforms.radius.value=e.radius),void 0!==e.radiusExponent&&e.radiusExponent!==this.pdRadiusExponent&&(this.pdRadiusExponent=e.radiusExponent,t=!0),void 0!==e.rings&&e.rings!==this.pdRings&&(this.pdRings=e.rings,t=!0),void 0!==e.samples&&e.samples!==this.pdSamples&&(this.pdSamples=e.samples,t=!0),t&&(this.pdMaterial.defines.SAMPLES=this.pdSamples,this.pdMaterial.defines.SAMPLE_VECTORS=(0,s.a)(this.pdSamples,this.pdRings,this.pdRadiusExponent),this.pdMaterial.needsUpdate=!0)}render(e,t,r){switch(this._renderGBuffer&&(this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.gtaoMaterial.uniforms.cameraWorldMatrix.value.copy(this.camera.matrixWorld),this.renderPass(e,this.gtaoMaterial,this.gtaoRenderTarget,16777215,1),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.renderPass(e,this.pdMaterial,this.pdRenderTarget,16777215,1),this.output){case u.OUTPUT.Off:break;case u.OUTPUT.Diffuse:this.copyMaterial.uniforms.tDiffuse.value=r.texture,this.copyMaterial.blending=i.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case u.OUTPUT.AO:this.copyMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.copyMaterial.blending=i.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case u.OUTPUT.Denoise:this.copyMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.copyMaterial.blending=i.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case u.OUTPUT.Depth:this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case u.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=i.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case u.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=r.texture,this.copyMaterial.blending=i.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blendMaterial.uniforms.intensity.value=this.blendIntensity,this.blendMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.renderPass(e,this.blendMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.GTAOPass: Unknown output type.")}}renderPass(e,t,r,i,a){e.getClearColor(this.originalClearColor);let n=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderOverride(e,t,r,i,a){e.getClearColor(this.originalClearColor);let n=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i=t.clearColor||i,a=t.clearAlpha||a,null!=i&&(e.setClearColor(i),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}setSize(e,t){this.width=e,this.height=t,this.gtaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.pdRenderTarget.setSize(e,t),this.gtaoMaterial.uniforms.resolution.value.set(e,t),this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.pdMaterial.uniforms.resolution.value.set(e,t),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse)}overrideVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){let r=t.get(e);e.visible=r}),t.clear()}generateNoise(e=64){let t=new l.L,r=new Uint8Array(e*e*4);for(let i=0;i<e;i++)for(let a=0;a<e;a++){let n=i,s=a;r[(i*e+a)*4]=(.5*t.noise(n,s)+.5)*255,r[(i*e+a)*4+1]=(.5*t.noise(n+e,s)+.5)*255,r[(i*e+a)*4+2]=(.5*t.noise(n,s+e)+.5)*255,r[(i*e+a)*4+3]=(.5*t.noise(n+e,s+e)+.5)*255}let a=new i.DataTexture(r,e,e,i.RGBAFormat,i.UnsignedByteType);return a.wrapS=i.RepeatWrapping,a.wrapT=i.RepeatWrapping,a.needsUpdate=!0,a}}u.OUTPUT={Off:-1,Default:0,Diffuse:1,Depth:2,Normal:3,AO:4,Denoise:5}}},function(e){e.O(0,[7512,4954,6799,5589,3901,7351,8938,6867,4940,9072,8648,4831,8181,9007,4342,2920,7936,1744],function(){return e(e.s=96086)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4780],{3261:(e,t,n)=>{"use strict";n.d(t,{PageClient:()=>b});var r=n(70691),a=n(49797),o=n(63106),l=n(99332),i=n(31423),s=n(53097),c=n(61572),u=n(77794),f=n(7147),h=n(79911),d=n(55227),x=n(79285),p=n(67235),v=n(36508),g=n(28737),m=n(88352);class w extends a.YJl{*initialize(e){let{water:t}=this;t.initialize(e.renderer),yield p.Q.on(w,e=>{e.setPayload(this)});let n=!1,r=0,i=new a.I9Y(.5,.5);return yield(0,v.xy)("three",{timeInterval:1/60},a=>{let{playing:o,autoRotate:l}=this.state;if(o){if(this.state.strength*=.9,n){let t=e.pointer.intersectPlane("xy");t.intersected&&i.set((0,x.inverseLerp)(-5,5,t.point.x),(0,x.inverseLerp)(-5,5,t.point.y)),this.state.strength=1}if(l&&!n){let e=2*(r+=a.deltaTime)*Math.PI*.4;i.set(.5+.3*Math.cos(e),.5+.3*Math.sin(e)),this.state.strength=1}t.pointer(i.x,i.y,40,this.state.strength*this.state.direction),t.update(a.deltaTime),this.plane.material.map=t.currentTexture(),this.plane.material.needsUpdate=!0}}),yield(0,l.s)(e.domElement,{onTap:()=>this.state.direction*=-1,onDragStart:()=>n=!0,onDragStop:()=>n=!1}),yield(0,o.a)([[{key:" "},()=>{this.state.playing=!this.state.playing}]]),this}constructor(){super(),this.plane=(0,h.mj)(new a.eaF(new a.bdM,new a.V9B),this),this.water=new c.S,this.grid=(0,h.mj)(new u.u,this).regularGrid({size:10,subdivisions:[2,10]}).onTop(),this.state={playing:!0,autoRotate:!1,strength:1,direction:1},this.name="water-demo",this.plane.scale.setScalar(10),this.plane.material.onBeforeCompile=e=>f.bI.with(e).fragment.top(d.M).fragment.after("map_fragment","\n        vec3 data = diffuseColor.rgb;\n        diffuseColor.r = clamp(data.r, 0.0, 1.0);\n        diffuseColor.g = clamp(-data.r, 0.0, 1.0);\n\n        Vec3Ramp r = ramp(0.5 + data.r * 0.1, ".concat((0,f.eR)("#9e0202ff"),", ").concat((0,f.eR)("#000000"),", ").concat((0,f.eR)("#027254ff"),");\n        diffuseColor.rgb = mix(r.a, r.b, r.t);\n      "))}}function y(){let e=(0,s.Fw)();return(0,s.dB)("my-scene",function*(t){e.pipeline.basicPasses.fxaa.enabled=!1;let n=(0,h.mj)(new w,t);yield*n.initialize(e)},[]),null}function b(){return(0,g.O)(),(0,r.jsxs)(s.uB,{vertigoControls:{fixed:!0,size:10.5,eventTarget:"canvas"},children:[(0,r.jsxs)("div",{className:"layer thru flex flex-col p-12 gap-2 items-start",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold",children:"GPU Compute - Water Demo"}),(0,r.jsx)("p",{children:"Classic water simulation using a height map and GPU Compute."}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)("button",{className:"px-2 py-1 border rounded bg-white/10 hover:bg-white/20 transition",onClick:()=>{let e=p.Q.send(w).assertPayload();e.state.playing=!e.state.playing},children:"Play / Pause [space]"})}),(0,r.jsx)("div",{className:"flex gap-2",children:[new a.I9Y(512,512),new a.I9Y(256,512),new a.I9Y(256,128)].map((e,t)=>(0,r.jsxs)("button",{className:"px-2 py-1 border rounded bg-white/10 hover:bg-white/20 transition",onClick:()=>{var t;let n=p.Q.send(w).assertPayload();n.water.setSize(e);let r=e.x/e.y;null!=(t=n.plane.scale)||(t=new a.I9Y),r>1?(t.x=10,t.y=10/r):(t.x=10*r,t.y=10),1===r?n.grid.clear().regularGrid({size:10,subdivisions:[2,10]}):n.grid.clear().rect({center:0,size:n.plane.scale})},children:[e.x,"x",e.y]},t))}),(0,r.jsx)(m.A,{}),(0,r.jsx)(i.l,{})]}),(0,r.jsx)(y,{})]})}},17099:(e,t,n)=>{"use strict";n.d(t,{c:()=>i});var r=n(79105);let a=e=>e,o={weightsAreNormalized:!1,indexOffset:0,forbiddenItems:[]};function l(){let e=(0,r.K2)((0,r.K2)((0,r.Ts)(r.KP)));function t(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.KP;return"string"==typeof t&&(t=t.split("").reduce((e,t)=>7*e+t.charCodeAt(0),0)),e=(0,r.K2)((0,r.K2)((0,r.Ts)(t))),u}function n(){return e=(0,r.K2)(e),(0,r.Tj)(e)}function l(e){switch(e.length){default:return[0,1,a];case 1:return[0,e[0],a];case 2:return[e[0],e[1],a];case 3:return[e[0],e[1],e[2]]}}function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[a,o,i]=l(t);return a+(o-a)*i(n())}function s(){for(var e,t=arguments.length,r=Array(t),a=0;a<t;a++)r[a]=arguments[a];let[l,i,{weightsAreNormalized:s,indexOffset:c,forbiddenItems:u}]=function(e){let[t,n=null,r]=e,a={...o,...r};if(Array.isArray(t))return[t,n,a];if("object"==typeof t)return[Object.values(t),n?Object.values(n):null,a];throw Error("pick: unsupported options type")}(r);if(u.length>0){let t=new Set;for(let e of u){let n=l.indexOf(e);n>=0&&t.add(n)}if(l=l.filter((e,n)=>!t.has(n)),i=null!=(e=null==i?void 0:i.filter((e,n)=>!t.has(n)))?e:null,0===l.length)throw Error("pick: all items are forbidden")}if(null===i){let e=Math.floor(n()*l.length);return c&&(e+=c,(e%=l.length)<0&&(e+=l.length)),l[e]}if(!s){let e=i.reduce((e,t)=>e+t,0);i=i.map(t=>t/e)}let f=n(),h=0;for(let e=0;e<l.length;e++)if(f<(h+=i[e]))return l[e];throw Error("among: unreachable")}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=n(),a=n(),o=Math.sqrt(-2*Math.log(r)),l=2*Math.PI*a;return[e+t*o*Math.cos(l),e+t*o*Math.sin(l)]}let u={seed:t,seedMax:function(){return r.Zu},reset:function(){return t(r.KP),u},next:function(){return e=(0,r.K2)(e),u},getState:function(){return e},setState:function(t){return e=t&r.Zu,u},random:n,between:i,around:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[o=1,l=a]=t,i=2*n();return(i>1?1:-1)*l(i>1?i-1:i)*o},int:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[a,o,i]=l(t);return a+Math.floor(i(n())*(o-a))},chance:function(e){return n()<e},shuffle:function(e){let{mutate:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t&&Array.isArray(e)?e:[...e],a=r.length;for(let e=0;e<a;e++){let t=Math.floor(a*n()),o=r[e];r[e]=r[t],r[t]=o}return r},pick:s,createPicker:function(e){let t=e.map(e=>{let[t]=e;return t}),n=e.map(e=>{let[t,n]=e;return n}),r=n.reduce((e,t)=>e+t,0);for(let[e,t]of n.entries())n[e]=t/r;return()=>s(t,n,{weightsAreNormalized:!0})},vector:function(e,t){let[n=0,r=1]=Array.isArray(t)?t:[null==t?void 0:t.min,null==t?void 0:t.max];for(let t of Object.keys(e))e[t]=i(n,r);return e},unitVector2:function(e){let t=2*Math.PI*n();return e.x=Math.cos(t),e.y=Math.sin(t),e},unitVector3:function(e){let t=n(),r=n(),a=2*Math.PI*t,o=Math.acos(1-2*r);return e.x=Math.sin(o)*Math.cos(a),e.y=Math.sin(o)*Math.sin(a),e.z=Math.cos(o),e},normalVector:function(e){let t=Object.keys(e),n=t.length,r=Math.sqrt(n);for(let a=0;a<n;a+=2){let[o,l]=c();e[t[a]]=o/r,a+1<n&&(e[t[a+1]]=l/r)}return e},unitVector:function(e){let t=Object.keys(e),n=t.length,r=0;for(let a=0;a<n;a+=2){let[o,l]=c();e[t[a]]=o,r+=o*o,a+1<n&&(e[t[a+1]]=l,r+=l*l)}r=Math.sqrt(r);for(let a=0;a<n;a++)e[t[a]]/=r;return e},boxMuller:c,quaternion:function(e){let t=n(),r=n(),a=n(),o=Math.sqrt(1-t),l=Math.sqrt(t);return e.x=o*Math.sin(2*Math.PI*r),e.y=o*Math.cos(2*Math.PI*r),e.z=l*Math.sin(2*Math.PI*a),e.w=l*Math.cos(2*Math.PI*a),e},insideCircle:function(e,t){let r=2*n()*Math.PI,a=Math.sqrt(n())*e;return t.x=a*Math.cos(r),t.y=a*Math.sin(r),t}};return u}let i=class{constructor(e){Object.assign(this,l().seed(e))}};Object.assign(i,l())},22899:(e,t,n)=>{"use strict";n.d(t,{I:()=>o});var r=n(65927);let a=["linear"];for(let e=1;e<=10;e++)a.push("easeIn".concat(e)),a.push("easeOut".concat(e)),a.push("easeInOut".concat(e)),a.push("easeOutIn".concat(e));let o="\n#ifndef GLSL_EASING\n#define GLSL_EASING\n\n".concat(r.S,"\n\nfloat easePow1(float x) {\n  return x;\n}\n\nfloat easePow2(float x) {\n  return x * x;\n}\n\nfloat easePow3(float x) {\n  return x * x * x;\n}\n\nfloat easePow4(float x) {\n  x *= x;\n  return x *= x;\n}\n\nfloat easePow5(float x) {\n  float x0 = x;\n  x *= x;\n  x *= x;\n  return x0 * x;\n}\n\nfloat easePow6(float x) {\n  x *= x * x;\n  return x *= x;\n}\n\nfloat easePow7(float x) {\n  float x0 = x;\n  x *= x * x;\n  x *= x;\n  return x0 * x;\n}\n\nfloat easePow8(float x) {\n  x *= x;\n  x *= x;\n  return x *= x;\n}\n\nfloat easePow9(float x) {\n  x *= x * x;\n  return x *= x * x;\n}\n\nfloat easePow10(float x) {\n  float x0 = x;\n  x *= x * x;\n  x *= x * x;\n  return x0 * x;\n}\n\nfloat linear(float x) {\n  return clamp01(x);\n}\n\n").concat(Array.from({length:10},(e,t)=>{let n=t+1;return"\n\n  float easeIn".concat(n," (float x) {\n    return easePow").concat(n,"(clamp01(x));\n  }\n  float easeOut").concat(n," (float x) {\n    return 1.0 - easePow").concat(n,"(clamp01(1.0 - x));\n  }\n  float easeInOut").concat(n," (float x) {\n    return x < 0.5 \n      ? 0.5 * easePow").concat(n,"(2.0 * x) \n      : 1.0 - 0.5 * easePow").concat(n,"(2.0 * (1.0 - x));\n  }\n  float easeOutIn").concat(n," (float x) {\n    return x < 0.5\n      ? 0.5 * (1.0 - easePow").concat(n,"(1.0 - x * 2.0))\n      : 1.0 - 0.5 * (1.0 - easePow").concat(n,"(2.0 * x - 1.0));\n  }\n\n").trim()}).join("\n\n"),"\n\n\n// https://www.desmos.com/calculator/mqou4lf9zc?lang=fr\nfloat easeInOut(float x, float p, float i) {\n  return  x <= 0.0 ? 0.0 :\n          x >= 1.0 ? 1.0 :\n          x <= i ? 1.0 / pow(i, p - 1.0) * pow(x, p) :\n          1.0 - 1.0 / pow(1.0 - i, p - 1.0) * pow(1.0 - x, p);\n}\n\n// https://www.desmos.com/calculator/nrjlezusdv\nfloat easeInThenOut(float x, float p) {\n  return 1.0 - pow(abs(2.0 * x - 1.0), p);\n}\n\n#endif\n")},28737:(e,t,n)=>{"use strict";n.d(t,{Leak:()=>f,O:()=>u});var r={};n.r(r),n.d(r,{distribute:()=>o.mn,every:()=>o.Si,findMaxBy:()=>o.vj,pairwise:()=>o.Ju,recordBy:()=>o.VY,some:()=>o.zN,split:()=>o.mn,uniqueBy:()=>o.pD});var a=n(30158),o=n(43107),l=n(38062),i=n(85795),s=n(17099),c=n(96122);function u(e){Object.assign(window,{...a,...i,...r,...e,PRNG:s.c,waveform:l.o,dedent:c.T})}function f(e){return u(e),null}},31423:(e,t,n)=>{"use strict";n.d(t,{l:()=>i});var r=n(70691),a=n(18479),o=n(36508);let l={frequency:3,tickerName:"three",precision:1};function i(e){let{frequency:t,tickerName:n,precision:i,...s}={...l,...e},{ref:c}=(0,a.C7)(function*(){let e=o.Rv.get("three");yield e.onTick({timeInterval:1/3},()=>{c.current.innerText="".concat(e.averageFps.toFixed(i)," fps")})},[t,n,i]);return(0,r.jsx)("div",{ref:c,...s,children:"-- fps"})}},38062:(e,t,n)=>{"use strict";n.d(t,{o:()=>r});let r={triangle:function(e){let{frequency:t=1,phase:n=0,f:r=t,p:a=n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e*r+a,l=2*o-Math.floor(2*o);return o-Math.floor(o)<.5?l:1-l}}},43107:(e,t,n)=>{"use strict";function r(e,t){for(let n of e)if(t(n))return!0;return!1}function a(e,t){for(let n of e)if(!t(n))return!1;return!0}function o(e,t,n){let r=[];function a(e){let t=[];return r[e]=t,t}if(void 0!==n)for(let e=0;e<n;e++)a(e);for(let n of e){var o;let e=t(n);(null!=(o=r[e])?o:a(e)).push(n)}return r}function*l(e){let t;for(let n of e)void 0!==t&&(yield[t,n]),t=n}function i(e,t){let n,r=-1/0;for(let a of e){let e=t(a);e>r&&(r=e,n=a)}return n}function s(e){let t=new Set;return n=>{let r=e(n);return!t.has(r)&&(t.add(r),!0)}}function c(e){return(t,n)=>{if(null!==t&&"object"!=typeof t)throw Error("Accumulator must be an object");let r=null===t?{}:t,a=e(n);return r[a]||(r[a]=[]),r[a].push(n),r}}n.d(t,{Ju:()=>l,Si:()=>a,VY:()=>c,mn:()=>o,pD:()=>s,vj:()=>i,zN:()=>r})},55227:(e,t,n)=>{"use strict";n.d(t,{M:()=>l});var r=n(22899),a=n(1029);let o="\n\nstruct FloatRamp {\n  float a;\n  float b;\n  float t;\n};\n\nstruct Vec2Ramp {\n  vec2 a;\n  vec2 b;\n  float t;\n};\n\nstruct Vec3Ramp {\n  vec3 a;\n  vec3 b;\n  float t;\n};\n\nstruct Vec4Ramp {\n  vec4 a;\n  vec4 b;\n  float t;\n};\n\n".concat((0,a.N)("vecX",e=>{let t=e[0].toUpperCase()+e.slice(1)+"Ramp";return"\n\n".concat(t," ramp(float t, T a, T b) {\n  return ").concat(t,"(a, b, t);\n}\n\n").concat(t," ramp(float t, T a, T b, T c) {\n  if (t < .5) {\n    return ").concat(t,"(a, b, t * 2.0);\n  } else {\n    return ").concat(t,"(b, c, (t - 0.5) * 2.0);\n  }\n}\n\n").concat(t," ramp(float t, T a, T b, T c, T d) {\n  if (t < .33) {\n    return ").concat(t,"(a, b, t * 3.0);\n  } else if (t < .66) {\n    return ").concat(t,"(b, c, (t - 0.33) * 3.0);\n  } else {\n    return ").concat(t,"(c, d, (t - 0.66) * 3.0);\n  }\n}\n\n").slice(1,-1)})),l="\n#ifndef GLSL_RAMP\n#define GLSL_RAMP\n".concat(r.I,"\n").concat(o,"\n#endif\n")},61572:(e,t,n)=>{"use strict";n.d(t,{S:()=>l});var r=n(49797),a=n(59813);let o={...a.q.defaultParams,size:512,viscosity:.98,cellScale:1};class l extends a.q{pointer(e,t,n,r){let{uPointer:a}=this.updateUniforms;a.value.set(e,t,n,r)}constructor(e){super({filter:"linear",...e}),this.shaders({initial:{fragmentColor:"\n          gl_FragColor.rgb = vec3(0.0);\n          gl_FragColor.a = 1.0;\n        "},update:{uniforms:{uViscosity:{value:this.params.viscosity},uCellScale:{value:this.params.cellScale},uPointer:{value:new r.IUQ(.5,.5,.1,1)}},fragmentTop:"\n          vec4 fetch(vec2 uv) {\n            if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {\n              return vec4(0.0);\n            }\n            float margin = 0.2;\n            float edgeDist = min(min(uv.x, 1.0 - uv.x), min(uv.y, 1.0 - uv.y));\n            edgeDist = 1.0 - pow(1.0 - edgeDist, 15.0);\n            float edgeFade = smoothstep(0.0, margin, edgeDist);\n            return texture2D(uTexture, uv) * edgeFade;\n          }\n        ",fragmentColor:"\n          vec2 uv = vUv;\n          float viscosity = uViscosity;\n          vec2 cellSize = uCellScale / uTextureSize;\n\n          vec4 center = fetch(uv);\n          vec4 north = fetch(uv + vec2(0.0, cellSize.y));\n          vec4 south = fetch(uv - vec2(0.0, cellSize.y));\n          vec4 east = fetch(uv + vec2(cellSize.x, 0.0));\n          vec4 west = fetch(uv - vec2(cellSize.x, 0.0));\n\n          // x: previous height\n          // y: penultimate height\n          // z: unused\n          // w: unused\n\n          float newHeight = ((north.x + south.x + east.x + west.x) * 0.5 - center.y) * viscosity;\n\n          // Pointer influence\n          float radius = uPointer.z;\n          float strength = uPointer.w;\n          float dist = distance(uv * uTextureSize, uPointer.xy * uTextureSize) - radius;\n          float cellLength = length(cellSize);\n          float influence = smoothstep(cellLength * 0.5, -cellLength * 0.5, dist);\n          newHeight += influence * strength;\n\n          gl_FragColor = vec4(newHeight, center.x, 0.0, 1.0);\n        "}})}}l.defaultParams=o},66620:(e,t,n)=>{"use strict";n.d(t,{_:()=>o});var r=n(89868),a=n(44138);function o(e,t){var n=(0,a._)(e,t,"update");return(0,r._)(e,n)}},79105:(e,t,n)=>{"use strict";n.d(t,{K2:()=>l,KP:()=>a,Tj:()=>i,Ts:()=>o,Zu:()=>r});let r=0x7fffffff,a=123456,o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;if(Number.isNaN(e))throw Error("NaN is not a valid seed.");let t=e;if(10>Math.abs(t)&&(t*=1e6),t%=r,(t=t<0?t+r:t)>1)return t&r;if(0===t)return a;throw Error("Impossible. ".concat(t))},l=e=>e=Math.imul(e,48271)&r,i=e=>(e-1)/(r-1)},88352:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(70691),a=n(53097);function o(){let e=(0,a.yk)();return(0,r.jsx)("button",{className:"absolute top-12 right-12 z-10 border border-white/50 hover:bg-black/10 hover:border-white text-white px-2 py-1 rounded transition",onClick:()=>e.setFullscreen("canvas"),children:"Fullscreen"})}},97313:(e,t,n)=>{Promise.resolve().then(n.bind(n,3261))}},e=>{var t=t=>e(e.s=t);e.O(0,[5611,7190,6564,7962,9635,8921,7953,4512,7775,7436,146,6726,3445,9332,3414,9717,1763,2143,3097,9813,1319,6852,7358],()=>t(97313)),_N_E=e.O()}]);
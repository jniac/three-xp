(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4780],{3261:(t,e,n)=>{"use strict";n.d(e,{PageClient:()=>b});var r=n(70691),a=n(49797),o=n(63106),l=n(99332),i=n(31423),s=n(53097),c=n(61572),u=n(77794),f=n(7147),h=n(79911),d=n(55227),x=n(79285),p=n(67235),v=n(36508),g=n(28737),m=n(88352);class w extends a.YJl{*initialize(t){let{water:e}=this;e.initialize(t.renderer),yield p.Q.on(w,t=>{t.setPayload(this)});let n=!1,r=0,i=new a.I9Y(.5,.5);return yield(0,v.xy)("three",{timeInterval:1/60},a=>{let{playing:o,autoRotate:l}=this.state;if(o){if(this.state.strength*=.9,n){let e=t.pointer.intersectPlane("xy");e.intersected&&i.set((0,x.inverseLerp)(-5,5,e.point.x),(0,x.inverseLerp)(-5,5,e.point.y)),this.state.strength=1}if(l&&!n){let t=2*(r+=a.deltaTime)*Math.PI*.4;i.set(.5+.3*Math.cos(t),.5+.3*Math.sin(t)),this.state.strength=1}e.pointer(i.x,i.y,40,this.state.strength*this.state.direction),e.update(a.deltaTime),this.plane.material.map=e.currentTexture(),this.plane.material.needsUpdate=!0}}),yield(0,l.s)(t.domElement,{onTap:()=>this.state.direction*=-1,onDragStart:()=>n=!0,onDragStop:()=>n=!1}),yield(0,o.a)([[{key:" "},()=>{this.state.playing=!this.state.playing}]]),this}constructor(){super(),this.plane=(0,h.mj)(new a.eaF(new a.bdM,new a.V9B),this),this.water=new c.S,this.grid=(0,h.mj)(new u.u,this).regularGrid({size:10,subdivisions:[2,10]}).onTop(),this.state={playing:!0,autoRotate:!1,strength:1,direction:1},this.name="water-demo",this.plane.scale.setScalar(10),this.plane.material.onBeforeCompile=t=>f.bI.with(t).fragment.top(d.M).fragment.after("map_fragment","\n        vec3 data = diffuseColor.rgb;\n        diffuseColor.r = clamp(data.r, 0.0, 1.0);\n        diffuseColor.g = clamp(-data.r, 0.0, 1.0);\n\n        Vec3Ramp r = ramp(0.5 + data.r * 0.1, ".concat((0,f.eR)("#9e0202ff"),", ").concat((0,f.eR)("#000000"),", ").concat((0,f.eR)("#027254ff"),");\n        diffuseColor.rgb = mix(r.a, r.b, r.t);\n      "))}}function y(){let t=(0,s.Fw)();return(0,s.dB)("my-scene",function*(e){t.pipeline.basicPasses.fxaa.enabled=!1;let n=(0,h.mj)(new w,e);yield*n.initialize(t)},[]),null}function b(){return(0,g.O)(),(0,r.jsxs)(s.uB,{vertigoControls:{fixed:!0,size:10.5,eventTarget:"canvas"},children:[(0,r.jsxs)("div",{className:"layer thru flex flex-col p-12 gap-2 items-start",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold",children:"GPU Compute - Water Demo"}),(0,r.jsx)("p",{children:"Classic water simulation using a height map and GPU Compute."}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)("button",{className:"px-2 py-1 border rounded bg-white/10 hover:bg-white/20 transition",onClick:()=>{let t=p.Q.send(w).assertPayload();t.state.playing=!t.state.playing},children:"Play / Pause [space]"})}),(0,r.jsx)("div",{className:"flex gap-2",children:[new a.I9Y(512,512),new a.I9Y(256,512),new a.I9Y(256,128)].map((t,e)=>(0,r.jsxs)("button",{className:"px-2 py-1 border rounded bg-white/10 hover:bg-white/20 transition",onClick:()=>{var e;let n=p.Q.send(w).assertPayload();n.water.setSize(t);let r=t.x/t.y;null!=(e=n.plane.scale)||(e=new a.I9Y),r>1?(e.x=10,e.y=10/r):(e.x=10*r,e.y=10),1===r?n.grid.clear().regularGrid({size:10,subdivisions:[2,10]}):n.grid.clear().rect({center:0,size:n.plane.scale})},children:[t.x,"x",t.y]},e))}),(0,r.jsx)(m.A,{}),(0,r.jsx)(i.l,{})]}),(0,r.jsx)(y,{})]})}},17099:(t,e,n)=>{"use strict";n.d(e,{c:()=>i});var r=n(79105);let a=t=>t,o={weightsAreNormalized:!1,indexOffset:0,forbiddenItems:[]};function l(){let t=(0,r.K2)((0,r.K2)((0,r.Ts)(r.KP)));function e(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.KP;return"string"==typeof e&&(e=e.split("").reduce((t,e)=>7*t+e.charCodeAt(0),0)),t=(0,r.K2)((0,r.K2)((0,r.Ts)(e))),u}function n(){return t=(0,r.K2)(t),(0,r.Tj)(t)}function l(t){switch(t.length){default:return[0,1,a];case 1:return[0,t[0],a];case 2:return[t[0],t[1],a];case 3:return[t[0],t[1],t[2]]}}function i(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];let[a,o,i]=l(e);return a+(o-a)*i(n())}function s(){for(var t,e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];let[l,i,{weightsAreNormalized:s,indexOffset:c,forbiddenItems:u}]=function(t){let[e,n=null,r]=t,a={...o,...r};if(Array.isArray(e))return[e,n,a];if("object"==typeof e)return[Object.values(e),n?Object.values(n):null,a];throw Error("pick: unsupported options type")}(r);if(u.length>0){let e=new Set;for(let t of u){let n=l.indexOf(t);n>=0&&e.add(n)}if(l=l.filter((t,n)=>!e.has(n)),i=null!=(t=null==i?void 0:i.filter((t,n)=>!e.has(n)))?t:null,0===l.length)throw Error("pick: all items are forbidden")}if(null===i){let t=Math.floor(n()*l.length);return c&&(t+=c,(t%=l.length)<0&&(t+=l.length)),l[t]}if(!s){let t=i.reduce((t,e)=>t+e,0);i=i.map(e=>e/t)}let f=n(),h=0;for(let t=0;t<l.length;t++)if(f<(h+=i[t]))return l[t];throw Error("among: unreachable")}function c(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=n(),a=n(),o=Math.sqrt(-2*Math.log(r)),l=2*Math.PI*a;return[t+e*o*Math.cos(l),t+e*o*Math.sin(l)]}let u={seed:e,seedMax:function(){return r.Zu},reset:function(){return e(r.KP),u},next:function(){return t=(0,r.K2)(t),u},getState:function(){return t},setState:function(e){return t=e&r.Zu,u},random:n,between:i,around:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];let[o=1,l=a]=e,i=2*n();return(i>1?1:-1)*l(i>1?i-1:i)*o},int:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];let[a,o,i]=l(e);return a+Math.floor(i(n())*(o-a))},chance:function(t){return n()<t},shuffle:function(t){let{mutate:e=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e&&Array.isArray(t)?t:[...t],a=r.length;for(let t=0;t<a;t++){let e=Math.floor(a*n()),o=r[t];r[t]=r[e],r[e]=o}return r},pick:s,createPicker:function(t){let e=t.map(t=>{let[e]=t;return e}),n=t.map(t=>{let[e,n]=t;return n}),r=n.reduce((t,e)=>t+e,0);for(let[t,e]of n.entries())n[t]=e/r;return()=>s(e,n,{weightsAreNormalized:!0})},vector:function(t,e){let[n=0,r=1]=Array.isArray(e)?e:[null==e?void 0:e.min,null==e?void 0:e.max];for(let e of Object.keys(t))t[e]=i(n,r);return t},unitVector2:function(t){let e=2*Math.PI*n();return t.x=Math.cos(e),t.y=Math.sin(e),t},unitVector3:function(t){let e=n(),r=n(),a=2*Math.PI*e,o=Math.acos(1-2*r);return t.x=Math.sin(o)*Math.cos(a),t.y=Math.sin(o)*Math.sin(a),t.z=Math.cos(o),t},normalVector:function(t){let e=Object.keys(t),n=e.length,r=Math.sqrt(n);for(let a=0;a<n;a+=2){let[o,l]=c();t[e[a]]=o/r,a+1<n&&(t[e[a+1]]=l/r)}return t},unitVector:function(t){let e=Object.keys(t),n=e.length,r=0;for(let a=0;a<n;a+=2){let[o,l]=c();t[e[a]]=o,r+=o*o,a+1<n&&(t[e[a+1]]=l,r+=l*l)}r=Math.sqrt(r);for(let a=0;a<n;a++)t[e[a]]/=r;return t},boxMuller:c,quaternion:function(t){let e=n(),r=n(),a=n(),o=Math.sqrt(1-e),l=Math.sqrt(e);return t.x=o*Math.sin(2*Math.PI*r),t.y=o*Math.cos(2*Math.PI*r),t.z=l*Math.sin(2*Math.PI*a),t.w=l*Math.cos(2*Math.PI*a),t},insideCircle:function(t,e){let r=2*n()*Math.PI,a=Math.sqrt(n())*t;return e.x=a*Math.cos(r),e.y=a*Math.sin(r),e}};return u}let i=class{constructor(t){Object.assign(this,l().seed(t))}};Object.assign(i,l())},22899:(t,e,n)=>{"use strict";n.d(e,{I:()=>o});var r=n(65927);let a=["linear"];for(let t=1;t<=10;t++)a.push("easeIn".concat(t)),a.push("easeOut".concat(t)),a.push("easeInOut".concat(t)),a.push("easeOutIn".concat(t));let o="\n#ifndef GLSL_EASING\n#define GLSL_EASING\n\n".concat(r.S,"\n\nfloat easePow1(float x) {\n  return x;\n}\n\nfloat easePow2(float x) {\n  return x * x;\n}\n\nfloat easePow3(float x) {\n  return x * x * x;\n}\n\nfloat easePow4(float x) {\n  x *= x;\n  return x *= x;\n}\n\nfloat easePow5(float x) {\n  float x0 = x;\n  x *= x;\n  x *= x;\n  return x0 * x;\n}\n\nfloat easePow6(float x) {\n  x *= x * x;\n  return x *= x;\n}\n\nfloat easePow7(float x) {\n  float x0 = x;\n  x *= x * x;\n  x *= x;\n  return x0 * x;\n}\n\nfloat easePow8(float x) {\n  x *= x;\n  x *= x;\n  return x *= x;\n}\n\nfloat easePow9(float x) {\n  x *= x * x;\n  return x *= x * x;\n}\n\nfloat easePow10(float x) {\n  float x0 = x;\n  x *= x * x;\n  x *= x * x;\n  return x0 * x;\n}\n\nfloat linear(float x) {\n  return clamp01(x);\n}\n\n").concat(Array.from({length:10},(t,e)=>{let n=e+1;return"\n\n  float easeIn".concat(n," (float x) {\n    return easePow").concat(n,"(clamp01(x));\n  }\n  float easeOut").concat(n," (float x) {\n    return 1.0 - easePow").concat(n,"(clamp01(1.0 - x));\n  }\n  float easeInOut").concat(n," (float x) {\n    return x < 0.5 \n      ? 0.5 * easePow").concat(n,"(2.0 * x) \n      : 1.0 - 0.5 * easePow").concat(n,"(2.0 * (1.0 - x));\n  }\n  float easeOutIn").concat(n," (float x) {\n    return x < 0.5\n      ? 0.5 * (1.0 - easePow").concat(n,"(1.0 - x * 2.0))\n      : 1.0 - 0.5 * (1.0 - easePow").concat(n,"(2.0 * x - 1.0));\n  }\n\n").trim()}).join("\n\n"),"\n\n\n// https://www.desmos.com/calculator/mqou4lf9zc?lang=fr\nfloat easeInOut(float x, float p, float i) {\n  return  x <= 0.0 ? 0.0 :\n          x >= 1.0 ? 1.0 :\n          x <= i ? 1.0 / pow(i, p - 1.0) * pow(x, p) :\n          1.0 - 1.0 / pow(1.0 - i, p - 1.0) * pow(1.0 - x, p);\n}\n\n// https://www.desmos.com/calculator/nrjlezusdv\nfloat easeInThenOut(float x, float p) {\n  return 1.0 - pow(abs(2.0 * x - 1.0), p);\n}\n\n#endif\n")},28737:(t,e,n)=>{"use strict";n.d(e,{Leak:()=>f,O:()=>u});var r={};n.r(r),n.d(r,{distribute:()=>o.mn,every:()=>o.Si,findMaxBy:()=>o.vj,pairwise:()=>o.Ju,recordBy:()=>o.VY,some:()=>o.zN,split:()=>o.mn,uniqueBy:()=>o.pD});var a=n(30158),o=n(43107),l=n(38062),i=n(85795),s=n(17099),c=n(96122);function u(t){Object.assign(window,{...a,...i,...r,...t,PRNG:s.c,waveform:l.o,dedent:c.T})}function f(t){return u(t),null}},31423:(t,e,n)=>{"use strict";n.d(e,{l:()=>i});var r=n(70691),a=n(18479),o=n(36508);let l={frequency:3,tickerName:"three",precision:1};function i(t){let{frequency:e,tickerName:n,precision:i,...s}={...l,...t},{ref:c}=(0,a.C7)(function*(){let t=o.Rv.get("three");yield t.onTick({timeInterval:1/3},()=>{c.current.innerText="".concat(t.averageFps.toFixed(i)," fps")})},[e,n,i]);return(0,r.jsx)("div",{ref:c,...s,children:"-- fps"})}},38062:(t,e,n)=>{"use strict";n.d(e,{o:()=>r});let r={triangle:function(t){let{frequency:e=1,phase:n=0,f:r=e,p:a=n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t*r+a,l=2*o-Math.floor(2*o);return o-Math.floor(o)<.5?l:1-l}}},43107:(t,e,n)=>{"use strict";function r(t,e){for(let n of t)if(e(n))return!0;return!1}function a(t,e){for(let n of t)if(!e(n))return!1;return!0}function o(t,e,n){let r=[];function a(t){let e=[];return r[t]=e,e}if(void 0!==n)for(let t=0;t<n;t++)a(t);for(let n of t){var o;let t=e(n);(null!=(o=r[t])?o:a(t)).push(n)}return r}function*l(t){let e;for(let n of t)void 0!==e&&(yield[e,n]),e=n}function i(t,e){let n,r=-1/0;for(let a of t){let t=e(a);t>r&&(r=t,n=a)}return n}function s(t){let e=new Set;return n=>{let r=t(n);return!e.has(r)&&(e.add(r),!0)}}function c(t){return(e,n)=>{if(null!==e&&"object"!=typeof e)throw Error("Accumulator must be an object");let r=null===e?{}:e,a=t(n);return r[a]||(r[a]=[]),r[a].push(n),r}}n.d(e,{Ju:()=>l,Si:()=>a,VY:()=>c,mn:()=>o,pD:()=>s,vj:()=>i,zN:()=>r})},55227:(t,e,n)=>{"use strict";n.d(e,{M:()=>l});var r=n(22899),a=n(1029);let o="\n\nstruct FloatRamp {\n  float a;\n  float b;\n  float t;\n};\n\nstruct Vec2Ramp {\n  vec2 a;\n  vec2 b;\n  float t;\n};\n\nstruct Vec3Ramp {\n  vec3 a;\n  vec3 b;\n  float t;\n};\n\nstruct Vec4Ramp {\n  vec4 a;\n  vec4 b;\n  float t;\n};\n\n".concat((0,a.N)("vecX",t=>{let e=t[0].toUpperCase()+t.slice(1)+"Ramp";return"\n\n// 1 stop (simple linear interpolation)\n".concat(e," ramp(float t, T a, T b) {\n  return ").concat(e,"(a, b, t);\n}\n\n// 2 stops\n").concat(e," ramp(float t, T a, T b, T c) {\n  if (t < 0.5) {\n    return ").concat(e,"(a, b, t * 2.0);\n  } else {\n    return ").concat(e,"(b, c, t * 2.0 - 1.0);\n  }\n}\n\n// 4 stops\n").concat(e," ramp(float t, T a, T b, T c, T d) {\n  if (t < 0.333) {\n    return ").concat(e,"(a, b, t * 3.0);\n  } else if (t < 0.666) {\n    return ").concat(e,"(b, c, t * 3.0 - 1.0);\n  } else {\n    return ").concat(e,"(c, d, t * 3.0 - 2.0);\n  }\n}\n\n// 5 stops\n").concat(e," ramp(float t, T a, T b, T c, T d, T e) {\n  if (t < 0.25) {\n    return ").concat(e,"(a, b, t * 4.0);\n  } else if (t < 0.5) {\n    return ").concat(e,"(b, c, t * 4.0 - 1.0);\n  } else if (t < 0.75) {\n    return ").concat(e,"(c, d, t * 4.0 - 2.0);\n  } else {\n    return ").concat(e,"(d, e, t * 4.0 - 3.0);\n  }\n}\n\n").slice(1,-1)})),l="\n#ifndef GLSL_RAMP\n#define GLSL_RAMP\n".concat(r.I,"\n").concat(o,"\n#endif\n")},61572:(t,e,n)=>{"use strict";n.d(e,{S:()=>l});var r=n(49797),a=n(59813);let o={...a.q.defaultParams,size:512,viscosity:.98,cellScale:1};class l extends a.q{pointer(t,e,n,r){let{uPointer:a}=this.updateUniforms;a.value.set(t,e,n,r)}constructor(t){super({filter:"linear",...t}),this.shaders({initial:{fragmentColor:"\n          gl_FragColor.rgb = vec3(0.0);\n          gl_FragColor.a = 1.0;\n        "},update:{uniforms:{uViscosity:{value:this.params.viscosity},uCellScale:{value:this.params.cellScale},uPointer:{value:new r.IUQ(.5,.5,.1,1)}},fragmentTop:"\n          vec4 fetch(vec2 uv) {\n            if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {\n              return vec4(0.0);\n            }\n            float margin = 0.2;\n            float edgeDist = min(min(uv.x, 1.0 - uv.x), min(uv.y, 1.0 - uv.y));\n            edgeDist = 1.0 - pow(1.0 - edgeDist, 15.0);\n            float edgeFade = smoothstep(0.0, margin, edgeDist);\n            return texture2D(uTexture, uv) * edgeFade;\n          }\n        ",fragmentColor:"\n          vec2 uv = vUv;\n          float viscosity = uViscosity;\n          vec2 cellSize = uCellScale / uTextureSize;\n\n          vec4 center = fetch(uv);\n          vec4 north = fetch(uv + vec2(0.0, cellSize.y));\n          vec4 south = fetch(uv - vec2(0.0, cellSize.y));\n          vec4 east = fetch(uv + vec2(cellSize.x, 0.0));\n          vec4 west = fetch(uv - vec2(cellSize.x, 0.0));\n\n          // x: previous height\n          // y: penultimate height\n          // z: unused\n          // w: unused\n\n          float newHeight = ((north.x + south.x + east.x + west.x) * 0.5 - center.y) * viscosity;\n\n          // Pointer influence\n          float radius = uPointer.z;\n          float strength = uPointer.w;\n          float dist = distance(uv * uTextureSize, uPointer.xy * uTextureSize) - radius;\n          float cellLength = length(cellSize);\n          float influence = smoothstep(cellLength * 0.5, -cellLength * 0.5, dist);\n          newHeight += influence * strength;\n\n          gl_FragColor = vec4(newHeight, center.x, 0.0, 1.0);\n        "}})}}l.defaultParams=o},66620:(t,e,n)=>{"use strict";n.d(e,{_:()=>o});var r=n(89868),a=n(44138);function o(t,e){var n=(0,a._)(t,e,"update");return(0,r._)(t,n)}},79105:(t,e,n)=>{"use strict";n.d(e,{K2:()=>l,KP:()=>a,Tj:()=>i,Ts:()=>o,Zu:()=>r});let r=0x7fffffff,a=123456,o=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;if(Number.isNaN(t))throw Error("NaN is not a valid seed.");let e=t;if(10>Math.abs(e)&&(e*=1e6),e%=r,(e=e<0?e+r:e)>1)return e&r;if(0===e)return a;throw Error("Impossible. ".concat(e))},l=t=>t=Math.imul(t,48271)&r,i=t=>(t-1)/(r-1)},88352:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});var r=n(70691),a=n(53097);function o(){let t=(0,a.yk)();return(0,r.jsx)("button",{className:"absolute top-12 right-12 z-10 border border-white/50 hover:bg-black/10 hover:border-white text-white px-2 py-1 rounded transition",onClick:()=>t.setFullscreen("canvas"),children:"Fullscreen"})}},97313:(t,e,n)=>{Promise.resolve().then(n.bind(n,3261))}},t=>{var e=e=>t(t.s=e);t.O(0,[5611,7190,6564,7962,9635,8921,7953,4512,7775,7436,146,6726,3445,9332,3414,9717,1763,2143,3097,9813,1319,6852,7358],()=>e(97313)),_N_E=t.O()}]);
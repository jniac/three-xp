(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9091],{70550:function(e,t,n){Promise.resolve().then(n.t.bind(n,62670,23)),Promise.resolve().then(n.bind(n,40034)),Promise.resolve().then(n.bind(n,49004)),Promise.resolve().then(n.bind(n,16535)),Promise.resolve().then(n.bind(n,90663)),Promise.resolve().then(n.bind(n,79841)),Promise.resolve().then(n.bind(n,31283)),Promise.resolve().then(n.bind(n,30730)),Promise.resolve().then(n.bind(n,32695)),Promise.resolve().then(n.bind(n,93342)),Promise.resolve().then(n.bind(n,49794)),Promise.resolve().then(n.t.bind(n,63149,23)),Promise.resolve().then(n.bind(n,8834))},40034:function(e,t,n){"use strict";n.d(t,{Main:function(){return C}});var r=n(78485),a=n(27275),i=n(48583),o=n(51886),s=n(52471),l=n(86712),c=n(55445),d=n(55440),u=n(82048),h=n(19687),p=n(28954),f=n(54422),m=n(9710),v=n(32423),x=n(39900),g=n(62604),w=n(38885),y=n(15529),b=n(31229);class M extends g.w{dispose(){this.gtaoNoiseTexture.dispose(),this.pdNoiseTexture.dispose(),this.normalRenderTarget.dispose(),this.gtaoRenderTarget.dispose(),this.pdRenderTarget.dispose(),this.normalMaterial.dispose(),this.pdMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}get gtaoMap(){return this.pdRenderTarget.texture}setGBuffer(e,t){void 0!==e?(this.depthTexture=e,this.normalTexture=t,this._renderGBuffer=!1):(this.depthTexture=new s.DepthTexture,this.depthTexture.format=s.DepthStencilFormat,this.depthTexture.type=s.UnsignedInt248Type,this.normalRenderTarget=new s.WebGLRenderTarget(this.width,this.height,{minFilter:s.NearestFilter,magFilter:s.NearestFilter,type:s.HalfFloatType,depthTexture:this.depthTexture}),this.normalTexture=this.normalRenderTarget.texture,this._renderGBuffer=!0);let n=this.normalTexture?1:0,r=this.depthTexture===this.normalTexture?"w":"x";this.gtaoMaterial.defines.NORMAL_VECTOR_TYPE=n,this.gtaoMaterial.defines.DEPTH_SWIZZLING=r,this.gtaoMaterial.uniforms.tNormal.value=this.normalTexture,this.gtaoMaterial.uniforms.tDepth.value=this.depthTexture,this.pdMaterial.defines.NORMAL_VECTOR_TYPE=n,this.pdMaterial.defines.DEPTH_SWIZZLING=r,this.pdMaterial.uniforms.tNormal.value=this.normalTexture,this.pdMaterial.uniforms.tDepth.value=this.depthTexture,this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture}setSceneClipBox(e){e?(this.gtaoMaterial.needsUpdate=1!==this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=1,this.gtaoMaterial.uniforms.sceneBoxMin.value.copy(e.min),this.gtaoMaterial.uniforms.sceneBoxMax.value.copy(e.max)):(this.gtaoMaterial.needsUpdate=0===this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=0)}updateGtaoMaterial(e){void 0!==e.radius&&(this.gtaoMaterial.uniforms.radius.value=e.radius),void 0!==e.distanceExponent&&(this.gtaoMaterial.uniforms.distanceExponent.value=e.distanceExponent),void 0!==e.thickness&&(this.gtaoMaterial.uniforms.thickness.value=e.thickness),void 0!==e.distanceFallOff&&(this.gtaoMaterial.uniforms.distanceFallOff.value=e.distanceFallOff,this.gtaoMaterial.needsUpdate=!0),void 0!==e.scale&&(this.gtaoMaterial.uniforms.scale.value=e.scale),void 0!==e.samples&&e.samples!==this.gtaoMaterial.defines.SAMPLES&&(this.gtaoMaterial.defines.SAMPLES=e.samples,this.gtaoMaterial.needsUpdate=!0),void 0!==e.screenSpaceRadius&&(e.screenSpaceRadius?1:0)!==this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS&&(this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS=e.screenSpaceRadius?1:0,this.gtaoMaterial.needsUpdate=!0)}updatePdMaterial(e){let t=!1;void 0!==e.lumaPhi&&(this.pdMaterial.uniforms.lumaPhi.value=e.lumaPhi),void 0!==e.depthPhi&&(this.pdMaterial.uniforms.depthPhi.value=e.depthPhi),void 0!==e.normalPhi&&(this.pdMaterial.uniforms.normalPhi.value=e.normalPhi),void 0!==e.radius&&e.radius!==this.radius&&(this.pdMaterial.uniforms.radius.value=e.radius),void 0!==e.radiusExponent&&e.radiusExponent!==this.pdRadiusExponent&&(this.pdRadiusExponent=e.radiusExponent,t=!0),void 0!==e.rings&&e.rings!==this.pdRings&&(this.pdRings=e.rings,t=!0),void 0!==e.samples&&e.samples!==this.pdSamples&&(this.pdSamples=e.samples,t=!0),t&&(this.pdMaterial.defines.SAMPLES=this.pdSamples,this.pdMaterial.defines.SAMPLE_VECTORS=(0,b.a)(this.pdSamples,this.pdRings,this.pdRadiusExponent),this.pdMaterial.needsUpdate=!0)}render(e,t,n){switch(this._renderGBuffer&&(this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.gtaoMaterial.uniforms.cameraWorldMatrix.value.copy(this.camera.matrixWorld),this.renderPass(e,this.gtaoMaterial,this.gtaoRenderTarget,16777215,1),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.renderPass(e,this.pdMaterial,this.pdRenderTarget,16777215,1),this.output){case M.OUTPUT.Off:break;case M.OUTPUT.Diffuse:this.copyMaterial.uniforms.tDiffuse.value=n.texture,this.copyMaterial.blending=s.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case M.OUTPUT.AO:this.copyMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.copyMaterial.blending=s.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case M.OUTPUT.Denoise:this.copyMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.copyMaterial.blending=s.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case M.OUTPUT.Depth:this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case M.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=s.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case M.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=n.texture,this.copyMaterial.blending=s.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blendMaterial.uniforms.intensity.value=this.blendIntensity,this.blendMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.renderPass(e,this.blendMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.GTAOPass: Unknown output type.")}}renderPass(e,t,n,r,a){e.getClearColor(this.originalClearColor);let i=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,null!=r&&(e.setClearColor(r),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(i)}renderOverride(e,t,n,r,a){e.getClearColor(this.originalClearColor);let i=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,r=t.clearColor||r,a=t.clearAlpha||a,null!=r&&(e.setClearColor(r),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t;let s=this.camera.layers.mask;this.camera.layers.set(0),e.render(this.scene,this.camera),this.camera.layers.mask=s,this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(i)}setSize(e,t){this.width=e,this.height=t,this.gtaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.pdRenderTarget.setSize(e,t),this.gtaoMaterial.uniforms.resolution.value.set(e,t),this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.pdMaterial.uniforms.resolution.value.set(e,t),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse)}overrideVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){let n=t.get(e);e.visible=n}),t.clear()}generateNoise(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=new x.L,n=new Uint8Array(e*e*4);for(let r=0;r<e;r++)for(let a=0;a<e;a++){let i=r,o=a;n[(r*e+a)*4]=(.5*t.noise(i,o)+.5)*255,n[(r*e+a)*4+1]=(.5*t.noise(i+e,o)+.5)*255,n[(r*e+a)*4+2]=(.5*t.noise(i,o+e)+.5)*255,n[(r*e+a)*4+3]=(.5*t.noise(i+e,o+e)+.5)*255}let r=new s.DataTexture(n,e,e,s.RGBAFormat,s.UnsignedByteType);return r.wrapS=s.RepeatWrapping,r.wrapT=s.RepeatWrapping,r.needsUpdate=!0,r}constructor(e,t,n,r,a,i,o){super(),this.width=void 0!==n?n:512,this.height=void 0!==r?r:512,this.clear=!0,this.camera=t,this.scene=e,this.output=0,this._renderGBuffer=!0,this._visibilityCache=new Map,this.blendIntensity=1,this.pdRings=2,this.pdRadiusExponent=2,this.pdSamples=16,this.gtaoNoiseTexture=(0,y.mK)(),this.pdNoiseTexture=this.generateNoise(),this.gtaoRenderTarget=new s.WebGLRenderTarget(this.width,this.height,{type:s.HalfFloatType}),this.pdRenderTarget=this.gtaoRenderTarget.clone(),this.gtaoMaterial=new s.ShaderMaterial({defines:Object.assign({},y.Sp.defines),uniforms:s.UniformsUtils.clone(y.Sp.uniforms),vertexShader:y.Sp.vertexShader,fragmentShader:y.Sp.fragmentShader,blending:s.NoBlending,depthTest:!1,depthWrite:!1}),this.gtaoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.gtaoMaterial.uniforms.tNoise.value=this.gtaoNoiseTexture,this.gtaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.normalMaterial=new s.MeshNormalMaterial,this.normalMaterial.blending=s.NoBlending,this.pdMaterial=new s.ShaderMaterial({defines:Object.assign({},b.m.defines),uniforms:s.UniformsUtils.clone(b.m.uniforms),vertexShader:b.m.vertexShader,fragmentShader:b.m.fragmentShader,depthTest:!1,depthWrite:!1}),this.pdMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.pdMaterial.uniforms.tNoise.value=this.pdNoiseTexture,this.pdMaterial.uniforms.resolution.value.set(this.width,this.height),this.pdMaterial.uniforms.lumaPhi.value=10,this.pdMaterial.uniforms.depthPhi.value=2,this.pdMaterial.uniforms.normalPhi.value=3,this.pdMaterial.uniforms.radius.value=8,this.depthRenderMaterial=new s.ShaderMaterial({defines:Object.assign({},y.gs.defines),uniforms:s.UniformsUtils.clone(y.gs.uniforms),vertexShader:y.gs.vertexShader,fragmentShader:y.gs.fragmentShader,blending:s.NoBlending}),this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new s.ShaderMaterial({uniforms:s.UniformsUtils.clone(w.C.uniforms),vertexShader:w.C.vertexShader,fragmentShader:w.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:s.DstColorFactor,blendDst:s.ZeroFactor,blendEquation:s.AddEquation,blendSrcAlpha:s.DstAlphaFactor,blendDstAlpha:s.ZeroFactor,blendEquationAlpha:s.AddEquation}),this.blendMaterial=new s.ShaderMaterial({uniforms:s.UniformsUtils.clone(y.mF.uniforms),vertexShader:y.mF.vertexShader,fragmentShader:y.mF.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:s.CustomBlending,blendSrc:s.DstColorFactor,blendDst:s.ZeroFactor,blendEquation:s.AddEquation,blendSrcAlpha:s.DstAlphaFactor,blendDstAlpha:s.ZeroFactor,blendEquationAlpha:s.AddEquation}),this.fsQuad=new g.T(null),this.originalClearColor=new s.Color,this.setGBuffer(a?a.depthTexture:void 0,a?a.normalTexture:void 0),void 0!==i&&this.updateGtaoMaterial(i),void 0!==o&&this.updatePdMaterial(o)}}M.OUTPUT={Off:-1,Default:0,Diffuse:1,Depth:2,Normal:3,AO:4,Denoise:5};var S=n(40069);class P extends u.C{render(e,t,n,r,a){var i;if(null===(i=this.onBeforeRender)||void 0===i||i.call(this),this.disableBackground){let i=this.scene.background;this.scene.background=null,super.render(e,t,n,r,a),this.scene.background=i}else super.render(e,t,n,r,a)}constructor(...e){super(...e),this.onBeforeRender=null,this.disableBackground=!1}}function T(){let{ref:e}=(0,i.sv)(function*(e){let t=function(e){let{width:t=window.innerWidth,height:n=window.innerHeight}=e,r=new s.WebGLRenderer({});r.setSize(t,n),r.setPixelRatio(window.devicePixelRatio);let a=new s.PerspectiveCamera(75,t/n,.1,1e3);a.position.z=8,new l.z(a,r.domElement);let i=new m.vB().set({activeDuration:30}),o=(0,v.s)(()=>i.requestActivation()),u=function(e){let t=new s.Scene;{let e=new s.DirectionalLight(16777215,1);e.position.set(0,3,1),t.add(e);let n=new s.HemisphereLight("#afdbf5","#845244",1);t.add(n)}new S.x().setPath("https://threejs.org/examples/textures/equirectangular/").loadAsync("pedestrian_overpass_1k.hdr").then(e=>{e.mapping=s.EquirectangularReflectionMapping,t.environmentIntensity=.1,t.environment=e,t.backgroundBlurriness=.5,t.background=e});let n=new s.Mesh(new s.TorusKnotGeometry(2,1,512,64),new s.MeshPhysicalMaterial);t.add(n);let r=new s.Mesh(new s.BoxGeometry(10,1,3),new s.MeshPhysicalMaterial);t.add(r);let a=new s.Mesh(new s.BoxGeometry(1,10,3),new s.MeshPhysicalMaterial);a.position.set(5,0,0),t.add(a);let i=new s.Mesh(new s.PlaneGeometry(10,10),new s.MeshPhysicalMaterial({color:"#d1ddff",transmission:1,roughness:0,dispersion:.1,ior:2.5,opacity:1}));return i.layers.set(1),t.add(i),e.onTick(e=>{n.rotation.x+=.5*e.deltaTime,n.rotation.y+=.5*e.deltaTime}),t}(i),x=new c.x(r),g=new P(u,a);g.onBeforeRender=()=>{a.layers.enableAll()},x.addPass(g);let w=new M(u,a,t,n);x.addPass(w);let y=new d.v;x.addPass(y);let b=new h.T(p.C);b.material.uniforms.resolution.value.set(1/t,1/n),x.addPass(b),i.onTick(()=>{x.render()}),f.v.on("REQUIRE:THREE",e=>{e.payload={three:T}});let T={renderer:r,camera:a,scene:u,ticker:i,passes:{render:g,ao:w,output:y},destroy:()=>{r.domElement.remove(),i.destroy(),o.destroy()}};return T}({width:e.clientWidth,height:e.clientHeight});yield t,Object.assign(window,{three:t}),e.appendChild(t.renderer.domElement)},[]);return(0,r.jsx)("div",{ref:e,className:"absolute inset-0"})}function C(){let[e,t]=(0,a.useState)(!0);return(0,r.jsxs)("div",{className:"page",children:[(0,r.jsx)(T,{}),(0,r.jsxs)("div",{className:"absolute inset-0 p-8 flex flex-col items-start justify-start pointer-through",children:[(0,r.jsxs)("div",{className:"flex flex-col items-start justify-start pointer-through max-w-[480px]",children:[(0,r.jsx)("h1",{className:"text-4xl uppercase",children:"ao-transparent"}),(0,r.jsx)("div",{className:"mt-4"}),(0,r.jsx)("p",{children:"Handling Ambient Occlusion and transparent objects"}),(0,r.jsx)("p",{children:"The glass does not generate AO"}),(0,r.jsx)("div",{className:"mt-4"}),(0,r.jsxs)("p",{children:["This is achieved by using a fork of the ",(0,r.jsx)("a",{href:"https://github.com/mrdoob/three.js/blob/master/examples/jsm/postprocessing/GTAOPass.js",children:"GTAOPass"}),"\xa0where the camera layer mask is set to 0 (default layer) and the glass object is set to layer 1 (transparent objects)."]}),(0,r.jsx)("div",{className:"mt-4"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl",children:"Pros:"}),(0,r.jsx)("ul",{children:(0,r.jsx)("li",{children:"Simple (layer based)"})})]}),(0,r.jsx)("div",{className:"mt-4"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl",children:"Cons:"}),(0,r.jsx)("ul",{children:(0,r.jsx)("li",{children:"AO is still rendered on top of transparent objects. For semi-opaque objects, this is could be a problem."})})]})]}),(0,r.jsx)("div",{className:"mt-4"}),(0,r.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,r.jsx)("label",{htmlFor:"ao-enabled",className:"select-none",children:"Enable AO"}),(0,r.jsx)("input",{type:"checkbox",name:"ao-enabled",id:"ao-enabled",checked:e,onChange:()=>{let{payload:e}=o.v.send("REQUIRE:THREE");if(e){let{three:n}=e,{passes:r}=n,{ao:a}=r;a.enabled=!a.enabled,t(a.enabled)}}})]})]})]})}},16535:function(e,t,n){"use strict";n.d(t,{Main:function(){return U}});var r=n(78485),a=n(98579),i=n(91659),o=n(52471),s=n(47174),l=n(94588),c=n(1060),d=n(77405),u=n(28142),h=n(96966),p=n(73899);let f=new(n(40069)).x;function m(e){return new Promise(t=>{f.load(e,e=>{t(e)})})}let v=new p.I;var x=n(70155);let g="\n\nstruct FloatRamp {\n  float a;\n  float b;\n  float t;\n};\n\nstruct Vec2Ramp {\n  vec2 a;\n  vec2 b;\n  float t;\n};\n\nstruct Vec3Ramp {\n  vec3 a;\n  vec3 b;\n  float t;\n};\n\nstruct Vec4Ramp {\n  vec4 a;\n  vec4 b;\n  float t;\n};\n\n".concat((0,x.C)("vecX",e=>{let t=e[0].toUpperCase()+e.slice(1)+"Ramp";return"\n\n".concat(t," ramp(float t, T a, T b) {\n  return ").concat(t,"(a, b, t);\n}\n\n").concat(t," ramp(float t, T a, T b, T c) {\n  if (t < .5) {\n    return ").concat(t,"(a, b, t * 2.0);\n  } else {\n    return ").concat(t,"(b, c, (t - 0.5) * 2.0);\n  }\n}\n\n").concat(t," ramp(float t, T a, T b, T c, T d) {\n  if (t < .33) {\n    return ").concat(t,"(a, b, t * 3.0);\n  } else if (t < .66) {\n    return ").concat(t,"(b, c, (t - 0.33) * 3.0);\n  } else {\n    return ").concat(t,"(c, d, (t - 0.66) * 3.0);\n  }\n}\n\n").slice(1,-1)})),w="\n#ifndef GLSL_RAMP\n#define GLSL_RAMP\n".concat(c.i,"\n").concat(g,"\n#endif\n"),y={white:new o.Color("#ffffff"),grey10:new o.Color("#f0f0f0"),grey20:new o.Color("#e0e0e0"),notSoWhite:new o.Color("#f8f8e8"),yellow:new o.Color("#fff700"),black:new o.Color("#110111"),red:new o.Color("#dd1a41"),brightSkin:new o.Color("#ebd8c6"),petrol:new o.Color("#005e6b"),brightGreen:new o.Color("#22c891"),darkGreen:new o.Color("#002f1c"),sand:new o.Color("#e6db9f")};class b extends o.Mesh{static createMaterial(e){let{color:t,shaded:n,emissiveIntensity:r,side:a}={...b.defaultProps,...e};return n?new o.MeshPhysicalMaterial({color:t,emissiveIntensity:r,emissive:r>0?t:void 0,side:a}):new o.MeshBasicMaterial({color:t})}}b.defaultProps={color:y.black,radius:1.3,align:.5,thickness:.3,innerRadiusRatio:null,shaded:!0,emissiveIntensity:.333};class M extends b{constructor(e){let{radius:t,thickness:n,align:r,innerRadiusRatio:a,color:i,shaded:s,...c}={...b.defaultProps,...e},d=t-n*r,u=t+n*(1-r);a&&(d=t*a,u=t),super(new o.RingGeometry(d,u,128),b.createMaterial({...e,side:o.DoubleSide})),(0,l.N)(this,c)}}class S extends o.Mesh{constructor(e){let{radius:t,thickness:n,align:r,innerRadiusRatio:a,color:i,shaded:s,emissiveIntensity:c,...d}={...b.defaultProps,...e},u=t-n*r,h=t+n*(1-r);a&&(u=t*a,h=t),super(new o.TorusGeometry((u+h)/2,(h-u)/2,128,512),b.createMaterial({...e,side:o.FrontSide})),(0,l.N)(this,d)}}class P extends M{constructor(e){super(e),this.material.onBeforeCompile=e=>s.b.with(e).defines({USE_UV:""}).fragment.top(w).fragment.after("map_fragment","\n      vec2 p = vUv - 0.5;\n      float alpha = atan(p.y, p.x) / 6.2831853;\n      alpha = 1.0 - mod(alpha + 0.0, 1.0);\n      Vec3Ramp r = ramp(alpha,\n        ".concat((0,s.R)(y.black),",\n        ").concat((0,s.R)(y.white),",\n        ").concat((0,s.R)(y.yellow),");\n      diffuseColor.rgb = mix(r.a, r.b, easeInOut4(r.t));\n    "))}}var T=n(6054);class C extends o.Group{constructor({globalIntensity:e=1,debug:t=!1}={}){super(),this.name="lights";let n=new o.HemisphereLight("#dbebf0","#645d61",e);this.add(n);let r=new o.RectAreaLight("#e8e6d3",1.3*e);r.position.set(10,10,10),r.width=40,r.height=40,r.lookAt(0,0,0),this.add(r),t&&this.add(new T.Z(r));let a=new o.AmbientLight("#f2f0dd",.8*e);this.add(a)}}function z(e){let{precision:t=3}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0,r=0,a=0;function i(){return"vec3(".concat(n.toFixed(t),", ").concat(r.toFixed(t),", ").concat(a.toFixed(t),")")}switch(typeof e){case"number":return n=(e>>16&255)/255,r=(e>>8&255)/255,a=(255&e)/255,i();case"string":if(e.startsWith("#")){if(4===e.length)return n=parseInt(e[1]+e[1],16)/255,r=parseInt(e[2]+e[2],16)/255,a=parseInt(e[3]+e[3],16)/255,i();return z(parseInt(e.slice(1),16),{precision:t})}throw Error("Invalid string: ".concat(e));case"object":if(Array.isArray(e))return[n,r,a]=e,i();if("r"in e)return n=e.r,r=e.g,a=e.b,i();if("x"in e)return n=e.x,r=e.y,a=e.z,i();throw Error("Invalid object: ".concat(e))}return"vec3(1.0, 0.0, 1.0)"}d.UM;let _="\n  ".concat(o.ShaderChunk.cube_uv_reflection_fragment,"\n  ").concat("\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex \n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20201014 (stegu)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+10.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r) {\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\n\n\n\n\n// 2D:\n\nvec3 mod289_2d(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289_2d(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute_2d(vec3 x) {\n  return mod289(((x*34.0)+10.0)*x);\n}\n\n\nfloat snoise(vec2 v) {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289_2d(i); // Avoid truncation effects in permutation\n  vec3 p = permute_2d( permute_2d( i.y + vec3(0.0, i1.y, 1.0 ))\n		+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\n// 3D: \n\nfloat snoise(vec3 v)\n{ \n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n  // First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n  // Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n  // Permutations\n  i = mod289(i); \n  vec4 p = permute( permute( permute( \n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n  // Gradients: 7x7 points over a square, mapped onto an octahedron.\n  // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n  //Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n  // Mix final noise value\n  vec4 m = max(0.5 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 105.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n                                dot(p2,x2), dot(p3,x3) ) );\n}\n","\n\n  varying vec3 vPosition;\n  varying vec3 vWorldNormal;\n\n  struct Plane {\n    vec3 origin;\n    vec3 normal;\n  };\n\n  float signedDistanceToPlane(Plane plane, vec3 p) {\n    return dot(plane.normal, p - plane.origin);\n  }\n\n  vec3 checker3(vec3 position, float scale, float edgeWidth, vec3 color1, vec3 color2) {\n    // Scale the position to control the size of the checker cubes\n    vec3 scaledPos = position / scale;\n\n    // Get the integer part (checker grid location)\n    vec3 checkerPos = floor(scaledPos);\n\n    // Get the fractional part (inside each cube)\n    vec3 fractPos = fract(scaledPos);\n\n    // Calculate the checkerboard pattern (even/odd cubes)\n    float checkerSum = mod(checkerPos.x + checkerPos.y + checkerPos.z, 2.0);\n\n    // Smooth transition using smoothstep on the fractional position\n    float edgeX = smoothstep(0.0, edgeWidth, fractPos.x);\n    float edgeY = smoothstep(0.0, edgeWidth, fractPos.y);\n    float edgeZ = smoothstep(0.0, edgeWidth, fractPos.z);\n\n    // Combine the edges to create a smooth transition\n    float blend = edgeX * edgeY * edgeZ;\n    blend = smoothstep(0.0, edgeWidth, min(min(fractPos.x, fractPos.y), fractPos.z));\n    \n    // Interpolate between black and white with the smoothstep value\n    vec3 baseColor = checkerSum == 0.0 ? color1 : color2;\n    vec3 oppositeColor = checkerSum == 0.0 ? color2 : color1;\n\n    // Use the smooth transition to blend between colors\n    return mix(baseColor, oppositeColor, blend);\n  }\n\n  float sphereGrid(vec3 position, float scale, float edgeWidth) {\n    // Scale the position to control the size of the checker cubes\n    vec3 scaledPos = position / scale;\n\n    // Get the integer part (checker grid location)\n    vec3 checkerPos = floor(scaledPos);\n\n    // Get the fractional part (inside each cube)\n    vec3 fractPos = fract(scaledPos);\n\n    vec3 p = fractPos - 0.5;\n    float alpha = 1.0 - length(p) * 2.0;\n\n    return smoothstep(0.0, edgeWidth, alpha - 0.1);    \n  }\n\n  void main() {\n    vec3 p = vWorldNormal * 0.33;\n    float n1 = snoise(p * 6.0 * 0.2 + 0.2);\n    float n2 = snoise(p * 20.0 + 10.1);\n    float n3 = snoise(p * 40.0 + 10.1);\n    float n4 = snoise(p * 1400.0 + 13.1);\n    float n = n1 * 0.5;\n    n += pow(fract((n1 + n2 * 0.015 + n3 * 0.01 + n4 * 0.005) * 85.0), 4.0) * 0.5;\n    n += pow(fract((n1 + n2 * 0.015) * 85.0), 4.0) * 0.25;\n    n += n4 * 0.2;\n    n += 0.8;\n    n = pow(n, 0.3);\n    float alpha = n;\n\n    gl_FragColor.rgb = mix(").concat(z(y.white),", ").concat(z(y.brightSkin),", alpha);\n    gl_FragColor.a = 1.0;\n\n    // float x = sphereGrid(vPosition, 1.0, 0.01);\n    // gl_FragColor.rgb = mix(").concat(z(y.black),", ").concat(z(y.brightSkin),", x);\n    // gl_FragColor.rgb = checker3(vPosition, 1.0, 0.1, ").concat(z(y.black),", ").concat(z(y.brightSkin),");\n  }\n");class A extends o.Mesh{constructor({debug:e=!1}={}){super(new o.IcosahedronGeometry(5.5,12),new o.ShaderMaterial({depthWrite:!1,side:o.BackSide,vertexShader:"\n  varying vec3 vWorldNormal;\n  varying vec3 vPosition;\n\n  vec3 rotate(mat4 m, vec3 v) {\n    return vec3(\n      dot(v, vec3(m[0][0], m[1][0], m[2][0])),  // X component\n      dot(v, vec3(m[0][1], m[1][1], m[2][1])),  // Y component\n      dot(v, vec3(m[0][2], m[1][2], m[2][2]))   // Z component\n    );\n  }\n\n  void main() {\n    vPosition = position;\n    vWorldNormal = normalize(rotate(modelMatrix, position));\n\n    // gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    // Ignore the position, we only need the normal:\n    gl_Position = projectionMatrix * vec4(rotate(modelViewMatrix, position), 1.0);\n  }\n",fragmentShader:_,uniforms:{}})),e&&(this.material=new o.MeshBasicMaterial({depthWrite:!1,color:"white",wireframe:!0})),this.onBeforeRender=(e,t,n,r,a,i)=>{this.position.copy(n.position)},this.renderOrder=-1,this.frustumCulled=!1,this.name="a-sky"}}var j=n(98828);class D extends o.Mesh{constructor(e){let{radius:t,...n}={...D.defaultProps,...e},r=new o.IcosahedronGeometry(t,18),a=new o.MeshPhysicalMaterial({});a.onBeforeCompile=e=>s.b.with(e).defines({USE_UV:""}).fragment.top(w).fragment.after("map_fragment","\n        vec2 p = vUv - 0.5;\n        float alpha = easeInOut(vUv.y, 1.6, 0.5);\n        Vec3Ramp r = ramp(alpha, ".concat((0,s.R)(y.black),", ").concat((0,s.R)(y.white),", ").concat((0,s.R)(y.yellow),");\n        diffuseColor.rgb = mix(r.a, r.b, easeInOut3(r.t));\n      ")),super(r,a),(0,l.N)(this,n)}}D.defaultProps={radius:1};class R{set(e){this.props={...this.props,...e},this.props.center=this.props.center.clone(),this.props.normal=this.props.normal.clone().normalize(),this.props.binormal=this.props.binormal.clone().normalize()}update(e){let{radius:t,turnVelocity:n,turn:r,center:a,normal:i,binormal:o}=this.props,s=r+n*e;this.props.turn=s,this.target.position.copy(a).addScaledVector(i,t*Math.cos(s*Math.PI*2)).addScaledVector(o,t*Math.sin(s*Math.PI*2))}constructor(e,t){this.target=e,this.set({...R.defaultProps,...t})}}R.defaultProps={center:new o.Vector3,normal:new o.Vector3(1,0,0),binormal:new o.Vector3(0,1,0),radius:1,turnVelocity:1,turn:0};class V extends o.Mesh{get satellite(){var e;return null!==(e=this._satellite)&&void 0!==e?e:this._satellite=new R(this)}constructor(e){let{radius:t,singleColor:n,emmissiveIntensity:r,lerpIn:a,lerpOut:i,...d}={...V.defaultProps,...e},{colorTop:u=null!=n?n:V.defaultProps.colorTop,colorBottom:h=null!=n?n:V.defaultProps.colorBottom}={...e},p=new o.IcosahedronGeometry(t,12),f=new o.MeshPhysicalMaterial({color:u,emissive:h});f.onBeforeCompile=e=>{s.b.with(e).defines({USE_UV:""}).uniforms({uLerpIn:{value:a},uLerpOut:{value:i},uColorTop:{value:new o.Color(u)},uColorBottom:{value:new o.Color(h)}}).fragment.top(c.i,j.U).fragment.mainBeforeAll("\n          float alpha = inverseLerp(uLerpIn, uLerpOut, vUv.y);\n          vec3 sphereColor = mix(uColorBottom, uColorTop, easeInOut3(alpha));\n        ").fragment.after("map_fragment","\n          diffuseColor.rgb = sphereColor;\n        ").fragment.after("emissivemap_fragment","\n          totalEmissiveRadiance.rgb = sphereColor * ".concat(r.toFixed(2),";\n        "))},super(p,f),this._satellite=null,(0,l.N)(this,d)}}V.defaultProps={radius:.225,singleColor:null,colorTop:y.white,colorBottom:y.yellow,emmissiveIntensity:.25,lerpIn:-.2,lerpOut:1.2};class k extends o.Mesh{constructor(e){let t=new o.IcosahedronGeometry(.4,12),n=new o.MeshPhysicalMaterial({});n.onBeforeCompile=e=>s.b.with(e).varying({vWorldPosition:"vec3",vNormalWorld:"vec3",vViewDir:"vec3"}).vertex.mainAfterAll("\n        vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n        vNormalWorld = normalize(mat3(modelMatrix) * normal);\n        vViewDir = normalize(cameraPosition - vWorldPosition);\n      ").fragment.top(c.i,"\n\nfloat contrast(float mValue, float mScale, float mMidPoint) {\n	// Why clamp? If necessary, it has to be done outside of this function.\n	// return clamp((mValue - mMidPoint) * mScale + mMidPoint, 0.0, 1.0);\n	return (mValue - mMidPoint) * mScale + mMidPoint;\n}\n\nfloat contrast(float mValue, float mScale) {\n	return contrast(mValue, mScale, 0.5);\n}\n\nvec3 contrast(vec3 mValue, float mScale, float mMidPoint) {\n	return vec3(contrast(mValue.r, mScale, mMidPoint), contrast(mValue.g, mScale, mMidPoint), contrast(mValue.b, mScale, mMidPoint));\n}\n\nvec3 contrast(vec3 mValue, float mScale) {\n	return contrast(mValue, mScale, 0.5);\n}\n\nfloat greyscaleFloat(vec3 color) {\n	return dot(color, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 greyscale(vec3 color) {\n    return vec3(greyscaleFloat(color));\n}\n\nvec3 greyscale(vec3 color, float alpha) {\n    return mix(color, greyscale(color), alpha);\n}\n\n").fragment.after("map_fragment","\n        float fresnel = dot(vNormalWorld, vViewDir);\n        vec3 inner = ".concat((0,s.R)(y.white),";\n        vec3 outer = ").concat((0,s.R)(y.black),";\n        float alpha = easeInOut(1.0 - pow(fresnel, 1.5), 2.0, 0.0);\n        diffuseColor.rgb = mix(inner, outer, alpha);\n      ")).fragment.mainAfterAll("\n        // Final tuning\n        gl_FragColor.rgb = mix(contrast(greyscale(gl_FragColor.rgb), 1.5), diffuseColor.rgb, alpha);\n      "),super(t,n),(0,l.N)(this,e)}}class B extends o.Mesh{constructor(e){let{color:t,thickness:n,length:r,shaded:a,...i}={...B.defaultProps,...e};super(new o.CylinderGeometry(n/2,n/2,r,12,1).rotateZ(.5*Math.PI),a?new o.MeshPhysicalMaterial({color:t}):new o.MeshBasicMaterial({color:t})),(0,l.N)(this,i)}}function N(e,t){return t.add(e),e}function*I(e,t){let n=yield*function*(e){let{ticker:t,scene:n}=e;t.set({activeDuration:h.v.development?3:180}),m("https://threejs.org/examples/textures/equirectangular/royal_esplanade_1k.hdr").then(t=>{new o.PMREMGenerator(e.renderer).fromEquirectangular(t).texture});let r=new o.Group;return n.add(r),yield()=>{r.removeFromParent()},r}(e);if(1===t.renderCount){let{camera:t}=e;t.fov=e.aspect>1?25:2*Math.atan(Math.tan(25*Math.PI/180/2)/e.aspect)*180/Math.PI,t.far=1e3,t.updateProjectionMatrix(),t.position.set(0,0,10)}n.add(new A),n.add(new C);let r=N(new D,n);n.add(new P({z:-1,radius:1.4,innerRadiusRatio:.805})),n.add(new S({z:-1,radius:.75,thickness:.01,color:y.yellow,emissiveIntensity:1})),n.add(new S({z:-1,radius:.8,thickness:.01,color:y.notSoWhite})),u.T.seed(6789402);let a=u.T.createPicker([[1,4],[2,2],[4,1]]);for(let{i:t}of function*(e){let t=0,n={get i(){return t},get t(){return t/8},get count(){return 8}};for(;t<8;t++)yield n}(8)){let r=u.T.pick(y),i=u.T.pick(y),s=new V({z:-1,radius:.1*a(),colorTop:r,colorBottom:i});s.rotation.set(u.T.between(2*Math.PI),u.T.between(2*Math.PI),u.T.between(2*Math.PI)),n.add(s),s.satellite.set({radius:0===t?.875:u.T.between(.25,.75)*(0,d.t7)(1,1.5,t),center:new o.Vector3(0,0,-1-.4*t),turnVelocity:u.T.between(.05,.25)}),yield e.ticker.onTick(e=>{s.satellite.update(e.deltaTime)})}let i=new o.Group;i.rotation.z=-.25*Math.PI,n.add(i),i.add(new V({x:-1.5,z:.5,singleColor:y.yellow})),i.add(new S({x:-1.81,radius:.1,thickness:.01,color:y.notSoWhite}));let s=N(new S({x:-2.315,radius:.2,thickness:.01,color:y.notSoWhite}),i);N(new B({x:-.2,thickness:.01,length:.4,shaded:!0,color:y.notSoWhite}),s),i.add(new V({x:1.7,z:.5,lerpIn:0,lerpOut:1})),i.add(new V({x:1.4,radius:.1,singleColor:y.black}));let c=N(new k({x:2.3}),i);N(new S({radius:.43,thickness:.015,color:y.black}),c),i.add(new B({x:1.5,thickness:.015,color:y.black}));let p=new o.Group;p.rotation.z=.25*Math.PI,n.add(p),p.add(new B({x:-1.6,thickness:.01,length:.35,shaded:!0,color:y.notSoWhite})),p.add(new B({x:1.6,thickness:.01,length:.35,shaded:!0,color:y.notSoWhite}));let f=new o.Group;f.rotation.y=.5*Math.PI,n.add(f),f.add(new B({x:-1.2,thickness:.01,length:.35,shaded:!0,color:y.notSoWhite})),f.add(new B({x:1.2,thickness:.01,length:.35,shaded:!0,color:y.notSoWhite})),(function(e){let t=e.split(".").pop();switch(t){case"hdr":return m(e);case"exr":return new Promise(t=>{v.load(e,e=>{t(e)})});default:return Promise.reject("Unsupported texture format: ".concat(t))}})("https://threejs.org/examples/textures/piz_compressed.exr").then(e=>{e.mapping=o.EquirectangularReflectionMapping,c.material.envMap=e,c.material.envMapIntensity=.25,c.material.envMapRotation.set(-.1*Math.PI,Math.PI,0),c.material.roughness=.3,c.material.metalness=.5,c.material.needsUpdate=!0,r.material.envMap=e,r.material.roughness=.2,r.material.envMapIntensity=.5,r.material.envMapRotation.set(-.1*Math.PI,Math.PI,0),r.material.needsUpdate=!0});let x=N(new o.Group,n);x.rotation.z=.25*Math.PI;class g extends o.Group{constructor(e){super();{let e=new o.CylinderGeometry(15,15,5,6,1,!0).rotateY(Math.PI/6),t=new o.MeshPhysicalMaterial({color:new o.Color("white").lerp(y.black,.995),side:o.BackSide,flatShading:!0});N(new o.Mesh(e,t),this)}{let e=new o.CylinderGeometry(15,15,5,6,60,!0).rotateY(Math.PI/6),t=new o.MeshPhysicalMaterial({color:y.black,wireframe:!0,flatShading:!0,side:o.BackSide});N(new o.Mesh(e,t),this)}(0,l.N)(this,e)}}N(new g({y:7.8}),x),N(new g({y:-7.8}),x)}function U(){return(0,r.jsx)("div",{className:"absolute-through",children:(0,r.jsx)(a.V,{className:"bg-[#ddd]",children:(0,r.jsx)(i.hR,{children:(0,r.jsx)(i.kB,{fn:I})})})})}B.defaultProps={color:y.black,thickness:.01,shaded:!1,length:1}},90663:function(e,t,n){"use strict";n.d(t,{Main:function(){return D}});var r=n(78485),a=n(86818),i=n(52471),o=n(74831),s=n(81796);let l=new i.LineBasicMaterial({color:"white",transparent:!0,depthTest:!1}),c={circle:(()=>{let e=new i.BufferGeometry,t=Array.from({length:81},(e,t)=>{let n=t/80*Math.PI*2;return new i.Vector3(Math.cos(n),Math.sin(n),0)});return e.setFromPoints(t),e})(),box2:(()=>{let e=new i.BufferGeometry,t=[new i.Vector3(-.5,-.5,0),new i.Vector3(.5,-.5,0),new i.Vector3(.5,.5,0),new i.Vector3(-.5,.5,0),new i.Vector3(-.5,-.5,0)];return e.setFromPoints(t),e})()};class d extends i.Group{setupUniforms(e,t){let{value:n}=e,{value:r}=t;n.copy(this.matrixWorld),n.invert()}init(e){this.props=e,this.renderOrder=1}setup(){}set(e){Object.assign(this.props,e),this.setup()}}let u={radius:2,falloff:1};class h extends d{get radius(){return this.props.radius}set radius(e){this.props.radius=e,this.setup()}get falloff(){return this.props.falloff}set falloff(e){this.props.falloff=e,this.setup()}setupUniforms(e,t){super.setupUniforms(e,t);let{radius:n,falloff:r}=this.props;t.value.set(n,r,0,0)}setup(){let{circle0:e,circle1:t}=this.parts,{radius:n,falloff:r}=this.props;e.scale.setScalar(n),t.scale.setScalar(n+r)}constructor(e){super(),this.parts={circle0:new i.Line(c.circle,l),circle1:new i.Line(c.circle,l)},this.init({...u,...e}),this.add(this.parts.circle0),this.add(this.parts.circle1),this.setup()}}h.glsl="\n    struct CircleFalloff {\n      mat4 matrix;\n      float radius;\n      float falloff;\n    };\n    float falloff(CircleFalloff falloff, vec3 p) {\n      p = (falloff.matrix * vec4(p, 1.0)).xyz;\n      float d = length(p);\n      return 1.0 - (d - falloff.radius) / falloff.falloff;\n    }\n  ";let p={width:1,height:1,falloff:1};class f extends d{setupUniforms(e,t){super.setupUniforms(e,t);let{width:n,height:r,falloff:a}=this.props;t.value.set(n,r,a,0)}setup(){let{box0:e,box1:t}=this.parts,{width:n,height:r,falloff:a}=this.props;e.scale.set(n,r,1),t.scale.set(n+2*a,r+2*a,1)}constructor(e){super(),this.parts={box0:new i.Line(c.box2,l),box1:new i.Line(c.box2,l)},this.init({...p,...e}),this.add(this.parts.box0),this.add(this.parts.box1),this.setup()}}f.glsl="\n    struct ManhattanBox2Falloff {\n      mat4 matrix;\n      float width;\n      float height;\n      float falloff;\n    };\n    float falloff(ManhattanBox2Falloff falloff, vec3 p) {\n      p = (falloff.matrix * vec4(p, 1.0)).xyz;\n      float x = abs(p.x) - falloff.width * 0.5;\n      float y = abs(p.y) - falloff.height * 0.5;\n      return 1.0 - max(x, y) / falloff.falloff;\n    }\n  ";var m=n(47174),v=n(49635),x=n(87858),g=n(58152),w=n(1060),y=n(98828),b=n(16573),M=n(77405);function S(e){let{r:t,g:n,b:r}=new i.Color(e);return"vec3(".concat(t.toFixed(3),", ").concat(n.toFixed(3),", ").concat(r.toFixed(3),")")}let P={grid:[16,16]},T=new i.PlaneGeometry(1,1,1,1),C=new i.MeshBasicMaterial({side:i.DoubleSide,transparent:!0}),z={uRadiusScalar:new i.Uniform(.9),uCircleMat:new i.Uniform(new i.Matrix4().identity()),uCircleProps:new i.Uniform(new i.Vector4(1,2,0,0)),uBox0Mat:new i.Uniform(new i.Matrix4().identity()),uBox0Props:new i.Uniform(new i.Vector4(1,1,0,0))};C.onBeforeCompile=e=>m.b.with(e).defines({USE_UV:""}).uniforms(z).varying({vCenter:"vec3",vWorldPosition2:"vec3"}).vertex.mainAfterAll("\n    vWorldPosition2 = (modelMatrix * instanceMatrix * vec4(transformed, 1.0)).xyz;\n    vCenter = (modelMatrix * instanceMatrix[3]).xyz;\n  ").fragment.top(y.U,g.g,w.i).fragment.top(h.glsl,f.glsl).fragment.after("color_fragment","\n    CircleFalloff circle = CircleFalloff(uCircleMat, uCircleProps.x, uCircleProps.y);\n    ManhattanBox2Falloff box = ManhattanBox2Falloff(uBox0Mat, uBox0Props.x, uBox0Props.y, uBox0Props.z);\n    float d = 0.0;\n    d += clamp01(falloff(box, vWorldPosition2));\n    d += clamp01(falloff(circle, vWorldPosition2));\n    diffuseColor.rgb = mix(".concat(S("#c2e1ff"),", ").concat(S("#d80773"),", easeInOut3(clamp01(d)));\n  ")).fragment.after("alphamap_fragment","\n    float scalar = 1.0 / uRadiusScalar / mix(1.0, 0.25, easeInOut3(clamp01(d)));\n    float alpha = smoothstep(1.0, 0.99, length(vUv - 0.5) * scalar / 0.5);\n\n    if (alpha < 0.01) discard;\n\n    diffuseColor.a *= alpha;\n  ");class _ extends i.InstancedMesh{onTick(e){for(let e of Object.values(this.falloffs))e.visible=this.falloffsAreVisible;let{box0:t,circle:n}=this.falloffs;n.falloff=(0,M.t7)(.1,4,e.sin01Time({frequency:.15})),n.radius=(0,M.t7)(1,5,e.sin01Time({frequency:.1,phase:.5})),n.setupUniforms(z.uCircleMat,z.uCircleProps),t.rotation.z+=.1*e.deltaTime,t.set({width:8,falloff:(0,M.t7)(.5,6,e.sin01Time({frequency:.15}))}),t.setupUniforms(z.uBox0Mat,z.uBox0Props)}constructor(e){var t;let{x:n,y:r}=(0,s.iK)(null!==(t=null==e?void 0:e.grid)&&void 0!==t?t:P.grid);for(let t of(super(T,C,n*r),this.internal={grid:new i.Vector2},this.falloffsAreVisible=!0,this.falloffs={circle:(0,x.cY)(new h,{parent:this,position:[-3,-2,0]}),box0:(0,x.cY)(new f({}),{parent:this,position:[3,2,0]})},this.props={...P,...e},(0,b.B)(n,r)))this.setMatrixAt(t.i,(0,v.$)({x:t.x-n/2,y:t.y-r/2}))}}function*A(e){e.scene.background=new i.Color("#1c54e0"),e.ticker.set({activeDuration:30}),e.useOrbitControls();let t=new _;e.scene.add(t),yield()=>t.removeFromParent(),yield(0,o.w)(document.body,{onTap(){t.falloffsAreVisible=!t.falloffsAreVisible}})}function j(){return(0,a.Ky)(A),null}function D(){return(0,r.jsx)("div",{className:"absolute-through",children:(0,r.jsx)(a.H7,{children:(0,r.jsx)(j,{})})})}},79841:function(e,t,n){"use strict";n.d(t,{Main:function(){return y}});var r=n(78485),a=n(494),i=n(9710),o=n(8834),s=n(52471),l=n(63549),c=n(87858),d=n(27275),u=n(48583),h=n(48181);n(94588);let p=(0,d.createContext)(null);function f(e,t){let n=(0,d.useContext)(p);return(0,u.sv)(async function*(t,r){if(e){let t=e(n,r);if(t&&"function"==typeof t.next)do{let{value:e,done:n}=await t.next();if(n)break;yield e}while(r.mounted)}},null!=t?t:"always"),n}let m={className:"",assetsPath:"/"};function v(e){let{children:t,className:n,assetsPath:a}={...m,...e},i=(0,d.useMemo)(()=>new h.Vu,[]);i.loader.setPath(a);let{ref:o}=(0,u.Nv)({debounce:!0},function*(e,t){yield i.initialize(e),t.triggerRender(),Object.assign(window,{three:i})},[]);return(0,r.jsx)("div",{ref:o,className:n,style:{position:"absolute",inset:0},children:(0,r.jsx)(p.Provider,{value:i,children:i.initialized&&t})})}function x(e){return function(){let[e,t]=(0,d.useState)(!1);return(0,d.useLayoutEffect)(()=>{t(!0)},[]),e}()&&(0,r.jsx)(v,{...e})}function g(){return!function(e,t,n){let r=(0,d.useMemo)(()=>new s.Group,[]);r.name=e,f(async function*(e,n){if(e.scene.add(r),yield()=>{r.clear(),r.removeFromParent()},t){let a=t(r,e,n);if(a&&"function"==typeof a.next)do{let{value:e,done:t}=await a.next();if(t)break;yield e}while(n.mounted)}},n)}("fractal-grid",function*(e){(0,c.cY)(new s.Mesh(new s.TorusKnotGeometry(1,.333,512,32),new l.P({color:"#0cf"})),e)},[]),null}function w(){return f(function*(e){(0,o.a)({three:e});let t=new a.F({size:6});yield t.initialize(e.renderer.domElement),yield(0,i.RC)("three",n=>{let{aspect:r,camera:a}=e;t.update(a,r,n.deltaTime)})},[]),null}function y(){return(0,r.jsx)("div",{className:"FractalGrid",children:(0,r.jsxs)(x,{children:[(0,r.jsx)("h1",{children:"FractalGrid"}),(0,r.jsx)(w,{}),(0,r.jsx)(g,{})]})})}},31283:function(e,t,n){"use strict";n.d(t,{Main:function(){return F}});var r=n(78485),a=n(52471),i=n(86818),o=n(37457),s=n(74831),l=n(494),c=n(9710),d=n(96966),u=n(8834);function h(){return(0,i.Ky)(function*(e){Object.assign(window,{three:e,Ticker:c.vB})},[]),null}var p=n(31454),f=n(87858),m=n(88156),v=n(47174),x=n(1060),g=n(98828),w=n(77405),y=n(28142),b=JSON.parse('[{"phi":1.7045171372513754,"theta":0.9426432714835036},{"phi":1.2138204764190186,"theta":0.5877279735536564},{"phi":2.018280663352346,"theta":0.4225774045053551},{"phi":1.58623960126316,"theta":0.11530620356664824},{"phi":1.4858931296682674,"theta":0.09988610745985425},{"phi":1.370250993061531,"theta":-0.6152078487213142},{"phi":0.9459811008591165,"theta":-0.4116473816238604},{"phi":1.06660504904375,"theta":-0.22199053344895067},{"phi":2.675243191552906,"theta":-0.6045343364962831},{"phi":2.5901332086293296,"theta":-0.45113353839646375},{"phi":3.0820510158643644,"theta":-0.20059237206688585},{"phi":2.920796326794876,"theta":-0.3506750512589778},{"phi":2.707382312980871,"theta":0.025009035614594027},{"phi":-2.771515207166003,"theta":0.43045560632597474},{"phi":-3.068326429226437,"theta":0.6129817652939101},{"phi":3.1105233820660763,"theta":0.7241618779795415},{"phi":-2.5251632895865317,"theta":0.6535499652931851},{"phi":-3.015091410598426,"theta":0.8642317265005449},{"phi":3.0788690924417255,"theta":0.8159956971859744},{"phi":-2.370767607902747,"theta":0.787316008336757},{"phi":-2.5030942996270586,"theta":0.7163689975296974},{"phi":-0.28189011450089596,"theta":0.6816391217572154},{"phi":-0.2988148637926313,"theta":0.5717768908896973},{"phi":-0.1772652581758269,"theta":0.4716751222011235},{"phi":-0.05544012907477782,"theta":-0.028486000516249495},{"phi":-0.06314162733968252,"theta":0.061655565733329316},{"phi":-0.8760666510861576,"theta":-0.6838346154783156},{"phi":-0.7161612255722236,"theta":-0.11386479380967202},{"phi":-0.5032773150049611,"theta":-0.5860256589964206},{"phi":1.7599491315598337,"theta":1.0140201131361222},{"phi":1.555598726738203,"theta":1.0275620052067571},{"phi":1.5867188262212921,"theta":1.091601234052012},{"phi":1.5622775626534053,"theta":1.1451634884556725},{"phi":1.8064000451323763,"theta":0.8291516658764525},{"phi":1.7711742769485577,"theta":0.8002332318072503},{"phi":1.5274585527636149,"theta":0.838434437058171},{"phi":1.3559514207428152,"theta":0.7754675571543634},{"phi":1.1792807716216012,"theta":0.7682476175679409},{"phi":1.3076110196152615,"theta":0.9387650274681301},{"phi":1.4565810952604292,"theta":1.0264229286514035}]');let M=new a.TextureLoader;function S(){let{theta:e=0,phi:t=0,radius:n=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;return null!=r||(r=new a.Vector3),r.x=n*Math.cos(e)*Math.cos(t),r.y=n*Math.sin(e),r.z=n*Math.cos(e)*Math.sin(t),r}class P extends a.Line{constructor(e,{color:t="white"}={}){let n=new a.BufferGeometry().setFromPoints(e),r=new a.LineDashedMaterial({color:t}),i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:512,t=new Uint8Array(4*e),n=0;for(;n<e;){let r=y.T.int(10,20);n+r>e&&(r=e-n);for(let e=0;e<r;e++)t[4*(n+e)]=255;n+=r+y.T.int(1,80)}for(let n=0;n<e;n+=2)t[4*n+1]=255;let r=new a.DataTexture(t,e,1,a.RGBAFormat);return r.minFilter=r.magFilter=a.NearestFilter,r.wrapS=r.wrapT=a.RepeatWrapping,r.needsUpdate=!0,r}(),o={uTime:c.vB.get("three").uTime,uTextureLengthRatio:{value:40},uScale:{value:1},uTexture:{value:i},uLineLength:{value:-1}};r.onBeforeCompile=e=>v.b.with(e).uniforms(o).varying({vWorldPosition2:"vec3"}).vertex.mainAfterAll("\n        vWorldPosition2 = (modelMatrix * vec4(position, 1.0)).xyz;\n      ").fragment.top("\n        float hash(vec3 p) {\n          // Combine the components of the vec3 using dot products\n          vec3 k = vec3(127.1, 311.7, 74.7); // Large primes to create randomness\n          return fract(sin(dot(p, k)) * 43758.5453123); // Sine and fract create pseudo-randomness\n        }\n      ").fragment.replace(/if .* {\s*discard;\s*}/,"\n        float alpha = vLineDistance / uLineLength;\n        alpha = pow(alpha, 1.0 / 2.0);\n        float x = mod(uLineLength * alpha / uTextureLengthRatio + uTime * -0.05, 1.0);\n        vec4 texel = texture2D(uTexture, vec2(x, 0.5));\n        float outHash = fract(hash(vWorldPosition2) + uTime * 10.0) + mix(5.0, -1.0, alpha);\n        if (texel.r * outHash < 0.5) {\n          discard;\n        }\n      "),super(n,r),this.computeLineDistances(),o.uLineLength.value=this.geometry.attributes.lineDistance.array.at(-1)}}class T extends a.Group{constructor(e,{pointsPerCurve:t=80,curveSubdivisions:n=256}={}){super();let r=e.length*t,i=new a.BufferGeometry,o=new Float32Array(3*r);i.setAttribute("position",new a.BufferAttribute(o,3));let s=new Float32Array(4*r);y.T.seed(987632);for(let e=0;e<s.length;e++)s[e]=y.T.random();i.setAttribute("random",new a.BufferAttribute(s,4));let l=new Float32Array(e.length*n*4),d=new Float32Array(e.length*n*4);for(let r=0;r<e.length;r++){for(let e=0;e<t;e++){let n=r*t+e;o[3*n]=e,o[3*n+1]=r,o[3*n+2]=0}let a=e[r].nurbsCurve;if(!a)throw Error("NURBS curve not set.");for(let e=0;e<n;e++){let t=e/n,i=a.getPoint(t),o=a.getTangent(t),s=r*n+e;l[4*s]=i.x,l[4*s+1]=i.y,l[4*s+2]=i.z,d[4*s]=o.x,d[4*s+1]=o.y,d[4*s+2]=o.z}}let u=t=>{let r=new a.DataTexture(t,n,e.length,a.RGBAFormat,a.FloatType,a.UVMapping,a.ClampToEdgeWrapping,a.ClampToEdgeWrapping,a.NearestFilter,a.NearestFilter);return r.generateMipmaps=!1,r.needsUpdate=!0,r},h=u(l),p=u(d);y.T.seed(5678492);let f={uTime:c.vB.get("three").uTime,uPointsPerCurve:{value:t},uCurvesMapSize:{value:new a.Vector2(n,e.length)},uCurvesPositionMap:{value:h},uCurvesTangentMap:{value:p},uColors:{value:e.map(e=>e.color)},uCurveRandom:{value:e.map(()=>y.T.random())},uMaskMaps:{value:[M.load("textures/rounded-square.png"),M.load("textures/rounded-plus.png"),M.load("textures/rounded-rhomb.png")]}},m=new a.PointsMaterial({vertexColors:!0,size:.5});m.onBeforeCompile=e=>v.b.with(e).uniforms(f).varying({vRandom:"vec4"}).vertex.top(x.i).vertex.top("\n        attribute vec4 random;\n      ").vertex.replace("begin_vertex","\n        int j = gl_VertexID / int(uPointsPerCurve);\n        int i = gl_VertexID - j * int(uPointsPerCurve);\n        float r = uCurveRandom[j]; // Curve random value\n\n        vColor = uColors[j] * mix(0.8, 1.2, random.x);\n\n        float curveFraction = 0.2;\n        float curveSpeed = 0.0125;\n        float curveInnerSpeed = 0.05;\n\n        float t3 = fract(position.x / uPointsPerCurve + uTime * curveInnerSpeed);\n        float t0 = fract(curveFraction * t3 + r + uTime * curveSpeed);\n        t0 = easeIn2(t0);\n\n        float x = t0;\n        float y = position.y / uCurvesMapSize.y;\n        float xMax = uCurvesMapSize.x - 1.0; // one less because of linear interpolation (x0 -> x1)\n        float xT = fract(x * xMax);\n        float x0 = floor(x * xMax) / xMax;\n        float x1 = floor(x * xMax + 1.0) / xMax;\n        \n        vec3 p0 = texture(uCurvesPositionMap, vec2(x0, y)).xyz;\n        vec3 p1 = texture(uCurvesPositionMap, vec2(x1, y)).xyz;\n        vec3 p = mix(p0, p1, xT);\n\n        vec3 tangent0 = texture(uCurvesTangentMap, vec2(x0, y)).xyz;\n        vec3 tangent1 = texture(uCurvesTangentMap, vec2(x1, y)).xyz;\n        vec3 tangent = mix(tangent0, tangent1, xT);\n\n        vec3 normal = normalize(cross(tangent, vec3(0.0, 1.0, 0.0)));\n        vec3 binormal = normalize(cross(normal, tangent));\n\n        float t1 = sin(random.x * PI2 + uTime * mix(0.5, 1.0, random.z));\n        float t2 = sin(random.y * PI2 + uTime * mix(0.5, 1.0, random.w));\n        float dispersion = mix(0.005, 0.2, easeOut8(t0));\n        vec3 transformed = p \n          + normal * (random.z - 0.5) * dispersion * t1 \n          + binormal * (random.w - 0.5) * dispersion * t2;\n      ").vertex.mainAfterAll("\n        gl_PointSize *= mix(0.2, 1.0, easeInThenOut(t0, 16.0))\n          * mix(0.25, 1.0, easeInThenOut(t3, 6.0))\n          * mix(0.25, 1.0, random.z);\n\n        vRandom = random;\n      ").fragment.mainAfterAll("\n        if (vRandom.x < 0.5) {\n          if (texture2D(uMaskMaps[0], gl_PointCoord).r < 0.5) discard;\n        } else if (vRandom.y < 0.2) {\n          if (texture2D(uMaskMaps[1], gl_PointCoord).r < 0.5) discard;\n        } else {\n          if (texture2D(uMaskMaps[2], gl_PointCoord).r < 0.5) discard;\n        }\n      ");let g=new a.Points(i,m);this.add(g)}}var C=n(25628),z=n(81796);class _ extends a.Group{setControlPoints(e){let{curveSubdivisions:t=512}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{degree:n,color:r}=this,i=e.map(e=>e instanceof a.Vector3?new a.Vector4(e.x,e.y,e.z,1):e),o=[],s=i.length;for(let e=0;e<=n;e++)o.push(0);for(let e=1;e<=s-n;e++)o.push(e);for(let e=0;e<n;e++)o.push(s-n);let l=new C.e(n,o,i),c=l.getSpacedPoints(t),d=new a.BufferGeometry().setFromPoints(c),u=new a.Line(d,new a.LineBasicMaterial({color:r}));this.add(u);let h=new a.InstancedMesh(_.instancedGeometry,new a.MeshBasicMaterial({color:r}),i.length);this.add(h);let p=new a.Matrix4;for(let[e,t]of i.entries()){let{x:n,y:r,z:a,w:i}=t;h.setMatrixAt(e,(0,z.Xe)({x:n,y:r,z:a,scaleScalar:i},p))}this.controlPoints=i,this.nurbsCurve=l,this.points=c}constructor(...e){super(...e),this.degree=8,this.color=new a.Color(16711680),this.nurbsCurve=null,this.controlPoints=[],this.points=[]}}_.instancedGeometry=new a.IcosahedronGeometry(.005,12);let A=["#3366ff","#009a27","#00943b","#2512cf","#bb1d81","#67cd6c","#fed801","#ff1f02"];class j extends a.Group{addSpot(e,t){let{x:n,y:r,z:a}=e,{matrix:i,color:o}=j.shared;this.instancedMesh.setMatrixAt(this.index,i.makeTranslation(n,r,a)),this.instancedMesh.setColorAt(this.index,o.set(t)),this.index++}constructor({sizeBase:e=400}={}){super(),this.index=0;let{geometry:t,material:n,matrix:r,color:i}=j.shared;this.instancedMesh=new a.InstancedMesh(t,n,e),this.add(this.instancedMesh),r.makeScale(0,0,0),i.set("white");for(let t=0;t<e;t++)this.instancedMesh.setMatrixAt(t,r),this.instancedMesh.setColorAt(t,i)}}j.shared={geometry:new a.IcosahedronGeometry(.005,12),material:new a.MeshBasicMaterial,matrix:new a.Matrix4().makeScale(0,0,0),color:new a.Color("white")};class D extends a.Group{onTick(e){}earthRaycast(e){var t;let n=e.clone().applyMatrix4(this.matrixWorld.clone().invert()).intersectSphere(new a.Sphere(new a.Vector3,1),new a.Vector3);return null!==(t=null==n?void 0:n.applyMatrix4(this.matrixWorld))&&void 0!==t?t:null}addSphericalSpot(e){let{phi:t,theta:n,color:r="white"}=e;this.parts.miniSpots.addSpot(S({phi:t,theta:n,radius:1}),r);let a=new _;a.degree=8,a.color.set(r);let i=[S({phi:t,theta:n,radius:1})],o=n,s=t;for(let e=0;e<12;e++){let t=(0,w.t7)(2,5,e/12);i.push(S({theta:o,phi:s,radius:t})),o=(0,w.t7)(o,0,.5),s+=-.65}return a.setControlPoints(i),a}constructor(){super(),this.uniforms={uTime:c.vB.get("three").uTime,uSpherize:{value:1},uSunPosition:{value:new a.Vector3(.5,.7,.3)},uSide:{value:0}},this.userData=function(e,t){for(let[n,r]of Object.entries(t)){let[t,a="value"]=r.bind;Object.defineProperty(e,n,{enumerable:!0,get:()=>t[a],set:e=>t[a]=e}),r.meta&&Object.defineProperty(e,"".concat(n,"_meta"),{enumerable:!0,get:()=>r.meta})}return e}({},{spherize:{bind:[this.uniforms.uSpherize,"value"],meta:"Slider(0, 1)"}}),this.parts={miniSpots:new j,back:null,front:null},this.sphericalSpots=[];let e=M.load("images/blank-world-map-alt.png"),{uniforms:t}=this,n=new a.MeshBasicMaterial({map:e,transparent:!0,side:a.DoubleSide,depthWrite:!1});n.onBeforeCompile=e=>v.b.with(e).uniforms(t).varying({vWorldNormal:"vec3",vWorldPosition2:"vec3"}).vertex.replace("begin_vertex","\n        float tx = position.x;\n        float ty = position.y;\n\n        vec3 transformed;\n        vec3 normal;\n        if (uSpherize < 0.001) {\n          transformed = vec3(tx * 2.0, ty, 0.0) * PI;\n          normal = vec3(0.0, 0.0, 1.0);\n        } else {\n          float r = 1.0 / uSpherize;\n          float phi = tx * PI * 2.0 * uSpherize - PI * 0.5;\n          float theta = ty * PI * uSpherize;\n          float x = cos(theta) * cos(phi);\n          float z = cos(theta) * -sin(phi);\n          float y = sin(theta);\n          transformed = vec3(x, y, z - 1.0) * r + vec3(0.0, 0.0, uSpherize);\n          normal = vec3(x, y, z);\n        }\n        vWorldNormal = normalize(mat3(modelMatrix) * normal);\n        vWorldPosition2 = (modelMatrix * vec4(transformed, 1.0)).xyz;\n      ").vertex.mainAfterAll("\n      ").fragment.top(g.U,x.i).fragment.mainBeforeAll("\n        vec3 lightDirection = normalize(uSunPosition);\n        float light = dot(vWorldNormal, lightDirection) * 0.5 + 0.5;\n        light = pow(light, 2.0);\n\n        vec3 viewDir = normalize(cameraPosition - vWorldPosition2);\n        float cosTheta = dot(normalize(vWorldNormal * uSide), viewDir);\n        float fresnelBias = 0.1;\n        float fresnelPower = 3.0;\n        float fresnel = fresnelBias + (1.0 - fresnelBias) * pow(1.0 - cosTheta, fresnelPower);\n      ").fragment.replace("map_fragment","\n        #ifdef USE_MAP\n          vec2 uv = vMapUv;\n          float r = uv.y * 2.0;\n          if (r > 1.0) r = 2.0 - r;\n          r = 1.0 - r;          \n\n          float a = 0.0;\n          a += pow(r, 2.4) * 0.205;\n          a += pow(r, 10.0) * 0.03;\n          float x = uv.x;\n          \n          float padding = 0.005;\n          uv.x = mix(padding + a, 1.0 - padding - a, x);\n          // uv.x = 1.0 - uv.x;\n          vec4 sampledDiffuseColor = texture2D(map, uv);\n\n          diffuseColor.rgb *= vec3(mix(0.75, 1.0, light));\n          float alpha = (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) > 0.1 ? 1.0 : 0.0;\n          diffuseColor.a *= alpha + fresnel * 1.2;\n          // diffuseColor.rgb = vec3(fresnel);\n          // diffuseColor.rgb = vWorldNormal;\n          // diffuseColor.a = 1.0;\n        #endif\n      ");let r=new a.PlaneGeometry(1,1,256,128);(0,f.cY)(this,{name:"earth"});let i=(0,f.cY)(new a.Mesh(r,n),{parent:this,name:"back"});i.onBeforeRender=()=>{t.uSide.value=-1,n.color.set("#cdcdcd"),n.side=a.BackSide,n.needsUpdate=!0},this.parts.back=i;let o=(0,f.cY)(new a.Mesh(r,n),{parent:this,name:"front"});o.onBeforeRender=()=>{t.uSide.value=1,n.color.set("#ffffff"),n.side=a.FrontSide,n.needsUpdate=!0},this.parts.front=o,(0,f.cY)(new a.Mesh(new a.PlaneGeometry,n),{parent:this,y:-1.5,scaleX:3,visible:!1}),(0,f.cY)(new m.O,{parent:this}).circle({radius:1.04}).draw(),y.T.seed(123);let s=[...b.map(e=>this.addSphericalSpot({...e,color:y.T.pick(A)})),...b.filter(()=>y.T.chance(.8)).map(e=>{let{phi:t,theta:n}=e;return t+=.04*y.T.around(),n+=.04*y.T.around(),this.addSphericalSpot({phi:t,theta:n,color:y.T.pick(A)})})];this.add(...s.map(e=>new P(e.points,{color:e.color})));let l=new T(s);this.add(l),this.add(this.parts.miniSpots)}}D.sphericalCoordinates={paris:{theta:.9426432714835036,phi:1.7045171372513754}};class R extends a.Mesh{constructor(){let e=new a.MeshBasicMaterial({color:"#cccccc",side:a.BackSide}),t={uResolution:{value:new a.Vector2}};e.onBeforeCompile=e=>v.b.with(e).uniforms(t).fragment.replace("map_fragment","\n        vec2 p = gl_FragCoord.xy / uResolution * 2.0 - 1.0;\n        float aspect = uResolution.x / uResolution.y;\n        p *= aspect > 1.0 ? vec2(1.0, 1.0 / aspect) : vec2(aspect, 1.0);\n        float alpha = 1.0 - length(p);\n        diffuseColor.rgb *= mix(0.8, 1.4, alpha);\n      "),super(new a.IcosahedronGeometry(40,12),e),this.onBeforeRender=e=>{e.getSize(t.uResolution.value).multiplyScalar(e.getPixelRatio())}}}class V extends a.Points{constructor(e=5e3){let t=new a.BufferGeometry,n=new Float32Array(3*e),r=new Float32Array(e),i=new a.Vector3;for(let t=0;t<e;t++)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new a.Vector3,t=2*Math.random()*Math.PI,n=Math.acos(2*Math.random()-1);return e.x=Math.sin(n)*Math.cos(t),e.y=Math.sin(n)*Math.sin(t),e.z=Math.cos(n),e})(i).multiplyScalar(36).toArray(n,3*t),r[t]=y.T.between(.2,.5);t.setAttribute("position",new a.Float32BufferAttribute(n,3)),t.setAttribute("instanceSize",new a.Float32BufferAttribute(r,1));let o=new a.PointsMaterial({color:"#ffffff"});o.onBeforeCompile=e=>v.b.with(e).vertex.top("\n        attribute float instanceSize;\n      ").vertex.mainAfterAll("\n        gl_PointSize *= instanceSize;\n      ").fragment.mainBeforeAll("\n        float dist = length(gl_PointCoord - 0.5);\n        if (dist > 0.5) discard;\n      "),super(t,o)}}class k extends a.Group{constructor(...e){super(...e),this.parts={sphere:(0,f.cY)(new R,this),stars:(0,f.cY)(new V,this)}}}class B extends a.Group{constructor(...e){super(...e),this.parts={ambient:(0,f.cY)(new a.AmbientLight(16777215,1.5),this),directional:(0,f.cY)(new a.DirectionalLight(16777215,1.5),this)}}}class N extends a.Group{constructor(...e){super(...e),this.parts={sky:(0,f.cY)(new k,this),earth:(0,f.cY)(new D,this),lights:(0,f.cY)(new B,this),grid:(0,f.cY)(new p.K({size:[20,20]}),{parent:this,visible:!1})}}}class I{initialize(e,t){return this.initialized?console.warn("Pointer already initialized."):(this.initialized=!0,this.destroyables.push(...this.doInitialize(e,t))),this}*doInitialize(e,t){yield(0,s.w)(e,{onChange:n=>{this.screen.position.copy(n.position);let r=e.getBoundingClientRect(),{x:a,y:i}=n.position;a-=r.left,i-=r.top,a/=r.width,i/=r.height,a=2*a-1,i=-(2*i-1),this.ndc.position.set(a,i),this.raycaster.setFromCamera(this.ndc.position,t)},onDown:()=>{this.screen.positionDown.copy(this.screen.position),this.ndc.positionDown.copy(this.ndc.position)}})}constructor(){this.screen={position:new a.Vector2,positionDown:new a.Vector2},this.ndc={position:new a.Vector2,positionDown:new a.Vector2},this.raycaster=new a.Raycaster,this.destroyables=[],this.initialized=!1}}function U(){return(0,i.Ky)(function*(e){let t=new N;e.scene.add(t),yield()=>{t.clear().removeFromParent()},e.ticker.set({minActiveDuration:100});let n=new I;n.initialize(e.renderer.domElement,e.camera);let r=new l.F({perspective:.25,size:4});r.initialize(e.renderer.domElement),yield(0,c.RC)("three",()=>{r.update(e.camera,e.aspect)}),yield(0,s.w)(e.renderer.domElement,{onTap:()=>{let e=t.parts.earth.earthRaycast(n.raycaster.ray);if(e){let{x:n,y:r,z:a}=e,i=Math.atan2(r,Math.sqrt(n**2+a**2)),o=Math.atan2(a,n);t.parts.earth.addSphericalSpot({theta:i,phi:o})}}}),yield(0,o.p)([[{code:"Space",modifiers:"shift"},()=>{document.body.requestFullscreen()}]]),Object.assign(window,{poc1:t,three:e,controls:r})},"always"),null}function E(){return(0,i.Ky)(function*(e){(0,u.a)(e),M.setPath(d.v.assets()),console.log("Assets config.assetsPath: ".concat(d.v.assets()))},[]),null}function F(){return(0,r.jsxs)("div",{className:"layer thru",children:[(0,r.jsxs)(i.H7,{children:[(0,r.jsx)(E,{}),(0,r.jsx)(h,{}),(0,r.jsx)(U,{})]}),(0,r.jsx)("header",{className:"absolute thru w-full top-0 p-8",children:(0,r.jsx)("img",{width:100,src:d.v.assets("images/acme-logo.png"),alt:""})}),(0,r.jsx)("footer",{className:"absolute thru w-full bottom-0 p-12 flex flex-row justify-center"}),(0,r.jsx)("div",{className:"layer thru",children:(0,r.jsx)("div",{className:"absolute left-0 top-0 w-[300px] h-full"})})]})}},30730:function(e,t,n){"use strict";n.d(t,{Client:function(){return S}});var r=n(78485),a=n(32423),i=n(48583),o=n(9710),s=n(27275),l=n(43147),c=n(73583),d=n(79509),u=n(97);class h{paint(e){let{ctx:t,pixelRatio:n}=this;t.clearRect(0,0,t.canvas.width,t.canvas.height),e.computeLayout();let r=e=>{let t=0;for(let n of e.allAncestors({includeSelf:!0}))t+=n.positioning===u.J8.Detached?100:1;return t};for(let a of[...e.allDescendants({includeSelf:!1})].filter(e=>!e.userData.skipPaint).sort((e,t)=>r(e)-r(t))){let e=a.rect.clone().multiplyScalar(n),r=function(e){let t;for(;!t&&e;){if(void 0!==(t=e.userData.color))return t;e=e.parent}return"#ffffff"}(a);a.userData.plain?(t.strokeStyle="",t.fillStyle=r,t.fillRect(e.x,e.y,e.width,e.height)):(t.lineWidth=2*n,t.strokeStyle=r,t.fillStyle="rgba(0, 0, 0, .5)",t.fillRect(e.x,e.y,e.width,e.height),t.strokeRect(e.x,e.y,e.width,e.height))}}constructor(e,{pixelRatio:t=window.devicePixelRatio,width:n=800,height:r=600}={}){e.width=n*t,e.height=r*t,e.style.width="".concat(n,"px"),e.style.height="".concat(r,"px"),this.ctx=e.getContext("2d"),this.pixelRatio=t,this.width=n,this.height=r}}let p={yellow:"#ffcc00",magenta:"#cc00ff",paleGreen:"#00ffcc",blue:"#00ccff",vibrantBlue:"#1c55ff"},f=[{direction:c.Nm.Horizontal,aspect:1},{direction:c.Nm.Vertical,aspect:2},{direction:c.Nm.Vertical,aspect:8},{direction:c.Nm.Vertical,aspect:.5},{direction:c.Nm.Horizontal,aspect:.5},{direction:c.Nm.Horizontal,aspect:1/4}];function m(){let e=(0,s.useMemo)(()=>new d.ObservableNumber(0),[]),{ref:t}=(0,i.sv)(function*(t){let n=new h(t.querySelector("canvas")),{direction:r,aspect:a}=f[e.value],i=new c.T({direction:r,size:[n.width,n.height],spacing:10,alignChildren:1}).add(new c.T({alignChildren:.5,aspect:a,spacing:10,userData:{color:p.yellow}}).add(new c.T({size:["50%","50%"]}),new c.T({size:["10%","10%"]})),new c.T({aspect:a,spacing:10,userData:{color:p.paleGreen}}).add(new c.T,new c.T),new c.T({aspect:a,userData:{color:p.magenta}}));yield e.onChange(e=>{let{direction:t,aspect:n}=f[e];for(let e of(i.set({direction:t}),i.children))e.set({aspect:n})}),yield(0,o.RC)("layout",e=>{i.set({alignChildren:e.cos01Time({frequency:.1})}),i.get(2).set({alignSelf:e.cos01Time({frequency:.3})}),n.paint(i)})},[]),n=()=>{e.value=(e.value+1)%f.length};return(0,r.jsxs)("div",{ref:t,className:"flex flex-col justify-center gap-4",style:{flex:"0 0 800px"},children:[(0,r.jsx)("canvas",{style:{border:"solid 2px #fff1",cursor:"pointer"},onClick:n}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("button",{className:"border border-white rounded px-2 py-1",onClick:n,children:[(0,r.jsxs)("span",{children:["Direction: ",c.Nm[f[(0,l.y)(e)].direction],","]}),"\xa0",(0,r.jsxs)("span",{children:["Aspect: ",f[(0,l.y)(e)].aspect]})]})}),(0,r.jsxs)("p",{style:{color:p.magenta},children:[(0,r.jsx)("code",{children:"alignSelf"})," allows the children to override the parent's ",(0,r.jsx)("code",{children:"alignChildren"}),"."]})]})]})}function v(){let{ref:e}=(0,i.sv)(function*(e){let t=e.querySelector("canvas"),n=new c.T({direction:c.Nm.Horizontal,offset:[100,100],size:[600,400],padding:10,gap:10,userData:{color:p.yellow}});n.add(new c.T({direction:c.Nm.Vertical,size:[".25rel","1rel"],spacing:10,userData:{color:p.vibrantBlue}}),new c.T({direction:c.Nm.Vertical,size:[".25rel","1rel"],spacing:10,userData:{color:p.vibrantBlue}}),new c.T({direction:c.Nm.Vertical,size:[".25rel","1rel"],spacing:10,userData:{color:p.vibrantBlue}}));for(let e=0;e<3;e++)n.get(0).add(new c.T({size:"".concat(e+1,"fr"),spacing:10,userData:{color:p.paleGreen}}));n.computeLayout();let r=window.devicePixelRatio;t.width=800*r,t.height=600*r,t.style.width="800px",t.style.height="600px";let a=t.getContext("2d");for(let e of n.allDescendants({includeSelf:!0})){var i;a.lineWidth=2*r,a.strokeStyle=null!==(i=e.userData.color)&&void 0!==i?i:"#fff",a.strokeRect(...e.rect.tupple(r))}},[]);return(0,r.jsxs)("div",{ref:e,className:"flex flex-col justify-center gap-4",style:{flex:"0 0 800px"},children:[(0,r.jsx)("canvas",{style:{border:"solid 2px #fff1"}}),(0,r.jsx)("div",{className:"text-center"})]})}function x(){let e=[10,30,90,0],t=[10,80],{ref:n}=(0,i.sv)(function*(n){let r=new h(n.querySelector("canvas")),a=new c.T({direction:c.Nm.Horizontal,size:[r.width,r.height],spacing:10,alignChildren:1}).add(new c.T({userData:{color:p.yellow}}).add(new c.T({margin:e,userData:{color:p.yellow}}).add(new c.T({margin:e,userData:{color:p.yellow}}).add(new c.T({margin:e,userData:{color:p.yellow}}).add(new c.T({margin:e,userData:{color:p.yellow}}).add(new c.T({margin:e,userData:{color:p.yellow}})))))),new c.T({userData:{color:p.paleGreen}}).add(new c.T({margin:t,userData:{color:p.paleGreen}})),new c.T({padding:10,userData:{color:p.magenta}}).add(new c.T({margin:[0,60],marginRight:0,userData:{color:p.magenta}}),new c.T({margin:[0,60],marginLeft:0,userData:{color:p.magenta}})));yield(0,o.RC)("layout",e=>{var t;null===(t=a.get(2))||void 0===t||t.set({padding:10+40*e.sin01Time({frequency:.2})}),r.paint(a)})},[]);return(0,r.jsxs)("div",{ref:n,className:"flex flex-col justify-center gap-4",style:{flex:"0 0 800px"},children:[(0,r.jsx)("canvas",{style:{border:"solid 2px #fff1"}}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{children:"css-like margins:"}),(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{style:{color:p.yellow},children:["4 values (",e.join(", "),") (top, right, bottom, left)"]}),(0,r.jsxs)("li",{style:{color:p.paleGreen},children:["2 values (",t.join(", "),") (vertical, horizontal)"]}),(0,r.jsxs)("li",{style:{color:p.magenta},children:["specific overrides: ",(0,r.jsx)("code",{children:"marginLeft"}),' overrides "2 values" declaration']})]})]})]})}function g(){let e=e=>{switch(e){case 40:return p.magenta;case 120:return p.paleGreen;default:return p.yellow}},{ref:t}=(0,i.sv)(function*(t){var n,r;let a=new h(t.querySelector("canvas"));function i(t){return{userData:{color:e(t)},margin:t}}let o=new c.T({direction:c.Nm.Horizontal,size:[a.width,a.height],spacing:10,alignChildren:1}).add(new c.T({spacing:10,userData:{color:"#fff2"}}).add(new c.T({...i(0)}),new c.T({...i(0)}),new c.T({...i(40)}),new c.T({...i(40)}),new c.T({...i(120)}),new c.T({...i(0)})));null===(n=o.get(0,2))||void 0===n||n.add(new c.T({positioning:u.J8.Detached,alignSelf:0,size:[38,38],offset:[-39,-39],userData:{color:"#fff2",plain:!0}})),null===(r=o.get(0,4))||void 0===r||r.add(new c.T({positioning:u.J8.Detached,alignSelf:0,size:[118,118],offset:[-119,-119],userData:{color:"#fff2",plain:!0}})),a.paint(o)},[]);return(0,r.jsxs)("div",{ref:t,className:"flex flex-col justify-center gap-4",style:{flex:"0 0 800px"},children:[(0,r.jsx)("canvas",{style:{border:"solid 2px #fff1"}}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{children:'Margins "collapse" when they are adjacent to each other or to the edge (padding) of the container.'}),(0,r.jsx)("p",{style:{color:e(0)},children:"margin: 0"}),(0,r.jsx)("p",{style:{color:e(40)},children:"margin: 40"}),(0,r.jsx)("p",{style:{color:e(120)},children:"margin: 120"})]})]})}var w=n(58681),y=n.n(w),b=n(28142);function M(){let{ref:e}=(0,i.sv)(function*(e){let t=new h(e.querySelector("canvas"));b.T.reset();let n=new c.T({direction:c.Nm.Horizontal,size:[t.width,t.height],spacing:10,userData:{color:p.blue}}).add(new c.T({direction:c.Nm.Vertical,size:"1part",spacing:10,userData:{color:p.paleGreen}}).populate(5,{spacing:10}),new c.T({direction:c.Nm.Vertical,size:"2sh",userData:{color:p.magenta},spacing:10}),new c.T({direction:c.Nm.Vertical,size:"1part",spacing:10}).add(new c.T().setSize("40"),new c.T().setSize("1part"),new c.T().setSize("40"),new c.T().setSize("1part").setSpacing(10).add(new c.T({direction:"vertical",size:"1part"}),new c.T({direction:"vertical",size:"1part"}),new c.T({direction:"vertical",size:"1part"})),new c.T().setSize("40")),new c.T().setPositioning("detached").setUserData({skipPaint:!0}).setPadding(20).setSize("1rel").add(new c.T({positioning:c.J8.Detached,offset:["0rel","1rel"],size:".7sm"})));n.get(0,3).populate(3),n.get(1).add(new c.T({positioning:c.J8.Detached,direction:c.Nm.Vertical,size:90,spacing:10}).populate(4),new c.T({positioning:c.J8.Detached,alignSelf:0,offset:[0,0],size:70,spacing:10}).populate(3),new c.T({positioning:c.J8.Detached,alignSelf:[0,1],size:30,spacing:10}).populate(1),new c.T({positioning:c.J8.Detached,alignSelf:1,size:50,spacing:10}).populate(2));let r=new c.T({positioning:c.J8.Detached,size:30}).populate(3).addTo(n.get(0,3));for(let e of n.allDescendants({includeSelf:!0}))e.positioning===c.J8.Detached&&e.set({userData:{color:p.yellow}});n.computeLayout(),yield(0,o.RC)("layout",e=>{n.get([0]).sizeX.value=e.lerpCos01Time(2,1,{frequency:1/6}),n.get([1]).sizeX.value=e.lerpCos01Time(0,4,{frequency:1/6}),r.set({alignSelf:e.sin01Time({frequency:1/3})}),t.paint(n)})},[]);return(0,r.jsxs)("div",{ref:e,className:"flex flex-col justify-center gap-4",style:{flex:"0 0 800px"},children:[(0,r.jsx)("canvas",{style:{border:"solid 2px #fff1"}}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)("p",{children:["When positioning is set to ",(0,r.jsx)("code",{style:{color:p.yellow},children:"detached"}),", spaces are not affected by their parent's size."]})})]})}function S(){let{ref:e}=(0,i.sv)(function*(e){let[t,...n]=e.children;t.style.flex="0 0 ".concat((n.length-1)*800,"px");let r=o.vB.get("layout").set({minActiveDuration:4});yield(0,a.s)(r.requestActivation)},[]);return(0,r.jsxs)("div",{ref:e,className:"".concat(y().Client," page overflow-scroll"),children:[(0,r.jsx)("div",{}),(0,r.jsx)(v,{}),(0,r.jsx)(x,{}),(0,r.jsx)(g,{}),(0,r.jsx)(m,{}),(0,r.jsx)(M,{})]})}},32695:function(e,t,n){"use strict";n.d(t,{Client:function(){return k}});var r=n(78485),a=n(4917),i=n(32717);n(4481);var o=n(81134),s=n(52471),l=n(32423),c=n(48583),d=n(28142),u=n(9710);let h=function(e,t){let{h:n=.3,w:r=1,p:a=3,q:i=1,a:o=.3}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=t**i;e.x=(t+o*Math.sin(s*Math.PI*2))*r,e.y=n*Math.pow(Math.sin(s*Math.PI),a)},p="\nvec2 looping(float t, float h, float w, float p, float q, float a) {\n  float t2 = pow(t, q);\n  return vec2(\n    (t + a * sin(t2 * PI * 2.0)) * w,\n    h * pow(sin(t2 * PI), p)\n  );\n}\n\nvec2 looping(float t) {\n  return looping(t, 0.3, 1.0, 3.0, 1.0, 0.3);\n}\n";function f(){let e=(0,i._)(["x(t) = w cdot left( t + a cdot sin(2 pi cdot t^q) \right)"],["x(t) = w \\cdot \\left( t + a \\cdot \\sin(2 \\pi \\cdot t^q) \\right)"]);return f=function(){return e},e}function m(){let e=(0,i._)(["y(t) = h cdot left( sin(pi cdot t^q) \right)^p"],["y(t) = h \\cdot \\left( \\sin(\\pi \\cdot t^q) \\right)^p"]);return m=function(){return e},e}let v=(()=>{let e=new s.Vector2;return function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return Array.from({length:n+1},(r,a)=>(t(e,a/n),"".concat(e.x.toFixed(5),",").concat(e.y.toFixed(5)))).join(" ")}})();function x(){let{samples:e=300,curve:t=(e,t)=>{e.x=t,e.y=t},color:n="#fff"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=v(t,e),{ref:i}=(0,c.sv)(function*(e){let n=new s.Vector2;console.log("foo"),yield u.vB.get("three").onTick(r=>{t(n,.5*r.time%1),e.setAttribute("cx",n.x.toFixed(5)),e.setAttribute("cy",n.y.toFixed(5))})},[]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("polyline",{stroke:n,points:a,opacity:.25}),(0,r.jsx)("circle",{ref:i,cx:0,cy:0,r:.005,fill:n,stroke:"none"})]})}function g(){return(0,r.jsxs)("div",{className:"absolute inset-0 text-sm p-4 pt-12",children:[(0,r.jsx)(o.BlockMath,{math:String.raw(f())}),(0,r.jsx)(o.BlockMath,{math:String.raw(m())})]})}function w(){(0,c.sv)(function*(){yield(0,l.s)(u.vB.current().requestActivation)},[]);let e=new s.Vector2(.5,.5),t=new s.Vector2(1,1),n="".concat(e.x-t.x/2-.05," ").concat(e.y-t.y/2-.05," ").concat(t.x+.1," ").concat(t.y+.1);return d.T.reset(),(0,r.jsxs)("div",{className:"relative self-start",children:[(0,r.jsx)(g,{}),(0,r.jsx)("svg",{viewBox:n,width:400,style:{border:"1px solid #fff3",borderRadius:".25em"},children:(0,r.jsxs)("g",{transform:"scale(1, -1) translate(0, -1)",children:[(0,r.jsxs)("g",{stroke:"#fff2",strokeWidth:.002,children:[(0,r.jsx)("line",{x1:-10,x2:10}),(0,r.jsx)("line",{y1:-10,y2:10}),(0,r.jsx)("line",{x1:1,x2:1,y1:-10,y2:10}),(0,r.jsx)("line",{x1:-10,x2:10,y1:1,y2:1})]}),(0,r.jsxs)("g",{id:"curves",stroke:"#fff",fill:"none",strokeWidth:.002,children:[Array.from({length:10},(e,t)=>{let n=d.T.between(3,5),a=d.T.between(1/3,1.5),i=d.T.between(.1,.5),o=d.T.between(.2,.3),s="hsl(".concat(d.T.between(180,360),", 100%, 70%)");return(0,r.jsx)(x,{curve:(e,t)=>h(e,t,{a:o,p:n,h:i,q:a}),color:s},t)}),(0,r.jsx)(x,{curve:h})]})]})})]})}var y=n(63221),b=n(63549),M=n(47174),S=n(87858),P=n(1060);class T extends s.Mesh{constructor(){super(new y.w({xColor:"#ff338b",yColor:"#33cc9c",zColor:"#4e33ff"}),new b.P)}}class C extends s.Object3D{constructor(){super(),this.axes1=(0,S.bB)(new T,this),this.axes2=(0,S.bB)(new T,this),this.onTick=e=>{let{deltaTime:t}=e,{axes1:n,axes2:r}=this;n.rotation.y+=.5*t,r.rotation.x+=.5*t};let{axes1:e,axes2:t}=this;e.position.set(-1,0,0),e.rotation.x=-Math.PI/2,t.position.set(1,0,0),t.rotation.x=-Math.PI/2;let n=new s.PlaneGeometry(1,1,1e3,1).translate(.5,.5,0),r=new s.MeshPhysicalMaterial({side:s.DoubleSide,flatShading:!0,emissiveIntensity:.25,emissive:"#ffffff"});(0,S.bB)(new s.Mesh(n,r),this);let a={uTime:u.vB.get("three").uTime,uWidth:{value:.6},uStartMatrix:{value:e.matrix},uEndMatrix:{value:t.matrix}};r.onBeforeCompile=e=>M.b.with(e).uniforms(a).vertex.top(P.i,p).vertex.top("\n        vec3 bezier3(vec3 a, vec3 b, vec3 c, vec3 d, float t) {\n          vec3 ab = mix(a, b, t);\n          vec3 bc = mix(b, c, t);\n          vec3 cd = mix(c, d, t);  \n          vec3 ab_bc = mix(ab, bc, t);\n          vec3 bc_cd = mix(bc, cd, t);\n          return mix(ab_bc, bc_cd, t);\n        }\n\n        vec3 bezier3_tangent(vec3 a, vec3 b, vec3 c, vec3 d, float t) {\n          return 3.0 * ( \n            (1.0 - t) * (1.0 - t) * (b - a) + \n            2.0 * (1.0 - t) * t * (c - b) + \n            t * t * (d - c));\n        }\n      ").vertex.replace("begin_vertex","\n        vec3 start = uStartMatrix[3].xyz;\n        vec3 end = uEndMatrix[3].xyz;\n\n        vec3 p0 = start;\n        vec3 p1 = mix(start, end, 0.0) + uStartMatrix[2].xyz;\n        vec3 p2 = mix(start, end, 1.0) + uEndMatrix[2].xyz;\n        vec3 p3 = end;\n\n        vec3 up = mix(uStartMatrix[1].xyz, uEndMatrix[1].xyz, position.x);\n        vec3 tangent = bezier3_tangent(p0, p1, p2, p3, position.x);\n        vec3 normal = cross(tangent, up);\n\n        float width = (position.y - 0.5)\n          // * easeInThenOut(position.x, 3.0)\n          * uWidth;\n\n        vec2 loop = looping(position.x);\n\n        vec3 transformed = \n          bezier3(p0, p1, p2, p3, position.x)\n          + tangent * (loop.x - position.x) * 2.0 + normal * loop.y * 2.0\n          + up * width;\n      ").vertex.replace("project_vertex","\n        vec4 mvPosition = vec4( transformed, 1.0 );\n        #ifdef USE_BATCHING\n          mvPosition = batchingMatrix * mvPosition;\n        #endif\n        #ifdef USE_INSTANCING\n          mvPosition = instanceMatrix * mvPosition;\n        #endif\n        mvPosition = modelViewMatrix * mvPosition;\n        gl_Position = projectionMatrix * mvPosition;\n      ")}}var z=n(66666);function _(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=Array.isArray(t)?t.map(e=>new s.Color(e)):[new s.Color(t)],o=e.attributes.position.count,l=null!==(n=e.attributes.color)&&void 0!==n?n:function(){let t=new s.BufferAttribute(new Float32Array(3*o),3);return e.setAttribute("color",t),t}(),c=a<0?o:a;for(let e=r;e<c;e++){let t=i[e%i.length];l.setXYZ(e,t.r,t.g,t.b)}l.needsUpdate=!0}let A=(()=>{let e=new s.Vector3(0,1,0),t=new s.Vector3(0,0,-1),n=new s.Vector3,r=new s.Vector3,a=new s.Vector3;return function(i,o){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;r.crossVectors(s,o),1e-6>r.lengthSq()&&r.crossVectors(t,o),r.normalize(),a.crossVectors(o,r).normalize(),i.set(r.x,a.x,o.x,l.x,r.y,a.y,o.y,l.y,r.z,a.z,o.z,l.z,0,0,0,1)}})();var j=n(98828);class D extends s.InstancedMesh{static getGeometry(){if(D._geometry)return D._geometry;let e=new s.CapsuleGeometry(.05,1,1,6).rotateZ(Math.PI/2).translate(.5,0,0);_(e,"#c60613");let t=e.clone().rotateZ(Math.PI/2);_(t,"#01b35a");let n=e.clone().rotateY(-Math.PI/2);return _(n,"#321bc7"),D._geometry=(0,z.n4)([e,t,n]),D._geometry}static getMaterial(){return D._material||(D._material=new s.MeshBasicMaterial({vertexColors:!0}),D._material.onBeforeCompile=e=>M.b.with(e).uniforms(D.uniforms).vertex.replace("begin_vertex","\n        vec3 transformed = vec3(position);\n        transformed *= uSize;\n        #ifdef USE_ALPHAHASH\n          vPosition = vec3(position);\n        #endif\n      ")),D._material}addTo(e){return e.add(this),this}constructor(e,t=.1){super(D.getGeometry(),D.getMaterial(),e.count),this.instanceMatrix=e,this.size=t,this.onBeforeRender=()=>{D.uniforms.uSize.value=this.size}}}D.uniforms={uSize:{value:.1}};class R extends s.Group{constructor(){var e,t;super(),d.T.reset();let n=new s.HemisphereLight("#ffffff","#926969",1);this.add(n);let r=new s.DirectionalLight("#ffffff",2);this.add(r),r.position.set(2,4,1);let a=new s.IcosahedronGeometry(1,8),i=a.clone(),o=new s.Points(a,new s.PointsMaterial({size:.05}));this.add(o);let l=new s.Points(i,new s.PointsMaterial({size:.05}));this.add(l),l.scale.setScalar(.33),l.position.set(0,0,-8),l.rotation.set(0,0,.66*Math.PI),this.onTick=e=>{let{deltaTime:t,time:n}=e;l.position.y=.5*Math.sin(.33*n)};let c=a.attributes.position.count,h=new s.InstancedMesh(new s.PlaneGeometry(1,1,100,1).translate(.5,.5,0),new s.MeshPhysicalMaterial({side:s.DoubleSide,flatShading:!0}),c);this.add(h),h.frustumCulled=!1;let f=new s.InstancedBufferAttribute(new Float32Array(16*c),16),m=new s.InstancedBufferAttribute(new Float32Array(16*c),16);h.geometry.setAttribute("aStartMat",f),h.geometry.setAttribute("aEndMat",m);let v=new s.Matrix4,x=new s.Vector3(0,1,0),g=new s.Vector3,w=new s.Vector3,y=new s.Color;for(let e=0;e<c;e++)g.fromBufferAttribute(a.attributes.position,e),w.copy(g),A(v,w,x,g),v.toArray(f.array,16*e),g.fromBufferAttribute(i.attributes.position,e),A(v,w,x,g),v.toArray(m.array,16*e),y.set("hsl(".concat(d.T.between(180,360),", 100%, 70%)")),h.setColorAt(e,y);let b={uTime:u.vB.get("three").uTime,uLength:{value:.1},uRand:{value:d.T.vector(new s.Vector4,{min:0,max:1})},uWorldStartMatrix:{value:o.matrix},uWorldEndMatrix:{value:l.matrix},uWidth:{value:.1}};h.material.onBeforeCompile=e=>M.b.with(e).shaderName("with-loop").uniforms(b).vertex.top(j.U,P.i,p).vertex.top("\n      attribute mat4 aStartMat;\n      attribute mat4 aEndMat;\n\n      float rand(vec3 p) {\n        return fract(sin(dot(p, vec3(12.9898, 78.233, 45.164))) * 43758.5453);\n      }\n\n      // float rand(vec3 p) {\n      //   p = fract(p * vec3(443.8975, 441.4236, 437.1954));\n      //   p += dot(p, p.yzx + 19.19);\n      //   return fract((p.x + p.y) * p.z);\n      // }\n\n      float rand(vec3 p, float rangeMin, float rangeMax) {\n        return mix(rangeMin, rangeMax, rand(p));\n      }\n\n      float rand11(vec3 p) {\n        float r = rand(p) * 2.0 - 1.0;\n        float s = sign(r);\n        r = fract(r);\n        r *= r * r * r;\n        return r * s;\n      }\n\n      float rand11(vec3 p, float rangeMin, float rangeMax) {\n        return (rand11(p) * 0.5 + 0.5) * (rangeMax - rangeMin) + rangeMin;\n      }\n\n      vec3 bezier3(vec3 a, vec3 b, vec3 c, vec3 d, float t) {\n        t = clamp(t, 0.0, 1.0);\n        vec3 ab = mix(a, b, t);\n        vec3 bc = mix(b, c, t);\n        vec3 cd = mix(c, d, t);  \n        vec3 ab_bc = mix(ab, bc, t);\n        vec3 bc_cd = mix(bc, cd, t);\n        return mix(ab_bc, bc_cd, t);\n      }\n\n      vec3 bezier3_tangent(vec3 a, vec3 b, vec3 c, vec3 d, float t) {\n        t = clamp(t, 0.0, 1.0);\n        return 3.0 * ( \n          (1.0 - t) * (1.0 - t) * (b - a) + \n          2.0 * (1.0 - t) * t * (c - b) + \n          t * t * (d - c));\n      }\n    ").vertex.replace("begin_vertex","\n      mat4 startMat = uWorldStartMatrix * aStartMat;\n      mat4 endMat = uWorldEndMatrix * aEndMat;\n\n      vec3 start = startMat[3].xyz;\n      vec3 end = endMat[3].xyz;\n\n      start += vec3(rand11(start.xyz), rand11(start.yzx), rand11(start.zxy)) * 0.66;\n      end += vec3(rand11(start.zyx), rand11(start.xzy), rand11(start.yxz)) * 0.33;\n      \n      float dt = mix(-uLength, 1.0, fract(uTime * 0.33 + rand11(start) * 0.4));\n      float t = position.x * uLength + dt;\n      t = clamp(t, 0.0, 1.0);\n      float d = distance(start, end);\n\n      vec3 p0 = start;\n      vec3 p1 = mix(start, end, 0.2) + d * 0.2 * startMat[2].xyz;\n      vec3 p2 = mix(start, end, 0.8) + d * 0.2 * endMat[2].xyz;\n      vec3 p3 = end;\n      \n      // p1 = mix(start, end, 0.33);\n      // p2 = mix(start, end, 0.66);\n\n      vec3 normal = normalize(mix(startMat[2].xyz, endMat[2].xyz, t));\n      vec3 up = normalize(mix(startMat[1].xyz, endMat[1].xyz, t));\n      vec3 tangent = normalize(bezier3_tangent(p0, p1, p2, p3, t));\n      \n      float shortT = (t - dt) / uLength;\n      float width = (position.y - 0.5)\n        * easeInThenOut(t, 6.0)\n        * easeInThenOut(shortT, 3.0)\n        * mix(0.33, 1.0, pcurve(t, 1.0, 2.0)) // Narrower at the end.\n        * uWidth;\n      \n      float randomness = 0.2;\n      float startLoopT = rand(start) * randomness;\n      float loopT = startLoopT + inverseLerp(0.0, 1.0 - randomness, t);\n\n      vec2 loop = looping(loopT, 0.3, 1.0, 3.0, rand11(start, 0.6, 1.2), 0.3);\n      // loop = vec2(t, 0.0);\n      \n      // Loop Random Scalar:\n      vec2 lrs = vec2(\n        rand11(start, 0.4, 1.0),\n        rand11(start.zyx, 0.9, 1.1));\n      vec3 transformed = \n        bezier3(p0, p1, p2, p3, t)\n        + tangent * (loop.x - loopT) * d * lrs.x + normal * loop.y * d * lrs.y\n        + up * width;\n      \n      #ifdef USE_ALPHAHASH\n        vPosition = transformed;\n      #endif\n    ").vertex.replace("beginnormal_vertex","\n      vec3 objectNormal = vec3(normal);\n\n      #ifdef USE_TANGENT\n        vec3 objectTangent = vec3(tangent.xyz);\n      #endif\n    "),a.computeBoundingBox(),a.computeBoundingSphere(),i.computeBoundingBox(),i.computeBoundingSphere(),h.computeBoundingBox(),null===(e=h.boundingBox)||void 0===e||e.copy(a.boundingBox.clone()).union(i.boundingBox).expandByScalar(1),h.computeBoundingSphere(),null===(t=h.boundingSphere)||void 0===t||t.copy(a.boundingSphere.clone()).union(i.boundingSphere).expandByPoint(new s.Vector3().setScalar(1)),h.geometry.computeBoundingBox=()=>{},h.geometry.computeBoundingSphere=()=>{},o.visible=!1,l.visible=!1}}function V(){return(0,a._v)("ThreeDemo",async function*(e,t){t.useOrbitControls({position:[2,4.5,8],target:[-1.2,1.2,-.2]}),e.add(new s.GridHelper(10,10,"#5c4f7d","#352945"));let n=new C;n.position.set(-5,0,0),yield t.onTick(n.onTick),e.add(n);let r=new R;r.position.set(0,0,0),yield t.onTick(r.onTick),e.add(r)},[]),null}function k(){return(0,r.jsxs)("div",{className:"absolute-through p-4 flex flex-col gap-4",children:[(0,r.jsx)("div",{className:"absolute-through",children:(0,r.jsx)(a.H7,{children:(0,r.jsx)(V,{})})}),(0,r.jsx)("h1",{className:"text-4xl",children:"Path with loop"}),(0,r.jsx)(w,{})]})}},93342:function(e,t,n){"use strict";n.d(t,{Client:function(){return B}});var r=n(78485),a=n(52471),i=n(13025),o=n(86818),s=n(63221),l=n(63549),c=n(49635),d=n(87858),u=n(28142),h=n(96966),p=n(4917),f=n(8834),m=n(81796),v=n(73583),x=n(77405);class g{constructor(e,t,n,r){this.space=e,this.rect=t,this.uvRect=n,this.scatterCoeff=r,this.r0=u.T.random(),this.r1=u.T.random()}}class w{constructor(e,t){this.props={...w.defaultProps,...t};let{position:n,size:r,scatterPadding:a,sizeOptions:i,seed:o}=this.props,{col:s,row:l}=e.props;u.T.seed(o);let c=u.T.createPicker(i),d=Array.from({length:s}).map(c),h=Array.from({length:l}).map(c),{x:p,y:f}=(0,m.iK)(n),{x:y,y:b}=(0,m.iK)(r),M=new v.T(v.Nm.Horizontal).setSize(y,b).setOffset(p-y/2,f-b/2);for(let e of d){let t=new v.T(v.Nm.Vertical).setSize("".concat(e,"fr")).addTo(M);for(let e of h)new v.T(v.Nm.Horizontal).setSize("".concat(e,"fr")).addTo(t)}M.computeLayout();let S=M.rect,P=[...M.allLeaves({includeSelf:!1})],T=(y+b)/2,C=P.map(e=>{let t=e.rect.clone(),n=t.clone().relativeTo(S),{x:r,y:i}=t.getCenter(),o=(0,x.ii)(.5,1,(Math.abs(r-p)+Math.abs(i-f))/T);return t.centerX+=u.T.between(-a,a)*o,t.centerY+=u.T.between(-a,a)*o,new g(e,t,n,o)});this.root=M,this.nodes=C}}w.defaultProps={seed:87654,position:new a.Vector2(0,0),size:new a.Vector2(3,2),scatterPadding:.1,sizeOptions:[[.5,1],[1,10],[2,2],[3,1]]};var y=n(88156),b=n(44645),M=n(47174),S=n(1060),P=n(98828),T=n(83018),C=n(58648);class z extends a.Object3D{constructor(){super();let e=new a.HemisphereLight("#ffffff","#926969",1);this.add(e);let t=new a.DirectionalLight("#ffffff",2);this.add(t),t.position.set(2,4,1)}}class _ extends a.MeshBasicMaterial{get mapAspect(){return this.uniforms.uMapInfo.value.x}set mapAspect(e){this.uniforms.uMapInfo.value.x=e}getScatteredSize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new a.Vector2;return e.x=this.uniforms.uScatteredInfo.value.x,e.y=this.uniforms.uScatteredInfo.value.y,e}setScatteredSize(e){this.uniforms.uScatteredInfo.value.x=e.x,this.uniforms.uScatteredInfo.value.y=e.y}get scatteredSize(){return this.getScatteredSize()}set scatteredSize(e){this.setScatteredSize(e)}update(e){e*=.33,this.uniforms.uDispersionTime.value+=e*this.uniforms.uDispersion.value.x,this.uniforms.uLowDispersionTime.value+=e*this.uniforms.uLowDispersion.value.x}constructor(){super({side:a.DoubleSide}),this.uniforms={uDispersionTime:{value:0},uLowDispersionTime:{value:0},uDispersion:{value:new a.Vector4(1,-.6,.4,2)},uLowDispersion:{value:new a.Vector4(0,-.6,.4,0)},uMainParams:{value:new a.Vector4(1,0)},uCenter:{value:new a.Vector3},uMapInfo:{value:new a.Vector4(1,1,.5,.5)},uScatteredInfo:{value:new a.Vector4(1,1,0,0)},uNormalMap:{value:b.R.get("three").loadTexture("textures/rough_concrete_nor_gl_1k.jpg",e=>{e.wrapS=e.wrapT=a.RepeatWrapping})}},this.userData=function(e,t){for(let[n,r,a,i]of t)Object.defineProperty(e,"".concat(n,"_meta"),{enumerable:!0,value:i}),Object.defineProperty(e,n,{enumerable:!0,get:()=>r[a],set(e){r[a]=e}});return e}({},[["chunkScale",this.uniforms.uMainParams.value,"x","\n        Name(chunk.scale)\n        Slider(0, 1, step: any)\n      "],["imageVisibility",this.uniforms.uMainParams.value,"y","\n        Name(image.visibility)\n        Slider(0, 1, step: any)\n      "],["dispX",this.uniforms.uDispersion.value,"x","\n        Name(disp.x)\n        Slider(0, 1, step: any)\n      "],["dispY",this.uniforms.uDispersion.value,"y","\n        Name(disp.y)\n        Slider(-1, 1, step: any)\n      "],["dispZ",this.uniforms.uDispersion.value,"z","\n        Name(disp.z)\n        Slider(-1, 1, step: any)\n      "],["dispW",this.uniforms.uDispersion.value,"w","\n        Name(disp.cycle)\n        Slider(1, 20, step: 1)\n      "],["lowDispX",this.uniforms.uLowDispersion.value,"x","\n        Name(lowDisp.x)\n        Slider(0, 1, step: any)\n      "]]),this.onBeforeCompile=e=>M.b.with(e).defines({USE_UV:""}).uniforms(this.uniforms).varying({vRand:"vec4"}).vertex.top(P.U,S.i,'\n  // sizeMode: 0 for "contain", 1 for "cover"\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, vec2 scale) {\n    align.y = 1.0 - align.y; // Flip y-coordinate\n    if ((outerAspect > innerAspect) != (sizeMode == 1.0)) { // XOR condition for mode\n      float scaleFactor = outerAspect / innerAspect;\n      uv.x = (uv.x - align.x) * scaleFactor + align.x; // Adjust x-coordinate\n    } else {\n      float scaleFactor = innerAspect / outerAspect;\n      uv.y = (uv.y - align.y) * scaleFactor + align.y; // Adjust y-coordinate\n    }\n    uv = (uv - align) / scale + align;\n    return uv;\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, float scale) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, align, vec2(scale));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, align, vec2(1.0));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, vec2(0.5));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect) {\n    return applyUvSize(uv, outerAspect, innerAspect, 1.0);\n  }\n').vertex.top("\n        attribute vec4 aRectUv;\n        attribute vec4 aRand;\n      ").vertex.top("\n        vec2 delta;\n        float scatterRatio;\n\n        vec4 computeDispersion() {\n          if (uDispersion.x == 0.0) {\n            return vec4(0.0, 0.0, 0.0, 1.0);\n          }\n\n          float duration = lerp(8.0, 1.0, aRand.x * aRand.y * aRand.z);\n          float cycleCount = max(floor(uDispersion.w), 1.0);\n          float time = mod(uDispersionTime + duration * cycleCount * aRand.x, duration * cycleCount) / duration;\n          float cycleVisibility = time <= 1.0 ? 1.0 : easeInOut3(1.0 - inverseLerp(.8 * aRand.w + .1, .8 * aRand.w + .2, uDispersion.x));\n          time = mod(time, 1.0);\n          float size = easeInThenOut(time, 8.0) * lerp(2.0, 1.0, time * time) * cycleVisibility;\n          size = mix(1.0, size, pow(uDispersion.x, 1.0 / 2.0));\n\n          // Apply scale before instanceMatrix (shrinking).\n          vec3 dispersed;\n          dispersed.xy = -delta * lerp(uDispersion.y, uDispersion.z, time);\n          dispersed.z = lerp(1.0, 0.0, time);\n          dispersed *= uDispersion.x;\n\n          return vec4(dispersed, size);\n        }\n\n        float getStartEffect(float time, float duration) {\n          return min(1.0, time / duration);\n        }\n\n        float getEndEffect(float time, float timeMax, float duration) {\n          return max(0.0, time - (timeMax - duration)) / duration;\n        }\n\n        vec4 computeLowDispersion() {\n          if (uLowDispersion.x == 0.0) {\n            return vec4(0.0, 0.0, 0.0, 1.0);\n          }\n\n          float periodScalarT = inverseLerp(0.1, 0.9, scatterRatio);\n          float period = lerp(2.0, 8.0, aRand.x) * lerp(60.0, 1.0, periodScalarT);\n          float time = mod(uLowDispersionTime + period * aRand.z, period);\n\n          float duration = 1.0;\n          float effectStart = min(1.0, time);\n          float effectEnd = getEndEffect(time, period, duration);\n\n          float size = getStartEffect(time, 0.3) * (1.0 - getEndEffect(time, period, 0.3));\n          size = pow(size, 1.0 / 4.0);\n          size = mix(1.0, size, pow(uLowDispersion.x, 1.0 / 4.0));\n\n          vec3 dispersed;\n\n          dispersed.xy = delta * 0.1;\n          dispersed.z = 0.2;\n          dispersed.xyz *= getEndEffect(time, period, 1.0);\n          dispersed *= uLowDispersion.x;\n\n          return vec4(dispersed, size);\n        }\n      ").vertex.replace("project_vertex","\n        vec4 mvPosition = vec4(position, 1.0);\n        delta = instanceMatrix[3].xy - uCenter.xy;\n        scatterRatio = clamp(1.1 * length(delta) / (length(uScatteredInfo.xy) / 2.0), 0.0, 1.0);\n\n        vec4 dispersion = computeDispersion();\n        vec4 lowDispersion = computeLowDispersion();\n\n        float scale = clamp01(uMainParams.x * 3.0 - 2.0 * aRand.w);\n        mvPosition.xyz *= dispersion.w * lowDispersion.w * easeInOut3(scale);\n\n        mvPosition = instanceMatrix * mvPosition;\n        mvPosition.xyz += dispersion.xyz + lowDispersion.xyz;\n\n        mvPosition = modelViewMatrix * mvPosition;\n        gl_Position = projectionMatrix * mvPosition;      \n      ").vertex.replace("uv_vertex","\n        #if defined( USE_UV ) || defined( USE_ANISOTROPY )\n          vUv = vec3( uv, 1 ).xy;\n          vUv = aRectUv.xy + aRectUv.zw * vUv;\n        #endif\n        #ifdef USE_MAP\n          vec2 instanceUv = aRectUv.xy + aRectUv.zw * MAP_UV;\n\n          // vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, vec2 scale\n          float outerAspect = uScatteredInfo.x / uScatteredInfo.y;\n          float innerAspect = uMapInfo.x;\n          float sizeMode = uMapInfo.y;\n          vec2 align = uMapInfo.zw;\n          instanceUv = applyUvSize(instanceUv, outerAspect, innerAspect, sizeMode, align, vec2(1.0));\n          \n          vMapUv = ( mapTransform * vec3( instanceUv, 1 ) ).xy;\n        #endif\n      ").vertex.mainAfterAll("\n        vRand = aRand;\n      ").fragment.top(P.U,S.i).fragment.replace("color_fragment","\n        vec3 normal = texture2D(uNormalMap, vUv * 4.0).rgb;\n        vec3 light = normalize(vec3(0.5, 2.5, 1.0));\n        float colorAlteration = mix(0.333, 1.0, dot(normal, light));\n        float transition = inverseLerp(0.0, 0.2, uMainParams.y - 0.8 * vRand.w);\n        diffuseColor.rgb = mix(vColor * colorAlteration, diffuseColor.rgb, transition);\n      ")}}class A extends a.Object3D{static createPlane(e){let{row:t,col:n}=e,r=t*n,i=new a.PlaneGeometry,o=new a.InstancedBufferAttribute(new Float32Array(4*r),4);i.setAttribute("aRectUv",o);let s=new a.InstancedBufferAttribute(new Float32Array(4*r),4);i.setAttribute("aRand",s);for(let e=0;e<r;e++)s.setXYZW(e,u.T.random(),u.T.random(),u.T.random(),u.T.random());let l=new _,c=new a.InstancedMesh(i,l,r);return c.name="plane",c}get count(){return this.internal.count}onTick(e){this.internal.plane.material.update(e.deltaTime)}getDistribution(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new w(this,e)}drawDistribution(e){let{position:t,size:n,scatterPadding:r}=e.props,{x:a,y:i}=(0,m.iK)(t),{x:o,y:s}=(0,m.iK)(n);this.internal.lineHelper.rectangle([a,i,o,s]).rectangle([a,i,o+2*r,s+2*r])}distribute(e){let{count:t,plane:n}=this.internal,{aRectUv:r}=n.geometry.attributes;for(let a=0;a<t;a++){let{rect:t,uvRect:i}=e.nodes[a];n.setMatrixAt(a,(0,c.$)({position:t.getCenter(),scale:t.getSize()})),r.setXYZW(a,i.x,i.y,i.width,i.height)}n.material.setScatteredSize(e.root.rect.getSize());let a=e.root.rect;n.material.setScatteredSize(a.getSize()),n.material.uniforms.uCenter.value.copy(a.getCenter())}lerpDistribute(e,t,n){let{count:r,plane:i}=this.internal,{aRectUv:o}=i.geometry.attributes,s=new C.Ae,l=new C.Ae,d=new C.Ae,u=new a.Vector3,h=new a.Vector3;for(let a=0;a<r;a++){let r=e.nodes[a],d=t.nodes[a],p=.3*(1-r.r0*(r.scatterCoeff+.2*d.r0)),f=(0,x.ii)(p,.7+p,n),m=(0,T.xD)(f);s.lerpRectangles(r.rect,d.rect,m),l.lerpRectangles(r.uvRect,d.uvRect,m),i.setMatrixAt(a,(0,c.$)({position:s.getCenter(u),scale:s.getSize(h),rotationY:(d.r0<.5?0:1)*m*Math.PI*2,rotationZ:.3*Math.sin(f*Math.PI)*(-1+2*r.r0)})),o.setXYZW(a,l.x,l.y,l.width,l.height)}let p=(0,T.uN)((0,x.ii)(.3,.7,n));d.lerpRectangles(e.root.rect,t.root.rect,p),i.material.setScatteredSize(d.getSize()),i.material.uniforms.uCenter.value.copy(d.getCenter()),i.instanceMatrix.needsUpdate=!0,o.needsUpdate=!0}constructor(e={}){super(),this.transition=0;let t={...A.defaultProps,...e},{col:n,row:r}=t,a=A.createPlane(t);(0,d.bB)(a,this);let i=new y.O;(0,d.bB)(i,this);let o=new z;(0,d.bB)(o,this),this.internal={count:r*n,plane:a,lineHelper:i,lightSetup:o},this.props=t,this.distribute(this.getDistribution())}}A.displayName="ScatteredPlane",A.defaultProps={row:20,col:30,imageAspect:1,imageResizeMode:"cover"},A.transition_meta="Range(0, 1)";class j extends a.Mesh{constructor(){super(new a.IcosahedronGeometry(40,1),new a.MeshBasicMaterial({color:"#aeb4e9",side:a.BackSide})),this.onBeforeRender=(e,t,n)=>{this.position.copy(n.position)}}}let D={darkBlue:"#002c52",orange:"#ff5c35",white:"#ffffff",lightGrey:"#c9cfd3"};function R(){let e=(0,o.jE)();return e.three.pipeline.basicPasses.outline.enabled=!1,(0,p._v)("ScatteredDemo",async function*(t,n){(0,d.bB)(new j,t),(0,d.bB)(new a.Mesh(new s.w,new l.P),t);let r=await n.loader.load("/assets/textures/DebugTexture.png");r.colorSpace=a.SRGBColorSpace;let o=(0,d.bB)(new A,t);o.internal.plane.material.map=r,o.internal.plane.material.mapAspect=r.image.width/r.image.height;let h=o.getDistribution({seed:4789,position:[-2,0],size:[2,3]}),p=o.getDistribution({seed:3249,position:[2,0],size:[2,4]});o.drawDistribution(h),o.drawDistribution(p),t.userData.transition=0,t.userData.transition_meta="Slider(0, 1, step: 0.01)",t.userData.scale=1,t.userData.scale_meta="Slider(-1, 1, pow: 10, step: .1)",t.userData.links=[o.internal.plane.material.userData];let f=Object.values(D);for(let e=0,t=o.count;e<t;e++)o.internal.plane.setColorAt(e,(0,c.E)(u.T.pick(f)));yield n.onTick(()=>{o.lerpDistribute(h,p,t.userData.transition),o.scale.setScalar(t.userData.scale)}),(0,i.v)(e,t),e.sceneSelection.add("Select ScatteredDemo",t)},[]),null}function V(){return(0,p.Ky)(function*(e){e.useOrbitControls({position:[-2,0,8],target:[-2,0,0]})},[]),null}function k(e){let{children:t}=e,n=(0,p.Ky)();return n.loader.setPath(h.v.assetsPath),(0,r.jsx)(o.KU,{three:n,backgroundColor:"#26163c4f",children:t})}function B(){return(0,r.jsxs)("div",{className:"layer thru",children:[(0,r.jsx)(f.Leak,{}),(0,r.jsx)(p.H7,{children:(0,r.jsxs)(k,{children:[(0,r.jsx)("div",{className:"layer thru px-3 py-2 flex flex-col gap-4",children:(0,r.jsx)("h1",{className:"text-4xl",children:"ScatteredPlane"})}),(0,r.jsx)(V,{}),(0,r.jsx)(R,{})]})})]})}},96966:function(e,t,n){"use strict";n.d(t,{v:function(){return a}});let r="/three-xp/assets/",a={development:!1,assetsPath:r,assets:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(r).concat(e)}}},4917:function(e,t,n){"use strict";n.d(t,{H7:function(){return f},Ky:function(){return u},_v:function(){return h}});var r=n(78485),a=n(27275),i=n(52471),o=n(48583),s=n(48181),l=n(96966),c=n(11030);let d=(0,a.createContext)(null);function u(e,t){let n=(0,a.useContext)(d);return(0,o.sv)(async function*(t,r){if(e){let t=e(n,r);if(t&&"function"==typeof t.next)do{let{value:e,done:n}=await t.next();if(n)break;yield e}while(r.mounted)}},null!=t?t:"always"),n}function h(e,t,n){let r=(0,a.useMemo)(()=>new i.Group,[]);return r.name=e,u(async function*(e,n){if(e.scene.add(r),yield()=>{r.clear(),r.removeFromParent()},t){let a=t(r,e,n);if(a&&"function"==typeof a.next)do{let{value:e,done:t}=await a.next();if(t)break;yield e}while(n.mounted)}},n),r}function p(e){let{children:t,className:n}=e,c=(0,a.useMemo)(()=>new s.Vu,[]),{ref:u}=(0,o.sv)(function*(e){c.loader.setPath(l.v.assetsPath),yield c.initialize(e),Object.assign(window,{three:c,THREE:i})},[]);return(0,r.jsx)("div",{ref:u,className:"ThreeProvider absolute-through ".concat(null!=n?n:""),children:(0,r.jsx)(d.Provider,{value:c,children:t})})}function f(e){return(0,c.O)()&&(0,r.jsx)(p,{...e})}},63221:function(e,t,n){"use strict";n.d(t,{w:function(){return c}});var r=n(52471),a=n(66666);let i={axis:"x",length:1,radialSegments:12,radius:.01,coneRatio:.1,radiusScale:1,vertexColor:!0,baseCap:"flat",color:"white"},o=new r.Color;function s(e){let{axis:t,length:n,radius:s,radialSegments:l,coneRatio:c,radiusScale:d,vertexColor:u,baseCap:h,color:p}={...i,...e},f=s*d,m=n*c,v=new r.ConeGeometry(3*f,m,l),x=new r.CylinderGeometry(f,f,1,l,1,!0),g=n-m,w=n-.5*m;v.rotateZ(-Math.PI/2).translate(w,0,0),x.scale(1,g,1).rotateZ(-Math.PI/2).translate(.5*g,0,0);let y="none"===h?new r.BufferGeometry:"flat"===h?new r.CircleGeometry(f,l).rotateY(-Math.PI/2):new r.SphereGeometry(f,l,3,0,2*Math.PI,0,.5*Math.PI).rotateZ(Math.PI/2).rotateX(Math.PI/2),b=(0,a.n4)([v,x,y]);switch(t){case"y":b.rotateZ(Math.PI/2);break;case"z":b.rotateY(-Math.PI/2)}if(u){let e=b.attributes.position.count,t=new r.BufferAttribute(new Float32Array(3*e),3);b.setAttribute("color",t),o.set(p);for(let n=0;n<e;n++)t.setXYZ(n,o.r,o.g,o.b)}return b}let l={xColor:"#ff3333",yColor:"#33cc66",zColor:"#3366ff"};class c extends r.BufferGeometry{constructor(e){super();let{xColor:t,yColor:n,zColor:r,...i}={...l,...e},o=s({...i,axis:"x",color:t}),c=s({...i,axis:"y",color:n}),d=s({...i,axis:"z",color:r}),u=(0,a.n4)([o,c,d]);this.copy(u),u.dispose()}}},31454:function(e,t,n){"use strict";n.d(t,{K:function(){return o}});var r=n(52471),a=n(81796);let i={color:"white",opacity:.5,size:[8,8],step:1,frame:!0};class o extends r.LineSegments{set(e){let{color:t,opacity:n,size:o,step:s,frame:l}={...i,...e},c=(0,a.iK)(o),d=(0,a.iK)(null!=s?s:c),u=[],h=(e,t)=>u.push(new r.Vector3(e,t,0));l&&(h(-c.x/2,+c.y/2),h(+c.x/2,+c.y/2),h(+c.x/2,+c.y/2),h(+c.x/2,-c.y/2),h(+c.x/2,-c.y/2),h(-c.x/2,-c.y/2),h(-c.x/2,-c.y/2),h(-c.x/2,+c.y/2));let p=Math.ceil(-c.x/2/d.x)*d.x;p===-c.x/2&&(p+=d.x);do h(p,-c.y/2),h(p,+c.y/2),p+=d.x;while(p<c.x/2);let f=Math.ceil(-c.y/2/d.y)*d.y;f===-c.y/2&&(f+=d.y);do h(-c.x/2,f),h(+c.x/2,f),f+=d.y;while(f<c.y/2);return this.geometry.setFromPoints(u),this.material.color.set(t),this.material.opacity=n,this.material.transparent=n<1,this}constructor(e){super(),this.set(null!=e?e:i)}}},88156:function(e,t,n){"use strict";n.d(t,{O:function(){return c}});var r=n(52471),a=n(58648),i=n(81796);let o=new r.Vector2,s=new r.Vector3,l=new r.Matrix4;class c extends r.LineSegments{showOccludedLines(){let{opacity:e=.2}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new r.LineBasicMaterial({color:this.material.color,transparent:!0,depthFunc:r.GreaterDepth,opacity:e}),n=new r.LineSegments(this.geometry,t);return this.add(n),this}clear(){return this.points.length=0,this.geometry.setFromPoints(this.points),this}draw(){return this.geometry.setFromPoints(this.points),this}circle(e){let{radius:t,segments:n,...a}={...c.circleDefaultOptions,...e};(0,i.Xe)(a,l);let o=new r.Vector3(1,0,0),s=new r.Vector3(0,1,0);for(let e=0;e<n;e++){let a=e/n*Math.PI*2,i=(e+1)/n*Math.PI*2,c=Math.cos(a)*t,d=Math.sin(a)*t,u=Math.cos(i)*t,h=Math.sin(i)*t,p=new r.Vector3().addScaledVector(o,c).addScaledVector(s,d).applyMatrix4(l),f=new r.Vector3().addScaledVector(o,u).addScaledVector(s,h).applyMatrix4(l);this.points.push(p,f)}return this}rectangle(e){let{centerX:t,centerY:n,width:i,height:o}=a.Ae.from(e),s=i/2,l=o/2,c=new r.Vector3(t-s,n-l,0),d=new r.Vector3(t+s,n-l,0),u=new r.Vector3(t+s,n+l,0),h=new r.Vector3(t-s,n+l,0);return this.points.push(c,d,d,u,u,h,h,c),this}box(){let{center:e=[0,0,0],size:t=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{x:n,y:a,z:o}=(0,i.Q7)(e,s),{x:l,y:c,z:d}=(0,i.Q7)(t,s),u=l/2,h=c/2,p=d/2,f=new r.Vector3(n-u,a-h,o-p),m=new r.Vector3(n+u,a-h,o-p),v=new r.Vector3(n+u,a+h,o-p),x=new r.Vector3(n-u,a+h,o-p),g=new r.Vector3(n-u,a-h,o+p),w=new r.Vector3(n+u,a-h,o+p),y=new r.Vector3(n+u,a+h,o+p),b=new r.Vector3(n-u,a+h,o+p);return this.points.push(f,m,m,v,v,x,x,f),this.points.push(g,w,w,y,y,b,b,g),this.points.push(f,g,m,w,v,y,x,b),this}plus(e,t){let n=t/2,{x:a,y:s}=(0,i.iK)(e,o),l=new r.Vector3(a-n,s,0),c=new r.Vector3(a+n,s,0),d=new r.Vector3(a,s-n,0),u=new r.Vector3(a,s+n,0);return this.points.push(l,c,d,u),this}cross(e,t){let n=t/2,{x:a,y:s}=(0,i.iK)(e,o),l=new r.Vector3(a-n,s-n,0),c=new r.Vector3(a+n,s+n,0),d=new r.Vector3(a-n,s+n,0),u=new r.Vector3(a+n,s-n,0);return this.points.push(l,c,d,u),this}constructor(...e){super(...e),this.points=[]}}c.circleDefaultOptions={radius:.5,segments:96}},63549:function(e,t,n){"use strict";n.d(t,{P:function(){return i}});var r=n(52471);let a={vertexColors:!0,color:"white",luminosity:.5};class i extends r.ShaderMaterial{constructor(e){let{color:t,luminosity:n,vertexColors:i,...o}={...a,...e};super({...o,uniforms:{uColor:{value:new r.Color(t)},uSunPosition:{value:new r.Vector3(.5,.7,.3)},uLuminosity:{value:n}},vertexColors:i,vertexShader:"\nvarying vec3 vWorldNormal;\nvarying vec3 vColor;\n\nvoid main() {\n  vWorldNormal = mat3(modelMatrix) * normal;\n  vColor = color;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\nvarying vec3 vWorldNormal;\nvarying vec3 vColor;\n\nuniform vec3 uSunPosition;\nuniform vec3 uColor;\nuniform float uLuminosity;\n\nvoid main() {\n  vec3 lightDirection = normalize(uSunPosition);\n  float light = dot(vWorldNormal, lightDirection) * 0.5 + 0.5;\n  light = pow(light, 2.0);\n  light = mix(uLuminosity, 1.0, light);\n  gl_FragColor = vec4(vColor * uColor * light, 1.0);\n}\n"}),this.sunPosition=this.uniforms.uSunPosition.value}}},47174:function(e,t,n){"use strict";n.d(t,{b:function(){return g},R:function(){return y}});var r=n(32717),a=n(52471);let i=["common","uv_pars_vertex","displacementmap_pars_vertex","color_pars_vertex","fog_pars_vertex","normal_pars_vertex","morphtarget_pars_vertex","skinning_pars_vertex","shadowmap_pars_vertex","logdepthbuf_pars_vertex","clipping_planes_pars_vertex","uv_vertex","color_vertex","morphcolor_vertex","beginnormal_vertex","morphnormal_vertex","skinbase_vertex","skinnormal_vertex","defaultnormal_vertex","normal_vertex","begin_vertex","morphtarget_vertex","skinning_vertex","displacementmap_vertex","project_vertex","logdepthbuf_vertex","clipping_planes_vertex","worldpos_vertex","shadowmap_vertex","fog_vertex","common","packing","dithering_pars_fragment","color_pars_fragment","uv_pars_fragment","map_pars_fragment","alphamap_pars_fragment","alphatest_pars_fragment","alphahash_pars_fragment","aomap_pars_fragment","lightmap_pars_fragment","emissivemap_pars_fragment","iridescence_fragment","cube_uv_reflection_fragment","envmap_common_pars_fragment","envmap_physical_pars_fragment","fog_pars_fragment","lights_pars_begin","normal_pars_fragment","lights_physical_pars_fragment","transmission_pars_fragment","shadowmap_pars_fragment","bumpmap_pars_fragment","normalmap_pars_fragment","clearcoat_pars_fragment","iridescence_pars_fragment","roughnessmap_pars_fragment","metalnessmap_pars_fragment","logdepthbuf_pars_fragment","clipping_planes_pars_fragment","clipping_planes_fragment","logdepthbuf_fragment","map_fragment","color_fragment","alphamap_fragment","alphatest_fragment","alphahash_fragment","roughnessmap_fragment","metalnessmap_fragment","normal_fragment_begin","normal_fragment_maps","clearcoat_normal_fragment_begin","clearcoat_normal_fragment_maps","emissivemap_fragment","lights_physical_fragment","lights_fragment_begin","lights_fragment_maps","lights_fragment_end","aomap_fragment","transmission_fragment","opaque_fragment","tonemapping_fragment","colorspace_fragment","fog_fragment","premultiplied_alpha_fragment","dithering_fragment"];var o=n(79509);class s{static from(e,t){if(t instanceof o.Observable){if("number"==typeof t.value)return new s(e,t);throw Error("Observable value must be a number")}let n=typeof t;return"object"===n&&(t.constructor===Object||t instanceof a.Uniform)&&"value"in t?new s(e,t):"string"===n?new s(e,{value:new a.Color(t)}):new s(e,{value:t})}get value(){return this.target.value}computeDeclaration(){let e=this.name,t=this.target.value,n="";if(t instanceof Float32Array)return"uniform float ".concat(e,"[").concat(t.length,"];");if(Array.isArray(t)&&(n="[".concat(t.length,"]"),t=t[0]),"number"==typeof t)return"uniform float ".concat(e).concat(n,";");if(t.isVector2)return"uniform vec2 ".concat(e).concat(n,";");if(t.isVector3||t.isColor)return"uniform vec3 ".concat(e).concat(n,";");if(t.isVector4||t.isQuaternion)return"uniform vec4 ".concat(e).concat(n,";");if(t.isMatrix3)return"uniform mat3 ".concat(e).concat(n,";");if(t.isMatrix4)return"uniform mat4 ".concat(e).concat(n,";");if(t.isTexture)return t.isCubeTexture?"uniform samplerCube ".concat(e).concat(n,";"):"uniform sampler2D ".concat(e).concat(n,";");throw console.log("unhandled value:",t),Error('unhandled value: "'.concat(null==t?void 0:t.constructor.name,'"'))}constructor(e,t){this.name=e,this.target=t}}function l(){let e=(0,r._)(["","s*",""],["","\\s*",""]);return l=function(){return e},e}let c=null,d=e=>(c=e,g),u="// ShaderForge (injected code) ->",h="// <- ShaderForge",p=e=>"".concat(u,"\n").concat(e.trim(),"\n").concat(h),f=e=>{let t=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=RegExp(String.raw(l(),t(h),t(u)),"g");return e.replaceAll(n,"")};class m{getPattern(e){let{throwError:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="#include <".concat(e,">"),r=this.type;if(t&&!1===c[r].includes(n))throw Error('"'.concat(n,'" is not present in the shader template program.'));return{pattern:n,type:r}}replace(e,t){if(e instanceof RegExp){let{type:n}=this;c[n].match(e),c[n]=c[n].replace(e,p(t))}else{let{type:n,pattern:r}=this.getPattern(e),a=p(t);c[n]=c[n].replace(r,a)}return g}inject(e,t,n){let{type:r,pattern:a}=this.getPattern(t),i="after"===e?"".concat(a,"\n").concat(p(n)):"".concat(p(n),"\n").concat(a);return c[r]=c[r].replace(a,i),g}injectTokenComments(){for(let e of i){let{type:t,pattern:n}=this.getPattern(e,{throwError:!1});c[t]=c[t].replace(n,"\n        ".concat(n,"\n        // ShaderForge TOKEN: ").concat(e,"\n      "))}return g}header(e){let t=this.type;return c[t]="".concat(e,"\n").concat(c[t]),g}before(e,t){return this.inject("before",e,t)}after(e,t){return this.inject("after",e,t)}top(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return c[this.type]=c[this.type].replace("void main() {","\n      ".concat(p(t.join("\n\n")),"\n      void main() {\n    ")),g}mainBeforeAll(e){return c[this.type]=c[this.type].replace("void main() {","void main() {\n        ".concat(p(e))),g}mainAfterAll(e){return c[this.type]=c[this.type].replace(/}\s*$/,"\n      ".concat(p(e),"\n    }")),g}uniforms(e){if("string"==typeof e)this.top(e);else{let t=[];for(let[n,r]of Object.entries(e)){let e=s.from(n,r);t.push(e.computeDeclaration())}this.top(t.join("\n")),function(e){for(let[t,n]of Object.entries(e)){let e=s.from(t,n);if(t in c.uniforms){if(e.value!==c.uniforms[t].value)throw Error("Shader redefinition! (Uniform values are not equal)")}else c.uniforms[t]=e}}(e)}return g}clean(){return c[this.type]=f(c[this.type]),g}printFinalCode(){return console.log(c[this.type].replace(/#include <(.*)>/g,(e,t)=>{let n=a.ShaderChunk[t];if(!n)throw Error('Shader chunk "'.concat(t,'" not found'));return n})),g}constructor(e){this.type=e}}let v=new m("fragmentShader"),x=new m("vertexShader"),g=Object.assign(function(e){return e&&d(e),g},{shaderName:function(e){return c.shaderName="".concat(e," (ShaderForge)"),g},defines:function(e){return c.defines?Object.assign(c.defines,e):c.defines=e,g},uniforms:function(e){return x.uniforms(e),v.uniforms(e),g},varying:function(e){let t="";if("string"==typeof e)t=e;else{let n=[];for(let[t,r]of Object.entries(e))n.push("varying ".concat(r," ").concat(t,";"));t=n.join("\n")}return x.top(t),v.top(t),g},vertex:x,fragment:v,header:function(e){return v.header(e),x.header(e),g},clean:function(){return v.clean(),x.clean(),g},with:d,wrap:(e,t)=>(e.onBeforeCompile=e=>{c=e},e)}),w=new a.Color;function y(e){let{r:t,g:n,b:r}=w.set(e);return"vec3(".concat(t.toFixed(3),", ").concat(n.toFixed(3),", ").concat(r.toFixed(3),")")}},49635:function(e,t,n){"use strict";n.d(t,{$:function(){return o},E:function(){return l}});var r=n(52471),a=n(81796);let i=new r.Matrix4;function o(e){return(0,a.Xe)(e,i)}let s=new r.Color;function l(e){return s.set(e)}},70155:function(e,t,n){"use strict";n.d(t,{C:function(){return a}});let r={vecX:["float","vec2","vec3","vec4"]},a=(e,t)=>{let n=[],a=Array.isArray(e)?e:[e].map(e=>e in r?r[e]:e).flat();if("function"==typeof t)for(let e of a)n.push(t(e).replaceAll(/\bT\b/g,e));else for(let e of a)n.push(t.replaceAll(/\bT\b/g,e));return n.join("\n")}},98828:function(e,t,n){"use strict";n.d(t,{U:function(){return i}});var r=n(26917),a=n(70155);let i="\n  ".concat(r.l,"\n\n  float sin01(float x) {\n    return 0.5 + 0.5 * sin(x * 6.283185307179586);\n  }\n\n  vec2 scaleAround(vec2 p, vec2 c, float s) {\n    return c + (p - c) / s;\n  }\n\n  // Same as mix, but clamped.\n  ").concat((0,a.C)("vecX","\n    T lerp(in T a, in T b, in float x) {\n      return mix(a, b, clamp01(x));\n    }\n  "),"\n\n  float inverseLerpUnclamped(in float a, in float b, float x) {\n    return (x - a) / (b - a);\n  }\n\n  float inverseLerp(in float a, in float b, float x) {\n    return clamp01((x - a) / (b - a));\n  }\n\n  float threshold(in float x, in float thresholdValue) {\n    return x < thresholdValue ? 0. : 1.;\n  }\n\n  float threshold(in float x, in float thresholdValue, in float width) {\n    return width < 1e-9 \n      ? (x < thresholdValue ? 0. : 1.)\n      : clamp01((x - thresholdValue + width * .5) / width);\n  }\n\n  mat3 extractRotation(mat4 matrix) {\n    return mat3(matrix[0].xyz, matrix[1].xyz, matrix[2].xyz);\n  }\n\n  vec2 rotate(vec2 p, float a) {\n    float c = cos(a);\n    float s = sin(a);\n    float x = c * p.x + s * p.y;\n    float y = -s * p.x + c * p.y;\n    return vec2(x, y);\n  }\n\n  vec2 rotateAround(vec2 p, float a, vec2 c) {\n    return c + rotate(p - c, a);\n  }\n\n  vec2 rotateScaleAround(vec2 p, float a, float s, vec2 c) {\n    return c + rotate((p - c) / s, a);\n  }\n  \n  float positiveModulo(float x) {\n    x = mod(x, 1.0);\n    return x < 0.0 ? x + 1.0 : x;\n  }\n\n  float positiveModulo(float x, float modulo) {\n    x = mod(x, modulo);\n    return x < 0.0 ? x + modulo : x;\n  }\n\n  // Limit a value to a maximum that the function tends to reach when x -> \n  // https://www.desmos.com/calculator/0vewkbnscu\n  float limited(float x, float maxValue) {\n    return x <= 0.0 ? x : maxValue * x / (maxValue + x);\n  }\n\n  // https://www.desmos.com/calculator/0vewkbnscu\n  float limited(float x, float minValue, float maxValue) {\n    float d = maxValue - minValue;\n    float xd = x - minValue;\n    return x <= minValue ? x : minValue + d * xd / (d + xd);\n  }\n\n  float sqLength(in vec2 p) {\n    return p.x * p.x + p.y * p.y;\n  }\n\n  float sqLength(in vec3 p) {\n    return p.x * p.x + p.y * p.y + p.z * p.z;\n  }\n\n  float pcurve(float x, float a, float b) {\n    float k = pow(a + b, a + b) / (pow(a, a) * pow(b, b));\n    return k * pow(x, a) * pow(1.0 - x, b);\n  }\n\n  float hash(vec3 p) {\n    return fract(sin(dot(p, vec3(12.9898, 78.233, 45.164))) * 43758.5453);\n  }\n\n  ").concat((0,a.C)("vecX","\n    T min3(in T a, in T b, in T c) {\n      return min(min(a, b), c);\n    }\n  "),"\n\n  ").concat((0,a.C)("vecX","\n    T min4(in T a, in T b, in T c, in T d) {\n      return min(min(a, b), min(c, d));\n    }\n  "),"\n")},16573:function(e,t,n){"use strict";function*r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=0,a=0;2===t.length?(r=t[0],a=t[1]):Array.isArray(t[0])?(r=t[0][0],a=t[0][1]):(r=t[0].x,a=t[0].y);let i=0,o=0,s=0,l={get i(){return i},get x(){return o},get y(){return s},get tx(){return o/(r-1)},get ty(){return s/(a-1)}};for(s=0;s<a;s++)for(o=0;o<r;o++)yield l,i++}function*a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=0,a=0,i=0;3===t.length?(r=t[0],a=t[1],i=t[2]):Array.isArray(t[0])?(r=t[0][0],a=t[0][1],i=t[0][2]):(r=t[0].x,a=t[0].y,i=t[0].z);let o=0,s=0,l=0,c=0,d={get i(){return o},get x(){return s},get y(){return l},get z(){return c},get tx(){return s/(r-1)},get ty(){return l/(a-1)},get tz(){return c/(i-1)}};for(c=0;c<i;c++)for(l=0;l<a;l++)for(s=0;s<r;s++)yield d,o++}n.d(t,{B:function(){return r},K:function(){return a}})},58681:function(e){e.exports={Client:"client_Client__zoy80"}}},function(e){e.O(0,[2973,2520,4979,6669,4339,5244,4964,6712,6666,5792,2452,7741,2722,9205,2670,3831,3718,4940,8648,4831,9918,8181,3583,324,494,9794,4187,2920,7936,1744],function(){return e(e.s=70550)}),_N_E=e.O()}]);
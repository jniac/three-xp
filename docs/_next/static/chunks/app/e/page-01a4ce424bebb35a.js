(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9091],{50406:function(e,t,i){Promise.resolve().then(i.t.bind(i,77601,23)),Promise.resolve().then(i.bind(i,37351)),Promise.resolve().then(i.bind(i,81665)),Promise.resolve().then(i.bind(i,81497)),Promise.resolve().then(i.bind(i,89202)),Promise.resolve().then(i.bind(i,35677)),Promise.resolve().then(i.bind(i,1938)),Promise.resolve().then(i.bind(i,71523)),Promise.resolve().then(i.t.bind(i,51011,23)),Promise.resolve().then(i.bind(i,1050))},37351:function(e,t,i){"use strict";i.d(t,{Main:function(){return A}});var a=i(41291),r=i(81406),s=i(13841),n=i(57872),o=i(64740),l=i(8423),d=i(51776),c=i(35459),u=i(4798),h=i(59544),p=i(33628),f=i(90642),m=i(11315),v=i(51845),g=i(55712),x=i(18620),M=i(37234),y=i(80493),w=i(91046);class b extends x.w{dispose(){this.gtaoNoiseTexture.dispose(),this.pdNoiseTexture.dispose(),this.normalRenderTarget.dispose(),this.gtaoRenderTarget.dispose(),this.pdRenderTarget.dispose(),this.normalMaterial.dispose(),this.pdMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}get gtaoMap(){return this.pdRenderTarget.texture}setGBuffer(e,t){void 0!==e?(this.depthTexture=e,this.normalTexture=t,this._renderGBuffer=!1):(this.depthTexture=new o.DepthTexture,this.depthTexture.format=o.DepthStencilFormat,this.depthTexture.type=o.UnsignedInt248Type,this.normalRenderTarget=new o.WebGLRenderTarget(this.width,this.height,{minFilter:o.NearestFilter,magFilter:o.NearestFilter,type:o.HalfFloatType,depthTexture:this.depthTexture}),this.normalTexture=this.normalRenderTarget.texture,this._renderGBuffer=!0);let i=this.normalTexture?1:0,a=this.depthTexture===this.normalTexture?"w":"x";this.gtaoMaterial.defines.NORMAL_VECTOR_TYPE=i,this.gtaoMaterial.defines.DEPTH_SWIZZLING=a,this.gtaoMaterial.uniforms.tNormal.value=this.normalTexture,this.gtaoMaterial.uniforms.tDepth.value=this.depthTexture,this.pdMaterial.defines.NORMAL_VECTOR_TYPE=i,this.pdMaterial.defines.DEPTH_SWIZZLING=a,this.pdMaterial.uniforms.tNormal.value=this.normalTexture,this.pdMaterial.uniforms.tDepth.value=this.depthTexture,this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture}setSceneClipBox(e){e?(this.gtaoMaterial.needsUpdate=1!==this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=1,this.gtaoMaterial.uniforms.sceneBoxMin.value.copy(e.min),this.gtaoMaterial.uniforms.sceneBoxMax.value.copy(e.max)):(this.gtaoMaterial.needsUpdate=0===this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=0)}updateGtaoMaterial(e){void 0!==e.radius&&(this.gtaoMaterial.uniforms.radius.value=e.radius),void 0!==e.distanceExponent&&(this.gtaoMaterial.uniforms.distanceExponent.value=e.distanceExponent),void 0!==e.thickness&&(this.gtaoMaterial.uniforms.thickness.value=e.thickness),void 0!==e.distanceFallOff&&(this.gtaoMaterial.uniforms.distanceFallOff.value=e.distanceFallOff,this.gtaoMaterial.needsUpdate=!0),void 0!==e.scale&&(this.gtaoMaterial.uniforms.scale.value=e.scale),void 0!==e.samples&&e.samples!==this.gtaoMaterial.defines.SAMPLES&&(this.gtaoMaterial.defines.SAMPLES=e.samples,this.gtaoMaterial.needsUpdate=!0),void 0!==e.screenSpaceRadius&&(e.screenSpaceRadius?1:0)!==this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS&&(this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS=e.screenSpaceRadius?1:0,this.gtaoMaterial.needsUpdate=!0)}updatePdMaterial(e){let t=!1;void 0!==e.lumaPhi&&(this.pdMaterial.uniforms.lumaPhi.value=e.lumaPhi),void 0!==e.depthPhi&&(this.pdMaterial.uniforms.depthPhi.value=e.depthPhi),void 0!==e.normalPhi&&(this.pdMaterial.uniforms.normalPhi.value=e.normalPhi),void 0!==e.radius&&e.radius!==this.radius&&(this.pdMaterial.uniforms.radius.value=e.radius),void 0!==e.radiusExponent&&e.radiusExponent!==this.pdRadiusExponent&&(this.pdRadiusExponent=e.radiusExponent,t=!0),void 0!==e.rings&&e.rings!==this.pdRings&&(this.pdRings=e.rings,t=!0),void 0!==e.samples&&e.samples!==this.pdSamples&&(this.pdSamples=e.samples,t=!0),t&&(this.pdMaterial.defines.SAMPLES=this.pdSamples,this.pdMaterial.defines.SAMPLE_VECTORS=(0,w.a)(this.pdSamples,this.pdRings,this.pdRadiusExponent),this.pdMaterial.needsUpdate=!0)}render(e,t,i){switch(this._renderGBuffer&&(this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.gtaoMaterial.uniforms.cameraWorldMatrix.value.copy(this.camera.matrixWorld),this.renderPass(e,this.gtaoMaterial,this.gtaoRenderTarget,16777215,1),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.renderPass(e,this.pdMaterial,this.pdRenderTarget,16777215,1),this.output){case b.OUTPUT.Off:break;case b.OUTPUT.Diffuse:this.copyMaterial.uniforms.tDiffuse.value=i.texture,this.copyMaterial.blending=o.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case b.OUTPUT.AO:this.copyMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.copyMaterial.blending=o.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case b.OUTPUT.Denoise:this.copyMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.copyMaterial.blending=o.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case b.OUTPUT.Depth:this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case b.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=o.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case b.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=i.texture,this.copyMaterial.blending=o.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blendMaterial.uniforms.intensity.value=this.blendIntensity,this.blendMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.renderPass(e,this.blendMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.GTAOPass: Unknown output type.")}}renderPass(e,t,i,a,r){e.getClearColor(this.originalClearColor);let s=e.getClearAlpha(),n=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,null!=a&&(e.setClearColor(a),e.setClearAlpha(r||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=n,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}renderOverride(e,t,i,a,r){e.getClearColor(this.originalClearColor);let s=e.getClearAlpha(),n=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,a=t.clearColor||a,r=t.clearAlpha||r,null!=a&&(e.setClearColor(a),e.setClearAlpha(r||0),e.clear()),this.scene.overrideMaterial=t;let o=this.camera.layers.mask;this.camera.layers.set(0),e.render(this.scene,this.camera),this.camera.layers.mask=o,this.scene.overrideMaterial=null,e.autoClear=n,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}setSize(e,t){this.width=e,this.height=t,this.gtaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.pdRenderTarget.setSize(e,t),this.gtaoMaterial.uniforms.resolution.value.set(e,t),this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.pdMaterial.uniforms.resolution.value.set(e,t),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse)}overrideVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){let i=t.get(e);e.visible=i}),t.clear()}generateNoise(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=new g.L,i=new Uint8Array(e*e*4);for(let a=0;a<e;a++)for(let r=0;r<e;r++){let s=a,n=r;i[(a*e+r)*4]=(.5*t.noise(s,n)+.5)*255,i[(a*e+r)*4+1]=(.5*t.noise(s+e,n)+.5)*255,i[(a*e+r)*4+2]=(.5*t.noise(s,n+e)+.5)*255,i[(a*e+r)*4+3]=(.5*t.noise(s+e,n+e)+.5)*255}let a=new o.DataTexture(i,e,e,o.RGBAFormat,o.UnsignedByteType);return a.wrapS=o.RepeatWrapping,a.wrapT=o.RepeatWrapping,a.needsUpdate=!0,a}constructor(e,t,i,a,r,s,n){super(),this.width=void 0!==i?i:512,this.height=void 0!==a?a:512,this.clear=!0,this.camera=t,this.scene=e,this.output=0,this._renderGBuffer=!0,this._visibilityCache=new Map,this.blendIntensity=1,this.pdRings=2,this.pdRadiusExponent=2,this.pdSamples=16,this.gtaoNoiseTexture=(0,y.mK)(),this.pdNoiseTexture=this.generateNoise(),this.gtaoRenderTarget=new o.WebGLRenderTarget(this.width,this.height,{type:o.HalfFloatType}),this.pdRenderTarget=this.gtaoRenderTarget.clone(),this.gtaoMaterial=new o.ShaderMaterial({defines:Object.assign({},y.Sp.defines),uniforms:o.UniformsUtils.clone(y.Sp.uniforms),vertexShader:y.Sp.vertexShader,fragmentShader:y.Sp.fragmentShader,blending:o.NoBlending,depthTest:!1,depthWrite:!1}),this.gtaoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.gtaoMaterial.uniforms.tNoise.value=this.gtaoNoiseTexture,this.gtaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.normalMaterial=new o.MeshNormalMaterial,this.normalMaterial.blending=o.NoBlending,this.pdMaterial=new o.ShaderMaterial({defines:Object.assign({},w.m.defines),uniforms:o.UniformsUtils.clone(w.m.uniforms),vertexShader:w.m.vertexShader,fragmentShader:w.m.fragmentShader,depthTest:!1,depthWrite:!1}),this.pdMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.pdMaterial.uniforms.tNoise.value=this.pdNoiseTexture,this.pdMaterial.uniforms.resolution.value.set(this.width,this.height),this.pdMaterial.uniforms.lumaPhi.value=10,this.pdMaterial.uniforms.depthPhi.value=2,this.pdMaterial.uniforms.normalPhi.value=3,this.pdMaterial.uniforms.radius.value=8,this.depthRenderMaterial=new o.ShaderMaterial({defines:Object.assign({},y.gs.defines),uniforms:o.UniformsUtils.clone(y.gs.uniforms),vertexShader:y.gs.vertexShader,fragmentShader:y.gs.fragmentShader,blending:o.NoBlending}),this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new o.ShaderMaterial({uniforms:o.UniformsUtils.clone(M.C.uniforms),vertexShader:M.C.vertexShader,fragmentShader:M.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:o.DstColorFactor,blendDst:o.ZeroFactor,blendEquation:o.AddEquation,blendSrcAlpha:o.DstAlphaFactor,blendDstAlpha:o.ZeroFactor,blendEquationAlpha:o.AddEquation}),this.blendMaterial=new o.ShaderMaterial({uniforms:o.UniformsUtils.clone(y.mF.uniforms),vertexShader:y.mF.vertexShader,fragmentShader:y.mF.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:o.CustomBlending,blendSrc:o.DstColorFactor,blendDst:o.ZeroFactor,blendEquation:o.AddEquation,blendSrcAlpha:o.DstAlphaFactor,blendDstAlpha:o.ZeroFactor,blendEquationAlpha:o.AddEquation}),this.fsQuad=new x.T(null),this.originalClearColor=new o.Color,this.setGBuffer(r?r.depthTexture:void 0,r?r.normalTexture:void 0),void 0!==s&&this.updateGtaoMaterial(s),void 0!==n&&this.updatePdMaterial(n)}}b.OUTPUT={Off:-1,Default:0,Diffuse:1,Depth:2,Normal:3,AO:4,Denoise:5};var S=i(91310);class T extends u.C{render(e,t,i,a,r){var s;if(null===(s=this.onBeforeRender)||void 0===s||s.call(this),this.disableBackground){let s=this.scene.background;this.scene.background=null,super.render(e,t,i,a,r),this.scene.background=s}else super.render(e,t,i,a,r)}constructor(...e){super(...e),this.onBeforeRender=null,this.disableBackground=!1}}function P(){let{ref:e}=(0,s.sv)(function*(e){let t=function(e){let{width:t=window.innerWidth,height:i=window.innerHeight}=e,a=new o.WebGLRenderer({});a.setSize(t,i),a.setPixelRatio(window.devicePixelRatio);let r=new o.PerspectiveCamera(75,t/i,.1,1e3);r.position.z=8,new l.z(r,a.domElement);let s=new m.vB().set({activeDuration:30}),n=(0,v.s)(()=>s.requestActivation()),u=function(e){let t=new o.Scene;{let e=new o.DirectionalLight(16777215,1);e.position.set(0,3,1),t.add(e);let i=new o.HemisphereLight("#afdbf5","#845244",1);t.add(i)}new S.x().setPath("https://threejs.org/examples/textures/equirectangular/").loadAsync("pedestrian_overpass_1k.hdr").then(e=>{e.mapping=o.EquirectangularReflectionMapping,t.environmentIntensity=.1,t.environment=e,t.backgroundBlurriness=.5,t.background=e});let i=new o.Mesh(new o.TorusKnotGeometry(2,1,512,64),new o.MeshPhysicalMaterial);t.add(i);let a=new o.Mesh(new o.BoxGeometry(10,1,3),new o.MeshPhysicalMaterial);t.add(a);let r=new o.Mesh(new o.BoxGeometry(1,10,3),new o.MeshPhysicalMaterial);r.position.set(5,0,0),t.add(r);let s=new o.Mesh(new o.PlaneGeometry(10,10),new o.MeshPhysicalMaterial({color:"#d1ddff",transmission:1,roughness:0,dispersion:.1,ior:2.5,opacity:1}));return s.layers.set(1),t.add(s),e.onTick(e=>{i.rotation.x+=.5*e.deltaTime,i.rotation.y+=.5*e.deltaTime}),t}(s),g=new d.x(a),x=new T(u,r);x.onBeforeRender=()=>{r.layers.enableAll()},g.addPass(x);let M=new b(u,r,t,i);g.addPass(M);let y=new c.v;g.addPass(y);let w=new h.T(p.C);w.material.uniforms.resolution.value.set(1/t,1/i),g.addPass(w),s.onTick(()=>{g.render()}),f.v.on("REQUIRE:THREE",e=>{e.payload={three:P}});let P={renderer:a,camera:r,scene:u,ticker:s,passes:{render:x,ao:M,output:y},destroy:()=>{a.domElement.remove(),s.destroy(),n.destroy()}};return P}({width:e.clientWidth,height:e.clientHeight});yield t,Object.assign(window,{three:t}),e.appendChild(t.renderer.domElement)},[]);return(0,a.jsx)("div",{ref:e,className:"absolute inset-0"})}function A(){let[e,t]=(0,r.useState)(!0);return(0,a.jsxs)("div",{className:"page",children:[(0,a.jsx)(P,{}),(0,a.jsxs)("div",{className:"absolute inset-0 p-8 flex flex-col items-start justify-start pointer-through",children:[(0,a.jsxs)("div",{className:"flex flex-col items-start justify-start pointer-through max-w-[480px]",children:[(0,a.jsx)("h1",{className:"text-4xl uppercase",children:"ao-transparent"}),(0,a.jsx)("div",{className:"mt-4"}),(0,a.jsx)("p",{children:"Handling Ambient Occlusion and transparent objects"}),(0,a.jsx)("p",{children:"The glass does not generate AO"}),(0,a.jsx)("div",{className:"mt-4"}),(0,a.jsxs)("p",{children:["This is achieved by using a fork of the ",(0,a.jsx)("a",{href:"https://github.com/mrdoob/three.js/blob/master/examples/jsm/postprocessing/GTAOPass.js",children:"GTAOPass"}),"\xa0where the camera layer mask is set to 0 (default layer) and the glass object is set to layer 1 (transparent objects)."]}),(0,a.jsx)("div",{className:"mt-4"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl",children:"Pros:"}),(0,a.jsx)("ul",{children:(0,a.jsx)("li",{children:"Simple (layer based)"})})]}),(0,a.jsx)("div",{className:"mt-4"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl",children:"Cons:"}),(0,a.jsx)("ul",{children:(0,a.jsx)("li",{children:"AO is still rendered on top of transparent objects. For semi-opaque objects, this is could be a problem."})})]})]}),(0,a.jsx)("div",{className:"mt-4"}),(0,a.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,a.jsx)("label",{htmlFor:"ao-enabled",className:"select-none",children:"Enable AO"}),(0,a.jsx)("input",{type:"checkbox",name:"ao-enabled",id:"ao-enabled",checked:e,onChange:()=>{let{payload:e}=n.v.send("REQUIRE:THREE");if(e){let{three:i}=e,{passes:a}=i,{ao:r}=a;r.enabled=!r.enabled,t(r.enabled)}}})]})]})]})}},89202:function(e,t,i){"use strict";i.d(t,{Main:function(){return z}});var a=i(41291),r=i(62362),s=i(64740),n=i(26028),o=i(73437);let l=new s.LineBasicMaterial({color:"white",transparent:!0,depthTest:!1}),d={circle:(()=>{let e=new s.BufferGeometry,t=Array.from({length:81},(e,t)=>{let i=t/80*Math.PI*2;return new s.Vector3(Math.cos(i),Math.sin(i),0)});return e.setFromPoints(t),e})(),box2:(()=>{let e=new s.BufferGeometry,t=[new s.Vector3(-.5,-.5,0),new s.Vector3(.5,-.5,0),new s.Vector3(.5,.5,0),new s.Vector3(-.5,.5,0),new s.Vector3(-.5,-.5,0)];return e.setFromPoints(t),e})()};class c extends s.Group{setupUniforms(e,t){let{value:i}=e,{value:a}=t;i.copy(this.matrixWorld),i.invert()}init(e){this.props=e,this.renderOrder=1}setup(){}set(e){Object.assign(this.props,e),this.setup()}}let u={radius:2,falloff:1};class h extends c{get radius(){return this.props.radius}set radius(e){this.props.radius=e,this.setup()}get falloff(){return this.props.falloff}set falloff(e){this.props.falloff=e,this.setup()}setupUniforms(e,t){super.setupUniforms(e,t);let{radius:i,falloff:a}=this.props;t.value.set(i,a,0,0)}setup(){let{circle0:e,circle1:t}=this.parts,{radius:i,falloff:a}=this.props;e.scale.setScalar(i),t.scale.setScalar(i+a)}constructor(e){super(),this.parts={circle0:new s.Line(d.circle,l),circle1:new s.Line(d.circle,l)},this.init({...u,...e}),this.add(this.parts.circle0),this.add(this.parts.circle1),this.setup()}}h.glsl="\n    struct CircleFalloff {\n      mat4 matrix;\n      float radius;\n      float falloff;\n    };\n    float falloff(CircleFalloff falloff, vec3 p) {\n      p = (falloff.matrix * vec4(p, 1.0)).xyz;\n      float d = length(p);\n      return 1.0 - (d - falloff.radius) / falloff.falloff;\n    }\n  ";let p={width:1,height:1,falloff:1};class f extends c{setupUniforms(e,t){super.setupUniforms(e,t);let{width:i,height:a,falloff:r}=this.props;t.value.set(i,a,r,0)}setup(){let{box0:e,box1:t}=this.parts,{width:i,height:a,falloff:r}=this.props;e.scale.set(i,a,1),t.scale.set(i+2*r,a+2*r,1)}constructor(e){super(),this.parts={box0:new s.Line(d.box2,l),box1:new s.Line(d.box2,l)},this.init({...p,...e}),this.add(this.parts.box0),this.add(this.parts.box1),this.setup()}}f.glsl="\n    struct ManhattanBox2Falloff {\n      mat4 matrix;\n      float width;\n      float height;\n      float falloff;\n    };\n    float falloff(ManhattanBox2Falloff falloff, vec3 p) {\n      p = (falloff.matrix * vec4(p, 1.0)).xyz;\n      float x = abs(p.x) - falloff.width * 0.5;\n      float y = abs(p.y) - falloff.height * 0.5;\n      return 1.0 - max(x, y) / falloff.falloff;\n    }\n  ";var m=i(42685),v=i(64556),g=i(56246),x=i(76171),M=i(2164),y=i(68392),w=i(25463),b=i(71441);function S(e){let{r:t,g:i,b:a}=new s.Color(e);return"vec3(".concat(t.toFixed(3),", ").concat(i.toFixed(3),", ").concat(a.toFixed(3),")")}let T={grid:[16,16]},P=new s.PlaneGeometry(1,1,1,1),A=new s.MeshBasicMaterial({side:s.DoubleSide,transparent:!0}),C={uRadiusScalar:new s.Uniform(.9),uCircleMat:new s.Uniform(new s.Matrix4().identity()),uCircleProps:new s.Uniform(new s.Vector4(1,2,0,0)),uBox0Mat:new s.Uniform(new s.Matrix4().identity()),uBox0Props:new s.Uniform(new s.Vector4(1,1,0,0))};A.onBeforeCompile=e=>m.b.with(e).defines({USE_UV:""}).uniforms(C).varying({vCenter:"vec3",vWorldPosition2:"vec3"}).vertex.mainAfterAll("\n    vWorldPosition2 = (modelMatrix * instanceMatrix * vec4(transformed, 1.0)).xyz;\n    vCenter = (modelMatrix * instanceMatrix[3]).xyz;\n  ").fragment.top(y.U,x.g,M.i).fragment.top(h.glsl,f.glsl).fragment.after("color_fragment","\n    CircleFalloff circle = CircleFalloff(uCircleMat, uCircleProps.x, uCircleProps.y);\n    ManhattanBox2Falloff box = ManhattanBox2Falloff(uBox0Mat, uBox0Props.x, uBox0Props.y, uBox0Props.z);\n    float d = 0.0;\n    d += clamp01(falloff(box, vWorldPosition2));\n    d += clamp01(falloff(circle, vWorldPosition2));\n    diffuseColor.rgb = mix(".concat(S("#c2e1ff"),", ").concat(S("#d80773"),", easeInOut3(clamp01(d)));\n  ")).fragment.after("alphamap_fragment","\n    float scalar = 1.0 / uRadiusScalar / mix(1.0, 0.25, easeInOut3(clamp01(d)));\n    float alpha = smoothstep(1.0, 0.99, length(vUv - 0.5) * scalar / 0.5);\n\n    if (alpha < 0.01) discard;\n\n    diffuseColor.a *= alpha;\n  ");class R extends s.InstancedMesh{onTick(e){for(let e of Object.values(this.falloffs))e.visible=this.falloffsAreVisible;let{box0:t,circle:i}=this.falloffs;i.falloff=(0,b.t7)(.1,4,e.sin01Time({frequency:.15})),i.radius=(0,b.t7)(1,5,e.sin01Time({frequency:.1,phase:.5})),i.setupUniforms(C.uCircleMat,C.uCircleProps),t.rotation.z+=.1*e.deltaTime,t.set({width:8,falloff:(0,b.t7)(.5,6,e.sin01Time({frequency:.15}))}),t.setupUniforms(C.uBox0Mat,C.uBox0Props)}constructor(e){var t;let{x:i,y:a}=(0,o.iK)(null!==(t=null==e?void 0:e.grid)&&void 0!==t?t:T.grid);for(let t of(super(P,A,i*a),this.internal={grid:new s.Vector2},this.falloffsAreVisible=!0,this.falloffs={circle:(0,g.bB)(new h,this,{position:[-3,-2,0]}),box0:(0,g.bB)(new f({}),this,{position:[3,2,0]})},this.props={...T,...e},(0,w.B)(i,a)))this.setMatrixAt(t.i,(0,v.$)({x:t.x-i/2,y:t.y-a/2}))}}function*D(e){e.scene.background=new s.Color("#1c54e0"),e.ticker.set({activeDuration:30}),e.useOrbitControls();let t=new R;e.scene.add(t),yield()=>t.removeFromParent(),yield(0,n.w)(document.body,{onTap(){t.falloffsAreVisible=!t.falloffsAreVisible}})}function U(){return(0,r.Ky)(D),null}function z(){return(0,a.jsx)("div",{className:"absolute-through",children:(0,a.jsx)(r.H7,{children:(0,a.jsx)(U,{})})})}},1938:function(e,t,i){"use strict";i.d(t,{Client:function(){return N}});var a=i(41291),r=i(64740),s=i(32678),n=i(75952),o=i(56246),l=i(70928),d=i(62362),c=i(1050),u=i(47804),h=i(64556),p=i(27636),f=i(73437),m=i(7556),v=i(71441);class g{constructor(e,t,i,a){this.space=e,this.rect=t,this.uvRect=i,this.scatterCoeff=a,this.r0=p.T.random(),this.r1=p.T.random()}}class x{constructor(e,t){this.props={...x.defaultProps,...t};let{position:i,size:a,scatterPadding:r,sizeOptions:s,seed:n}=this.props,{col:o,row:l}=e.props;p.T.seed(n);let d=p.T.createPicker(s),c=Array.from({length:o}).map(d),u=Array.from({length:l}).map(d),{x:h,y:M}=(0,f.iK)(i),{x:y,y:w}=(0,f.iK)(a),b=new m.T(m.Nm.Horizontal).setSize(y,w).setOffset(h-y/2,M-w/2);for(let e of c){let t=new m.T(m.Nm.Vertical).setSize("".concat(e,"fr")).addTo(b);for(let e of u)new m.T(m.Nm.Horizontal).setSize("".concat(e,"fr")).addTo(t)}b.computeLayout();let S=b.rect,T=[...b.allLeaves({includeSelf:!1})],P=(y+w)/2,A=T.map(e=>{let t=e.rect.clone(),i=t.clone().relativeTo(S),{x:a,y:s}=t.getCenter(),n=(0,v.ii)(.5,1,(Math.abs(a-h)+Math.abs(s-M))/P);return t.centerX+=p.T.between(-r,r)*n,t.centerY+=p.T.between(-r,r)*n,new g(e,t,i,n)});this.root=b,this.nodes=A}}x.defaultProps={seed:87654,position:new r.Vector2(0,0),size:new r.Vector2(3,2),scatterPadding:.1,sizeOptions:[[.5,1],[1,10],[2,2],[3,1]]};var M=i(73987);class y extends r.LineSegments{clear(){return this.points.length=0,this.geometry.setFromPoints(this.points),this}rectangle(e){let{x:t,y:i,width:a,height:s}=M.Ae.from(e),n=a/2,o=s/2,l=new r.Vector2(t-n,i-o),d=new r.Vector2(t+n,i-o),c=new r.Vector2(t+n,i+o),u=new r.Vector2(t-n,i+o);return this.points.push(l,d,d,c,c,u,u,l),this.geometry.setFromPoints(this.points),this}constructor(...e){super(...e),this.points=[]}}var w=i(16516),b=i(42685),S=i(2164),T=i(68392),P=i(89425);class A extends r.Object3D{constructor(){super();let e=new r.HemisphereLight("#ffffff","#926969",1);this.add(e);let t=new r.DirectionalLight("#ffffff",2);this.add(t),t.position.set(2,4,1)}}class C extends r.MeshBasicMaterial{get mapAspect(){return this.uniforms.uMapInfo.value.x}set mapAspect(e){this.uniforms.uMapInfo.value.x=e}getScatteredSize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new r.Vector2;return e.x=this.uniforms.uScatteredInfo.value.x,e.y=this.uniforms.uScatteredInfo.value.y,e}setScatteredSize(e){this.uniforms.uScatteredInfo.value.x=e.x,this.uniforms.uScatteredInfo.value.y=e.y}get scatteredSize(){return this.getScatteredSize()}set scatteredSize(e){this.setScatteredSize(e)}update(e){e*=.33,this.uniforms.uDispersionTime.value+=e*this.uniforms.uDispersion.value.x,this.uniforms.uLowDispersionTime.value+=e*this.uniforms.uLowDispersion.value.x}constructor(){super({side:r.DoubleSide}),this.uniforms={uDispersionTime:{value:0},uLowDispersionTime:{value:0},uDispersion:{value:new r.Vector4(1,-.6,.4,2)},uLowDispersion:{value:new r.Vector4(0,-.6,.4,0)},uMainParams:{value:new r.Vector4(1,0)},uCenter:{value:new r.Vector3},uMapInfo:{value:new r.Vector4(1,1,.5,.5)},uScatteredInfo:{value:new r.Vector4(1,1,0,0)},uNormalMap:{value:w.R.get("three").loadTexture("textures/rough_concrete_nor_gl_1k.jpg",e=>{e.wrapS=e.wrapT=r.RepeatWrapping})}},this.userData=function(e,t){for(let[i,a,r,s]of t)Object.defineProperty(e,"".concat(i,"_meta"),{enumerable:!0,value:s}),Object.defineProperty(e,i,{enumerable:!0,get:()=>a[r],set(e){a[r]=e}});return e}({},[["chunkScale",this.uniforms.uMainParams.value,"x","\n        Name(chunk.scale)\n        Slider(0, 1, step: any)\n      "],["imageVisibility",this.uniforms.uMainParams.value,"y","\n        Name(image.visibility)\n        Slider(0, 1, step: any)\n      "],["dispX",this.uniforms.uDispersion.value,"x","\n        Name(disp.x)\n        Slider(0, 1, step: any)\n      "],["dispY",this.uniforms.uDispersion.value,"y","\n        Name(disp.y)\n        Slider(-1, 1, step: any)\n      "],["dispZ",this.uniforms.uDispersion.value,"z","\n        Name(disp.z)\n        Slider(-1, 1, step: any)\n      "],["dispW",this.uniforms.uDispersion.value,"w","\n        Name(disp.cycle)\n        Slider(1, 20, step: 1)\n      "],["lowDispX",this.uniforms.uLowDispersion.value,"x","\n        Name(lowDisp.x)\n        Slider(0, 1, step: any)\n      "]]),this.onBeforeCompile=e=>b.b.with(e).defines({USE_UV:""}).uniforms(this.uniforms).varying({vRand:"vec4"}).vertex.top(T.U,S.i,'\n  // sizeMode: 0 for "contain", 1 for "cover"\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, vec2 scale) {\n    align.y = 1.0 - align.y; // Flip y-coordinate\n    if ((outerAspect > innerAspect) != (sizeMode == 1.0)) { // XOR condition for mode\n      float scaleFactor = outerAspect / innerAspect;\n      uv.x = (uv.x - align.x) * scaleFactor + align.x; // Adjust x-coordinate\n    } else {\n      float scaleFactor = innerAspect / outerAspect;\n      uv.y = (uv.y - align.y) * scaleFactor + align.y; // Adjust y-coordinate\n    }\n    uv = (uv - align) / scale + align;\n    return uv;\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, float scale) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, align, vec2(scale));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, align, vec2(1.0));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, vec2(0.5));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect) {\n    return applyUvSize(uv, outerAspect, innerAspect, 1.0);\n  }\n').vertex.top("\n        attribute vec4 aRectUv;\n        attribute vec4 aRand;\n      ").vertex.top("\n        vec2 delta;\n        float scatterRatio;\n\n        vec4 computeDispersion() {\n          if (uDispersion.x == 0.0) {\n            return vec4(0.0, 0.0, 0.0, 1.0);\n          }\n\n          float duration = lerp(8.0, 1.0, aRand.x * aRand.y * aRand.z);\n          float cycleCount = max(floor(uDispersion.w), 1.0);\n          float time = mod(uDispersionTime + duration * cycleCount * aRand.x, duration * cycleCount) / duration;\n          float cycleVisibility = time <= 1.0 ? 1.0 : easeInOut3(1.0 - inverseLerp(.8 * aRand.w + .1, .8 * aRand.w + .2, uDispersion.x));\n          time = mod(time, 1.0);\n          float size = easeInThenOut(time, 8.0) * lerp(2.0, 1.0, time * time) * cycleVisibility;\n          size = mix(1.0, size, pow(uDispersion.x, 1.0 / 2.0));\n\n          // Apply scale before instanceMatrix (shrinking).\n          vec3 dispersed;\n          dispersed.xy = -delta * lerp(uDispersion.y, uDispersion.z, time);\n          dispersed.z = lerp(1.0, 0.0, time);\n          dispersed *= uDispersion.x;\n\n          return vec4(dispersed, size);\n        }\n\n        float getStartEffect(float time, float duration) {\n          return min(1.0, time / duration);\n        }\n\n        float getEndEffect(float time, float timeMax, float duration) {\n          return max(0.0, time - (timeMax - duration)) / duration;\n        }\n\n        vec4 computeLowDispersion() {\n          if (uLowDispersion.x == 0.0) {\n            return vec4(0.0, 0.0, 0.0, 1.0);\n          }\n\n          float periodScalarT = inverseLerp(0.1, 0.9, scatterRatio);\n          float period = lerp(2.0, 8.0, aRand.x) * lerp(60.0, 1.0, periodScalarT);\n          float time = mod(uLowDispersionTime + period * aRand.z, period);\n\n          float duration = 1.0;\n          float effectStart = min(1.0, time);\n          float effectEnd = getEndEffect(time, period, duration);\n\n          float size = getStartEffect(time, 0.3) * (1.0 - getEndEffect(time, period, 0.3));\n          size = pow(size, 1.0 / 4.0);\n          size = mix(1.0, size, pow(uLowDispersion.x, 1.0 / 4.0));\n\n          vec3 dispersed;\n\n          dispersed.xy = delta * 0.1;\n          dispersed.z = 0.2;\n          dispersed.xyz *= getEndEffect(time, period, 1.0);\n          dispersed *= uLowDispersion.x;\n\n          return vec4(dispersed, size);\n        }\n      ").vertex.replace("project_vertex","\n        vec4 mvPosition = vec4(position, 1.0);\n        delta = instanceMatrix[3].xy - uCenter.xy;\n        scatterRatio = clamp(1.1 * length(delta) / (length(uScatteredInfo.xy) / 2.0), 0.0, 1.0);\n\n        vec4 dispersion = computeDispersion();\n        vec4 lowDispersion = computeLowDispersion();\n\n        float scale = clamp01(uMainParams.x * 3.0 - 2.0 * aRand.w);\n        mvPosition.xyz *= dispersion.w * lowDispersion.w * easeInOut3(scale);\n\n        mvPosition = instanceMatrix * mvPosition;\n        mvPosition.xyz += dispersion.xyz + lowDispersion.xyz;\n\n        mvPosition = modelViewMatrix * mvPosition;\n        gl_Position = projectionMatrix * mvPosition;      \n      ").vertex.replace("uv_vertex","\n        #if defined( USE_UV ) || defined( USE_ANISOTROPY )\n          vUv = vec3( uv, 1 ).xy;\n          vUv = aRectUv.xy + aRectUv.zw * vUv;\n        #endif\n        #ifdef USE_MAP\n          vec2 instanceUv = aRectUv.xy + aRectUv.zw * MAP_UV;\n\n          // vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, vec2 scale\n          float outerAspect = uScatteredInfo.x / uScatteredInfo.y;\n          float innerAspect = uMapInfo.x;\n          float sizeMode = uMapInfo.y;\n          vec2 align = uMapInfo.zw;\n          instanceUv = applyUvSize(instanceUv, outerAspect, innerAspect, sizeMode, align, vec2(1.0));\n          \n          vMapUv = ( mapTransform * vec3( instanceUv, 1 ) ).xy;\n        #endif\n      ").vertex.mainAfterAll("\n        vRand = aRand;\n      ").fragment.top(T.U,S.i).fragment.replace("color_fragment","\n        vec3 normal = texture2D(uNormalMap, vUv * 4.0).rgb;\n        vec3 light = normalize(vec3(0.5, 2.5, 1.0));\n        float colorAlteration = mix(0.333, 1.0, dot(normal, light));\n        float transition = inverseLerp(0.0, 0.2, uMainParams.y - 0.8 * vRand.w);\n        diffuseColor.rgb = mix(vColor * colorAlteration, diffuseColor.rgb, transition);\n      ")}}class R extends r.Object3D{static createPlane(e){let{row:t,col:i}=e,a=t*i,s=new r.PlaneGeometry,n=new r.InstancedBufferAttribute(new Float32Array(4*a),4);s.setAttribute("aRectUv",n);let o=new r.InstancedBufferAttribute(new Float32Array(4*a),4);s.setAttribute("aRand",o);for(let e=0;e<a;e++)o.setXYZW(e,p.T.random(),p.T.random(),p.T.random(),p.T.random());let l=new C,d=new r.InstancedMesh(s,l,a);return d.name="plane",d}get count(){return this.internal.count}onTick(e){this.internal.plane.material.update(e.deltaTime)}getDistribution(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new x(this,e)}drawDistribution(e){let{position:t,size:i,scatterPadding:a}=e.props,{x:r,y:s}=(0,f.iK)(t),{x:n,y:o}=(0,f.iK)(i);this.internal.lineHelper.rectangle([r,s,n,o]).rectangle([r,s,n+2*a,o+2*a])}distribute(e){let{count:t,plane:i}=this.internal,{aRectUv:a}=i.geometry.attributes;for(let r=0;r<t;r++){let{rect:t,uvRect:s}=e.nodes[r];i.setMatrixAt(r,(0,h.$)({position:t.getCenter(),scale:t.getSize()})),a.setXYZW(r,s.x,s.y,s.width,s.height)}i.material.setScatteredSize(e.root.rect.getSize());let r=e.root.rect;i.material.setScatteredSize(r.getSize()),i.material.uniforms.uCenter.value.copy(r.getCenter())}lerpDistribute(e,t,i){let{count:a,plane:s}=this.internal,{aRectUv:n}=s.geometry.attributes,o=new M.Ae,l=new M.Ae,d=new M.Ae,c=new r.Vector3,u=new r.Vector3;for(let r=0;r<a;r++){let a=e.nodes[r],d=t.nodes[r],p=.3*(1-a.r0*(a.scatterCoeff+.2*d.r0)),f=(0,v.ii)(p,.7+p,i),m=(0,P.xD)(f);o.lerpRectangles(a.rect,d.rect,m),l.lerpRectangles(a.uvRect,d.uvRect,m),s.setMatrixAt(r,(0,h.$)({position:o.getCenter(c),scale:o.getSize(u),rotationY:(d.r0<.5?0:1)*m*Math.PI*2,rotationZ:.3*Math.sin(f*Math.PI)*(-1+2*a.r0)})),n.setXYZW(r,l.x,l.y,l.width,l.height)}let p=(0,P.uN)((0,v.ii)(.3,.7,i));d.lerpRectangles(e.root.rect,t.root.rect,p),s.material.setScatteredSize(d.getSize()),s.material.uniforms.uCenter.value.copy(d.getCenter()),s.instanceMatrix.needsUpdate=!0,n.needsUpdate=!0}constructor(e={}){super(),this.transition=0;let t={...R.defaultProps,...e},{col:i,row:a}=t,r=R.createPlane(t);(0,o.bB)(r,this);let s=new y;(0,o.bB)(s,this);let n=new A;(0,o.bB)(n,this),this.internal={count:a*i,plane:r,lineHelper:s,lightSetup:n},this.props=t,this.distribute(this.getDistribution())}}R.displayName="ScatteredPlane",R.defaultProps={row:20,col:30,imageAspect:1,imageResizeMode:"cover"},R.transition_meta="Range(0, 1)";class D extends r.Mesh{constructor(){super(new r.IcosahedronGeometry(40,1),new r.MeshBasicMaterial({color:"#aeb4e9",side:r.BackSide})),this.onBeforeRender=(e,t,i)=>{this.position.copy(i.position)}}}let U={darkBlue:"#002c52",orange:"#ff5c35",white:"#ffffff",lightGrey:"#c9cfd3"};function z(){let e=(0,d.jE)();return e.three.pipeline.basicPasses.outline.enabled=!1,(0,u._v)("ScatteredDemo",async function*(t,i){(0,o.bB)(new D,t),(0,o.bB)(new r.Mesh(new s.w,new n.P),t);let a=await i.loader.load("/images/DebugTexture.png");a.colorSpace=r.SRGBColorSpace;let d=(0,o.bB)(new R,t);d.internal.plane.material.map=a,d.internal.plane.material.mapAspect=a.image.width/a.image.height;let c=d.getDistribution({seed:4789,position:[-2,0],size:[2,3]}),u=d.getDistribution({seed:3249,position:[2,0],size:[2,4]});d.drawDistribution(c),d.drawDistribution(u),t.userData.transition=0,t.userData.transition_meta="Slider(0, 1, step: 0.01)",t.userData.scale=1,t.userData.scale_meta="Slider(-1, 1, pow: 10, step: .1)",t.userData.links=[d.internal.plane.material.userData];let f=Object.values(U);for(let e=0,t=d.count;e<t;e++)d.internal.plane.setColorAt(e,(0,h.E)(p.T.pick(f)));yield i.onTick(()=>{d.lerpDistribute(c,u,t.userData.transition),d.scale.setScalar(t.userData.scale)}),(0,l.v)(e,t),e.sceneSelection.add("Select ScatteredDemo",t)},[]),null}function E(){return(0,u.Ky)(function*(e){e.useOrbitControls({position:[-2,0,8],target:[-2,0,0]})},[]),null}function j(e){let{children:t}=e,i=(0,u.Ky)();return(0,a.jsx)(d.KU,{three:i,backgroundColor:"#26163c4f",children:t})}function N(){return(0,a.jsxs)("div",{className:"layer thru",children:[(0,a.jsx)(c.Leak,{}),(0,a.jsx)(u.H7,{children:(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"layer thru px-3 py-2 flex flex-col gap-4",children:(0,a.jsx)("h1",{className:"text-4xl",children:"ScatteredPlane"})}),(0,a.jsx)(E,{}),(0,a.jsx)(z,{})]})})]})}},25463:function(e,t,i){"use strict";function*a(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let a=0,r=0;2===t.length?(a=t[0],r=t[1]):Array.isArray(t[0])?(a=t[0][0],r=t[0][1]):(a=t[0].x,r=t[0].y);let s={i:0,x:0,y:0},n=0;for(let e=0;e<r;e++)for(let t=0;t<a;t++)s.i=n++,s.x=t,s.y=e,yield s}function*r(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let a=0,r=0,s=0;3===t.length?(a=t[0],r=t[1],s=t[2]):Array.isArray(t[0])?(a=t[0][0],r=t[0][1],s=t[0][2]):(a=t[0].x,r=t[0].y,s=t[0].z);let n={i:0,x:0,y:0,z:0},o=0;for(let e=0;e<s;e++)for(let t=0;t<r;t++)for(let i=0;i<a;i++)n.i=o++,n.x=i,n.y=t,n.z=e,yield n}i.d(t,{B:function(){return a},K:function(){return r}})}},function(e){e.O(0,[4330,5890,6655,5835,5244,4964,8423,3662,7579,893,7601,2290,1943,7516,6626,6028,7112,550,900,9111,1523,5836,5677,1497,1658,3510,1744],function(){return e(e.s=50406)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9091],{50406:function(e,t,a){Promise.resolve().then(a.t.bind(a,77601,23)),Promise.resolve().then(a.bind(a,37351)),Promise.resolve().then(a.bind(a,31636)),Promise.resolve().then(a.bind(a,81497)),Promise.resolve().then(a.bind(a,89202)),Promise.resolve().then(a.bind(a,7722)),Promise.resolve().then(a.bind(a,86471)),Promise.resolve().then(a.bind(a,71523)),Promise.resolve().then(a.t.bind(a,51011,23)),Promise.resolve().then(a.bind(a,1050))},37351:function(e,t,a){"use strict";a.d(t,{Main:function(){return A}});var r=a(41291),i=a(81406),n=a(13841),s=a(57872),o=a(64740),l=a(8423),d=a(51776),c=a(35459),h=a(4798),u=a(59544),p=a(33628),f=a(90642),m=a(11315),v=a(51845),g=a(55712),x=a(18620),M=a(37234),y=a(80493),b=a(91046);class w extends x.w{dispose(){this.gtaoNoiseTexture.dispose(),this.pdNoiseTexture.dispose(),this.normalRenderTarget.dispose(),this.gtaoRenderTarget.dispose(),this.pdRenderTarget.dispose(),this.normalMaterial.dispose(),this.pdMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}get gtaoMap(){return this.pdRenderTarget.texture}setGBuffer(e,t){void 0!==e?(this.depthTexture=e,this.normalTexture=t,this._renderGBuffer=!1):(this.depthTexture=new o.DepthTexture,this.depthTexture.format=o.DepthStencilFormat,this.depthTexture.type=o.UnsignedInt248Type,this.normalRenderTarget=new o.WebGLRenderTarget(this.width,this.height,{minFilter:o.NearestFilter,magFilter:o.NearestFilter,type:o.HalfFloatType,depthTexture:this.depthTexture}),this.normalTexture=this.normalRenderTarget.texture,this._renderGBuffer=!0);let a=this.normalTexture?1:0,r=this.depthTexture===this.normalTexture?"w":"x";this.gtaoMaterial.defines.NORMAL_VECTOR_TYPE=a,this.gtaoMaterial.defines.DEPTH_SWIZZLING=r,this.gtaoMaterial.uniforms.tNormal.value=this.normalTexture,this.gtaoMaterial.uniforms.tDepth.value=this.depthTexture,this.pdMaterial.defines.NORMAL_VECTOR_TYPE=a,this.pdMaterial.defines.DEPTH_SWIZZLING=r,this.pdMaterial.uniforms.tNormal.value=this.normalTexture,this.pdMaterial.uniforms.tDepth.value=this.depthTexture,this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture}setSceneClipBox(e){e?(this.gtaoMaterial.needsUpdate=1!==this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=1,this.gtaoMaterial.uniforms.sceneBoxMin.value.copy(e.min),this.gtaoMaterial.uniforms.sceneBoxMax.value.copy(e.max)):(this.gtaoMaterial.needsUpdate=0===this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=0)}updateGtaoMaterial(e){void 0!==e.radius&&(this.gtaoMaterial.uniforms.radius.value=e.radius),void 0!==e.distanceExponent&&(this.gtaoMaterial.uniforms.distanceExponent.value=e.distanceExponent),void 0!==e.thickness&&(this.gtaoMaterial.uniforms.thickness.value=e.thickness),void 0!==e.distanceFallOff&&(this.gtaoMaterial.uniforms.distanceFallOff.value=e.distanceFallOff,this.gtaoMaterial.needsUpdate=!0),void 0!==e.scale&&(this.gtaoMaterial.uniforms.scale.value=e.scale),void 0!==e.samples&&e.samples!==this.gtaoMaterial.defines.SAMPLES&&(this.gtaoMaterial.defines.SAMPLES=e.samples,this.gtaoMaterial.needsUpdate=!0),void 0!==e.screenSpaceRadius&&(e.screenSpaceRadius?1:0)!==this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS&&(this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS=e.screenSpaceRadius?1:0,this.gtaoMaterial.needsUpdate=!0)}updatePdMaterial(e){let t=!1;void 0!==e.lumaPhi&&(this.pdMaterial.uniforms.lumaPhi.value=e.lumaPhi),void 0!==e.depthPhi&&(this.pdMaterial.uniforms.depthPhi.value=e.depthPhi),void 0!==e.normalPhi&&(this.pdMaterial.uniforms.normalPhi.value=e.normalPhi),void 0!==e.radius&&e.radius!==this.radius&&(this.pdMaterial.uniforms.radius.value=e.radius),void 0!==e.radiusExponent&&e.radiusExponent!==this.pdRadiusExponent&&(this.pdRadiusExponent=e.radiusExponent,t=!0),void 0!==e.rings&&e.rings!==this.pdRings&&(this.pdRings=e.rings,t=!0),void 0!==e.samples&&e.samples!==this.pdSamples&&(this.pdSamples=e.samples,t=!0),t&&(this.pdMaterial.defines.SAMPLES=this.pdSamples,this.pdMaterial.defines.SAMPLE_VECTORS=(0,b.a)(this.pdSamples,this.pdRings,this.pdRadiusExponent),this.pdMaterial.needsUpdate=!0)}render(e,t,a){switch(this._renderGBuffer&&(this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.gtaoMaterial.uniforms.cameraWorldMatrix.value.copy(this.camera.matrixWorld),this.renderPass(e,this.gtaoMaterial,this.gtaoRenderTarget,16777215,1),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.renderPass(e,this.pdMaterial,this.pdRenderTarget,16777215,1),this.output){case w.OUTPUT.Off:break;case w.OUTPUT.Diffuse:this.copyMaterial.uniforms.tDiffuse.value=a.texture,this.copyMaterial.blending=o.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case w.OUTPUT.AO:this.copyMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.copyMaterial.blending=o.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case w.OUTPUT.Denoise:this.copyMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.copyMaterial.blending=o.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case w.OUTPUT.Depth:this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case w.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=o.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case w.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=a.texture,this.copyMaterial.blending=o.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blendMaterial.uniforms.intensity.value=this.blendIntensity,this.blendMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.renderPass(e,this.blendMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.GTAOPass: Unknown output type.")}}renderPass(e,t,a,r,i){e.getClearColor(this.originalClearColor);let n=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(a),e.autoClear=!1,null!=r&&(e.setClearColor(r),e.setClearAlpha(i||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderOverride(e,t,a,r,i){e.getClearColor(this.originalClearColor);let n=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(a),e.autoClear=!1,r=t.clearColor||r,i=t.clearAlpha||i,null!=r&&(e.setClearColor(r),e.setClearAlpha(i||0),e.clear()),this.scene.overrideMaterial=t;let o=this.camera.layers.mask;this.camera.layers.set(0),e.render(this.scene,this.camera),this.camera.layers.mask=o,this.scene.overrideMaterial=null,e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}setSize(e,t){this.width=e,this.height=t,this.gtaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.pdRenderTarget.setSize(e,t),this.gtaoMaterial.uniforms.resolution.value.set(e,t),this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.pdMaterial.uniforms.resolution.value.set(e,t),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse)}overrideVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){let a=t.get(e);e.visible=a}),t.clear()}generateNoise(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=new g.L,a=new Uint8Array(e*e*4);for(let r=0;r<e;r++)for(let i=0;i<e;i++){let n=r,s=i;a[(r*e+i)*4]=(.5*t.noise(n,s)+.5)*255,a[(r*e+i)*4+1]=(.5*t.noise(n+e,s)+.5)*255,a[(r*e+i)*4+2]=(.5*t.noise(n,s+e)+.5)*255,a[(r*e+i)*4+3]=(.5*t.noise(n+e,s+e)+.5)*255}let r=new o.DataTexture(a,e,e,o.RGBAFormat,o.UnsignedByteType);return r.wrapS=o.RepeatWrapping,r.wrapT=o.RepeatWrapping,r.needsUpdate=!0,r}constructor(e,t,a,r,i,n,s){super(),this.width=void 0!==a?a:512,this.height=void 0!==r?r:512,this.clear=!0,this.camera=t,this.scene=e,this.output=0,this._renderGBuffer=!0,this._visibilityCache=new Map,this.blendIntensity=1,this.pdRings=2,this.pdRadiusExponent=2,this.pdSamples=16,this.gtaoNoiseTexture=(0,y.mK)(),this.pdNoiseTexture=this.generateNoise(),this.gtaoRenderTarget=new o.WebGLRenderTarget(this.width,this.height,{type:o.HalfFloatType}),this.pdRenderTarget=this.gtaoRenderTarget.clone(),this.gtaoMaterial=new o.ShaderMaterial({defines:Object.assign({},y.Sp.defines),uniforms:o.UniformsUtils.clone(y.Sp.uniforms),vertexShader:y.Sp.vertexShader,fragmentShader:y.Sp.fragmentShader,blending:o.NoBlending,depthTest:!1,depthWrite:!1}),this.gtaoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.gtaoMaterial.uniforms.tNoise.value=this.gtaoNoiseTexture,this.gtaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.normalMaterial=new o.MeshNormalMaterial,this.normalMaterial.blending=o.NoBlending,this.pdMaterial=new o.ShaderMaterial({defines:Object.assign({},b.m.defines),uniforms:o.UniformsUtils.clone(b.m.uniforms),vertexShader:b.m.vertexShader,fragmentShader:b.m.fragmentShader,depthTest:!1,depthWrite:!1}),this.pdMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.pdMaterial.uniforms.tNoise.value=this.pdNoiseTexture,this.pdMaterial.uniforms.resolution.value.set(this.width,this.height),this.pdMaterial.uniforms.lumaPhi.value=10,this.pdMaterial.uniforms.depthPhi.value=2,this.pdMaterial.uniforms.normalPhi.value=3,this.pdMaterial.uniforms.radius.value=8,this.depthRenderMaterial=new o.ShaderMaterial({defines:Object.assign({},y.gs.defines),uniforms:o.UniformsUtils.clone(y.gs.uniforms),vertexShader:y.gs.vertexShader,fragmentShader:y.gs.fragmentShader,blending:o.NoBlending}),this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new o.ShaderMaterial({uniforms:o.UniformsUtils.clone(M.C.uniforms),vertexShader:M.C.vertexShader,fragmentShader:M.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:o.DstColorFactor,blendDst:o.ZeroFactor,blendEquation:o.AddEquation,blendSrcAlpha:o.DstAlphaFactor,blendDstAlpha:o.ZeroFactor,blendEquationAlpha:o.AddEquation}),this.blendMaterial=new o.ShaderMaterial({uniforms:o.UniformsUtils.clone(y.mF.uniforms),vertexShader:y.mF.vertexShader,fragmentShader:y.mF.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:o.CustomBlending,blendSrc:o.DstColorFactor,blendDst:o.ZeroFactor,blendEquation:o.AddEquation,blendSrcAlpha:o.DstAlphaFactor,blendDstAlpha:o.ZeroFactor,blendEquationAlpha:o.AddEquation}),this.fsQuad=new x.T(null),this.originalClearColor=new o.Color,this.setGBuffer(i?i.depthTexture:void 0,i?i.normalTexture:void 0),void 0!==n&&this.updateGtaoMaterial(n),void 0!==s&&this.updatePdMaterial(s)}}w.OUTPUT={Off:-1,Default:0,Diffuse:1,Depth:2,Normal:3,AO:4,Denoise:5};var S=a(91310);class T extends h.C{render(e,t,a,r,i){var n;if(null===(n=this.onBeforeRender)||void 0===n||n.call(this),this.disableBackground){let n=this.scene.background;this.scene.background=null,super.render(e,t,a,r,i),this.scene.background=n}else super.render(e,t,a,r,i)}constructor(...e){super(...e),this.onBeforeRender=null,this.disableBackground=!1}}function P(){let{ref:e}=(0,n.sv)(function*(e){let t=function(e){let{width:t=window.innerWidth,height:a=window.innerHeight}=e,r=new o.WebGLRenderer({});r.setSize(t,a),r.setPixelRatio(window.devicePixelRatio);let i=new o.PerspectiveCamera(75,t/a,.1,1e3);i.position.z=8,new l.z(i,r.domElement);let n=new m.vB().set({activeDuration:30}),s=(0,v.s)(()=>n.requestActivation()),h=function(e){let t=new o.Scene;{let e=new o.DirectionalLight(16777215,1);e.position.set(0,3,1),t.add(e);let a=new o.HemisphereLight("#afdbf5","#845244",1);t.add(a)}new S.x().setPath("https://threejs.org/examples/textures/equirectangular/").loadAsync("pedestrian_overpass_1k.hdr").then(e=>{e.mapping=o.EquirectangularReflectionMapping,t.environmentIntensity=.1,t.environment=e,t.backgroundBlurriness=.5,t.background=e});let a=new o.Mesh(new o.TorusKnotGeometry(2,1,512,64),new o.MeshPhysicalMaterial);t.add(a);let r=new o.Mesh(new o.BoxGeometry(10,1,3),new o.MeshPhysicalMaterial);t.add(r);let i=new o.Mesh(new o.BoxGeometry(1,10,3),new o.MeshPhysicalMaterial);i.position.set(5,0,0),t.add(i);let n=new o.Mesh(new o.PlaneGeometry(10,10),new o.MeshPhysicalMaterial({color:"#d1ddff",transmission:1,roughness:0,dispersion:.1,ior:2.5,opacity:1}));return n.layers.set(1),t.add(n),e.onTick(e=>{a.rotation.x+=.5*e.deltaTime,a.rotation.y+=.5*e.deltaTime}),t}(n),g=new d.x(r),x=new T(h,i);x.onBeforeRender=()=>{i.layers.enableAll()},g.addPass(x);let M=new w(h,i,t,a);g.addPass(M);let y=new c.v;g.addPass(y);let b=new u.T(p.C);b.material.uniforms.resolution.value.set(1/t,1/a),g.addPass(b),n.onTick(()=>{g.render()}),f.v.on("REQUIRE:THREE",e=>{e.payload={three:P}});let P={renderer:r,camera:i,scene:h,ticker:n,passes:{render:x,ao:M,output:y},destroy:()=>{r.domElement.remove(),n.destroy(),s.destroy()}};return P}({width:e.clientWidth,height:e.clientHeight});yield t,Object.assign(window,{three:t}),e.appendChild(t.renderer.domElement)},[]);return(0,r.jsx)("div",{ref:e,className:"absolute inset-0"})}function A(){let[e,t]=(0,i.useState)(!0);return(0,r.jsxs)("div",{className:"page",children:[(0,r.jsx)(P,{}),(0,r.jsxs)("div",{className:"absolute inset-0 p-8 flex flex-col items-start justify-start pointer-through",children:[(0,r.jsxs)("div",{className:"flex flex-col items-start justify-start pointer-through max-w-[480px]",children:[(0,r.jsx)("h1",{className:"text-4xl uppercase",children:"ao-transparent"}),(0,r.jsx)("div",{className:"mt-4"}),(0,r.jsx)("p",{children:"Handling Ambient Occlusion and transparent objects"}),(0,r.jsx)("p",{children:"The glass does not generate AO"}),(0,r.jsx)("div",{className:"mt-4"}),(0,r.jsxs)("p",{children:["This is achieved by using a fork of the ",(0,r.jsx)("a",{href:"https://github.com/mrdoob/three.js/blob/master/examples/jsm/postprocessing/GTAOPass.js",children:"GTAOPass"}),"\xa0where the camera layer mask is set to 0 (default layer) and the glass object is set to layer 1 (transparent objects)."]}),(0,r.jsx)("div",{className:"mt-4"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl",children:"Pros:"}),(0,r.jsx)("ul",{children:(0,r.jsx)("li",{children:"Simple (layer based)"})})]}),(0,r.jsx)("div",{className:"mt-4"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl",children:"Cons:"}),(0,r.jsx)("ul",{children:(0,r.jsx)("li",{children:"AO is still rendered on top of transparent objects. For semi-opaque objects, this is could be a problem."})})]})]}),(0,r.jsx)("div",{className:"mt-4"}),(0,r.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,r.jsx)("label",{htmlFor:"ao-enabled",className:"select-none",children:"Enable AO"}),(0,r.jsx)("input",{type:"checkbox",name:"ao-enabled",id:"ao-enabled",checked:e,onChange:()=>{let{payload:e}=s.v.send("REQUIRE:THREE");if(e){let{three:a}=e,{passes:r}=a,{ao:i}=r;i.enabled=!i.enabled,t(i.enabled)}}})]})]})]})}},89202:function(e,t,a){"use strict";a.d(t,{Main:function(){return E}});var r=a(41291),i=a(62362),n=a(64740),s=a(26028),o=a(73437);let l=new n.LineBasicMaterial({color:"white",transparent:!0,depthTest:!1}),d={circle:(()=>{let e=new n.BufferGeometry,t=Array.from({length:81},(e,t)=>{let a=t/80*Math.PI*2;return new n.Vector3(Math.cos(a),Math.sin(a),0)});return e.setFromPoints(t),e})(),box2:(()=>{let e=new n.BufferGeometry,t=[new n.Vector3(-.5,-.5,0),new n.Vector3(.5,-.5,0),new n.Vector3(.5,.5,0),new n.Vector3(-.5,.5,0),new n.Vector3(-.5,-.5,0)];return e.setFromPoints(t),e})()};class c extends n.Group{setupUniforms(e,t){let{value:a}=e,{value:r}=t;a.copy(this.matrixWorld),a.invert()}setup(){}set(e){Object.assign(this.props,e),this.setup()}constructor(e){super(),this.props=e,this.renderOrder=1}}let h={radius:2,falloff:1};class u extends c{get radius(){return this.props.radius}set radius(e){this.props.radius=e,this.setup()}get falloff(){return this.props.falloff}set falloff(e){this.props.falloff=e,this.setup()}setupUniforms(e,t){super.setupUniforms(e,t);let{radius:a,falloff:r}=this.props;t.value.set(a,r,0,0)}setup(){let{circle0:e,circle1:t}=this.parts,{radius:a,falloff:r}=this.props;e.scale.setScalar(a),t.scale.setScalar(a+r)}constructor(e){super({...h,...e}),this.parts={circle0:new n.Line(d.circle,l),circle1:new n.Line(d.circle,l)},this.add(this.parts.circle0),this.add(this.parts.circle1),this.setup()}}u.glsl="\n    struct CircleFalloff {\n      mat4 matrix;\n      float radius;\n      float falloff;\n    };\n    float falloff(CircleFalloff falloff, vec3 p) {\n      p = (falloff.matrix * vec4(p, 1.0)).xyz;\n      float d = length(p);\n      return 1.0 - (d - falloff.radius) / falloff.falloff;\n    }\n  ";let p={width:1,height:1,falloff:1};class f extends c{setupUniforms(e,t){super.setupUniforms(e,t);let{width:a,height:r,falloff:i}=this.props;t.value.set(a,r,i,0)}setup(){let{box0:e,box1:t}=this.parts,{width:a,height:r,falloff:i}=this.props;e.scale.set(a,r,1),t.scale.set(a+i,r+i,1)}constructor(e){super({...p,...e}),this.parts={box0:new n.Line(d.box2,l),box1:new n.Line(d.box2,l)},this.add(this.parts.box0),this.add(this.parts.box1),this.setup()}}f.glsl="\n    struct ManhattanBox2Falloff {\n      mat4 matrix;\n      float width;\n      float height;\n      float falloff;\n    };\n    float falloff(ManhattanBox2Falloff falloff, vec3 p) {\n      p = (falloff.matrix * vec4(p, 1.0)).xyz;\n      float x = abs(p.x) - falloff.width * 0.5;\n      float y = abs(p.y) - falloff.height * 0.5;\n      return 1.0 - max(x, y) * 2.0 / falloff.falloff;\n    }\n  ";var m=a(42685),v=a(64556),g=a(56246),x=a(76171),M=a(2164),y=a(68392),b=a(25463),w=a(71441);function S(e){let{r:t,g:a,b:r}=new n.Color(e);return"vec3(".concat(t.toFixed(3),", ").concat(a.toFixed(3),", ").concat(r.toFixed(3),")")}let T={grid:[16,16]},P=new n.PlaneGeometry(1,1,1,1),A=new n.MeshBasicMaterial({side:n.DoubleSide,transparent:!0}),C={uRadiusScalar:new n.Uniform(.9),uCircleMat:new n.Uniform(new n.Matrix4().identity()),uCircleProps:new n.Uniform(new n.Vector4(1,2,0,0)),uBox0Mat:new n.Uniform(new n.Matrix4().identity()),uBox0Props:new n.Uniform(new n.Vector4(1,1,0,0))};A.onBeforeCompile=e=>m.b.with(e).defines({USE_UV:""}).uniforms(C).varying({vCenter:"vec3",vWorldPosition2:"vec3"}).vertex.mainAfterAll("\n    vWorldPosition2 = (modelMatrix * instanceMatrix * vec4(transformed, 1.0)).xyz;\n    vCenter = (modelMatrix * instanceMatrix[3]).xyz;\n  ").fragment.top(y.U,x.g,M.i).fragment.top(u.glsl,f.glsl).fragment.after("color_fragment","\n    CircleFalloff circle = CircleFalloff(uCircleMat, uCircleProps.x, uCircleProps.y);\n    ManhattanBox2Falloff box = ManhattanBox2Falloff(uBox0Mat, uBox0Props.x, uBox0Props.y, uBox0Props.z);\n    float d = 0.0;\n    d += clamp01(falloff(box, vWorldPosition2));\n    d += clamp01(falloff(circle, vWorldPosition2));\n    diffuseColor.rgb = mix(".concat(S("#c2e1ff"),", ").concat(S("#d80773"),", easeInOut3(clamp01(d)));\n  ")).fragment.after("alphamap_fragment","\n    float scalar = 1.0 / uRadiusScalar / mix(1.0, 0.25, easeInOut3(clamp01(d)));\n    float alpha = smoothstep(1.0, 0.99, length(vUv - 0.5) * scalar / 0.5);\n\n    if (alpha < 0.01) discard;\n\n    diffuseColor.a *= alpha;\n  ");class R extends n.InstancedMesh{onTick(e){for(let e of Object.values(this.falloffs))e.visible=this.falloffsAreVisible;let{box0:t,circle:a}=this.falloffs;a.falloff=(0,w.t7)(.1,4,e.sin01Time({frequency:.15})),a.radius=(0,w.t7)(1,5,e.sin01Time({frequency:.1,phase:.5})),a.setupUniforms(C.uCircleMat,C.uCircleProps),t.rotation.z+=.1*e.deltaTime,t.set({width:8,falloff:(0,w.t7)(.5,6,e.sin01Time({frequency:.15}))}),t.setupUniforms(C.uBox0Mat,C.uBox0Props)}constructor(e){var t;let{x:a,y:r}=(0,o.iK)(null!==(t=null==e?void 0:e.grid)&&void 0!==t?t:T.grid);for(let t of(super(P,A,a*r),this.internal={grid:new n.Vector2},this.falloffsAreVisible=!0,this.falloffs={circle:(0,g.bB)(new u,this,{position:[-3,-2,0]}),box0:(0,g.bB)(new f({}),this,{position:[3,2,0]})},this.props={...T,...e},(0,b.B)(a,r)))this.setMatrixAt(t.i,(0,v.$)({x:t.x-a/2,y:t.y-r/2}))}}function*U(e){e.scene.background=new n.Color("#1c54e0"),e.ticker.set({activeDuration:30}),e.useOrbitControls();let t=new R;e.scene.add(t),yield()=>t.removeFromParent(),yield(0,s.w)(document.body,{onTap(){t.falloffsAreVisible=!t.falloffsAreVisible}})}function z(){return(0,i.Ky)(U),null}function E(){return(0,r.jsx)("div",{className:"absolute-through",children:(0,r.jsx)(i.H7,{children:(0,r.jsx)(z,{})})})}},86471:function(e,t,a){"use strict";a.d(t,{Client:function(){return j}});var r=a(41291),i=a(64740),n=a(32678),s=a(75952),o=a(56246),l=a(70928),d=a(62362),c=a(1050),h=a(47804),u=a(73437),p=a(7556),f=a(71441),m=a(27636);class v{constructor(e,t){this.props={...v.defaultProps,...t};let{position:a,size:r,scatterPadding:i,sizeOptions:n,seed:s}=this.props,{col:o,row:l}=e.props;m.T.seed(s);let d=m.T.createPicker(n),c=Array.from({length:o}).map(d),h=Array.from({length:l}).map(d),{x:g,y:x}=(0,u.iK)(a),{x:M,y:y}=(0,u.iK)(r),b=new p.T(p.Nm.Horizontal).setSize(M,y).setOffset(g-M/2,x-y/2);for(let e of c){let t=new p.T(p.Nm.Vertical).setSize("".concat(e,"fr")).addTo(b);for(let e of h)new p.T(p.Nm.Horizontal).setSize("".concat(e,"fr")).addTo(t)}b.computeLayout();let w=b.rect,S=[...b.allLeaves({includeSelf:!1})],T=(M+y)/2,P=S.map(e=>{let t=e.rect.clone(),a=t.clone().relativeTo(w),{x:r,y:n}=t.getCenter(),s=(0,f.ii)(.5,1,(Math.abs(r-g)+Math.abs(n-x))/T);return t.centerX+=m.T.between(-i,i)*s,t.centerY+=m.T.between(-i,i)*s,{space:e,rect:t,uvRect:a,scatterCoeff:s}});this.root=b,this.nodes=P}}v.defaultProps={seed:87654,position:new i.Vector2(0,0),size:new i.Vector2(3,2),scatterPadding:.1,sizeOptions:[[.5,1],[1,10],[2,2],[3,1]]};var g=a(42685),x=a(64556),M=a(6332),y=a(11315);class b extends i.LineSegments{clear(){return this.points.length=0,this.geometry.setFromPoints(this.points),this}drawRect(e){let{x:t,y:a,width:r,height:n}=M.Ae.from(e),s=r/2,o=n/2,l=new i.Vector2(t-s,a-o),d=new i.Vector2(t+s,a-o),c=new i.Vector2(t+s,a+o),h=new i.Vector2(t-s,a+o);return this.points.push(l,d,d,c,c,h,h,l),this.geometry.setFromPoints(this.points),this}constructor(...e){super(...e),this.points=[]}}var w=a(2164),S=a(68392),T=a(77535);class P extends i.InstancedMesh{constructor(e){let{row:t,col:a}=e,r=t*a,n=new i.PlaneGeometry(1,1,100,1),s=new i.MeshPhysicalMaterial({side:i.DoubleSide,flatShading:!0}),o=new i.InstancedBufferAttribute(new Float32Array(16*r),16),l=new i.InstancedBufferAttribute(new Float32Array(16*r),16);n.setAttribute("aStartMat",o),n.setAttribute("aEndMat",l);let d={uTime:y.vB.get("three").uTime,uLength:{value:1},uWidth:{value:.01},uRand:{value:m.T.vector(new i.Vector4,{min:0,max:1})},uWorldStartMatrix:{value:new i.Matrix4().identity()},uWorldEndMatrix:{value:new i.Matrix4().identity()}};s.onBeforeCompile=e=>g.b.with(e).shaderName("with-loop").uniforms(d).vertex.top(S.U,w.i,T.T).vertex.top("\n        attribute mat4 aStartMat;\n        attribute mat4 aEndMat;\n\n        float rand(vec3 p) {\n          return fract(sin(dot(p, vec3(12.9898, 78.233, 45.164))) * 43758.5453);\n        }\n\n        // float rand(vec3 p) {\n        //   p = fract(p * vec3(443.8975, 441.4236, 437.1954));\n        //   p += dot(p, p.yzx + 19.19);\n        //   return fract((p.x + p.y) * p.z);\n        // }\n\n        float rand(vec3 p, float rangeMin, float rangeMax) {\n          return mix(rangeMin, rangeMax, rand(p));\n        }\n\n        float rand11(vec3 p) {\n          float r = rand(p) * 2.0 - 1.0;\n          float s = sign(r);\n          r = fract(r);\n          r *= r * r * r;\n          return r * s;\n        }\n\n        float rand11(vec3 p, float rangeMin, float rangeMax) {\n          return (rand11(p) * 0.5 + 0.5) * (rangeMax - rangeMin) + rangeMin;\n        }\n\n        vec3 bezier3(vec3 a, vec3 b, vec3 c, vec3 d, float t) {\n          t = clamp(t, 0.0, 1.0);\n          vec3 ab = mix(a, b, t);\n          vec3 bc = mix(b, c, t);\n          vec3 cd = mix(c, d, t);  \n          vec3 ab_bc = mix(ab, bc, t);\n          vec3 bc_cd = mix(bc, cd, t);\n          return mix(ab_bc, bc_cd, t);\n        }\n\n        vec3 bezier3_tangent(vec3 a, vec3 b, vec3 c, vec3 d, float t) {\n          t = clamp(t, 0.0, 1.0);\n          return 3.0 * ( \n            (1.0 - t) * (1.0 - t) * (b - a) + \n            2.0 * (1.0 - t) * t * (c - b) + \n            t * t * (d - c));\n        }\n      ").vertex.replace("begin_vertex","\n        mat4 startMat = uWorldStartMatrix * aStartMat;\n        mat4 endMat = uWorldEndMatrix * aEndMat;\n\n        vec3 start = startMat[3].xyz;\n        vec3 end = endMat[3].xyz;\n\n        start += vec3(rand11(start.xyz), rand11(start.yzx), rand11(start.zxy)) * 0.66;\n        end += vec3(rand11(start.zyx), rand11(start.xzy), rand11(start.yxz)) * 0.33;\n        \n        float dt = mix(-uLength, 1.0, fract(uTime * 0.33 + rand11(start) * 0.4));\n        float t = position.x * uLength + dt;\n        t = clamp(t, 0.0, 1.0);\n        float d = distance(start, end);\n\n        vec3 p0 = start;\n        vec3 p1 = mix(start, end, 0.2) + d * 0.2 * startMat[2].xyz;\n        vec3 p2 = mix(start, end, 0.8) + d * 0.2 * endMat[2].xyz;\n        vec3 p3 = end;\n        \n        // p1 = mix(start, end, 0.33);\n        // p2 = mix(start, end, 0.66);\n\n        vec3 normal = normalize(mix(startMat[2].xyz, endMat[2].xyz, t));\n        vec3 up = normalize(mix(startMat[1].xyz, endMat[1].xyz, t));\n        vec3 tangent = normalize(bezier3_tangent(p0, p1, p2, p3, t));\n        \n        float shortT = (t - dt) / uLength;\n        float width = (position.y - 0.5)\n          * easeInThenOut(t, 6.0)\n          * easeInThenOut(shortT, 3.0)\n          * mix(0.33, 1.0, pcurve(t, 1.0, 2.0)) // Narrower at the end.\n          * uWidth;\n        \n        float randomness = 0.2;\n        float startLoopT = rand(start) * randomness;\n        float loopT = startLoopT + inverseLerp(0.0, 1.0 - randomness, t);\n\n        vec2 loop = looping(loopT, 0.3, 1.0, 3.0, rand11(start, 0.6, 1.2), 0.3);\n        // loop = vec2(t, 0.0);\n        \n        // Loop Random Scalar:\n        vec2 lrs = vec2(\n          rand11(start, 0.4, 1.0),\n          rand11(start.zyx, 0.9, 1.1));\n        vec3 transformed = \n          bezier3(p0, p1, p2, p3, t)\n          + tangent * (loop.x - loopT) * d * lrs.x + normal * loop.y * d * lrs.y\n          + up * width;\n        \n        #ifdef USE_ALPHAHASH\n          vPosition = transformed;\n        #endif\n      "),super(n,s,r),this.name="lines",this.parts={aStartMat:o,aEndMat:l}}}class A extends i.Object3D{constructor(){super();let e=new i.HemisphereLight("#ffffff","#926969",1);this.add(e);let t=new i.DirectionalLight("#ffffff",2);this.add(t),t.position.set(2,4,1)}}class C extends i.MeshBasicMaterial{get mapAspect(){return this.internal.uniforms.uMapInfo.value.x}set mapAspect(e){this.internal.uniforms.uMapInfo.value.x=e}getScatteredSize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new i.Vector2;return e.x=this.internal.uniforms.uScatteredInfo.value.x,e.y=this.internal.uniforms.uScatteredInfo.value.y,e}setScatteredSize(e){this.internal.uniforms.uScatteredInfo.value.x=e.x,this.internal.uniforms.uScatteredInfo.value.y=e.y}get scatteredSize(){return this.getScatteredSize()}set scatteredSize(e){this.setScatteredSize(e)}constructor(){super({side:i.DoubleSide}),this.internal={uniforms:{uMapInfo:{value:new i.Vector4(1,1,.5,.5)},uScatteredInfo:{value:new i.Vector4(1,1,0,0)},uTime:y.vB.get("three").uTime}},this.onBeforeCompile=e=>g.b.with(e).uniforms(this.internal.uniforms).vertex.top('\n  // sizeMode: 0 for "contain", 1 for "cover"\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, vec2 scale) {\n    align.y = 1.0 - align.y; // Flip y-coordinate\n    if ((outerAspect > innerAspect) != (sizeMode == 1.0)) { // XOR condition for mode\n      float scaleFactor = outerAspect / innerAspect;\n      uv.x = (uv.x - align.x) * scaleFactor + align.x; // Adjust x-coordinate\n    } else {\n      float scaleFactor = innerAspect / outerAspect;\n      uv.y = (uv.y - align.y) * scaleFactor + align.y; // Adjust y-coordinate\n    }\n    uv = (uv - align) / scale + align;\n    return uv;\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, float scale) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, align, vec2(scale));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, align, vec2(1.0));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, vec2(0.5));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect) {\n    return applyUvSize(uv, outerAspect, innerAspect, 1.0);\n  }\n').vertex.top("\n        attribute vec4 aRectUv;\n      ").vertex.replace("uv_vertex","\n        #if defined( USE_UV ) || defined( USE_ANISOTROPY )\n          vUv = vec3( uv, 1 ).xy;\n        #endif\n        #ifdef USE_MAP\n          vec2 instanceUv = aRectUv.xy + aRectUv.zw * MAP_UV;\n\n          // vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, vec2 scale\n          float outerAspect = uScatteredInfo.x / uScatteredInfo.y;\n          float innerAspect = uMapInfo.x;\n          float sizeMode = uMapInfo.y;\n          vec2 align = uMapInfo.zw;\n          instanceUv = applyUvSize(instanceUv, outerAspect, innerAspect, sizeMode, align, vec2(1.0));\n          \n          vMapUv = ( mapTransform * vec3( instanceUv, 1 ) ).xy;\n        #endif\n      ")}}class R extends i.Object3D{static createPlane(e){let{row:t,col:a}=e,r=t*a,n=new i.PlaneGeometry,s=new i.InstancedBufferAttribute(new Float32Array(4*r),4);n.setAttribute("aRectUv",s);let o=new C,l=new i.InstancedMesh(n,o,r);return l.name="plane",l}get count(){return this.internal.count}getDistribution(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new v(this,e)}drawDistribution(e){let{position:t,size:a,scatterPadding:r}=e.props,{x:i,y:n}=(0,u.iK)(t),{x:s,y:o}=(0,u.iK)(a);this.internal.lineHelper.drawRect([i,n,s,o]).drawRect([i,n,s+2*r,o+2*r])}distribute(e){let{count:t,plane:a}=this.internal,{aRectUv:r}=a.geometry.attributes;for(let i=0;i<t;i++){let{rect:t,uvRect:n}=e.nodes[i];a.setMatrixAt(i,(0,x.$)({position:t.getCenter(),scale:t.getSize()})),r.setXYZW(i,n.x,n.y,n.width,n.height)}a.material.setScatteredSize(e.root.rect.getSize())}lerpDistribute(e,t,a){let{count:r,plane:n,lines:s}=this.internal,{aRectUv:o}=n.geometry.attributes,l=new M.Ae,d=new M.Ae,c=new i.Vector3,h=new i.Vector3;for(let i=0;i<r;i++){let r=e.nodes[i],u=t.nodes[i];l.lerpRectangles(r.rect,u.rect,a),d.lerpRectangles(r.uvRect,u.uvRect,a),n.setMatrixAt(i,(0,x.$)({position:l.getCenter(c),scale:l.getSize(h)})),o.setXYZW(i,d.x,d.y,d.width,d.height),(0,x.$)({position:r.rect.getCenter(c)}).toArray(s.parts.aStartMat.array,16*i),(0,x.$)({position:u.rect.getCenter(c)}).toArray(s.parts.aEndMat.array,16*i)}let u=new M.Ae().lerpRectangles(e.root.rect,t.root.rect,a);n.material.setScatteredSize(u.getSize()),n.instanceMatrix.needsUpdate=!0,o.needsUpdate=!0,s.parts.aStartMat.needsUpdate=!0,s.parts.aEndMat.needsUpdate=!0}constructor(e={}){super(),this.transition=0;let t={...R.defaultProps,...e},{col:a,row:r}=t,i=R.createPlane(t);(0,o.bB)(i,this);let n=new P(t);(0,o.bB)(n,this);let s=new b;(0,o.bB)(s,this);let l=new A;(0,o.bB)(l,this),this.internal={count:r*a,plane:i,lineHelper:s,lines:n,lightSetup:l},this.props=t,this.distribute(this.getDistribution())}}R.displayName="ScatteredPlane",R.defaultProps={row:20,col:30,imageAspect:1,imageResizeMode:"cover"},R.transition_meta="Range(0, 1)";class U extends i.Mesh{constructor(){super(new i.IcosahedronGeometry(40,1),new i.MeshBasicMaterial({color:"#aeb4e9",side:i.BackSide})),this.onBeforeRender=(e,t,a)=>{this.position.copy(a.position)}}}function z(){let e=(0,d.jE)();return(0,h._v)("ScatteredDemo",async function*(t,a){(0,o.bB)(new U,t),(0,o.bB)(new i.Mesh(new n.w,new s.P),t);let r=await a.loader.load("/images/DebugTexture.png");r.colorSpace=i.SRGBColorSpace;let d=(0,o.bB)(new R,t);d.internal.plane.material.map=r,d.internal.plane.material.mapAspect=r.image.width/r.image.height;let c=d.getDistribution({position:[-2,0],size:[3,2]}),h=d.getDistribution({position:[2,0],size:[2,3]});d.drawDistribution(c),d.drawDistribution(h),t.userData.transition=0,t.userData.transition_meta="Slider(0, 1, step: 0.01)",t.userData.foo=0,t.userData.foo_meta="Slider(-2, 2, step: 0.25)",t.userData.scale=1,t.userData.scale_meta="Slider(-1, 1, pow: 10, step: .1)",yield a.onTick(()=>{d.lerpDistribute(c,h,t.userData.transition),d.rotation.z=t.userData.foo*Math.PI,d.scale.setScalar(t.userData.scale)}),(0,l.v)(e,t),e.sceneSelection.add("Select ScatteredDemo",t)},[]),null}function E(){return(0,h.Ky)(function*(e){e.useOrbitControls({position:[0,0,8],target:0})},[]),null}function B(e){let{children:t}=e,a=(0,h.Ky)();return(0,r.jsx)(d.KU,{three:a,backgroundColor:"#26163c4f",children:t})}function j(){return(0,r.jsxs)("div",{className:"absolute-through",children:[(0,r.jsx)(c.Leak,{}),(0,r.jsx)(h.H7,{children:(0,r.jsxs)(B,{children:[(0,r.jsx)("div",{className:"absolute-through px-3 py-2 flex flex-col gap-4",children:(0,r.jsx)("h1",{className:"text-4xl",children:"ScatteredPlane"})}),(0,r.jsx)(E,{}),(0,r.jsx)(z,{})]})})]})}},25463:function(e,t,a){"use strict";function*r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let r=0,i=0;2===t.length?(r=t[0],i=t[1]):Array.isArray(t[0])?(r=t[0][0],i=t[0][1]):(r=t[0].x,i=t[0].y);let n={i:0,x:0,y:0},s=0;for(let e=0;e<i;e++)for(let t=0;t<r;t++)n.i=s++,n.x=t,n.y=e,yield n}function*i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let r=0,i=0,n=0;3===t.length?(r=t[0],i=t[1],n=t[2]):Array.isArray(t[0])?(r=t[0][0],i=t[0][1],n=t[0][2]):(r=t[0].x,i=t[0].y,n=t[0].z);let s={i:0,x:0,y:0,z:0},o=0;for(let e=0;e<n;e++)for(let t=0;t<i;t++)for(let a=0;a<r;a++)s.i=o++,s.x=a,s.y=t,s.z=e,yield s}a.d(t,{B:function(){return r},K:function(){return i}})}},function(e){e.O(0,[4330,5890,6655,5835,5244,4964,8423,3662,7579,893,7601,2290,1943,7516,6626,6028,7112,3679,900,9427,1523,4069,7722,1497,1658,3510,1744],function(){return e(e.s=50406)}),_N_E=e.O()}]);
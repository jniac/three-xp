(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6989],{1029:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});let a={vecX:["float","vec2","vec3","vec4"]},r=(e,t)=>{let n=[],r=Array.isArray(e)?e:[e].map(e=>e in a?a[e]:e).flat();if("function"==typeof t)for(let e of r)n.push(t(e).replaceAll(/\bT\b/g,e));else for(let e of r)n.push(t.replaceAll(/\bT\b/g,e));return n.join("\n")}},4941:(e,t,n)=>{"use strict";n.d(t,{_5:()=>r.ol,YN:()=>r.o8,cz:()=>i,kY:()=>r.kY});var a=n(37197),r=n(40074);let i={transition:r.kY,bump:a.$p}},8144:(e,t,n)=>{"use strict";n.d(t,{H:()=>i});var a=n(65927),r=n(1029);let i="\n".concat(a.S,"\n\n#ifndef GLSL_UTILS\n#define GLSL_UTILS\n\nfloat sin01(float x) {\n  return 0.5 + 0.5 * sin(x * 6.283185307179586);\n}\n\nvec2 scaleAround(vec2 p, vec2 c, float s) {\n  return c + (p - c) / s;\n}\n\n// Same as mix, but clamped.\n").concat((0,r.N)("vecX","\n  T lerp(in T a, in T b, in float x) {\n    return mix(a, b, clamp01(x));\n  }\n"),"\n\nfloat inverseLerpUnclamped(in float a, in float b, float x) {\n  return (x - a) / (b - a);\n}\n\nfloat inverseLerp(in float a, in float b, float x) {\n  return clamp01((x - a) / (b - a));\n}\n\nfloat remap(in float x, in float a, in float b, in float c, in float d) {\n  return c + (d - c) * inverseLerp(a, b, x);\n}\n\n// Remap from [-1, 1] to [0, 1]\nfloat remap1101(in float x) {\n  return clamp01(0.5 + 0.5 * x);\n}\n\nfloat oneMinus(in float x) {\n  return 1.0 - x;\n}\n\n// Returns x^p, but handles negative x values correctly.\nfloat spow(in float x, in float p) {\n  return x >= 0.0 ? pow(x, p) : -pow(-x, p);\n}\n\nfloat threshold(in float x, in float thresholdValue) {\n  return x < thresholdValue ? 0. : 1.;\n}\n\nfloat threshold(in float x, in float thresholdValue, in float width) {\n  return width < 1e-9 \n    ? (x < thresholdValue ? 0. : 1.)\n    : clamp01((x - thresholdValue + width * .5) / width);\n}\n\nmat3 extractRotation(mat4 matrix) {\n  return mat3(matrix[0].xyz, matrix[1].xyz, matrix[2].xyz);\n}\n\nvec2 rotate(vec2 p, float a) {\n  float c = cos(a);\n  float s = sin(a);\n  float x = c * p.x + s * p.y;\n  float y = -s * p.x + c * p.y;\n  return vec2(x, y);\n}\n\nvec2 rotateAround(vec2 p, float a, vec2 c) {\n  return c + rotate(p - c, a);\n}\n\nvec2 rotateScaleAround(vec2 p, float a, float s, vec2 c) {\n  return c + rotate((p - c) / s, a);\n}\n\nfloat positiveModulo(float x) {\n  x = mod(x, 1.0);\n  return x < 0.0 ? x + 1.0 : x;\n}\n\nfloat positiveModulo(float x, float modulo) {\n  x = mod(x, modulo);\n  return x < 0.0 ? x + modulo : x;\n}\n\n// Limit a value to a maximum that the function tends to reach when x -> âˆž\n// https://www.desmos.com/calculator/0vewkbnscu\nfloat limited(float x, float maxValue) {\n  return x <= 0.0 ? x : maxValue * x / (maxValue + x);\n}\n\n// https://www.desmos.com/calculator/0vewkbnscu\nfloat limited(float x, float minValue, float maxValue) {\n  float d = maxValue - minValue;\n  float xd = x - minValue;\n  return x <= minValue ? x : minValue + d * xd / (d + xd);\n}\n\nfloat sqLength(in vec2 p) {\n  return p.x * p.x + p.y * p.y;\n}\n\nfloat sqLength(in vec3 p) {\n  return p.x * p.x + p.y * p.y + p.z * p.z;\n}\n\nfloat pcurve(float x, float a, float b) {\n  float k = pow(a + b, a + b) / (pow(a, a) * pow(b, b));\n  return k * pow(x, a) * pow(1.0 - x, b);\n}\n\nfloat hash(float p) {\n  return fract(sin(p * 12.9898) * 43758.5453);\n}\n\nfloat hash(vec2 p) {\n  return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat hash(vec3 p) {\n  return fract(sin(dot(p, vec3(12.9898, 78.233, 45.164))) * 43758.5453);\n}\n\nfloat hash(vec4 p) {\n  return fract(sin(dot(p, vec4(12.9898, 78.233, 45.164, 94.673))) * 43758.5453);\n}\n\nvec2 hash2(float p) {\n  return vec2(hash(p), hash(p + 1.0));\n}\n\nvec2 hash2(vec2 p) {\n  return vec2(hash(p.x), hash(p.y));\n}\n\nvec2 hash2(vec3 p) {\n  return vec2(hash(p.xy), hash(p.yz));\n}\n\nvec2 hash2(vec4 p) {\n  return vec2(hash(p.xyz), hash(p.yzw));\n}\n\nvec3 hash3(float p) {\n  return vec3(hash2(p),  hash(p + 2.0));\n}\n\nvec3 hash3(vec2 p) {\n  return vec3(hash2(p), hash(p));\n}\n\nvec3 hash3(vec3 p) {\n  return vec3(hash(p.x), hash(p.y), hash(p.z));\n}\n\nvec3 hash3(vec4 p) {\n  return vec3(hash(p.xy), hash(p.yz), hash(p.zw));\n}\n\nfloat hash_alt(float p) {\n  return fract(sin(p * 127.1) * 311.7);\n}\n\nfloat hash_alt(vec2 p) {\n  return fract(sin(dot(p, vec2(127.1, 311.7))) * 269.5);\n}\n\nfloat hash_alt(vec3 p) {\n  return fract(sin(dot(p, vec3(127.1, 311.7, 74.7))) * 269.5);\n}\n\nfloat hash_alt(vec4 p) {\n  return fract(sin(dot(p, vec4(127.1, 311.7, 74.7, 113.5))) * 269.5);\n}\n\n").concat((0,r.N)("vecX","\n  T min3(in T a, in T b, in T c) {\n    return min(min(a, b), c);\n  }\n"),"\n\n").concat((0,r.N)("vecX","\n  T min4(in T a, in T b, in T c, in T d) {\n    return min(min(a, b), min(c, d));\n  }\n"),"\n\n#endif // GLSL_UTILS\n")},9723:(e,t,n)=>{"use strict";n.d(t,{Y:()=>o});var a=n(49797),r=n(60041);let i={shadowColor:"#808080",luminosity:1,rampPower:1,onBeforeCompile:void 0};class o extends a.V9B{constructor(e){let{rampPower:t,shadowColor:n,luminosity:o,onBeforeCompile:s,...l}={...i,...e},c={uSunPosition:{value:new a.Pq0(.5,.7,.3)},uShadowColor:{value:new a.Q1f(n)},uRampPower:{value:t},uLuminosity:{value:o}};super(l),this.onBeforeCompile=e=>{r.b.with(e).uniforms(c).varying({vWorldNormal:"vec3"}).vertex.mainAfterAll("\n          vWorldNormal = mat3(modelMatrix) * normal;\n        ").fragment.after("map_fragment","\n          vec3 lightDirection = normalize(uSunPosition);\n          float light = dot(vWorldNormal, lightDirection) * 0.5 + 0.5;\n          light = pow(light, uRampPower);\n          diffuseColor.rgb *= mix(uShadowColor * uLuminosity, vec3(1.0), light);\n        "),null==s||s(e)},this.sunPosition=c.uSunPosition.value}}},10937:(e,t,n)=>{"use strict";n.d(t,{k:()=>c});var a=n(49797),r=n(38921);let i={axis:"x",length:1,radialSegments:12,radius:.01,coneRatio:.1,radiusScale:1,vertexColor:!0,baseCap:"flat",color:"white",align:0},o=new a.Q1f;function s(e){let{axis:t,length:n,radius:s,radialSegments:l,coneRatio:c,radiusScale:u,vertexColor:f,baseCap:p,color:d,align:h}={...i,...e},x=s*u,v=n*c,m=new a.qFE(3*x,v,l),w=new a.Ho_(x,x,1,l,1,!0),y=n-v,g=n-.5*v;m.rotateZ(-Math.PI/2).translate(g,0,0),w.scale(1,y,1).rotateZ(-Math.PI/2).translate(.5*y,0,0);let b="none"===p?new a.LoY:"flat"===p?new a.tcD(x,l).rotateY(-Math.PI/2):new a.Gu$(x,l,3,0,2*Math.PI,0,.5*Math.PI).rotateZ(Math.PI/2).rotateX(Math.PI/2),S=(0,r.pP)([m,w,b]);switch(0!==h&&S.translate(-n*h,0,0),t){case"y":S.rotateZ(Math.PI/2);break;case"z":S.rotateY(-Math.PI/2)}if(f){let e=S.attributes.position.count,t=new a.THS(new Float32Array(3*e),3);S.setAttribute("color",t),o.set(d);for(let n=0;n<e;n++)t.setXYZ(n,o.r,o.g,o.b)}return S}a.LoY;let l={xColor:"#ff3333",yColor:"#33cc66",zColor:"#3366ff"};class c extends a.LoY{static get defaultOptions(){return{...l}}constructor(e){super();let{xColor:t,yColor:n,zColor:a,...i}={...l,...e},o=s({...i,axis:"x",color:t}),c=s({...i,axis:"y",color:n}),u=s({...i,axis:"z",color:a}),f=(0,r.pP)([o,c,u]);this.copy(f),f.dispose()}}},14277:(e,t,n)=>{"use strict";n.d(t,{D:()=>r});var a=n(67203);function r(){let[e,t]=(0,a.useState)(!1);return(0,a.useLayoutEffect)(()=>{t(!0)},[]),e}},17099:(e,t,n)=>{"use strict";n.d(t,{c:()=>s});var a=n(79105);let r=e=>e,i={weightsAreNormalized:!1,indexOffset:0,forbiddenItems:[]};function o(){let e=(0,a.K2)((0,a.K2)((0,a.Ts)(a.KP)));function t(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.KP;return"string"==typeof t&&(t=t.split("").reduce((e,t)=>7*e+t.charCodeAt(0),0)),e=(0,a.K2)((0,a.K2)((0,a.Ts)(t))),u}function n(){return e=(0,a.K2)(e),(0,a.Tj)(e)}function o(e){switch(e.length){default:return[0,1,r];case 1:return[0,e[0],r];case 2:return[e[0],e[1],r];case 3:return[e[0],e[1],e[2]]}}function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let[r,i,s]=o(t);return r+(i-r)*s(n())}function l(){for(var e,t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];let[o,s,{weightsAreNormalized:l,indexOffset:c,forbiddenItems:u}]=function(e){let[t,n=null,a]=e,r={...i,...a};if(Array.isArray(t))return[t,n,r];if("object"==typeof t)return[Object.values(t),n?Object.values(n):null,r];throw Error("pick: unsupported options type")}(a);if(u.length>0){let t=new Set;for(let e of u){let n=o.indexOf(e);n>=0&&t.add(n)}if(o=o.filter((e,n)=>!t.has(n)),s=null!=(e=null==s?void 0:s.filter((e,n)=>!t.has(n)))?e:null,0===o.length)throw Error("pick: all items are forbidden")}if(null===s){let e=Math.floor(n()*o.length);return c&&(e+=c,(e%=o.length)<0&&(e+=o.length)),o[e]}if(!l){let e=s.reduce((e,t)=>e+t,0);s=s.map(t=>t/e)}let f=n(),p=0;for(let e=0;e<o.length;e++)if(f<(p+=s[e]))return o[e];throw Error("among: unreachable")}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=n(),r=n(),i=Math.sqrt(-2*Math.log(a)),o=2*Math.PI*r;return[e+t*i*Math.cos(o),e+t*i*Math.sin(o)]}let u={seed:t,seedMax:function(){return a.Zu},reset:function(){return t(a.KP),u},next:function(){return e=(0,a.K2)(e),u},getState:function(){return e},setState:function(t){return e=t&a.Zu,u},random:n,between:s,around:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let[i=1,o=r]=t,s=2*n();return(s>1?1:-1)*o(s>1?s-1:s)*i},int:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let[r,i,s]=o(t);return r+Math.floor(s(n())*(i-r))},chance:function(e){return n()<e},shuffle:function(e){let{mutate:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t&&Array.isArray(e)?e:[...e],r=a.length;for(let e=0;e<r;e++){let t=Math.floor(r*n()),i=a[e];a[e]=a[t],a[t]=i}return a},pick:l,createPicker:function(e){let t=e.map(e=>{let[t]=e;return t}),n=e.map(e=>{let[t,n]=e;return n}),a=n.reduce((e,t)=>e+t,0);for(let[e,t]of n.entries())n[e]=t/a;return()=>l(t,n,{weightsAreNormalized:!0})},vector:function(e,t){let[n=0,a=1]=Array.isArray(t)?t:[null==t?void 0:t.min,null==t?void 0:t.max];for(let t of Object.keys(e))e[t]=s(n,a);return e},unitVector2:function(e){let t=2*Math.PI*n();return e.x=Math.cos(t),e.y=Math.sin(t),e},unitVector3:function(e){let t=n(),a=n(),r=2*Math.PI*t,i=Math.acos(1-2*a);return e.x=Math.sin(i)*Math.cos(r),e.y=Math.sin(i)*Math.sin(r),e.z=Math.cos(i),e},normalVector:function(e){let t=Object.keys(e),n=t.length,a=Math.sqrt(n);for(let r=0;r<n;r+=2){let[i,o]=c();e[t[r]]=i/a,r+1<n&&(e[t[r+1]]=o/a)}return e},unitVector:function(e){let t=Object.keys(e),n=t.length,a=0;for(let r=0;r<n;r+=2){let[i,o]=c();e[t[r]]=i,a+=i*i,r+1<n&&(e[t[r+1]]=o,a+=o*o)}a=Math.sqrt(a);for(let r=0;r<n;r++)e[t[r]]/=a;return e},boxMuller:c,quaternion:function(e){let t=n(),a=n(),r=n(),i=Math.sqrt(1-t),o=Math.sqrt(t);return e.x=i*Math.sin(2*Math.PI*a),e.y=i*Math.cos(2*Math.PI*a),e.z=o*Math.sin(2*Math.PI*r),e.w=o*Math.cos(2*Math.PI*r),e},insideCircle:function(e,t){let a=2*n()*Math.PI,r=Math.sqrt(n())*e;return t.x=r*Math.cos(a),t.y=r*Math.sin(a),t}};return u}let s=class{constructor(e){Object.assign(this,o().seed(e))}};Object.assign(s,o())},22899:(e,t,n)=>{"use strict";n.d(t,{I:()=>i});var a=n(65927);let r=["linear"];for(let e=1;e<=10;e++)r.push("easeIn".concat(e)),r.push("easeOut".concat(e)),r.push("easeInOut".concat(e)),r.push("easeOutIn".concat(e));let i="\n#ifndef GLSL_EASING\n#define GLSL_EASING\n\n".concat(a.S,"\n\nfloat easePow1(float x) {\n  return x;\n}\n\nfloat easePow2(float x) {\n  return x * x;\n}\n\nfloat easePow3(float x) {\n  return x * x * x;\n}\n\nfloat easePow4(float x) {\n  x *= x;\n  return x *= x;\n}\n\nfloat easePow5(float x) {\n  float x0 = x;\n  x *= x;\n  x *= x;\n  return x0 * x;\n}\n\nfloat easePow6(float x) {\n  x *= x * x;\n  return x *= x;\n}\n\nfloat easePow7(float x) {\n  float x0 = x;\n  x *= x * x;\n  x *= x;\n  return x0 * x;\n}\n\nfloat easePow8(float x) {\n  x *= x;\n  x *= x;\n  return x *= x;\n}\n\nfloat easePow9(float x) {\n  x *= x * x;\n  return x *= x * x;\n}\n\nfloat easePow10(float x) {\n  float x0 = x;\n  x *= x * x;\n  x *= x * x;\n  return x0 * x;\n}\n\nfloat linear(float x) {\n  return clamp01(x);\n}\n\n").concat(Array.from({length:10},(e,t)=>{let n=t+1;return"\n\n  float easeIn".concat(n," (float x) {\n    return easePow").concat(n,"(clamp01(x));\n  }\n  float easeOut").concat(n," (float x) {\n    return 1.0 - easePow").concat(n,"(clamp01(1.0 - x));\n  }\n  float easeInOut").concat(n," (float x) {\n    return x < 0.5 \n      ? 0.5 * easePow").concat(n,"(2.0 * x) \n      : 1.0 - 0.5 * easePow").concat(n,"(2.0 * (1.0 - x));\n  }\n  float easeOutIn").concat(n," (float x) {\n    return x < 0.5\n      ? 0.5 * (1.0 - easePow").concat(n,"(1.0 - x * 2.0))\n      : 1.0 - 0.5 * (1.0 - easePow").concat(n,"(2.0 * x - 1.0));\n  }\n\n").trim()}).join("\n\n"),"\n\n\n// https://www.desmos.com/calculator/mqou4lf9zc?lang=fr\nfloat easeInOut(float x, float p, float i) {\n  return  x <= 0.0 ? 0.0 :\n          x >= 1.0 ? 1.0 :\n          x <= i ? 1.0 / pow(i, p - 1.0) * pow(x, p) :\n          1.0 - 1.0 / pow(1.0 - i, p - 1.0) * pow(1.0 - x, p);\n}\n\n// https://www.desmos.com/calculator/nrjlezusdv\nfloat easeInThenOut(float x, float p) {\n  return 1.0 - pow(abs(2.0 * x - 1.0), p);\n}\n\n#endif\n")},28737:(e,t,n)=>{"use strict";n.d(t,{Leak:()=>c,O:()=>l});var a={};n.r(a),n.d(a,{distribute:()=>i.mn,every:()=>i.Si,findMaxBy:()=>i.vj,pairwise:()=>i.Ju,recordBy:()=>i.VY,some:()=>i.zN,split:()=>i.mn,uniqueBy:()=>i.pD});var r=n(30158),i=n(43107),o=n(85795),s=n(17099);function l(e){Object.assign(window,{...r,...o,...a,...e,PRNG:s.c})}function c(e){return l(e),null}},33855:(e,t,n)=>{"use strict";n.d(t,{dB:()=>d,q:()=>h,uB:()=>m,yk:()=>p});var a=n(70691),r=n(67203),i=n(49797),o=n(7587),s=n(16219),l=n(6697),c=n(36508),u=n(14277);let f=(0,r.createContext)(null);function p(e,t){let n=(0,r.useContext)(f);return(0,o.C7)(async function*(t,a){if(e){let t=e(n,a);if(t&&"function"==typeof t.next)do{let{value:e,done:n}=await t.next();if(n)break;yield e}while(a.mounted)}},null!=t?t:"always"),n}function d(e,t,n){let a=(0,r.useMemo)(()=>new i.YJl,[]);return a.name=e,p(async function*(e,n){if(e.scene.add(a),yield()=>{a.clear(),a.removeFromParent()},t){let r=t(a,e,n);if(r&&"function"==typeof r.next)do{let{value:e,done:t}=await r.next();if(t)break;yield e}while(n.mounted)}},n),a}function h(e){let{value:t}=e,n=(0,r.useMemo)(()=>"function"==typeof t?new t:t,[t]);return p(async function*(e){if(e.scene.add(n),"initialize"in n){let t=n.initialize(e);if(t&&"function"==typeof t.next)for(;;){let{value:e,done:n}=await t.next();if(n)break;yield e}}yield()=>{if(n.removeFromParent(),"destroy"in n){var e;null==(e=n.destroy)||e.call(n)}}},[n]),null}let x={className:"",assetsPath:"/",vertigoControls:!1};function v(e){let{children:t,className:n,assetsPath:i,vertigoControls:u}={...x,...e},p=(0,r.useMemo)(()=>new l.XW,[]);p.loader.setPath(i);let{ref:d}=(0,o.IZ)({debounce:!0},function*(e,t){yield p.initialize(e.firstElementChild),t.triggerRender(),Object.assign(window,{three:p})},[]);(0,o.C7)(function*(){if(u){let e=new s.n("object"==typeof u?u:{}).initialize(d.current).start();yield e.destroy,yield(0,c.xy)("three",t=>{e.update(p.camera,p.aspect,t.deltaTime)})}},[u]);let h={position:"absolute",inset:0};return(0,a.jsx)("div",{ref:d,className:n,style:h,children:(0,a.jsxs)(f.Provider,{value:p,children:[(0,a.jsx)("div",{style:h}),(0,a.jsx)("div",{style:h,className:"thru",children:p.initialized&&t})]})})}function m(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,u.D)()&&(0,a.jsx)(v,{...t[0]})}},35375:(e,t,n)=>{"use strict";n.d(t,{$:()=>r});let a="/three-xp/assets/",r={development:!1,assetsPath:a,assets:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(a).concat(e)}}},56969:(e,t,n)=>{"use strict";n.d(t,{Client:()=>U});var a=n(70691),r=n(49797),i=n(64028),o=n(84306),s=n(10937),l=n(9723),c=n(66851),u=n(87381),f=n(17099),p=n(35375),d=n(33855),h=n(28737),x=n(92381),v=n(42206),m=n(79285);class w{constructor(e,t,n,a){this.space=e,this.rect=t,this.uvRect=n,this.scatterCoeff=a,this.r0=f.c.random(),this.r1=f.c.random()}}class y{constructor(e,t){this.props={...y.defaultProps,...t};let{position:n,size:a,scatterPadding:r,sizeOptions:i,seed:o}=this.props,{col:s,row:l}=e.props;f.c.seed(o);let c=f.c.createPicker(i),u=Array.from({length:s}).map(c),p=Array.from({length:l}).map(c),{x:d,y:h}=(0,x.wX)(n),{x:g,y:b}=(0,x.wX)(a),S=new v.$x(v.OP.Horizontal).setSize(g,b).setOffset(d-g/2,h-b/2);for(let e of u){let t=new v.$x(v.OP.Vertical).setSize("".concat(e,"fr")).addTo(S);for(let e of p)new v.$x(v.OP.Horizontal).setSize("".concat(e,"fr")).addTo(t)}S.computeLayout();let z=S.rect,M=[...S.allLeaves({includeSelf:!1})],P=(g+b)/2,A=M.map(e=>{let t=e.rect.clone(),n=t.clone().relativeTo(z),{x:a,y:i}=t.getCenter(),o=Math.abs(a-d)+Math.abs(i-h),s=(0,m.inverseLerp)(.5,1,o/P);return t.centerX+=f.c.between(-r,r)*s,t.centerY+=f.c.between(-r,r)*s,new w(e,t,n,s)});this.root=S,this.nodes=A}}y.defaultProps={seed:87654,position:new r.I9Y(0,0),size:new r.I9Y(3,2),scatterPadding:.1,sizeOptions:[[.5,1],[1,10],[2,2],[3,1]]};var g=n(56647),b=n(17475),S=n(60041),z=n(22899),M=n(8144),P=n(4941),A=n(6726);class D extends r.B69{constructor(){super();let e=new r.dth("#ffffff","#926969",1);this.add(e);let t=new r.ZyN("#ffffff",2);this.add(t),t.position.set(2,4,1)}}class I extends r.V9B{get mapAspect(){return this.uniforms.uMapInfo.value.x}set mapAspect(e){this.uniforms.uMapInfo.value.x=e}getScatteredSize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new r.I9Y;return e.x=this.uniforms.uScatteredInfo.value.x,e.y=this.uniforms.uScatteredInfo.value.y,e}setScatteredSize(e){this.uniforms.uScatteredInfo.value.x=e.x,this.uniforms.uScatteredInfo.value.y=e.y}get scatteredSize(){return this.getScatteredSize()}set scatteredSize(e){this.setScatteredSize(e)}update(e){e*=.33,this.uniforms.uDispersionTime.value+=e*this.uniforms.uDispersion.value.x,this.uniforms.uLowDispersionTime.value+=e*this.uniforms.uLowDispersion.value.x}constructor(){super({side:r.$EB}),this.uniforms={uDispersionTime:{value:0},uLowDispersionTime:{value:0},uDispersion:{value:new r.IUQ(1,-.6,.4,2)},uLowDispersion:{value:new r.IUQ(0,-.6,.4,0)},uMainParams:{value:new r.IUQ(1,0)},uCenter:{value:new r.Pq0},uMapInfo:{value:new r.IUQ(1,1,.5,.5)},uScatteredInfo:{value:new r.IUQ(1,1,0,0)},uNormalMap:{value:b.o.get("three").loadTexture("textures/rough_concrete_nor_gl_1k.jpg",e=>{e.wrapS=e.wrapT=r.GJx})}},this.userData=function(e,t){for(let[n,a,r,i]of t)Object.defineProperty(e,"".concat(n,"_meta"),{enumerable:!0,value:i}),Object.defineProperty(e,n,{enumerable:!0,get:()=>a[r],set(e){a[r]=e}});return e}({},[["chunkScale",this.uniforms.uMainParams.value,"x","\n        Name(chunk.scale)\n        Slider(0, 1, step: any)\n      "],["imageVisibility",this.uniforms.uMainParams.value,"y","\n        Name(image.visibility)\n        Slider(0, 1, step: any)\n      "],["dispX",this.uniforms.uDispersion.value,"x","\n        Name(disp.x)\n        Slider(0, 1, step: any)\n      "],["dispY",this.uniforms.uDispersion.value,"y","\n        Name(disp.y)\n        Slider(-1, 1, step: any)\n      "],["dispZ",this.uniforms.uDispersion.value,"z","\n        Name(disp.z)\n        Slider(-1, 1, step: any)\n      "],["dispW",this.uniforms.uDispersion.value,"w","\n        Name(disp.cycle)\n        Slider(1, 20, step: 1)\n      "],["lowDispX",this.uniforms.uLowDispersion.value,"x","\n        Name(lowDisp.x)\n        Slider(0, 1, step: any)\n      "]]),this.onBeforeCompile=e=>S.b.with(e).defines({USE_UV:""}).uniforms(this.uniforms).varying({vRand:"vec4"}).vertex.top(M.H,z.I,'\n  // sizeMode: 0 for "contain", 1 for "cover"\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, vec2 scale) {\n    align.y = 1.0 - align.y; // Flip y-coordinate\n    if ((outerAspect > innerAspect) != (sizeMode == 1.0)) { // XOR condition for mode\n      float scaleFactor = outerAspect / innerAspect;\n      uv.x = (uv.x - align.x) * scaleFactor + align.x; // Adjust x-coordinate\n    } else {\n      float scaleFactor = innerAspect / outerAspect;\n      uv.y = (uv.y - align.y) * scaleFactor + align.y; // Adjust y-coordinate\n    }\n    uv = (uv - align) / scale + align;\n    return uv;\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, float scale) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, align, vec2(scale));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, align, vec2(1.0));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect, float sizeMode) {\n    return applyUvSize(uv, outerAspect, innerAspect, sizeMode, vec2(0.5));\n  }\n\n  vec2 applyUvSize(vec2 uv, float outerAspect, float innerAspect) {\n    return applyUvSize(uv, outerAspect, innerAspect, 1.0);\n  }\n').vertex.top("\n        attribute vec4 aRectUv;\n        attribute vec4 aRand;\n      ").vertex.top("\n        vec2 delta;\n        float scatterRatio;\n\n        vec4 computeDispersion() {\n          if (uDispersion.x == 0.0) {\n            return vec4(0.0, 0.0, 0.0, 1.0);\n          }\n\n          float duration = lerp(8.0, 1.0, aRand.x * aRand.y * aRand.z);\n          float cycleCount = max(floor(uDispersion.w), 1.0);\n          float time = mod(uDispersionTime + duration * cycleCount * aRand.x, duration * cycleCount) / duration;\n          float cycleVisibility = time <= 1.0 ? 1.0 : easeInOut3(1.0 - inverseLerp(.8 * aRand.w + .1, .8 * aRand.w + .2, uDispersion.x));\n          time = mod(time, 1.0);\n          float size = easeInThenOut(time, 8.0) * lerp(2.0, 1.0, time * time) * cycleVisibility;\n          size = mix(1.0, size, pow(uDispersion.x, 1.0 / 2.0));\n\n          // Apply scale before instanceMatrix (shrinking).\n          vec3 dispersed;\n          dispersed.xy = -delta * lerp(uDispersion.y, uDispersion.z, time);\n          dispersed.z = lerp(1.0, 0.0, time);\n          dispersed *= uDispersion.x;\n\n          return vec4(dispersed, size);\n        }\n\n        float getStartEffect(float time, float duration) {\n          return min(1.0, time / duration);\n        }\n\n        float getEndEffect(float time, float timeMax, float duration) {\n          return max(0.0, time - (timeMax - duration)) / duration;\n        }\n\n        vec4 computeLowDispersion() {\n          if (uLowDispersion.x == 0.0) {\n            return vec4(0.0, 0.0, 0.0, 1.0);\n          }\n\n          float periodScalarT = inverseLerp(0.1, 0.9, scatterRatio);\n          float period = lerp(2.0, 8.0, aRand.x) * lerp(60.0, 1.0, periodScalarT);\n          float time = mod(uLowDispersionTime + period * aRand.z, period);\n\n          float duration = 1.0;\n          float effectStart = min(1.0, time);\n          float effectEnd = getEndEffect(time, period, duration);\n\n          float size = getStartEffect(time, 0.3) * (1.0 - getEndEffect(time, period, 0.3));\n          size = pow(size, 1.0 / 4.0);\n          size = mix(1.0, size, pow(uLowDispersion.x, 1.0 / 4.0));\n\n          vec3 dispersed;\n\n          dispersed.xy = delta * 0.1;\n          dispersed.z = 0.2;\n          dispersed.xyz *= getEndEffect(time, period, 1.0);\n          dispersed *= uLowDispersion.x;\n\n          return vec4(dispersed, size);\n        }\n      ").vertex.replace("project_vertex","\n        vec4 mvPosition = vec4(position, 1.0);\n        delta = instanceMatrix[3].xy - uCenter.xy;\n        scatterRatio = clamp(1.1 * length(delta) / (length(uScatteredInfo.xy) / 2.0), 0.0, 1.0);\n\n        vec4 dispersion = computeDispersion();\n        vec4 lowDispersion = computeLowDispersion();\n\n        float scale = clamp01(uMainParams.x * 3.0 - 2.0 * aRand.w);\n        mvPosition.xyz *= dispersion.w * lowDispersion.w * easeInOut3(scale);\n\n        mvPosition = instanceMatrix * mvPosition;\n        mvPosition.xyz += dispersion.xyz + lowDispersion.xyz;\n\n        mvPosition = modelViewMatrix * mvPosition;\n        gl_Position = projectionMatrix * mvPosition;      \n      ").vertex.replace("uv_vertex","\n        #if defined( USE_UV ) || defined( USE_ANISOTROPY )\n          vUv = vec3( uv, 1 ).xy;\n          vUv = aRectUv.xy + aRectUv.zw * vUv;\n        #endif\n        #ifdef USE_MAP\n          vec2 instanceUv = aRectUv.xy + aRectUv.zw * MAP_UV;\n\n          // vec2 uv, float outerAspect, float innerAspect, float sizeMode, vec2 align, vec2 scale\n          float outerAspect = uScatteredInfo.x / uScatteredInfo.y;\n          float innerAspect = uMapInfo.x;\n          float sizeMode = uMapInfo.y;\n          vec2 align = uMapInfo.zw;\n          instanceUv = applyUvSize(instanceUv, outerAspect, innerAspect, sizeMode, align, vec2(1.0));\n          \n          vMapUv = ( mapTransform * vec3( instanceUv, 1 ) ).xy;\n        #endif\n      ").vertex.mainAfterAll("\n        vRand = aRand;\n      ").fragment.top(M.H,z.I).fragment.replace("color_fragment","\n        vec3 normal = texture2D(uNormalMap, vUv * 4.0).rgb;\n        vec3 light = normalize(vec3(0.5, 2.5, 1.0));\n        float colorAlteration = mix(0.333, 1.0, dot(normal, light));\n        float transition = inverseLerp(0.0, 0.2, uMainParams.y - 0.8 * vRand.w);\n        diffuseColor.rgb = mix(vColor * colorAlteration, diffuseColor.rgb, transition);\n      ")}}class L extends r.B69{static createPlane(e){let{row:t,col:n}=e,a=t*n,i=new r.bdM,o=new r.uWO(new Float32Array(4*a),4);i.setAttribute("aRectUv",o);let s=new r.uWO(new Float32Array(4*a),4);i.setAttribute("aRand",s);for(let e=0;e<a;e++)s.setXYZW(e,f.c.random(),f.c.random(),f.c.random(),f.c.random());let l=new I,c=new r.ZLX(i,l,a);return c.name="plane",c}get count(){return this.internal.count}onTick(e){this.internal.plane.material.update(e.deltaTime)}getDistribution(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new y(this,e)}drawDistribution(e){let{position:t,size:n,scatterPadding:a}=e.props,{x:r,y:i}=(0,x.wX)(t),{x:o,y:s}=(0,x.wX)(n);this.internal.lineHelper.rectangle([r,i,o,s]).rectangle([r,i,o+2*a,s+2*a])}distribute(e){let{count:t,plane:n}=this.internal,{aRectUv:a}=n.geometry.attributes;for(let r=0;r<t;r++){let{rect:t,uvRect:i}=e.nodes[r];n.setMatrixAt(r,(0,c.w)({position:t.getCenter(),scale:t.getSize()})),a.setXYZW(r,i.x,i.y,i.width,i.height)}n.material.setScatteredSize(e.root.rect.getSize());let r=e.root.rect;n.material.setScatteredSize(r.getSize()),n.material.uniforms.uCenter.value.copy(r.getCenter())}lerpDistribute(e,t,n){let{count:a,plane:i}=this.internal,{aRectUv:o}=i.geometry.attributes,s=new A.M_,l=new A.M_,u=new A.M_,f=new r.Pq0,p=new r.Pq0;for(let r=0;r<a;r++){let a=e.nodes[r],u=t.nodes[r],d=.3*(1-a.r0*(a.scatterCoeff+.2*u.r0)),h=(0,m.inverseLerp)(d,.7+d,n),x=(0,P.YN)(h);s.lerpRectangles(a.rect,u.rect,x),l.lerpRectangles(a.uvRect,u.uvRect,x),i.setMatrixAt(r,(0,c.w)({position:s.getCenter(f),scale:s.getSize(p),rotationY:(u.r0<.5?0:1)*x*Math.PI*2,rotationZ:.3*Math.sin(h*Math.PI)*(-1+2*a.r0)})),o.setXYZW(r,l.x,l.y,l.width,l.height)}let d=(0,P._5)((0,m.inverseLerp)(.3,.7,n));u.lerpRectangles(e.root.rect,t.root.rect,d),i.material.setScatteredSize(u.getSize()),i.material.uniforms.uCenter.value.copy(u.getCenter()),i.instanceMatrix.needsUpdate=!0,o.needsUpdate=!0}constructor(e={}){super(),this.transition=0;let t={...L.defaultProps,...e},{col:n,row:a}=t,r=L.createPlane(t);(0,u.DN)(r,this);let i=new g.R;(0,u.DN)(i,this);let o=new D;(0,u.DN)(o,this),this.internal={count:a*n,plane:r,lineHelper:i,lightSetup:o},this.props=t,this.distribute(this.getDistribution())}}L.displayName="ScatteredPlane",L.defaultProps={row:20,col:30,imageAspect:1,imageResizeMode:"cover"},L.transition_meta="Range(0, 1)";class N extends r.eaF{constructor(){super(new r.WBB(40,1),new r.V9B({color:"#aeb4e9",side:r.hsX})),this.onBeforeRender=(e,t,n)=>{this.position.copy(n.position)}}}let C={darkBlue:"#002c52",orange:"#ff5c35",white:"#ffffff",lightGrey:"#c9cfd3"};function T(){let e=(0,o.hG)();return e.three.pipeline.basicPasses.outline.enabled=!1,(0,d.dB)("ScatteredDemo",async function*(t,n){(0,u.DN)(new N,t),(0,u.DN)(new r.eaF(new s.k,new l.Y),t);let a=await n.loader.load("/assets/textures/DebugTexture.png");a.colorSpace=r.er$;let o=(0,u.DN)(new L,t);o.internal.plane.material.map=a,o.internal.plane.material.mapAspect=a.image.width/a.image.height;let p=o.getDistribution({seed:4789,position:[-2,0],size:[2,3]}),d=o.getDistribution({seed:3249,position:[2,0],size:[2,4]});o.drawDistribution(p),o.drawDistribution(d),t.userData.transition=0,t.userData.transition_meta="Slider(0, 1, step: 0.01)",t.userData.scale=1,t.userData.scale_meta="Slider(-1, 1, pow: 10, step: .1)",t.userData.links=[o.internal.plane.material.userData];let h=Object.values(C);for(let e=0,t=o.count;e<t;e++)o.internal.plane.setColorAt(e,(0,c._)(f.c.pick(h)));yield n.onTick(()=>{o.lerpDistribute(p,d,t.userData.transition),o.scale.setScalar(t.userData.scale)}),(0,i.it)(e,t),e.sceneSelection.add("Select ScatteredDemo",t)},[]),null}function _(){return(0,d.yk)(function*(e){e.useOrbitControls({position:[-2,0,8],target:[-2,0,0]})},[]),null}function R(e){let{children:t}=e,n=(0,d.yk)();return n.loader.setPath(p.$.assetsPath),(0,a.jsx)(o.zz,{three:n,backgroundColor:"#26163c4f",children:t})}function U(){return(0,a.jsxs)("div",{className:"layer thru",children:[(0,a.jsx)(h.Leak,{}),(0,a.jsx)(d.uB,{children:(0,a.jsxs)(R,{children:[(0,a.jsx)("div",{className:"layer thru px-3 py-2 flex flex-col gap-4",children:(0,a.jsx)("h1",{className:"text-4xl",children:"ScatteredPlane"})}),(0,a.jsx)(_,{}),(0,a.jsx)(T,{})]})})]})}},65927:(e,t,n)=>{"use strict";n.d(t,{S:()=>a});let a="\n#ifndef GLSL_BASIC\n#define GLSL_BASIC\n\nfloat clamp01(float x) {\n  return x < 0.0 ? 0.0 : x > 1.0 ? 1.0 : x;\n}\n\n#endif\n"},66620:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});var a=n(89868),r=n(44138);function i(e,t){var n=(0,r._)(e,t,"update");return(0,a._)(e,n)}},76205:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,89294,23)),Promise.resolve().then(n.bind(n,56969))},79105:(e,t,n)=>{"use strict";n.d(t,{K2:()=>o,KP:()=>r,Tj:()=>s,Ts:()=>i,Zu:()=>a});let a=0x7fffffff,r=123456,i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;if(Number.isNaN(e))throw Error("NaN is not a valid seed.");let t=e;if(10>Math.abs(t)&&(t*=1e6),t%=a,(t=t<0?t+a:t)>1)return t&a;if(0===t)return r;throw Error("Impossible. ".concat(t))},o=e=>e=Math.imul(e,48271)&a,s=e=>(e-1)/(a-1)}},e=>{var t=t=>e(e.s=t);e.O(0,[2193,5611,7190,6564,7962,9635,8921,7953,4512,7775,7436,7706,9294,4638,6726,3231,9303,7456,6219,7112,7558,6647,1319,6852,7358],()=>t(76205)),_N_E=e.O()}]);
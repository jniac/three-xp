(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4978],{80475:function(e,t,i){Promise.resolve().then(i.bind(i,84501))},84501:function(e,t,i){"use strict";i.d(t,{Main:function(){return ec}});var r,s,a,n=i(32617),o=i(74259),l=i(9258),h=i(42544),d=i(28104),c=i(47090),u=i(2132),p=i(92948),f=i(37186),m=i(81540),g=i(15721),w=i(35357),v=i(29368),x=i(44044),y=i(97219),M=i(78780),C=i(20821);let P=new f.Pa4(6,4,9),S=[new f.Pa4(0,0,4),new f.Pa4(0,4,0),new f.Pa4(6,0,9),new f.Pa4(6,4,6)],T=new f.Pa4(0,-8,8),b=new f.Pa4(1,0,1).normalize(),E=new f.Pa4(0,1,-1).normalize(),k=new f.Pa4().crossVectors(b,E).normalize();E.crossVectors(k,b).normalize();let A=new f.yGw().makeBasis(b,E,k).setPosition(T),R=new f.yGw().copy(A).invert(),O=new f.USm().setFromRotationMatrix(A),_=new f.JOQ().setFromNormalAndCoplanarPoint(k,T);class j extends f.ZAu{static current(){if(0===this.instances.length)throw Error("No Scope!");return this.instances[this.instances.length-1]}updateScope(){let{aspect:e=1,size:t=4}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e>1?t:t*e,r=i/e;(i!==this.state.width||r!==this.state.height)&&(this.parts.lines.clear().circle({radius:1}).rectangle([-i/2,-r/2,i,r]).plus([0,0],.2).draw(),this.parts.lines.geometry.computeBoundingSphere(),this.state.width=i,this.state.height=r)}isWithin(e){let{x:t,y:i}=e.clone().applyMatrix4(this.matrixWorldInverse),{width:r,height:s}=this.state;return t>=-r/2&&t<=r/2&&i>=-s/2&&i<=s/2}chunkIntersects(e){this.updateMatrixWorld(),e.updateMatrixWorld();let t=!0,i=!0,r=!0,s=!0,a=this.state.width/2,n=this.state.height/2;for(let o=0;o<4;o++){let{x:l,y:h,z:d}=j._chunkIntersectsVectors[o].copy(S[o]).applyMatrix4(e.matrixWorld).applyMatrix4(this.matrixWorldInverse);if(t&&(t=l<-a),r&&(r=l>a),i&&(i=h<-n),s&&(s=h>n),!1===(t||i||r||s))return!0}return!1}toVertigoProps(){let{width:e,height:t}=this.state;return{perspective:.5,size:[e,t],focus:this.position,rotation:this.rotation}}constructor(){super(),this.parts={lines:(0,M.cY)(new y.O,this),debugLines:(0,M.cY)(new y.O,this)},this.state={width:4,height:4},this.matrixWorldInverse=new f.yGw,this.destroy=()=>{let e=j.instances.indexOf(this);if(-1===e)throw Error("Scope instance not found");j.instances.splice(e,1)},j.instances.push(this),this.position.set(0,0,6),this.rotation.setFromRotationMatrix(A,x.a.default.rotation.order),this.rotation.x+=(0,C.FE)("20deg"),this.updateMatrix(),this.updateMatrixWorld(),this.matrixWorldInverse.copy(this.matrixWorld).invert()}}j.instances=[],j._chunkIntersectsVectors=[new f.Pa4,new f.Pa4,new f.Pa4,new f.Pa4];var I=i(60236),F=i(12042),N=i(32219),V=i(80536),Y=i(85705),z=i(6246);function D(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.Pa4;return i.set(e,t,e-t)}function G(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,{x:s,y:a,z:n}=t,o=s+i,l=a+i,h=n+i;for(let t=n;t<h;t++)for(let i=a;i<l;i++)for(let a=s;a<o;a++)e.getVoxelState(a,i,t+16).setInt8(0,r)}function U(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=P.clone().multiplyScalar(4/t),r=[];for(let s of(0,d.loop3)(i)){let i=s.x*t,a=s.y*t,n=s.z*t;(function(e,t,i,r){var s,a,n,o,l,h;let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return e.getVoxelState(t,i,r).getInt8(0)>0&&!((null!==(o=null===(s=e.tryGetVoxelState(t-d,i,r))||void 0===s?void 0:s.getInt8(0))&&void 0!==o?o:0)>0)&&!((null!==(l=null===(a=e.tryGetVoxelState(t,i+d,r))||void 0===a?void 0:a.getInt8(0))&&void 0!==l?l:0)>0)&&!((null!==(h=null===(n=e.tryGetVoxelState(t,i,r+d))||void 0===n?void 0:n.getInt8(0))&&void 0!==h?h:0)>0)})(e,i,a,n,t)&&z.T.chance(1-s.py)&&r.push(new f.Pa4(i,a,n))}return r}function W(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=P.clone().multiplyScalar(4/t),r=[];for(let s of(0,d.loop3)(i)){let i=s.x*t,a=s.y*t,n=s.z*t;(function(e,t,i,r){var s,a,n,o,l,h;let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return!(e.getVoxelState(t,i,r).getInt8(0)>0)&&(null!==(o=null===(s=e.tryGetVoxelState(t+d,i,r))||void 0===s?void 0:s.getInt8(0))&&void 0!==o?o:0)>0&&(null!==(l=null===(a=e.tryGetVoxelState(t,i-d,r))||void 0===a?void 0:a.getInt8(0))&&void 0!==l?l:0)>0&&(null!==(h=null===(n=e.tryGetVoxelState(t,i,r-d))||void 0===n?void 0:n.getInt8(0))&&void 0!==h?h:0)>0})(e,i,a,n,t)&&z.T.chance(1-s.py)&&r.push(new f.Pa4(i,a,n))}return r}let L=new f.Pa4;new f.Pa4;class X extends f.Kj0{createDots(){let e=new f.SPe(new f.cJO(.1,8),new F.P,4);for(let[t,i]of((0,M.cY)(e,this),S.entries()))e.setMatrixAt(t,(0,Y.$)({position:i})),e.setColorAt(t,(0,Y.E)("#ffffff"));return this.dots=e,this}updateDots(e){this.dots||this.createDots();let t=this.dots;for(let[i,r]of S.entries()){t.setMatrixAt(i,(0,Y.$)({position:r}));let s=e.isWithin(r)?"#00ffa6":"#ff0000";t.setColorAt(i,(0,Y.E)(s))}t.instanceMatrix.needsUpdate=!0,t.instanceColor.needsUpdate=!0}get gridCoords(){return this._gridCoords}setGridCoords(e){(0,N.iK)(e,this._gridCoords);let{x:t,y:i}=this._gridCoords;this.scale.setScalar(.5**i),function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.Pa4,r=.5**t;i.set(6*e*r,4*(.5*r*2-1),6*e*r+8*(1-r))}(t,i,this.position)}toWhite(){this.material.color.set(16777215)}toColor(){this.material.color.set(this.color)}constructor({world:e=null,color:t=16777215*z.T.random()}={}){let i=new V.z(Math.ceil(115.19999999999999),1);for(let{x:e,y:t}of(0,d.loop2)(6,4))D(e,t,L).multiplyScalar(4),G(i,L,4);for(let e=0;e<6;e+=2)D(e,3,L).add(new f.Pa4(1,0,0)).multiplyScalar(4),G(i,L,4),z.T.chance(.8)&&(D(e,3,L).add(new f.Pa4(1,1,0)).multiplyScalar(4),G(i,L,4));{let e=W(i,2),t=U(i,2);for(let t of e)G(i,t,2,1);for(let e of t)G(i,e,2,0)}{let e=W(i,1),t=U(i,1);for(let t of e)z.T.chance(.25)&&G(i,t,1,1);for(let e of t)z.T.chance(.25)&&G(i,e,1,0)}console.time("geometry");let r=new f.u9r;console.timeEnd("geometry"),r.scale(.25,.25,.25);let s=new F.P({color:t});super(function(){let e=new f.u9r;e.index=new f.TlE(new Uint16Array([0,2,1,0,3,2]),1);let t=new Float32Array(12),i=new f.Pa4(0,0,1);D(0,0).add(i).toArray(t,0),D(6,0).add(i).toArray(t,9),D(6,4).add(i).toArray(t,6),D(0,4).add(i).toArray(t,3),e.setAttribute("position",new f.TlE(t,3));let r=new Float32Array(12);k.toArray(r,0),E.toArray(r,3),k.toArray(r,6),E.toArray(r,9),e.setAttribute("normal",new f.TlE(new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]),3));let s=new Float32Array(12).fill(1);return e.setAttribute("color",new f.TlE(s,3)),e}(),new F.P({color:t,side:f.ehD})),this._gridCoords=new f.FM8,this.world=null,this.dots=null,(0,M.cY)(new f.Kj0(r,s),this),(0,M.cY)(new f.y8_,this),this.chunk=i,this.color=t,this.world=e}}function H(e,t){if(e<-32768||e>=32768||t<-32768||t>=32768)throw RangeError("x and y must be in the range -0x8000 to 0x7fff, received: ".concat(e," (0x").concat(e.toString(16),"), ").concat(t," (0x").concat(t.toString(16),")"));return(e+=32768)<<16|(t+=32768)}let B=new f.FM8;function*Z(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let[r,s]=(()=>{if(1!==t.length)return t;{let{x:e,y:i}=(0,C.iK)(t[0]);return[e,i]}})();yield B.set(Math.floor((r-1)/2),s-1),yield B.set(Math.floor((r+1)/2),s-1),yield B.set(r-1,s),yield B.set(r+1,s),yield B.set(2*r-1,s+1),yield B.set(2*r,s+1),yield B.set(2*r+1,s+1),yield B.set(2*r+2,s+1)}class K extends f.ZAu{drawCircles(){let{count:e=1,step:t=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(let i=1;i<e;i++){let e=1+i*t;(0,M.cY)(new f.ejS(this.parts.circles.geometry,this.parts.circles.material),{parent:this,scaleScalar:e})}return this}constructor(...e){super(...e),this.parts=(()=>{let e=new y.O;e.circle({radius:1,color:I.w.defaultOptions.zColor}).circle({radius:1,color:I.w.defaultOptions.xColor,transform:{rotationY:"90deg"}}).circle({radius:1,color:I.w.defaultOptions.yColor,transform:{rotationX:"90deg"}}).draw();let t=new f.Kj0(new I.w,new F.P({vertexColors:!0}));return{axes:(0,M.cY)(t,this),circles:(0,M.cY)(e,this)}})()}}class Q extends f.ZAu{static current(){if(0===this.instances.length)throw Error("No World!");return this.instances[this.instances.length-1]}scopeUpdate(e){let t=(0,u.M3)(1e-4,e);this.dampedScopeCoordinates.lerp(this.scopeCoordinates,t);let{x:i,y:r}=this.dampedScopeCoordinates;this.scope.position.set(0,0,6).addScaledVector(b,i),this.worldScale=2**(.33*r),this.setChunkGroupScale(this.worldScale)}getChunk(e,t){var i;return null!==(i=this.chunks.get(H(e,t)))&&void 0!==i?i:null}ensureChunk(e,t){let i=H(e,t),r=this.chunks.get(i);if(r)return r;{let i=(0,M.cY)(new X({world:this}),this.chunkGroup);return this.chunks.set(H(e,t),i),i.setGridCoords([e,t]),i}}ensureChunkNeighbors(e,t){for(let i of(this.ensureChunk(e,t),Z(e,t)))this.ensureChunk(i.x,i.y)}ensureScopeChunks(){let e=new Set([H(0,0)]),t=[this.ensureChunk(0,0)],i=0;for(;t.length>0;){if(i++>100){console.error("Exceeded maximum chunk count of ".concat(100));break}let r=t.pop();if(this.scope.chunkIntersects(r))for(let i of Z(r.gridCoords)){let r=H(i.x,i.y);e.has(r)||(e.add(r),t.push(this.ensureChunk(i.x,i.y)))}}}toWhite(){for(let e of this.chunks.values())e.toWhite()}toColor(){for(let e of this.chunks.values())e.toColor()}constructor(){super(),this.origin=(0,M.cY)(new f.y8_,{parent:this,position:T,rotation:O}),this.chunkGroup=(0,M.cY)(new f.ZAu,{parent:this}),this.scopeCoordinates=new f.FM8,this.dampedScopeCoordinates=new f.FM8,this.worldScale=1,this.scopeOriginPoint=new f.Pa4,this.scopeCenterChunkPoint=new f.Pa4,this.scope=(0,M.cY)(new j,this),this.XXX=(0,M.cY)(new K,this.chunkGroup),this.YYY=new f.FM8,this.setChunkGroupScale=(()=>{let e=new f.yGw;return t=>{var i;this.scopeCenterChunkPoint.copy(this.scope.position).applyMatrix4(R),this.scopeOriginPoint.set(this.scopeCenterChunkPoint.x,0,0).applyMatrix4(A),this.chunkGroup.position.copy(this.scopeOriginPoint).addScaledVector(this.scopeOriginPoint,-t),this.chunkGroup.scale.setScalar(t),this.chunkGroup.updateMatrix(),this.XXX.position.copy(this.scope.position).applyMatrix4(R),this.XXX.position.z=0,this.XXX.position.applyMatrix4(A).applyMatrix4(e.copy(this.chunkGroup.matrix).invert());let{x:r,y:s}=function(){let e;for(var t,i,r=arguments.length,s=Array(r),a=0;a<r;a++)s[a]=arguments[a];let n=0,o=0;if("number"==typeof s[0])[n,o]=s,e=null!==(t=s[3])&&void 0!==t?t:new f.FM8;else{let[t]=s;n=t.x,o=t.y,e=null!==(i=s[1])&&void 0!==i?i:new f.FM8}let l=-Math.log2((o/4+1)/2)-1,h=n/(6*.5**l);return e.set(h,l)}(this.XXX.position,this.YYY);r=Math.round(r-.5),s=Math.round(s+.5),this.toWhite(),null===(i=this.getChunk(r,s))||void 0===i||i.toColor()}})(),this.chunks=new Map,this.destroy=()=>{this.scope.destroy(),this.chunks.clear(),this.clear();let e=Q.instances.indexOf(this);if(-1===e)throw Error("World instance not found");Q.instances.splice(e,1)},Q.instances.push(this)}}Q.instances=[],(r=s||(s={}))[r.Free=0]="Free",r[r.Scope=1]="Scope";class q{initialize(e){return this.element=e,this}*doStart(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null!==(a=this.element)&&void 0!==a?a:document.body;yield(0,m.w)(e,{onDrag:e=>{let t=Q.current();t.scopeCoordinates.x+=-(.005*e.delta.x)/t.worldScale,t.scopeCoordinates.y+=-(.01*e.delta.y)}}),yield(0,v.RC)("three",e=>{let t=Q.current();t.scopeUpdate(e.deltaTime);let i=t.scope.position;this.vertigoControls.vertigo.set({focus:i}),this.vertigoControls.dampedVertigo.set({focus:i})})}start(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this._started||(this._destroyables.collect(this.doStart(...t)),this._started=!0)}stop(){this._started&&(this._destroyables.destroy(),this._started=!1)}toggle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this._started;e?this.start():this.stop()}update(e,t,i){this.vertigoControls.update(e,t,i)}constructor(){this.position=new f.FM8,this.dampedPosition=new f.FM8,this.scale=1,this._destroyables=new w.N,this.vertigoControls=new g.F({perspective:.5}),this._started=!1,this.destroy=()=>{this._destroyables.destroy()}}}class J{get mode(){return this._mode}set mode(e){this.setMode(e)}initialize(e,t){this.camera=e,this.freeVertigoControls.initialize(t).toggle(0===this._mode),this.scopeCameraHandler.initialize(t).toggle(1===this._mode);let i=j.current().toVertigoProps();return this.scopeCameraHandler.vertigoControls.vertigo.set(i),this.scopeCameraHandler.vertigoControls.dampedVertigo.set(i),this}setMode(e){if(e%=2,this._mode!==e)switch(this._mode=e,this.freeVertigoControls.toggle(0===e),this.scopeCameraHandler.toggle(1===e),e){case 0:(()=>{this.mode=J.Mode.Free,this.freeVertigoControls.dampedVertigo.copy(this.scopeCameraHandler.vertigoControls.dampedVertigo)})();break;case 1:(()=>{this.mode=J.Mode.Scope,this.scopeCameraHandler.vertigoControls.dampedVertigo.copy(this.freeVertigoControls.dampedVertigo),this.scopeCameraHandler.vertigoControls.vertigo.set(j.current().toVertigoProps())})()}}onTick(e,t){switch(this._mode){case 0:this.freeVertigoControls.update(this.camera,t,e.deltaTime),console.log();break;case 1:this.scopeCameraHandler.update(this.camera,t,e.deltaTime)}}constructor(){this._mode=0,this.freeVertigoControls=new g.F({size:24,perspective:1}),this.scopeCameraHandler=new q,this.destroy=()=>{this.freeVertigoControls.destroy(),this.scopeCameraHandler.destroy();let e=J.instances.indexOf(this);if(-1===e)throw Error("CameraHandler instance not found");J.instances.splice(e,1)},J.instances.push(this)}}J.Mode=s,J.instances=[];var $=i(67896);function ee(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.Ltg,r=2**t,s=2*(1-1/r),a=1/r;return i.x=6*e*a,i.y=-4*s,i.z=4*s+6*e*a,i.w=a,i}class et extends f.ZAu{updatePointer(e){let t=e.intersectPlane(_,new f.Pa4);if(!t)return;let{text:i,pointerText:r}=this.internal,s=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.FM8;return i.y=Math.floor(-Math.log2(1- -t/4/2)),i.x=Math.floor(e/6*2**i.y),i}(t.x,t.y);if(Number.isNaN(s.x)||Number.isNaN(s.y))return;let a=1/2**function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.FM8,r=1- -t/4/2;return i.y=-Math.log2(r),i.x=e/(6*r),i}(t.x,t.y,new f.FM8).y;for(let e of this.internal.positions){let t=e.x===s.x&&e.y===s.y?"#ffff66":"white";i.data.setColorAt(e.i+1,{backgroundColor:t})}i.dataTexture.needsUpdate=!0,i.material.needsUpdate=!0,r.setTextAt(0,"".concat(s.x,",").concat(s.y),{textColor:"#ffff66",textOpacity:0,backgroundColor:"#ffff66",backgroundOpacity:1,position:t,size:3*a});let n=ee(s.x,s.y);this.internal.pointerLine.clear().line(t,[n.x,n.y,n.z],{color:"#ffff66"}).draw()}constructor(...e){super(...e),this.internal=(()=>{let e=[new f.Pa4(0,0,0),new f.Pa4(0,-4,4),new f.Pa4(6,-4,10),new f.Pa4(6,0,6)],t=(0,M.cY)(new y.O,this);for(let i=0;i<12;i++){let r=2**i,s=2*(1-1/r),a=1/r,n=new f.Pa4(0,-4*s,4*s);t.polygon(e.map(e=>e.clone().multiplyScalar(a).add(n)))}t.polyline([[0,0,0],T]),t.draw(),(0,M.cY)(new f.Kj0(new I.w,new F.P({vertexColors:!0})),{parent:this,position:T,rotation:O});let i=(0,d.loop2Array)(4,8),r=(0,M.cY)(new h.m({lineCount:1,lineLength:14}),this),s=(0,M.cY)(new y.O,this);for(let e of i){let{x:t,y:i,z:s,w:a}=ee(e.x,e.y);r.setTextAt(e.i+1,"".concat(e.x,",").concat(e.y),{textColor:"white",textOpacity:0,backgroundColor:"white",backgroundOpacity:1,position:[t,i,s],size:2*a})}return{positions:i,text:r,pointerText:(0,M.cY)(new h.m({lineCount:2,lineLength:16}),this),pointerLine:s}})()}}var ei=i(87200),er=i(23657);i(41737);let es=(0,ei.createContext)(null);function ea(e,t){let i=(0,ei.useContext)(es);return(0,er.sv)(async function*(t,r){if(e){let t=e(i,r);if(t&&"function"==typeof t.next)do{let{value:e,done:i}=await t.next();if(i)break;yield e}while(r.mounted)}},null!=t?t:"always"),i}let en={className:"",assetsPath:"/"};function eo(e){let{children:t,className:i,assetsPath:r}={...en,...e},s=(0,ei.useMemo)(()=>new l.Vu,[]);s.loader.setPath(r);let{ref:a}=(0,er.Nv)({debounce:!0},function*(e,t){yield s.initialize(e.firstElementChild),t.triggerRender(),Object.assign(window,{three:s})},[]);return(0,n.jsx)("div",{ref:a,className:i,style:{position:"absolute",inset:0},children:(0,n.jsxs)(es.Provider,{value:s,children:[(0,n.jsx)("div",{style:{position:"absolute",inset:"0"}}),(0,n.jsx)("div",{style:{position:"absolute",inset:"0"},className:"thru",children:s.initialized&&t})]})})}function el(e){return function(){let[e,t]=(0,ei.useState)(!1);return(0,ei.useLayoutEffect)(()=>{t(!0)},[]),e}()&&(0,n.jsx)(eo,{...e})}function eh(){return!function(e,t,i){let r=(0,ei.useMemo)(()=>new f.ZAu,[]);r.name=e,ea(async function*(e,i){if(e.scene.add(r),yield()=>{r.clear(),r.removeFromParent()},t){let s=t(r,e,i);if(s&&"function"==typeof s.next)do{let{value:e,done:t}=await s.next();if(t)break;yield e}while(i.mounted)}},i)}("fractal-grid",function*(e,t){var i;(0,M.cY)(new $.w({color:"#110512"}),e);let r=(0,M.cY)(new et,e);(0,M.cY)(new f.Kj0(new f.FE5(2.5,.025,512,32),new F.P({color:"#0cf"})),e).visible=!1,z.T.seed(98763);let s=(0,M.cY)(new Q,e);yield s.destroy,s.visible=!1,s.scope.updateScope({aspect:t.aspect}),s.ensureScopeChunks();let a=new J().initialize(t.camera,t.renderer.domElement),n=new f.Pa4,o=(0,M.cY)(new f.Kj0(new f.cJO(.1),new F.P({color:"#f0f"})),e);yield(0,v.RC)("three",e=>{a.onTick(e,t.aspect),s.scope.updateScope({aspect:t.aspect}),t.pointer.ray.intersectPlane(_,n),o.position.copy(n),r.updatePointer(t.pointer.ray)}),s.toColor(),null===(i=s.getChunk(0,0))||void 0===i||i.toWhite(),Object.assign(window,{world:s,cameraHandler:a}),(0,M.cY)(new f.Kj0(new I.w,new F.P({vertexColors:!0})),e)},[]),null}function ed(){return ea(function*(e){let t=new o.n(e.scene,e.camera);t.updatePdMaterial({lumaPhi:10,depthPhi:2,normalPhi:3,radius:2,radiusExponent:2,rings:2,samples:24}),yield e.pipeline.addPass(t,{type:l.GR.PostProcessing}),(0,p.a)({three:e,...d,TextHelper:h.m,calculateExponentialDecayLerpRatio:u.M3,calculateExponentialDecayLerpRatio2:u.zl,lerp:c.t7})},[]),null}function ec(){return(0,n.jsx)("div",{className:"FractalGrid",children:(0,n.jsxs)(el,{children:[(0,n.jsxs)("div",{className:"layer thru flex flex-col p-4 gap-2 items-start",children:[(0,n.jsx)("h1",{className:"text-2xl",children:"FractalGrid"}),(0,n.jsx)("button",{className:"border border-white px-2 py-1 rounded",onClick:()=>J.instances[0].mode++,children:"Switch camera"})]}),(0,n.jsx)(ed,{}),(0,n.jsx)(eh,{})]})})}},60236:function(e,t,i){"use strict";i.d(t,{w:function(){return h}});var r=i(88780),s=i(27834);let a={axis:"x",length:1,radialSegments:12,radius:.01,coneRatio:.1,radiusScale:1,vertexColor:!0,baseCap:"flat",color:"white"},n=new r.Ilk;function o(e){let{axis:t,length:i,radius:o,radialSegments:l,coneRatio:h,radiusScale:d,vertexColor:c,baseCap:u,color:p}={...a,...e},f=o*d,m=i*h,g=new r.b_z(3*f,m,l),w=new r.fHI(f,f,1,l,1,!0),v=i-m,x=i-.5*m;g.rotateZ(-Math.PI/2).translate(x,0,0),w.scale(1,v,1).rotateZ(-Math.PI/2).translate(.5*v,0,0);let y="none"===u?new r.u9r:"flat"===u?new r.zf8(f,l).rotateY(-Math.PI/2):new r.xo$(f,l,3,0,2*Math.PI,0,.5*Math.PI).rotateZ(Math.PI/2).rotateX(Math.PI/2),M=(0,s.n4)([g,w,y]);switch(t){case"y":M.rotateZ(Math.PI/2);break;case"z":M.rotateY(-Math.PI/2)}if(c){let e=M.attributes.position.count,t=new r.TlE(new Float32Array(3*e),3);M.setAttribute("color",t),n.set(p);for(let i=0;i<e;i++)t.setXYZ(i,n.r,n.g,n.b)}return M}let l={xColor:"#ff3333",yColor:"#33cc66",zColor:"#3366ff"};class h extends r.u9r{static get defaultOptions(){return{...l}}constructor(e){super();let{xColor:t,yColor:i,zColor:r,...a}={...l,...e},n=o({...a,axis:"x",color:t}),h=o({...a,axis:"y",color:i}),d=o({...a,axis:"z",color:r}),c=(0,s.n4)([n,h,d]);this.copy(c),c.dispose()}}},77478:function(e,t,i){"use strict";function r(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}i.d(t,{_:function(){return r}})},74259:function(e,t,i){"use strict";i.d(t,{n:function(){return h}});var r=i(37186),s=i(6549),a=i(17557),n=i(50897),o=i(10313),l=i(69315);class h extends s.w{constructor(e,t,i,l,h,d,c){super(),this.width=void 0!==i?i:512,this.height=void 0!==l?l:512,this.clear=!0,this.camera=t,this.scene=e,this.output=0,this._renderGBuffer=!0,this._visibilityCache=new Map,this.blendIntensity=1,this.pdRings=2,this.pdRadiusExponent=2,this.pdSamples=16,this.gtaoNoiseTexture=(0,a.mK)(),this.pdNoiseTexture=this.generateNoise(),this.gtaoRenderTarget=new r.dd2(this.width,this.height,{type:r.cLu}),this.pdRenderTarget=this.gtaoRenderTarget.clone(),this.gtaoMaterial=new r.jyz({defines:Object.assign({},a.Sp.defines),uniforms:r.rDY.clone(a.Sp.uniforms),vertexShader:a.Sp.vertexShader,fragmentShader:a.Sp.fragmentShader,blending:r.jFi,depthTest:!1,depthWrite:!1}),this.gtaoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.gtaoMaterial.uniforms.tNoise.value=this.gtaoNoiseTexture,this.gtaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.normalMaterial=new r.RSm,this.normalMaterial.blending=r.jFi,this.pdMaterial=new r.jyz({defines:Object.assign({},n.m.defines),uniforms:r.rDY.clone(n.m.uniforms),vertexShader:n.m.vertexShader,fragmentShader:n.m.fragmentShader,depthTest:!1,depthWrite:!1}),this.pdMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.pdMaterial.uniforms.tNoise.value=this.pdNoiseTexture,this.pdMaterial.uniforms.resolution.value.set(this.width,this.height),this.pdMaterial.uniforms.lumaPhi.value=10,this.pdMaterial.uniforms.depthPhi.value=2,this.pdMaterial.uniforms.normalPhi.value=3,this.pdMaterial.uniforms.radius.value=8,this.depthRenderMaterial=new r.jyz({defines:Object.assign({},a.gs.defines),uniforms:r.rDY.clone(a.gs.uniforms),vertexShader:a.gs.vertexShader,fragmentShader:a.gs.fragmentShader,blending:r.jFi}),this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new r.jyz({uniforms:r.rDY.clone(o.C.uniforms),vertexShader:o.C.vertexShader,fragmentShader:o.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:r.Vdb,blendDst:r.c8b,blendEquation:r.bGH,blendSrcAlpha:r.fSK,blendDstAlpha:r.c8b,blendEquationAlpha:r.bGH}),this.blendMaterial=new r.jyz({uniforms:r.rDY.clone(a.mF.uniforms),vertexShader:a.mF.vertexShader,fragmentShader:a.mF.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:r.Xaj,blendSrc:r.Vdb,blendDst:r.c8b,blendEquation:r.bGH,blendSrcAlpha:r.fSK,blendDstAlpha:r.c8b,blendEquationAlpha:r.bGH}),this.fsQuad=new s.T(null),this.originalClearColor=new r.Ilk,this.setGBuffer(h?h.depthTexture:void 0,h?h.normalTexture:void 0),void 0!==d&&this.updateGtaoMaterial(d),void 0!==c&&this.updatePdMaterial(c)}dispose(){this.gtaoNoiseTexture.dispose(),this.pdNoiseTexture.dispose(),this.normalRenderTarget.dispose(),this.gtaoRenderTarget.dispose(),this.pdRenderTarget.dispose(),this.normalMaterial.dispose(),this.pdMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}get gtaoMap(){return this.pdRenderTarget.texture}setGBuffer(e,t){void 0!==e?(this.depthTexture=e,this.normalTexture=t,this._renderGBuffer=!1):(this.depthTexture=new r.$YQ,this.depthTexture.format=r.brP,this.depthTexture.type=r.wJv,this.normalRenderTarget=new r.dd2(this.width,this.height,{minFilter:r.TyD,magFilter:r.TyD,type:r.cLu,depthTexture:this.depthTexture}),this.normalTexture=this.normalRenderTarget.texture,this._renderGBuffer=!0);let i=this.normalTexture?1:0,s=this.depthTexture===this.normalTexture?"w":"x";this.gtaoMaterial.defines.NORMAL_VECTOR_TYPE=i,this.gtaoMaterial.defines.DEPTH_SWIZZLING=s,this.gtaoMaterial.uniforms.tNormal.value=this.normalTexture,this.gtaoMaterial.uniforms.tDepth.value=this.depthTexture,this.pdMaterial.defines.NORMAL_VECTOR_TYPE=i,this.pdMaterial.defines.DEPTH_SWIZZLING=s,this.pdMaterial.uniforms.tNormal.value=this.normalTexture,this.pdMaterial.uniforms.tDepth.value=this.depthTexture,this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture}setSceneClipBox(e){e?(this.gtaoMaterial.needsUpdate=1!==this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=1,this.gtaoMaterial.uniforms.sceneBoxMin.value.copy(e.min),this.gtaoMaterial.uniforms.sceneBoxMax.value.copy(e.max)):(this.gtaoMaterial.needsUpdate=0===this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=0)}updateGtaoMaterial(e){void 0!==e.radius&&(this.gtaoMaterial.uniforms.radius.value=e.radius),void 0!==e.distanceExponent&&(this.gtaoMaterial.uniforms.distanceExponent.value=e.distanceExponent),void 0!==e.thickness&&(this.gtaoMaterial.uniforms.thickness.value=e.thickness),void 0!==e.distanceFallOff&&(this.gtaoMaterial.uniforms.distanceFallOff.value=e.distanceFallOff,this.gtaoMaterial.needsUpdate=!0),void 0!==e.scale&&(this.gtaoMaterial.uniforms.scale.value=e.scale),void 0!==e.samples&&e.samples!==this.gtaoMaterial.defines.SAMPLES&&(this.gtaoMaterial.defines.SAMPLES=e.samples,this.gtaoMaterial.needsUpdate=!0),void 0!==e.screenSpaceRadius&&(e.screenSpaceRadius?1:0)!==this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS&&(this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS=e.screenSpaceRadius?1:0,this.gtaoMaterial.needsUpdate=!0)}updatePdMaterial(e){let t=!1;void 0!==e.lumaPhi&&(this.pdMaterial.uniforms.lumaPhi.value=e.lumaPhi),void 0!==e.depthPhi&&(this.pdMaterial.uniforms.depthPhi.value=e.depthPhi),void 0!==e.normalPhi&&(this.pdMaterial.uniforms.normalPhi.value=e.normalPhi),void 0!==e.radius&&e.radius!==this.radius&&(this.pdMaterial.uniforms.radius.value=e.radius),void 0!==e.radiusExponent&&e.radiusExponent!==this.pdRadiusExponent&&(this.pdRadiusExponent=e.radiusExponent,t=!0),void 0!==e.rings&&e.rings!==this.pdRings&&(this.pdRings=e.rings,t=!0),void 0!==e.samples&&e.samples!==this.pdSamples&&(this.pdSamples=e.samples,t=!0),t&&(this.pdMaterial.defines.SAMPLES=this.pdSamples,this.pdMaterial.defines.SAMPLE_VECTORS=(0,n.a)(this.pdSamples,this.pdRings,this.pdRadiusExponent),this.pdMaterial.needsUpdate=!0)}render(e,t,i){switch(this._renderGBuffer&&(this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.gtaoMaterial.uniforms.cameraWorldMatrix.value.copy(this.camera.matrixWorld),this.renderPass(e,this.gtaoMaterial,this.gtaoRenderTarget,16777215,1),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.renderPass(e,this.pdMaterial,this.pdRenderTarget,16777215,1),this.output){case h.OUTPUT.Off:break;case h.OUTPUT.Diffuse:this.copyMaterial.uniforms.tDiffuse.value=i.texture,this.copyMaterial.blending=r.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.AO:this.copyMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.copyMaterial.blending=r.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Denoise:this.copyMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.copyMaterial.blending=r.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Depth:this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=r.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=i.texture,this.copyMaterial.blending=r.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blendMaterial.uniforms.intensity.value=this.blendIntensity,this.blendMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.renderPass(e,this.blendMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.GTAOPass: Unknown output type.")}}renderPass(e,t,i,r,s){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),n=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,null!=r&&(e.setClearColor(r),e.setClearAlpha(s||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=n,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderOverride(e,t,i,r,s){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),n=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,r=t.clearColor||r,s=t.clearAlpha||s,null!=r&&(e.setClearColor(r),e.setClearAlpha(s||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=n,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}setSize(e,t){this.width=e,this.height=t,this.gtaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.pdRenderTarget.setSize(e,t),this.gtaoMaterial.uniforms.resolution.value.set(e,t),this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.pdMaterial.uniforms.resolution.value.set(e,t),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse)}overrideVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){let i=t.get(e);e.visible=i}),t.clear()}generateNoise(e=64){let t=new l.L,i=new Uint8Array(e*e*4);for(let r=0;r<e;r++)for(let s=0;s<e;s++){let a=r,n=s;i[(r*e+s)*4]=(.5*t.noise(a,n)+.5)*255,i[(r*e+s)*4+1]=(.5*t.noise(a+e,n)+.5)*255,i[(r*e+s)*4+2]=(.5*t.noise(a,n+e)+.5)*255,i[(r*e+s)*4+3]=(.5*t.noise(a+e,n+e)+.5)*255}let s=new r.IEO(i,e,e,r.wk1,r.ywz);return s.wrapS=r.rpg,s.wrapT=r.rpg,s.needsUpdate=!0,s}}h.OUTPUT={Off:-1,Default:0,Diffuse:1,Depth:2,Normal:3,AO:4,Denoise:5}}},function(e){e.O(0,[411,7512,9829,5406,4465,812,3420,1540,167,4157,9258,5721,1174,2835,2544,5694,2840,1744],function(){return e(e.s=80475)}),_N_E=e.O()}]);
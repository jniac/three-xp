(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4978],{80475:function(e,t,r){Promise.resolve().then(r.bind(r,84501))},84501:function(e,t,r){"use strict";r.d(t,{Main:function(){return ec}});var i,s,a,o=r(32617),n=r(87062),l=r(9258),h=r(42544),d=r(28104),c=r(47090),u=r(2132),p=r(92948),f=r(88780),m=r(81540),g=r(15721),x=r(35357),w=r(29368),v=r(44044),y=r(97219),M=r(78780),C=r(20821);let S=new f.Vector3(6,4,9),T=[new f.Vector3(0,0,4),new f.Vector3(0,4,0),new f.Vector3(6,0,9),new f.Vector3(6,4,6)],P=new f.Vector3(0,-8,8),b=new f.Vector3(1,0,1).normalize(),V=new f.Vector3(0,1,-1).normalize(),A=new f.Vector3().crossVectors(b,V).normalize();V.crossVectors(A,b).normalize();let E=new f.Matrix4().makeBasis(b,V,A).setPosition(P),R=new f.Matrix4().copy(E).invert(),k=new f.Euler().setFromRotationMatrix(E),N=new f.Plane().setFromNormalAndCoplanarPoint(A,P);class O extends f.Group{static current(){if(0===this.instances.length)throw Error("No Scope!");return this.instances[this.instances.length-1]}updateScope(){let{aspect:e=1,size:t=4}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e>1?t:t*e,i=r/e;(r!==this.state.width||i!==this.state.height)&&(this.parts.lines.clear().circle({radius:1}).rectangle([-r/2,-i/2,r,i]).plus([0,0],.2).draw(),this.parts.lines.geometry.computeBoundingSphere(),this.state.width=r,this.state.height=i)}isWithin(e){let{x:t,y:r}=e.clone().applyMatrix4(this.matrixWorldInverse),{width:i,height:s}=this.state;return t>=-i/2&&t<=i/2&&r>=-s/2&&r<=s/2}chunkIntersects(e){this.updateMatrixWorld(),e.updateMatrixWorld();let t=!0,r=!0,i=!0,s=!0,a=this.state.width/2,o=this.state.height/2;for(let n=0;n<4;n++){let{x:l,y:h,z:d}=O._chunkIntersectsVectors[n].copy(T[n]).applyMatrix4(e.matrixWorld).applyMatrix4(this.matrixWorldInverse);if(t&&(t=l<-a),i&&(i=l>a),r&&(r=h<-o),s&&(s=h>o),!1===(t||r||i||s))return!0}return!1}toVertigoProps(){let{width:e,height:t}=this.state;return{perspective:.5,size:[e,t],focus:this.position,rotation:this.rotation}}constructor(){super(),this.parts={lines:(0,M.cY)(new y.O,this),debugLines:(0,M.cY)(new y.O,this)},this.state={width:4,height:4},this.matrixWorldInverse=new f.Matrix4,this.destroy=()=>{let e=O.instances.indexOf(this);if(-1===e)throw Error("Scope instance not found");O.instances.splice(e,1)},O.instances.push(this),this.position.set(0,0,6),this.rotation.setFromRotationMatrix(E,v.a.default.rotation.order),this.rotation.x+=(0,C.FE)("20deg"),this.updateMatrix(),this.updateMatrixWorld(),this.matrixWorldInverse.copy(this.matrixWorld).invert()}}O.instances=[],O._chunkIntersectsVectors=[new f.Vector3,new f.Vector3,new f.Vector3,new f.Vector3];var _=r(60236),G=r(12042),I=r(32219),U=r(80536),F=r(85705),D=r(6246);function Y(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.Vector3;return r.set(e,t,e-t)}function B(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,{x:s,y:a,z:o}=t,n=s+r,l=a+r,h=o+r;for(let t=o;t<h;t++)for(let r=a;r<l;r++)for(let a=s;a<n;a++)e.getVoxelState(a,r,t+16).setInt8(0,i)}function z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=S.clone().multiplyScalar(4/t),i=[];for(let s of(0,d.loop3)(r)){let r=s.x*t,a=s.y*t,o=s.z*t;(function(e,t,r,i){var s,a,o,n,l,h;let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return e.getVoxelState(t,r,i).getInt8(0)>0&&!((null!==(n=null===(s=e.tryGetVoxelState(t-d,r,i))||void 0===s?void 0:s.getInt8(0))&&void 0!==n?n:0)>0)&&!((null!==(l=null===(a=e.tryGetVoxelState(t,r+d,i))||void 0===a?void 0:a.getInt8(0))&&void 0!==l?l:0)>0)&&!((null!==(h=null===(o=e.tryGetVoxelState(t,r,i+d))||void 0===o?void 0:o.getInt8(0))&&void 0!==h?h:0)>0)})(e,r,a,o,t)&&D.T.chance(1-s.py)&&i.push(new f.Vector3(r,a,o))}return i}function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=S.clone().multiplyScalar(4/t),i=[];for(let s of(0,d.loop3)(r)){let r=s.x*t,a=s.y*t,o=s.z*t;(function(e,t,r,i){var s,a,o,n,l,h;let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return!(e.getVoxelState(t,r,i).getInt8(0)>0)&&(null!==(n=null===(s=e.tryGetVoxelState(t+d,r,i))||void 0===s?void 0:s.getInt8(0))&&void 0!==n?n:0)>0&&(null!==(l=null===(a=e.tryGetVoxelState(t,r-d,i))||void 0===a?void 0:a.getInt8(0))&&void 0!==l?l:0)>0&&(null!==(h=null===(o=e.tryGetVoxelState(t,r,i-d))||void 0===o?void 0:o.getInt8(0))&&void 0!==h?h:0)>0})(e,r,a,o,t)&&D.T.chance(1-s.py)&&i.push(new f.Vector3(r,a,o))}return i}let W=new f.Vector3;new f.Vector3;class L extends f.Mesh{createDots(){let e=new f.InstancedMesh(new f.IcosahedronGeometry(.1,8),new G.P,4);for(let[t,r]of((0,M.cY)(e,this),T.entries()))e.setMatrixAt(t,(0,F.$)({position:r})),e.setColorAt(t,(0,F.E)("#ffffff"));return this.dots=e,this}updateDots(e){this.dots||this.createDots();let t=this.dots;for(let[r,i]of T.entries()){t.setMatrixAt(r,(0,F.$)({position:i}));let s=e.isWithin(i)?"#00ffa6":"#ff0000";t.setColorAt(r,(0,F.E)(s))}t.instanceMatrix.needsUpdate=!0,t.instanceColor.needsUpdate=!0}get gridCoords(){return this._gridCoords}setGridCoords(e){(0,I.iK)(e,this._gridCoords);let{x:t,y:r}=this._gridCoords;this.scale.setScalar(.5**r),function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.Vector3,i=.5**t;r.set(6*e*i,4*(.5*i*2-1),6*e*i+8*(1-i))}(t,r,this.position)}toWhite(){this.material.color.set(16777215)}toColor(){this.material.color.set(this.color)}constructor({world:e=null,color:t=16777215*D.T.random()}={}){let r=new U.z(Math.ceil(115.19999999999999),1);for(let{x:e,y:t}of(0,d.loop2)(6,4))Y(e,t,W).multiplyScalar(4),B(r,W,4);for(let e=0;e<6;e+=2)Y(e,3,W).add(new f.Vector3(1,0,0)).multiplyScalar(4),B(r,W,4),D.T.chance(.8)&&(Y(e,3,W).add(new f.Vector3(1,1,0)).multiplyScalar(4),B(r,W,4));{let e=j(r,2),t=z(r,2);for(let t of e)B(r,t,2,1);for(let e of t)B(r,e,2,0)}{let e=j(r,1),t=z(r,1);for(let t of e)D.T.chance(.25)&&B(r,t,1,1);for(let e of t)D.T.chance(.25)&&B(r,e,1,0)}console.time("geometry");let i=new f.BufferGeometry;console.timeEnd("geometry"),i.scale(.25,.25,.25);let s=new G.P({color:t});super(function(){let e=new f.BufferGeometry;e.index=new f.BufferAttribute(new Uint16Array([0,2,1,0,3,2]),1);let t=new Float32Array(12),r=new f.Vector3(0,0,1);Y(0,0).add(r).toArray(t,0),Y(6,0).add(r).toArray(t,9),Y(6,4).add(r).toArray(t,6),Y(0,4).add(r).toArray(t,3),e.setAttribute("position",new f.BufferAttribute(t,3));let i=new Float32Array(12);A.toArray(i,0),V.toArray(i,3),A.toArray(i,6),V.toArray(i,9),e.setAttribute("normal",new f.BufferAttribute(new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]),3));let s=new Float32Array(12).fill(1);return e.setAttribute("color",new f.BufferAttribute(s,3)),e}(),new G.P({color:t,side:f.DoubleSide})),this._gridCoords=new f.Vector2,this.world=null,this.dots=null,(0,M.cY)(new f.Mesh(i,s),this),(0,M.cY)(new f.AxesHelper,this),this.chunk=r,this.color=t,this.world=e}}function X(e,t){if(e<-32768||e>=32768||t<-32768||t>=32768)throw RangeError("x and y must be in the range -0x8000 to 0x7fff, received: ".concat(e," (0x").concat(e.toString(16),"), ").concat(t," (0x").concat(t.toString(16),")"));return(e+=32768)<<16|(t+=32768)}let H=new f.Vector2;function*Z(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[i,s]=(()=>{if(1!==t.length)return t;{let{x:e,y:r}=(0,C.iK)(t[0]);return[e,r]}})();yield H.set(Math.floor((i-1)/2),s-1),yield H.set(Math.floor((i+1)/2),s-1),yield H.set(i-1,s),yield H.set(i+1,s),yield H.set(2*i-1,s+1),yield H.set(2*i,s+1),yield H.set(2*i+1,s+1),yield H.set(2*i+2,s+1)}class q extends f.Group{drawCircles(){let{count:e=1,step:t=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(let r=1;r<e;r++){let e=1+r*t;(0,M.cY)(new f.LineSegments(this.parts.circles.geometry,this.parts.circles.material),{parent:this,scaleScalar:e})}return this}constructor(...e){super(...e),this.parts=(()=>{let e=new y.O;e.circle({radius:1,color:_.w.defaultOptions.zColor}).circle({radius:1,color:_.w.defaultOptions.xColor,transform:{rotationY:"90deg"}}).circle({radius:1,color:_.w.defaultOptions.yColor,transform:{rotationX:"90deg"}}).draw();let t=new f.Mesh(new _.w,new G.P({vertexColors:!0}));return{axes:(0,M.cY)(t,this),circles:(0,M.cY)(e,this)}})()}}class K extends f.Group{static current(){if(0===this.instances.length)throw Error("No World!");return this.instances[this.instances.length-1]}scopeUpdate(e){let t=(0,u.M3)(1e-4,e);this.dampedScopeCoordinates.lerp(this.scopeCoordinates,t);let{x:r,y:i}=this.dampedScopeCoordinates;this.scope.position.set(0,0,6).addScaledVector(b,r),this.worldScale=2**(.33*i),this.setChunkGroupScale(this.worldScale)}getChunk(e,t){var r;return null!==(r=this.chunks.get(X(e,t)))&&void 0!==r?r:null}ensureChunk(e,t){let r=X(e,t),i=this.chunks.get(r);if(i)return i;{let r=(0,M.cY)(new L({world:this}),this.chunkGroup);return this.chunks.set(X(e,t),r),r.setGridCoords([e,t]),r}}ensureChunkNeighbors(e,t){for(let r of(this.ensureChunk(e,t),Z(e,t)))this.ensureChunk(r.x,r.y)}ensureScopeChunks(){let e=new Set([X(0,0)]),t=[this.ensureChunk(0,0)],r=0;for(;t.length>0;){if(r++>100){console.error("Exceeded maximum chunk count of ".concat(100));break}let i=t.pop();if(this.scope.chunkIntersects(i))for(let r of Z(i.gridCoords)){let i=X(r.x,r.y);e.has(i)||(e.add(i),t.push(this.ensureChunk(r.x,r.y)))}}}toWhite(){for(let e of this.chunks.values())e.toWhite()}toColor(){for(let e of this.chunks.values())e.toColor()}constructor(){super(),this.origin=(0,M.cY)(new f.AxesHelper,{parent:this,position:P,rotation:k}),this.chunkGroup=(0,M.cY)(new f.Group,{parent:this}),this.scopeCoordinates=new f.Vector2,this.dampedScopeCoordinates=new f.Vector2,this.worldScale=1,this.scopeOriginPoint=new f.Vector3,this.scopeCenterChunkPoint=new f.Vector3,this.scope=(0,M.cY)(new O,this),this.XXX=(0,M.cY)(new q,this.chunkGroup),this.YYY=new f.Vector2,this.setChunkGroupScale=(()=>{let e=new f.Matrix4;return t=>{var r;this.scopeCenterChunkPoint.copy(this.scope.position).applyMatrix4(R),this.scopeOriginPoint.set(this.scopeCenterChunkPoint.x,0,0).applyMatrix4(E),this.chunkGroup.position.copy(this.scopeOriginPoint).addScaledVector(this.scopeOriginPoint,-t),this.chunkGroup.scale.setScalar(t),this.chunkGroup.updateMatrix(),this.XXX.position.copy(this.scope.position).applyMatrix4(R),this.XXX.position.z=0,this.XXX.position.applyMatrix4(E).applyMatrix4(e.copy(this.chunkGroup.matrix).invert());let{x:i,y:s}=function(){let e;for(var t,r,i=arguments.length,s=Array(i),a=0;a<i;a++)s[a]=arguments[a];let o=0,n=0;if("number"==typeof s[0])[o,n]=s,e=null!==(t=s[3])&&void 0!==t?t:new f.Vector2;else{let[t]=s;o=t.x,n=t.y,e=null!==(r=s[1])&&void 0!==r?r:new f.Vector2}let l=-Math.log2((n/4+1)/2)-1,h=o/(6*.5**l);return e.set(h,l)}(this.XXX.position,this.YYY);i=Math.round(i-.5),s=Math.round(s+.5),this.toWhite(),null===(r=this.getChunk(i,s))||void 0===r||r.toColor()}})(),this.chunks=new Map,this.destroy=()=>{this.scope.destroy(),this.chunks.clear(),this.clear();let e=K.instances.indexOf(this);if(-1===e)throw Error("World instance not found");K.instances.splice(e,1)},K.instances.push(this)}}K.instances=[],(i=s||(s={}))[i.Free=0]="Free",i[i.Scope=1]="Scope";class Q{initialize(e){return this.element=e,this}*doStart(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null!==(a=this.element)&&void 0!==a?a:document.body;yield(0,m.w)(e,{onDrag:e=>{let t=K.current();t.scopeCoordinates.x+=-(.005*e.delta.x)/t.worldScale,t.scopeCoordinates.y+=-(.01*e.delta.y)}}),yield(0,w.RC)("three",e=>{let t=K.current();t.scopeUpdate(e.deltaTime);let r=t.scope.position;this.vertigoControls.vertigo.set({focus:r}),this.vertigoControls.dampedVertigo.set({focus:r})})}start(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this._started||(this._destroyables.collect(this.doStart(...t)),this._started=!0)}stop(){this._started&&(this._destroyables.destroy(),this._started=!1)}toggle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this._started;e?this.start():this.stop()}update(e,t,r){this.vertigoControls.update(e,t,r)}constructor(){this.position=new f.Vector2,this.dampedPosition=new f.Vector2,this.scale=1,this._destroyables=new x.N,this.vertigoControls=new g.F({perspective:.5}),this._started=!1,this.destroy=()=>{this._destroyables.destroy()}}}class ${get mode(){return this._mode}set mode(e){this.setMode(e)}initialize(e,t){this.camera=e,this.freeVertigoControls.initialize(t).toggle(0===this._mode),this.scopeCameraHandler.initialize(t).toggle(1===this._mode);let r=O.current().toVertigoProps();return this.scopeCameraHandler.vertigoControls.vertigo.set(r),this.scopeCameraHandler.vertigoControls.dampedVertigo.set(r),this}setMode(e){if(e%=2,this._mode!==e)switch(this._mode=e,this.freeVertigoControls.toggle(0===e),this.scopeCameraHandler.toggle(1===e),e){case 0:(()=>{this.mode=$.Mode.Free,this.freeVertigoControls.dampedVertigo.copy(this.scopeCameraHandler.vertigoControls.dampedVertigo)})();break;case 1:(()=>{this.mode=$.Mode.Scope,this.scopeCameraHandler.vertigoControls.dampedVertigo.copy(this.freeVertigoControls.dampedVertigo),this.scopeCameraHandler.vertigoControls.vertigo.set(O.current().toVertigoProps())})()}}onTick(e,t){switch(this._mode){case 0:this.freeVertigoControls.update(this.camera,t,e.deltaTime),console.log();break;case 1:this.scopeCameraHandler.update(this.camera,t,e.deltaTime)}}constructor(){this._mode=0,this.freeVertigoControls=new g.F({size:24,perspective:1}),this.scopeCameraHandler=new Q,this.destroy=()=>{this.freeVertigoControls.destroy(),this.scopeCameraHandler.destroy();let e=$.instances.indexOf(this);if(-1===e)throw Error("CameraHandler instance not found");$.instances.splice(e,1)},$.instances.push(this)}}$.Mode=s,$.instances=[];var J=r(67896);function ee(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.Vector4,i=2**t,s=2*(1-1/i),a=1/i;return r.x=6*e*a,r.y=-4*s,r.z=4*s+6*e*a,r.w=a,r}class et extends f.Group{updatePointer(e){let t=e.intersectPlane(N,new f.Vector3);if(!t)return;let{text:r,pointerText:i}=this.internal,s=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.Vector2;return r.y=Math.floor(-Math.log2(1- -t/4/2)),r.x=Math.floor(e/6*2**r.y),r}(t.x,t.y);if(Number.isNaN(s.x)||Number.isNaN(s.y))return;let a=1/2**function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.Vector2,i=1- -t/4/2;return r.y=-Math.log2(i),r.x=e/(6*i),r}(t.x,t.y,new f.Vector2).y;for(let e of this.internal.positions){let t=e.x===s.x&&e.y===s.y?"#ffff66":"white";r.data.setColorAt(e.i+1,{backgroundColor:t})}r.dataTexture.needsUpdate=!0,r.material.needsUpdate=!0,i.setTextAt(0,"".concat(s.x,",").concat(s.y),{textColor:"#ffff66",textOpacity:0,backgroundColor:"#ffff66",backgroundOpacity:1,position:t,size:3*a});let o=ee(s.x,s.y);this.internal.pointerLine.clear().line(t,[o.x,o.y,o.z],{color:"#ffff66"}).draw()}constructor(...e){super(...e),this.internal=(()=>{let e=[new f.Vector3(0,0,0),new f.Vector3(0,-4,4),new f.Vector3(6,-4,10),new f.Vector3(6,0,6)],t=(0,M.cY)(new y.O,this);for(let r=0;r<12;r++){let i=2**r,s=2*(1-1/i),a=1/i,o=new f.Vector3(0,-4*s,4*s);t.polygon(e.map(e=>e.clone().multiplyScalar(a).add(o)))}t.polyline([[0,0,0],P]),t.draw(),(0,M.cY)(new f.Mesh(new _.w,new G.P({vertexColors:!0})),{parent:this,position:P,rotation:k});let r=(0,d.loop2Array)(4,8),i=(0,M.cY)(new h.m({lineCount:1,lineLength:14}),this),s=(0,M.cY)(new y.O,this);for(let e of r){let{x:t,y:r,z:s,w:a}=ee(e.x,e.y);i.setTextAt(e.i+1,"".concat(e.x,",").concat(e.y),{textColor:"white",textOpacity:0,backgroundColor:"white",backgroundOpacity:1,position:[t,r,s],size:2*a})}return{positions:r,text:i,pointerText:(0,M.cY)(new h.m({lineCount:2,lineLength:16}),this),pointerLine:s}})()}}var er=r(87200),ei=r(23657);r(41737);let es=(0,er.createContext)(null);function ea(e,t){let r=(0,er.useContext)(es);return(0,ei.sv)(async function*(t,i){if(e){let t=e(r,i);if(t&&"function"==typeof t.next)do{let{value:e,done:r}=await t.next();if(r)break;yield e}while(i.mounted)}},null!=t?t:"always"),r}let eo={className:"",assetsPath:"/"};function en(e){let{children:t,className:r,assetsPath:i}={...eo,...e},s=(0,er.useMemo)(()=>new l.Vu,[]);s.loader.setPath(i);let{ref:a}=(0,ei.Nv)({debounce:!0},function*(e,t){yield s.initialize(e.firstElementChild),t.triggerRender(),Object.assign(window,{three:s})},[]);return(0,o.jsx)("div",{ref:a,className:r,style:{position:"absolute",inset:0},children:(0,o.jsxs)(es.Provider,{value:s,children:[(0,o.jsx)("div",{style:{position:"absolute",inset:"0"}}),(0,o.jsx)("div",{style:{position:"absolute",inset:"0"},className:"thru",children:s.initialized&&t})]})})}function el(e){return function(){let[e,t]=(0,er.useState)(!1);return(0,er.useLayoutEffect)(()=>{t(!0)},[]),e}()&&(0,o.jsx)(en,{...e})}function eh(){return!function(e,t,r){let i=(0,er.useMemo)(()=>new f.Group,[]);i.name=e,ea(async function*(e,r){if(e.scene.add(i),yield()=>{i.clear(),i.removeFromParent()},t){let s=t(i,e,r);if(s&&"function"==typeof s.next)do{let{value:e,done:t}=await s.next();if(t)break;yield e}while(r.mounted)}},r)}("fractal-grid",function*(e,t){var r;(0,M.cY)(new J.w({color:"#110512"}),e);let i=(0,M.cY)(new et,e);(0,M.cY)(new f.Mesh(new f.TorusKnotGeometry(2.5,.025,512,32),new G.P({color:"#0cf"})),e).visible=!1,D.T.seed(98763);let s=(0,M.cY)(new K,e);yield s.destroy,s.visible=!1,s.scope.updateScope({aspect:t.aspect}),s.ensureScopeChunks();let a=new $().initialize(t.camera,t.renderer.domElement),o=new f.Vector3,n=(0,M.cY)(new f.Mesh(new f.IcosahedronGeometry(.1),new G.P({color:"#f0f"})),e);yield(0,w.RC)("three",e=>{a.onTick(e,t.aspect),s.scope.updateScope({aspect:t.aspect}),t.pointer.ray.intersectPlane(N,o),n.position.copy(o),i.updatePointer(t.pointer.ray)}),s.toColor(),null===(r=s.getChunk(0,0))||void 0===r||r.toWhite(),Object.assign(window,{world:s,cameraHandler:a}),(0,M.cY)(new f.Mesh(new _.w,new G.P({vertexColors:!0})),e)},[]),null}function ed(){return ea(function*(e){let t=new n.n(e.scene,e.camera);t.updatePdMaterial({lumaPhi:10,depthPhi:2,normalPhi:3,radius:2,radiusExponent:2,rings:2,samples:24}),yield e.pipeline.addPass(t,{type:l.GR.PostProcessing}),(0,p.a)({three:e,...d,TextHelper:h.m,calculateExponentialDecayLerpRatio:u.M3,calculateExponentialDecayLerpRatio2:u.zl,lerp:c.t7})},[]),null}function ec(){return(0,o.jsx)("div",{className:"FractalGrid",children:(0,o.jsxs)(el,{children:[(0,o.jsxs)("div",{className:"layer thru flex flex-col p-4 gap-2 items-start",children:[(0,o.jsx)("h1",{className:"text-2xl",children:"FractalGrid"}),(0,o.jsx)("button",{className:"border border-white px-2 py-1 rounded",onClick:()=>$.instances[0].mode++,children:"Switch camera"})]}),(0,o.jsx)(ed,{}),(0,o.jsx)(eh,{})]})})}},60236:function(e,t,r){"use strict";r.d(t,{w:function(){return h}});var i=r(88780),s=r(27834);let a={axis:"x",length:1,radialSegments:12,radius:.01,coneRatio:.1,radiusScale:1,vertexColor:!0,baseCap:"flat",color:"white"},o=new i.Color;function n(e){let{axis:t,length:r,radius:n,radialSegments:l,coneRatio:h,radiusScale:d,vertexColor:c,baseCap:u,color:p}={...a,...e},f=n*d,m=r*h,g=new i.ConeGeometry(3*f,m,l),x=new i.CylinderGeometry(f,f,1,l,1,!0),w=r-m,v=r-.5*m;g.rotateZ(-Math.PI/2).translate(v,0,0),x.scale(1,w,1).rotateZ(-Math.PI/2).translate(.5*w,0,0);let y="none"===u?new i.BufferGeometry:"flat"===u?new i.CircleGeometry(f,l).rotateY(-Math.PI/2):new i.SphereGeometry(f,l,3,0,2*Math.PI,0,.5*Math.PI).rotateZ(Math.PI/2).rotateX(Math.PI/2),M=(0,s.n4)([g,x,y]);switch(t){case"y":M.rotateZ(Math.PI/2);break;case"z":M.rotateY(-Math.PI/2)}if(c){let e=M.attributes.position.count,t=new i.BufferAttribute(new Float32Array(3*e),3);M.setAttribute("color",t),o.set(p);for(let r=0;r<e;r++)t.setXYZ(r,o.r,o.g,o.b)}return M}let l={xColor:"#ff3333",yColor:"#33cc66",zColor:"#3366ff"};class h extends i.BufferGeometry{static get defaultOptions(){return{...l}}constructor(e){super();let{xColor:t,yColor:r,zColor:i,...a}={...l,...e},o=n({...a,axis:"x",color:t}),h=n({...a,axis:"y",color:r}),d=n({...a,axis:"z",color:i}),c=(0,s.n4)([o,h,d]);this.copy(c),c.dispose()}}},77478:function(e,t,r){"use strict";function i(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}r.d(t,{_:function(){return i}})},87062:function(e,t,r){"use strict";r.d(t,{n:function(){return h}});var i=r(88780),s=r(14778),a=r(42098),o=r(40105),n=r(19297),l=r(90654);class h extends s.w{constructor(e,t,r,l,h,d,c){super(),this.width=void 0!==r?r:512,this.height=void 0!==l?l:512,this.clear=!0,this.camera=t,this.scene=e,this.output=0,this._renderGBuffer=!0,this._visibilityCache=new Map,this.blendIntensity=1,this.pdRings=2,this.pdRadiusExponent=2,this.pdSamples=16,this.gtaoNoiseTexture=(0,a.mK)(),this.pdNoiseTexture=this.generateNoise(),this.gtaoRenderTarget=new i.WebGLRenderTarget(this.width,this.height,{type:i.HalfFloatType}),this.pdRenderTarget=this.gtaoRenderTarget.clone(),this.gtaoMaterial=new i.ShaderMaterial({defines:Object.assign({},a.Sp.defines),uniforms:i.UniformsUtils.clone(a.Sp.uniforms),vertexShader:a.Sp.vertexShader,fragmentShader:a.Sp.fragmentShader,blending:i.NoBlending,depthTest:!1,depthWrite:!1}),this.gtaoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.gtaoMaterial.uniforms.tNoise.value=this.gtaoNoiseTexture,this.gtaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.normalMaterial=new i.MeshNormalMaterial,this.normalMaterial.blending=i.NoBlending,this.pdMaterial=new i.ShaderMaterial({defines:Object.assign({},o.m.defines),uniforms:i.UniformsUtils.clone(o.m.uniforms),vertexShader:o.m.vertexShader,fragmentShader:o.m.fragmentShader,depthTest:!1,depthWrite:!1}),this.pdMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.pdMaterial.uniforms.tNoise.value=this.pdNoiseTexture,this.pdMaterial.uniforms.resolution.value.set(this.width,this.height),this.pdMaterial.uniforms.lumaPhi.value=10,this.pdMaterial.uniforms.depthPhi.value=2,this.pdMaterial.uniforms.normalPhi.value=3,this.pdMaterial.uniforms.radius.value=8,this.depthRenderMaterial=new i.ShaderMaterial({defines:Object.assign({},a.gs.defines),uniforms:i.UniformsUtils.clone(a.gs.uniforms),vertexShader:a.gs.vertexShader,fragmentShader:a.gs.fragmentShader,blending:i.NoBlending}),this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new i.ShaderMaterial({uniforms:i.UniformsUtils.clone(n.C.uniforms),vertexShader:n.C.vertexShader,fragmentShader:n.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:i.DstColorFactor,blendDst:i.ZeroFactor,blendEquation:i.AddEquation,blendSrcAlpha:i.DstAlphaFactor,blendDstAlpha:i.ZeroFactor,blendEquationAlpha:i.AddEquation}),this.blendMaterial=new i.ShaderMaterial({uniforms:i.UniformsUtils.clone(a.mF.uniforms),vertexShader:a.mF.vertexShader,fragmentShader:a.mF.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:i.CustomBlending,blendSrc:i.DstColorFactor,blendDst:i.ZeroFactor,blendEquation:i.AddEquation,blendSrcAlpha:i.DstAlphaFactor,blendDstAlpha:i.ZeroFactor,blendEquationAlpha:i.AddEquation}),this.fsQuad=new s.T(null),this.originalClearColor=new i.Color,this.setGBuffer(h?h.depthTexture:void 0,h?h.normalTexture:void 0),void 0!==d&&this.updateGtaoMaterial(d),void 0!==c&&this.updatePdMaterial(c)}dispose(){this.gtaoNoiseTexture.dispose(),this.pdNoiseTexture.dispose(),this.normalRenderTarget.dispose(),this.gtaoRenderTarget.dispose(),this.pdRenderTarget.dispose(),this.normalMaterial.dispose(),this.pdMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}get gtaoMap(){return this.pdRenderTarget.texture}setGBuffer(e,t){void 0!==e?(this.depthTexture=e,this.normalTexture=t,this._renderGBuffer=!1):(this.depthTexture=new i.DepthTexture,this.depthTexture.format=i.DepthStencilFormat,this.depthTexture.type=i.UnsignedInt248Type,this.normalRenderTarget=new i.WebGLRenderTarget(this.width,this.height,{minFilter:i.NearestFilter,magFilter:i.NearestFilter,type:i.HalfFloatType,depthTexture:this.depthTexture}),this.normalTexture=this.normalRenderTarget.texture,this._renderGBuffer=!0);let r=this.normalTexture?1:0,s=this.depthTexture===this.normalTexture?"w":"x";this.gtaoMaterial.defines.NORMAL_VECTOR_TYPE=r,this.gtaoMaterial.defines.DEPTH_SWIZZLING=s,this.gtaoMaterial.uniforms.tNormal.value=this.normalTexture,this.gtaoMaterial.uniforms.tDepth.value=this.depthTexture,this.pdMaterial.defines.NORMAL_VECTOR_TYPE=r,this.pdMaterial.defines.DEPTH_SWIZZLING=s,this.pdMaterial.uniforms.tNormal.value=this.normalTexture,this.pdMaterial.uniforms.tDepth.value=this.depthTexture,this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture}setSceneClipBox(e){e?(this.gtaoMaterial.needsUpdate=1!==this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=1,this.gtaoMaterial.uniforms.sceneBoxMin.value.copy(e.min),this.gtaoMaterial.uniforms.sceneBoxMax.value.copy(e.max)):(this.gtaoMaterial.needsUpdate=0===this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=0)}updateGtaoMaterial(e){void 0!==e.radius&&(this.gtaoMaterial.uniforms.radius.value=e.radius),void 0!==e.distanceExponent&&(this.gtaoMaterial.uniforms.distanceExponent.value=e.distanceExponent),void 0!==e.thickness&&(this.gtaoMaterial.uniforms.thickness.value=e.thickness),void 0!==e.distanceFallOff&&(this.gtaoMaterial.uniforms.distanceFallOff.value=e.distanceFallOff,this.gtaoMaterial.needsUpdate=!0),void 0!==e.scale&&(this.gtaoMaterial.uniforms.scale.value=e.scale),void 0!==e.samples&&e.samples!==this.gtaoMaterial.defines.SAMPLES&&(this.gtaoMaterial.defines.SAMPLES=e.samples,this.gtaoMaterial.needsUpdate=!0),void 0!==e.screenSpaceRadius&&(e.screenSpaceRadius?1:0)!==this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS&&(this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS=e.screenSpaceRadius?1:0,this.gtaoMaterial.needsUpdate=!0)}updatePdMaterial(e){let t=!1;void 0!==e.lumaPhi&&(this.pdMaterial.uniforms.lumaPhi.value=e.lumaPhi),void 0!==e.depthPhi&&(this.pdMaterial.uniforms.depthPhi.value=e.depthPhi),void 0!==e.normalPhi&&(this.pdMaterial.uniforms.normalPhi.value=e.normalPhi),void 0!==e.radius&&e.radius!==this.radius&&(this.pdMaterial.uniforms.radius.value=e.radius),void 0!==e.radiusExponent&&e.radiusExponent!==this.pdRadiusExponent&&(this.pdRadiusExponent=e.radiusExponent,t=!0),void 0!==e.rings&&e.rings!==this.pdRings&&(this.pdRings=e.rings,t=!0),void 0!==e.samples&&e.samples!==this.pdSamples&&(this.pdSamples=e.samples,t=!0),t&&(this.pdMaterial.defines.SAMPLES=this.pdSamples,this.pdMaterial.defines.SAMPLE_VECTORS=(0,o.a)(this.pdSamples,this.pdRings,this.pdRadiusExponent),this.pdMaterial.needsUpdate=!0)}render(e,t,r){switch(this._renderGBuffer&&(this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.gtaoMaterial.uniforms.cameraWorldMatrix.value.copy(this.camera.matrixWorld),this.renderPass(e,this.gtaoMaterial,this.gtaoRenderTarget,16777215,1),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.renderPass(e,this.pdMaterial,this.pdRenderTarget,16777215,1),this.output){case h.OUTPUT.Off:break;case h.OUTPUT.Diffuse:this.copyMaterial.uniforms.tDiffuse.value=r.texture,this.copyMaterial.blending=i.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.AO:this.copyMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.copyMaterial.blending=i.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Denoise:this.copyMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.copyMaterial.blending=i.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Depth:this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=i.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=r.texture,this.copyMaterial.blending=i.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blendMaterial.uniforms.intensity.value=this.blendIntensity,this.blendMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.renderPass(e,this.blendMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.GTAOPass: Unknown output type.")}}renderPass(e,t,r,i,s){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(s||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderOverride(e,t,r,i,s){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i=t.clearColor||i,s=t.clearAlpha||s,null!=i&&(e.setClearColor(i),e.setClearAlpha(s||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}setSize(e,t){this.width=e,this.height=t,this.gtaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.pdRenderTarget.setSize(e,t),this.gtaoMaterial.uniforms.resolution.value.set(e,t),this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.pdMaterial.uniforms.resolution.value.set(e,t),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse)}overrideVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){let r=t.get(e);e.visible=r}),t.clear()}generateNoise(e=64){let t=new l.L,r=new Uint8Array(e*e*4);for(let i=0;i<e;i++)for(let s=0;s<e;s++){let a=i,o=s;r[(i*e+s)*4]=(.5*t.noise(a,o)+.5)*255,r[(i*e+s)*4+1]=(.5*t.noise(a+e,o)+.5)*255,r[(i*e+s)*4+2]=(.5*t.noise(a,o+e)+.5)*255,r[(i*e+s)*4+3]=(.5*t.noise(a+e,o+e)+.5)*255}let s=new i.DataTexture(r,e,e,i.RGBAFormat,i.UnsignedByteType);return s.wrapS=i.RepeatWrapping,s.wrapT=i.RepeatWrapping,s.needsUpdate=!0,s}}h.OUTPUT={Off:-1,Default:0,Diffuse:1,Depth:2,Normal:3,AO:4,Denoise:5}}},function(e){e.O(0,[7512,1561,7834,6158,3956,1067,3310,5229,812,3420,1540,167,4157,9258,5721,1174,2835,2544,5694,2840,1744],function(){return e(e.s=80475)}),_N_E=e.O()}]);
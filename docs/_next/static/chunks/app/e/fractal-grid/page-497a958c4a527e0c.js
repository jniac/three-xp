(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4978],{17746:function(e,t,i){Promise.resolve().then(i.bind(i,25731))},94588:function(e,t,i){"use strict";i.d(t,{N:function(){return n}});var a=i(52471),r=i(81796);new a.Vector3(0,0,0),new a.Euler(0,0,0,"XYZ"),new a.Vector3(1,1,1);let s={x:0,y:0,z:0,rotationX:0,rotationY:0,rotationZ:0,rotationOrder:"XYZ",rotationUnit:"rad",scaleX:1,scaleY:1,scaleZ:1,scaleScalar:1,visible:void 0,name:void 0,parent:void 0};function n(e,t){let{x:i,y:n,z:o,position:l=new a.Vector3(i,n,o),rotationX:h,rotationY:d,rotationZ:u,rotationOrder:p,rotationUnit:c,rotation:f,scaleX:m,scaleY:g,scaleZ:M,scaleScalar:v,scale:T=new a.Vector3(m,g,M).multiplyScalar(v),visible:S,name:x,parent:C}={...s,...t};return(0,r.Q7)(l,e.position),(0,r.Gg)(null!=f?f:[h,d,u,p,c],e.rotation),(0,r.Q7)(T,e.scale),void 0!==S&&(e.visible=S),void 0!==x&&(e.name=x),void 0!==C&&C.add(e),e}},87858:function(e,t,i){"use strict";i.d(t,{H$:function(){return o},bB:function(){return n},cY:function(){return s}});var a=i(52471),r=i(94588);function s(e,t,i){return t&&(t instanceof a.Object3D?t.add(e):(0,r.N)(e,t)),null==i||i(e),e}let n=s;function o(e,t){return function(e,t){let i=e;for(;i.parent;){if(i.parent===t)return!0;i=i.parent}return!1}(t,e)}},40855:function(e,t,i){"use strict";function a(e,t){for(let i of e)if(t(i))return!0;return!1}function r(e,t){for(let i of e)if(!t(i))return!1;return!0}function s(e,t,i){let a=[];function r(e){let t=[];return a[e]=t,t}if(void 0!==i)for(let e=0;e<i;e++)r(e);for(let i of e){var s;let e=t(i);(null!==(s=a[e])&&void 0!==s?s:r(e)).push(i)}return a}i.r(t),i.d(t,{every:function(){return r},some:function(){return a},split:function(){return s}})},53171:function(e,t,i){"use strict";i.d(t,{n:function(){return h}});var a=i(52471),r=i(62604),s=i(15529),n=i(31229),o=i(38885),l=i(39900);class h extends r.w{constructor(e,t,i,l,h,d,u){super(),this.width=void 0!==i?i:512,this.height=void 0!==l?l:512,this.clear=!0,this.camera=t,this.scene=e,this.output=0,this._renderGBuffer=!0,this._visibilityCache=new Map,this.blendIntensity=1,this.pdRings=2,this.pdRadiusExponent=2,this.pdSamples=16,this.gtaoNoiseTexture=(0,s.mK)(),this.pdNoiseTexture=this.generateNoise(),this.gtaoRenderTarget=new a.WebGLRenderTarget(this.width,this.height,{type:a.HalfFloatType}),this.pdRenderTarget=this.gtaoRenderTarget.clone(),this.gtaoMaterial=new a.ShaderMaterial({defines:Object.assign({},s.Sp.defines),uniforms:a.UniformsUtils.clone(s.Sp.uniforms),vertexShader:s.Sp.vertexShader,fragmentShader:s.Sp.fragmentShader,blending:a.NoBlending,depthTest:!1,depthWrite:!1}),this.gtaoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.gtaoMaterial.uniforms.tNoise.value=this.gtaoNoiseTexture,this.gtaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.normalMaterial=new a.MeshNormalMaterial,this.normalMaterial.blending=a.NoBlending,this.pdMaterial=new a.ShaderMaterial({defines:Object.assign({},n.m.defines),uniforms:a.UniformsUtils.clone(n.m.uniforms),vertexShader:n.m.vertexShader,fragmentShader:n.m.fragmentShader,depthTest:!1,depthWrite:!1}),this.pdMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.pdMaterial.uniforms.tNoise.value=this.pdNoiseTexture,this.pdMaterial.uniforms.resolution.value.set(this.width,this.height),this.pdMaterial.uniforms.lumaPhi.value=10,this.pdMaterial.uniforms.depthPhi.value=2,this.pdMaterial.uniforms.normalPhi.value=3,this.pdMaterial.uniforms.radius.value=8,this.depthRenderMaterial=new a.ShaderMaterial({defines:Object.assign({},s.gs.defines),uniforms:a.UniformsUtils.clone(s.gs.uniforms),vertexShader:s.gs.vertexShader,fragmentShader:s.gs.fragmentShader,blending:a.NoBlending}),this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(o.C.uniforms),vertexShader:o.C.vertexShader,fragmentShader:o.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:a.DstColorFactor,blendDst:a.ZeroFactor,blendEquation:a.AddEquation,blendSrcAlpha:a.DstAlphaFactor,blendDstAlpha:a.ZeroFactor,blendEquationAlpha:a.AddEquation}),this.blendMaterial=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(s.mF.uniforms),vertexShader:s.mF.vertexShader,fragmentShader:s.mF.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:a.CustomBlending,blendSrc:a.DstColorFactor,blendDst:a.ZeroFactor,blendEquation:a.AddEquation,blendSrcAlpha:a.DstAlphaFactor,blendDstAlpha:a.ZeroFactor,blendEquationAlpha:a.AddEquation}),this.fsQuad=new r.T(null),this.originalClearColor=new a.Color,this.setGBuffer(h?h.depthTexture:void 0,h?h.normalTexture:void 0),void 0!==d&&this.updateGtaoMaterial(d),void 0!==u&&this.updatePdMaterial(u)}dispose(){this.gtaoNoiseTexture.dispose(),this.pdNoiseTexture.dispose(),this.normalRenderTarget.dispose(),this.gtaoRenderTarget.dispose(),this.pdRenderTarget.dispose(),this.normalMaterial.dispose(),this.pdMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}get gtaoMap(){return this.pdRenderTarget.texture}setGBuffer(e,t){void 0!==e?(this.depthTexture=e,this.normalTexture=t,this._renderGBuffer=!1):(this.depthTexture=new a.DepthTexture,this.depthTexture.format=a.DepthStencilFormat,this.depthTexture.type=a.UnsignedInt248Type,this.normalRenderTarget=new a.WebGLRenderTarget(this.width,this.height,{minFilter:a.NearestFilter,magFilter:a.NearestFilter,type:a.HalfFloatType,depthTexture:this.depthTexture}),this.normalTexture=this.normalRenderTarget.texture,this._renderGBuffer=!0);let i=this.normalTexture?1:0,r=this.depthTexture===this.normalTexture?"w":"x";this.gtaoMaterial.defines.NORMAL_VECTOR_TYPE=i,this.gtaoMaterial.defines.DEPTH_SWIZZLING=r,this.gtaoMaterial.uniforms.tNormal.value=this.normalTexture,this.gtaoMaterial.uniforms.tDepth.value=this.depthTexture,this.pdMaterial.defines.NORMAL_VECTOR_TYPE=i,this.pdMaterial.defines.DEPTH_SWIZZLING=r,this.pdMaterial.uniforms.tNormal.value=this.normalTexture,this.pdMaterial.uniforms.tDepth.value=this.depthTexture,this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture}setSceneClipBox(e){e?(this.gtaoMaterial.needsUpdate=1!==this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=1,this.gtaoMaterial.uniforms.sceneBoxMin.value.copy(e.min),this.gtaoMaterial.uniforms.sceneBoxMax.value.copy(e.max)):(this.gtaoMaterial.needsUpdate=0===this.gtaoMaterial.defines.SCENE_CLIP_BOX,this.gtaoMaterial.defines.SCENE_CLIP_BOX=0)}updateGtaoMaterial(e){void 0!==e.radius&&(this.gtaoMaterial.uniforms.radius.value=e.radius),void 0!==e.distanceExponent&&(this.gtaoMaterial.uniforms.distanceExponent.value=e.distanceExponent),void 0!==e.thickness&&(this.gtaoMaterial.uniforms.thickness.value=e.thickness),void 0!==e.distanceFallOff&&(this.gtaoMaterial.uniforms.distanceFallOff.value=e.distanceFallOff,this.gtaoMaterial.needsUpdate=!0),void 0!==e.scale&&(this.gtaoMaterial.uniforms.scale.value=e.scale),void 0!==e.samples&&e.samples!==this.gtaoMaterial.defines.SAMPLES&&(this.gtaoMaterial.defines.SAMPLES=e.samples,this.gtaoMaterial.needsUpdate=!0),void 0!==e.screenSpaceRadius&&(e.screenSpaceRadius?1:0)!==this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS&&(this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS=e.screenSpaceRadius?1:0,this.gtaoMaterial.needsUpdate=!0)}updatePdMaterial(e){let t=!1;void 0!==e.lumaPhi&&(this.pdMaterial.uniforms.lumaPhi.value=e.lumaPhi),void 0!==e.depthPhi&&(this.pdMaterial.uniforms.depthPhi.value=e.depthPhi),void 0!==e.normalPhi&&(this.pdMaterial.uniforms.normalPhi.value=e.normalPhi),void 0!==e.radius&&e.radius!==this.radius&&(this.pdMaterial.uniforms.radius.value=e.radius),void 0!==e.radiusExponent&&e.radiusExponent!==this.pdRadiusExponent&&(this.pdRadiusExponent=e.radiusExponent,t=!0),void 0!==e.rings&&e.rings!==this.pdRings&&(this.pdRings=e.rings,t=!0),void 0!==e.samples&&e.samples!==this.pdSamples&&(this.pdSamples=e.samples,t=!0),t&&(this.pdMaterial.defines.SAMPLES=this.pdSamples,this.pdMaterial.defines.SAMPLE_VECTORS=(0,n.a)(this.pdSamples,this.pdRings,this.pdRadiusExponent),this.pdMaterial.needsUpdate=!0)}render(e,t,i){switch(this._renderGBuffer&&(this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.gtaoMaterial.uniforms.cameraWorldMatrix.value.copy(this.camera.matrixWorld),this.renderPass(e,this.gtaoMaterial,this.gtaoRenderTarget,16777215,1),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.renderPass(e,this.pdMaterial,this.pdRenderTarget,16777215,1),this.output){case h.OUTPUT.Off:break;case h.OUTPUT.Diffuse:this.copyMaterial.uniforms.tDiffuse.value=i.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.AO:this.copyMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Denoise:this.copyMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Depth:this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case h.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=i.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blendMaterial.uniforms.intensity.value=this.blendIntensity,this.blendMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.renderPass(e,this.blendMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.GTAOPass: Unknown output type.")}}renderPass(e,t,i,a,r){e.getClearColor(this.originalClearColor);let s=e.getClearAlpha(),n=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,null!=a&&(e.setClearColor(a),e.setClearAlpha(r||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=n,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}renderOverride(e,t,i,a,r){e.getClearColor(this.originalClearColor);let s=e.getClearAlpha(),n=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,a=t.clearColor||a,r=t.clearAlpha||r,null!=a&&(e.setClearColor(a),e.setClearAlpha(r||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=n,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}setSize(e,t){this.width=e,this.height=t,this.gtaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.pdRenderTarget.setSize(e,t),this.gtaoMaterial.uniforms.resolution.value.set(e,t),this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.pdMaterial.uniforms.resolution.value.set(e,t),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse)}overrideVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){let i=t.get(e);e.visible=i}),t.clear()}generateNoise(e=64){let t=new l.L,i=new Uint8Array(e*e*4);for(let a=0;a<e;a++)for(let r=0;r<e;r++){let s=a,n=r;i[(a*e+r)*4]=(.5*t.noise(s,n)+.5)*255,i[(a*e+r)*4+1]=(.5*t.noise(s+e,n)+.5)*255,i[(a*e+r)*4+2]=(.5*t.noise(s,n+e)+.5)*255,i[(a*e+r)*4+3]=(.5*t.noise(s+e,n+e)+.5)*255}let r=new a.DataTexture(i,e,e,a.RGBAFormat,a.UnsignedByteType);return r.wrapS=a.RepeatWrapping,r.wrapT=a.RepeatWrapping,r.needsUpdate=!0,r}}h.OUTPUT={Off:-1,Default:0,Diffuse:1,Depth:2,Normal:3,AO:4,Denoise:5}}},function(e){e.O(0,[5244,6712,6666,5792,2452,7741,2722,3831,4940,8648,4831,9918,8181,3425,494,5731,2920,7936,1744],function(){return e(e.s=17746)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6449],{4076:(e,t,n)=>{"use strict";n.d(t,{Client:()=>j,X:()=>g});var r=n(70691),i=n(53097),s=n(50926),o=n(87381),a=n(67235),l=n(28737),c=n(79285),u=n(4941),h=n(38062),d=n(49797),f=n(69621),m=n(12033),x=n(16219);function p(){return(0,r.jsxs)(f.kE,{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-8",children:"Decompose Matrix4 with Shear"}),(0,r.jsx)(f.$n,{label:"Orthographic (reset)",onClick:()=>{a.Q.send(x.n).assertPayload().vertigo.set({perspective:0,zoom:1,focus:0,rotation:[0,0,0]})}}),(0,r.jsx)(f.$n,{label:"Perspective",onClick:()=>{a.Q.send(x.n).assertPayload().vertigo.set({perspective:1})}}),(0,r.jsx)(f.$n,{label:"Toggle Rotation",onClick:()=>{let e=a.Q.send(g).payload;e&&(e.rotate=!e.rotate)}})]})}class g{constructor(){this.rotate=!1,a.Q.on(g,e=>e.setPayload(this))}}function y(){return(0,i.dB)("my-test-1",function*(e,t){let n=(0,m.l1)({position:[-2,4,0],scale:[1,2,3],shear:[.1,.2,.3]}),r=m.W.transformToTransform(n),i=(0,o.mj)(new f.QT(r?"white":"red"),e);i.matrixAutoUpdate=!1,(0,m.Nb)(n,i.matrix);let s=(0,m.Ez)(i.matrix);console.log(s.position),console.log(s.scale),console.log(new d.O9p().setFromQuaternion(s.rotation)),console.log(s.shear);let a=(0,o.mj)(new f.QT("yellow"),e);a.matrixAutoUpdate=!1,(0,m.Nb)(s,a.matrix)},[]),null}function v(){return(0,i.dB)("my-test-2",function*(e,t){let n=[(0,m.l1)({position:[-2,-4,0],scale:[2,4,1],euler:[1,0,2],shear:[1,.5,.1]}),(0,m.l1)({position:[2,-4,0],scale:[4,1,2],euler:[0,1,-1],shear:[-.5,1,.25]})],r=new g,[i,s]=n.map(t=>{let n=(0,o.mj)(new f.QT,e);n.matrixAutoUpdate=!1;let i=1,s=()=>{(0,m.Nb)(t,n.matrix)};return s(),n.onTick=e=>{r.rotate&&(i+=e.deltaTime),s()},n}),a=(0,o.mj)(new f.QT("yellow"),e),l=(0,m.Ez)(i.matrix),d=(0,m.Ez)(s.matrix),x=(0,m.Ez)(a.matrix);yield t.ticker.onTick(e=>{let t=h.o.triangle(e.time,{frequency:1/4});t=(0,c.inverseLerp)(.05,.95,t),t=u.kY.inOut2(t),(0,m.$N)(l,d,t,x),a.matrixAutoUpdate=!1,a.matrix=(0,m.Nb)(x,a.matrix)})},[]),null}function w(){return(0,i.Fw)(function*(e){e.pipeline.basicPasses.fxaa.enabled=!1}),(0,i.dB)("my-settings",function*(e,t){(0,o.mj)(new s.u,e).regularGrid({size:12,subdivisions:[2,6],opacity:[1,.1]})},[]),null}function j(){return(0,r.jsxs)(i.uB,{vertigoControls:{eventTarget:"canvas",size:12,zoom:.7,rotation:["8deg","12deg","0deg"],focus:[0,0,.5]},children:[(0,r.jsx)(l.Leak,{}),(0,r.jsx)(w,{}),(0,r.jsx)(y,{}),(0,r.jsx)(v,{}),(0,r.jsx)(p,{})]})}},4941:(e,t,n)=>{"use strict";n.d(t,{_5:()=>i.ol,YN:()=>i.o8,cz:()=>s,kY:()=>i.kY});var r=n(37197),i=n(40074);let s={transition:i.kY,bump:r.$p}},17099:(e,t,n)=>{"use strict";n.d(t,{c:()=>a});var r=n(79105);let i=e=>e,s={weightsAreNormalized:!1,indexOffset:0,forbiddenItems:[]};function o(){let e=(0,r.K2)((0,r.K2)((0,r.Ts)(r.KP)));function t(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.KP;return"string"==typeof t&&(t=t.split("").reduce((e,t)=>7*e+t.charCodeAt(0),0)),e=(0,r.K2)((0,r.K2)((0,r.Ts)(t))),u}function n(){return e=(0,r.K2)(e),(0,r.Tj)(e)}function o(e){switch(e.length){default:return[0,1,i];case 1:return[0,e[0],i];case 2:return[e[0],e[1],i];case 3:return[e[0],e[1],e[2]]}}function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[i,s,a]=o(t);return i+(s-i)*a(n())}function l(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];let[o,a,{weightsAreNormalized:l,indexOffset:c,forbiddenItems:u}]=function(e){let[t,n=null,r]=e,i={...s,...r};if(Array.isArray(t))return[t,n,i];if("object"==typeof t)return[Object.values(t),n?Object.values(n):null,i];throw Error("pick: unsupported options type")}(r);if(u.length>0){let t=new Set;for(let e of u){let n=o.indexOf(e);n>=0&&t.add(n)}if(o=o.filter((e,n)=>!t.has(n)),a=null!=(e=null==a?void 0:a.filter((e,n)=>!t.has(n)))?e:null,0===o.length)throw Error("pick: all items are forbidden")}if(null===a){let e=Math.floor(n()*o.length);return c&&(e+=c,(e%=o.length)<0&&(e+=o.length)),o[e]}if(!l){let e=a.reduce((e,t)=>e+t,0);a=a.map(t=>t/e)}let h=n(),d=0;for(let e=0;e<o.length;e++)if(h<(d+=a[e]))return o[e];throw Error("among: unreachable")}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=n(),i=n(),s=Math.sqrt(-2*Math.log(r)),o=2*Math.PI*i;return[e+t*s*Math.cos(o),e+t*s*Math.sin(o)]}let u={seed:t,seedMax:function(){return r.Zu},reset:function(){return t(r.KP),u},next:function(){return e=(0,r.K2)(e),u},getState:function(){return e},setState:function(t){return e=t&r.Zu,u},random:n,between:a,around:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[s=1,o=i]=t,a=2*n();return(a>1?1:-1)*o(a>1?a-1:a)*s},int:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[i,s,a]=o(t);return i+Math.floor(a(n())*(s-i))},chance:function(e){return n()<e},shuffle:function(e){let{mutate:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t&&Array.isArray(e)?e:[...e],i=r.length;for(let e=0;e<i;e++){let t=Math.floor(i*n()),s=r[e];r[e]=r[t],r[t]=s}return r},pick:l,createPicker:function(e){let t=e.map(e=>{let[t]=e;return t}),n=e.map(e=>{let[t,n]=e;return n}),r=n.reduce((e,t)=>e+t,0);for(let[e,t]of n.entries())n[e]=t/r;return()=>l(t,n,{weightsAreNormalized:!0})},vector:function(e,t){let[n=0,r=1]=Array.isArray(t)?t:[null==t?void 0:t.min,null==t?void 0:t.max];for(let t of Object.keys(e))e[t]=a(n,r);return e},unitVector2:function(e){let t=2*Math.PI*n();return e.x=Math.cos(t),e.y=Math.sin(t),e},unitVector3:function(e){let t=n(),r=n(),i=2*Math.PI*t,s=Math.acos(1-2*r);return e.x=Math.sin(s)*Math.cos(i),e.y=Math.sin(s)*Math.sin(i),e.z=Math.cos(s),e},normalVector:function(e){let t=Object.keys(e),n=t.length,r=Math.sqrt(n);for(let i=0;i<n;i+=2){let[s,o]=c();e[t[i]]=s/r,i+1<n&&(e[t[i+1]]=o/r)}return e},unitVector:function(e){let t=Object.keys(e),n=t.length,r=0;for(let i=0;i<n;i+=2){let[s,o]=c();e[t[i]]=s,r+=s*s,i+1<n&&(e[t[i+1]]=o,r+=o*o)}r=Math.sqrt(r);for(let i=0;i<n;i++)e[t[i]]/=r;return e},boxMuller:c,quaternion:function(e){let t=n(),r=n(),i=n(),s=Math.sqrt(1-t),o=Math.sqrt(t);return e.x=s*Math.sin(2*Math.PI*r),e.y=s*Math.cos(2*Math.PI*r),e.z=o*Math.sin(2*Math.PI*i),e.w=o*Math.cos(2*Math.PI*i),e},insideCircle:function(e,t){let r=2*n()*Math.PI,i=Math.sqrt(n())*e;return t.x=i*Math.cos(r),t.y=i*Math.sin(r),t}};return u}let a=class{constructor(e){Object.assign(this,o().seed(e))}};Object.assign(a,o())},18397:(e,t,n)=>{"use strict";n.d(t,{Client:()=>x});var r=n(70691),i=n(49797),s=n(53097),o=n(50926),a=n(87381),l=n(80446),c=n(69621),u=n(12033),h=n(16219),d=n(67235);function f(){return(0,r.jsxs)(c.kE,{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-8",children:"Some Shear Examples"}),(0,r.jsx)(c.$n,{label:"Orthographic (reset)",onClick:()=>{d.Q.send(h.n).assertPayload().vertigo.set({perspective:0,zoom:1,rotation:[0,0,0]})}}),(0,r.jsx)(c.$n,{label:"Perspective",onClick:()=>{d.Q.send(h.n).assertPayload().vertigo.set({perspective:1})}}),(0,r.jsxs)("p",{className:"max-w-sm",children:["Using ",(0,r.jsx)("code",{children:"TransformWithShear"})," from ",(0,r.jsx)("code",{children:"some-utils-three/experimental/transform-with-shear"}),"."]})]})}function m(){return(0,s.Fw)(function*(e){e.pipeline.basicPasses.fxaa.enabled=!1}),(0,s.dB)("my-scene",function*(e,t){(0,a.mj)(new o.u,e).regularGrid({size:12,subdivisions:[2,6],opacity:[1,.1]});let n=[{x:-5,y:3,z:0,xy:1,xz:0,yz:0},{x:-2,y:3,z:0,xy:0,xz:1,yz:0},{x:-3,y:1,z:0,xy:0,xz:0,yz:1},{x:1,y:4,z:0,xy:1,xz:1,yz:0},{x:4,y:3,z:0,xy:0,xz:1,yz:1},{x:1,y:1,z:0,xy:1,xz:0,yz:1}];for(let{x:t,y:r,z:s,xy:o,xz:l,yz:h}of n){let n={position:new i.Pq0(t,r,s),scale:new i.Pq0(1,1,1),rotation:new i.PTz,shear:{xy:o,xz:l,yz:h}},d=u.W.transformToTransform(n),f=(0,a.mj)(new c.QT(d?"white":"red"),e);f.matrixAutoUpdate=!1,(0,u.Nb)(n,f.matrix)}for(let{x:t,y:r,z:s,xy:o,xz:h,yz:d}of(l.n.setRandom("parkmiller",5678),n)){let n={position:new i.Pq0(t,r-6,s),scale:new i.Pq0(l.n.number(.1,2),l.n.number(.1,2),l.n.number(.1,2)),rotation:l.n.quaternion(new i.PTz),shear:{xy:o,xz:h,yz:d}},f=u.W.transformToTransform(n),m=(0,a.mj)(new c.QT(f?"white":"red"),e);m.matrixAutoUpdate=!1,(0,u.Nb)(n,m.matrix)}},[]),null}function x(){return(0,r.jsxs)(s.uB,{vertigoControls:{eventTarget:"canvas",size:12,zoom:.7,rotation:["15deg","20deg","0deg"],focus:[0,0,.5]},children:[(0,r.jsx)(m,{}),(0,r.jsx)(f,{})]})}},25809:(e,t,n)=>{"use strict";n.d(t,{P:()=>o});var r=n(49797),i=n(92381);let s={color:"white",opacity:.5,plane:"XY",size:[8,8],step:1,frame:!0};class o extends r.DXC{set(e){let{color:t,opacity:n,size:o,step:a,frame:l,plane:c}={...s,...e},u=(0,i.wX)(o),h=(0,i.wX)(null!=a?a:u),d=[],f=(e,t)=>d.push(new r.Pq0(e,t,0));l&&(f(-u.x/2,u.y/2),f(u.x/2,u.y/2),f(u.x/2,u.y/2),f(u.x/2,-u.y/2),f(u.x/2,-u.y/2),f(-u.x/2,-u.y/2),f(-u.x/2,-u.y/2),f(-u.x/2,u.y/2));let m=Math.ceil(-u.x/2/h.x)*h.x;m===-u.x/2&&(m+=h.x);do f(m,-u.y/2),f(m,u.y/2),m+=h.x;while(m<u.x/2);let x=Math.ceil(-u.y/2/h.y)*h.y;x===-u.y/2&&(x+=h.y);do f(-u.x/2,x),f(u.x/2,x),x+=h.y;while(x<u.y/2);switch(this.geometry.setFromPoints(d),c){case"XZ":this.geometry.rotateX(Math.PI/2);break;case"YZ":this.geometry.rotateY(Math.PI/2)}return this.material.color.set(t),this.material.opacity=n,this.material.transparent=n<1,this}constructor(e){super(),this.set(null!=e?e:s)}}},28737:(e,t,n)=>{"use strict";n.d(t,{Leak:()=>u,O:()=>c});var r={};n.r(r),n.d(r,{distribute:()=>s.mn,every:()=>s.Si,findMaxBy:()=>s.vj,pairwise:()=>s.Ju,recordBy:()=>s.VY,some:()=>s.zN,split:()=>s.mn,uniqueBy:()=>s.pD});var i=n(30158),s=n(43107),o=n(38062),a=n(85795),l=n(17099);function c(e){Object.assign(window,{...i,...a,...r,...e,PRNG:l.c,waveform:o.o})}function u(e){return c(e),null}},34125:(e,t,n)=>{"use strict";n.d(t,{ServerProof:()=>o});var r=n(70691),i=n(67203);let s=function(){return(0,r.jsx)("div",{className:"w-full h-full flex flex-col items-center justify-center",children:"loading..."})};function o(){let[,e]=(0,i.useState)(0);return(0,i.useEffect)(()=>{let t=!0;return Promise.all([n.e(5611),n.e(6564),n.e(7962),n.e(7953),n.e(4638),n.e(2294)]).then(n.bind(n,52294)).then(n=>{t&&(s=n.ChooseOne,e(Math.random()))}),()=>{t=!1}},[]),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:(0,r.jsx)("div",{className:"absolute-through",children:(0,r.jsx)(s,{})})})}},37833:(e,t,n)=>{"use strict";n.d(t,{Client:()=>b,X:()=>v});var r=n(70691),i=n(49797),s=n(53097),o=n(40747),a=n(50926),l=n(87381),c=n(79285),u=n(4941),h=n(38062),d=n(67235),f=n(36508),m=n(28737),x=n(69621),p=n(16219);function g(){return(0,r.jsxs)(x.kE,{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-8",children:"Some Shear Examples"}),(0,r.jsx)(x.$n,{label:"Orthographic (reset)",onClick:()=>{d.Q.send(p.n).assertPayload().vertigo.set({perspective:0,zoom:1,rotation:[0,0,0]})}}),(0,r.jsx)(x.$n,{label:"Perspective",onClick:()=>{d.Q.send(p.n).assertPayload().vertigo.set({perspective:1})}}),(0,r.jsx)(x.$n,{label:"Negate Matrix",onClick:()=>{let e=d.Q.send(v).payload;e&&(e.negateMatrix=!e.negateMatrix)}}),(0,r.jsxs)("p",{className:"mt-4",children:["Using ",(0,r.jsx)("code",{children:"TransformWithShear"})," from ",(0,r.jsx)("code",{children:"some-utils-three/experimental/transform-with-shear"}),"."]}),(0,r.jsxs)("p",{children:["The ",(0,r.jsx)("span",{className:"text-yellow-500",children:"yellow object"})," is defined by position, rotation, scale, and shear (transform props)."]}),(0,r.jsxs)("p",{children:["The ",(0,r.jsx)("span",{className:"text-cyan-500",children:"cyan object"})," is defined by basis vectors (matrix), transform is inferred from matrix."]}),(0,r.jsx)("p",{children:'Works with reflections too (try clicking "Negate Matrix" button).'})]})}class y extends x.QT{setTransform(e){return this.transform.from(e),this.transform.toMatrix(this.matrix),this}constructor(e="white"){super(e),this.transform=new o.Q,this.matrixAutoUpdate=!1}}class v{constructor(){this.negateMatrix=!1,d.Q.on(v,e=>e.setPayload(this))}}function w(){return(0,s.dB)("my-test-1",function*(e,t){let n=new v,r=(0,l.mj)(new y("yellow"),e).setTransform({position:[-2,-3,-1],scale:[3,2,1],rotation:["30deg","-120deg","10deg"],shear:[.1,.2,.3]}),s=(0,l.mj)(new y("cyan"),e),o=(0,l.mj)(new y("white"),e);yield(0,f.xy)("three",e=>{let t=new i.Pq0(0,1,-.5),a=new i.Pq0(0,.5,3),l=new i.Pq0(2.5,0,.5);n.negateMatrix&&l.negate(),s.matrix.makeBasis(t,a,l).setPosition(new i.Pq0(1,2,-1)),s.transform.from(s.matrix);let d=u.kY.inOut4((0,c.inverseLerp)(.05,.95,h.o.triangle(e.time,{f:.2})));o.transform.lerpTransforms(r.transform,s.transform,d),o.transform.toMatrix(o.matrix)})},[]),null}function j(){return(0,s.Fw)(function*(e){e.pipeline.basicPasses.fxaa.enabled=!1}),(0,s.dB)("my-settings",function*(e,t){(0,l.mj)(new a.u,e).regularGrid({size:12,subdivisions:[2,6],opacity:[1,.1]})},[]),null}function b(){return(0,r.jsxs)(s.uB,{vertigoControls:{eventTarget:"canvas",size:12,zoom:.7,rotation:["8deg","12deg","0deg"],focus:[0,0,.5]},children:[(0,r.jsx)(m.Leak,{}),(0,r.jsx)(j,{}),(0,r.jsx)(w,{}),(0,r.jsx)(g,{})]})}},38062:(e,t,n)=>{"use strict";n.d(t,{o:()=>r});let r={triangle:function(e){let{frequency:t=1,phase:n=0,f:r=t,p:i=n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=e*r+i,o=2*s-Math.floor(2*s);return s-Math.floor(s)<.5?o:1-o}}},40747:(e,t,n)=>{"use strict";n.d(t,{Q:()=>T});var r=n(28535),i=n(76999),s=n(57368),o=n(66066),a=n(15940),l=n(77674),c=n(49797),u=n(92381);let h=new c.kn4;function d(e,t){let{scale:{x:n,y:r,z:i},shear:{x:s,y:o,z:a}}=e;t.makeRotationFromQuaternion(e.quaternion),t.multiply(h.set(1,s,o,0,0,1,a,0,0,0,1,0,0,0,0,1)),t.elements[0]*=n,t.elements[1]*=n,t.elements[2]*=n,t.elements[4]*=r,t.elements[5]*=r,t.elements[6]*=r,t.elements[8]*=i,t.elements[9]*=i,t.elements[10]*=i,t.setPosition(e.position)}let f=new c.Pq0,m=new c.Pq0,x=new c.Pq0,p=new c.Pq0,g=new c.Pq0,y=new c.Pq0,v=new c.Pq0;function w(e,t){let n=e.elements;t.position.set(n[12],n[13],n[14]),f.set(n[0],n[1],n[2]),m.set(n[4],n[5],n[6]),x.set(n[8],n[9],n[10]);let r=0>f.dot(p.crossVectors(m,x))?-1:1,i=f.length();g.copy(f).divideScalar(i);let s=g.dot(m);y.copy(m).addScaledVector(g,-s);let o=y.length();y.divideScalar(o);let a=g.dot(x),l=y.dot(x);v.copy(x).addScaledVector(g,-a).addScaledVector(y,-l);let c=v.length();v.divideScalar(c),r<0&&g.negate(),t.quaternion.setFromRotationMatrix(h.makeBasis(g,y,v)),t.scale.set(r*i,o,c),t.shear.set(r*s/o,r*a/c,l/c)}function j(e,t){let{resetMissing:n=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return void 0!==e.position?(0,u.jj)(e.position,t.position):n&&t.position.set(0,0,0),void 0!==e.quaternion?(0,u.EC)(e.quaternion,t.quaternion):void 0!==e.rotation?t.quaternion.setFromEuler((0,u.if)(e.rotation)):n&&t.quaternion.set(0,0,0,1),void 0!==e.scale?(0,u.jj)(e.scale,t.scale):n&&t.scale.set(1,1,1),void 0!==e.shear?(0,u.jj)(e.shear,t.shear):n&&t.shear.set(0,0,0),t}function b(e,t,n,r){r.position.lerpVectors(e.position,t.position,n),r.quaternion.slerpQuaternions(e.quaternion,t.quaternion,n),r.scale.lerpVectors(e.scale,t.scale,n),r.shear.lerpVectors(e.shear,t.shear,n)}function M(){return{position:new c.Pq0,quaternion:new c.PTz,scale:new c.Pq0(1,1,1),shear:new c.Pq0}}let P=new c.kn4,z=M(),k=M(),q=M();var C=new WeakMap,N=new WeakSet;class T{static lerp(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,l._)(T,T,S);return j(e,z),j(t,k),b(z,k,n,r),r}static from(e){return new this().from(e)}get rotation(){return(0,o._)(this,N,A).call(this)}copy(e){return this.position.copy(e.position),this.scale.copy(e.scale),this.quaternion.copy(e.quaternion),this.shear.copy(e.shear),this}clone(){return(new this.constructor).copy(this)}toMatrix(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new c.kn4;return d(this,e),e}from(e){return e instanceof c.kn4?w(e,this):j(e,this),this}setTransform(e){let{partial:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return j(e,this,{resetMissing:!t}),this}lerpTransforms(e,t,n){return b(e,t,n,this),this}lerp(e,t){return b(this,e,t,this),this}identity(){return this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1),this.shear.set(0,0,0),this}isIdentity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-6;return this.position.lengthSq()<=e&&Math.abs(this.quaternion.x)<=e&&Math.abs(this.quaternion.y)<=e&&Math.abs(this.quaternion.z)<=e&&Math.abs(this.quaternion.w-1)<=e&&Math.abs(this.scale.x-1)<=e&&Math.abs(this.scale.y-1)<=e&&Math.abs(this.scale.z-1)<=e&&Math.abs(this.shear.x)<=e&&Math.abs(this.shear.y)<=e&&Math.abs(this.shear.z)<=e}isDirect(){let{x:e,y:t,z:n}=this.scale;return e*t*n>=0}constructor(){(0,a._)(this,N),(0,i._)(this,C,{writable:!0,value:void 0}),this.position=new c.Pq0,this.scale=new c.Pq0(1,1,1),this.quaternion=new c.PTz,this.shear=new c.Pq0,(0,s._)(this,C,null)}}T.lerpMatrixes=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P;return w(e,z),w(t,k),b(z,k,n,q),d(q,r),r};var S={writable:!0,value:new T};function A(){if(null===(0,r._)(this,C)){let e=new c.O9p().setFromQuaternion(this.quaternion);return e._onChangeCallback=()=>{this.quaternion.setFromEuler(e)},(0,s._)(this,C,e)}return(0,r._)(this,C)}},59481:(e,t,n)=>{"use strict";n.d(t,{Main:()=>m});var r=n(70691),i=n(49797),s=n(84306),o=n(16219),a=n(56647),l=n(9723),c=n(87381),u=n(36508);class h extends i.eaF{constructor(){super(new i.bdM(4,.2),new l.Y({color:"#ff9900"}))}}class d extends i.eaF{constructor(){super(new i.bdM(4,.2),new i.BKk({uniforms:{uColor:{value:new i.Q1f("#ff9900")},uSunPosition:{value:new i.Pq0(.5,.7,.3)},uLuminosity:{value:.5}},vertexShader:"\n      varying vec3 vWorldNormal;\n      \n      void main() {\n        vWorldNormal = mat3(modelMatrix) * normal;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        gl_Position.z += -0.01;\n      }\n    ",fragmentShader:"\n      varying vec3 vWorldNormal;\n      varying vec3 vColor;\n      \n      uniform vec3 uSunPosition;\n      uniform vec3 uColor;\n      uniform float uLuminosity;\n      \n      void main() {\n        vec3 lightDirection = normalize(uSunPosition);\n        float light = dot(vWorldNormal, lightDirection) * 0.5 + 0.5;\n        light = pow(light, 2.0);\n        light = mix(uLuminosity, 1.0, light);\n        gl_FragColor = vec4(uColor * light, 1.0);\n      }\n    "}))}}function f(){return(0,s.hG)(function*(e){e.useOrbitControls=!1;let t=new o.n({size:[8,8]});t.start(e.three.renderer.domElement),yield(0,u.xy)("three",n=>{t.update(e.three.camera,e.three.aspect)})}),(0,s.yk)(function*(e){e.scene.background=new i.Q1f("#6699cc"),(0,c.mj)(new i.eaF(new i.WBB(1,4),new l.Y({color:"red"})),e.scene),(0,c.mj)(new a.R,e.scene).box({size:2}).draw().showOccludedLines(),(0,c.mj)(new h,{parent:e.scene,position:[0,.5,0]}),(0,c.mj)(new d,{parent:e.scene,position:[0,-.5,0]}),yield()=>e.scene.clear()},[]),null}function m(){return(0,r.jsx)(s.YV,{children:(0,r.jsx)(f,{})})}},66209:(e,t,n)=>{"use strict";n.d(t,{Main:()=>m});var r=n(70691),i=n(49797),s=n(84306),o=n(9723),a=n(60041),l=n(66851),c=n(87381),u=n(72612),h=n(17099);class d extends i.YJl{constructor(){super(),(0,c.mj)(new i.eaF(new i.WBB(1,12),new o.Y),this),(0,c.mj)(new i.eaF(new i.UPV(2,.1,256,16),new o.Y({color:"red"})),this);let e=new i.uWO(new Float32Array(100),4),t=new i.bdM;t.setAttribute("aRand",e);let n=new i.V9B({side:i.$EB});n.onBeforeCompile=e=>a.b.with(e).vertex.top("\n        attribute vec4 aRand;\n      ").vertex.after("project_vertex","\n        gl_Position.z += aRand.x * .1;\n      ");let r=(0,c.mj)(new i.ZLX(t,n,25),this);h.c.reset();let s=Array.from({length:25},()=>0xffffff*h.c.random());for(let t of(0,u.loop2)(5,5)){let n=(t.px-.5)*4,i=(t.py-.5)*4,o=(t.px+t.py)*.4;r.setMatrixAt(t.i,(0,l.w)({x:n,y:i,z:o,scaleScalar:1.25})),r.setColorAt(t.i,(0,l._)(h.c.pick(s))),e.setXYZW(t.i,h.c.random(),h.c.random(),h.c.random(),h.c.random())}}}function f(){return(0,s.yk)(function*(e){e.useOrbitControls(),e.scene.background=new i.Q1f("#345");let t=new d;e.scene.add(t),yield()=>t.removeFromParent()},[]),null}function m(){return(0,r.jsx)(s.YV,{children:(0,r.jsx)(f,{})})}},68516:(e,t,n)=>{"use strict";n.d(t,{SafeClient:()=>s});var r=n(70691),i=n(67203);function s(){let[e,t]=(0,i.useState)(null);return(0,i.useEffect)(()=>{Promise.all([n.e(5500),n.e(5611),n.e(7190),n.e(6564),n.e(7953),n.e(4638),n.e(6726),n.e(3231),n.e(9303),n.e(7456),n.e(6219),n.e(7215)]).then(n.bind(n,51571)).then(e=>t(e))},[]),e?(0,r.jsx)(e.Client,{}):(0,r.jsx)("div",{className:"layer col-center",children:"loading..."})}},70574:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,89294,23)),Promise.resolve().then(n.bind(n,66209)),Promise.resolve().then(n.bind(n,59481)),Promise.resolve().then(n.bind(n,76033)),Promise.resolve().then(n.bind(n,18397)),Promise.resolve().then(n.bind(n,4076)),Promise.resolve().then(n.bind(n,37833)),Promise.resolve().then(n.bind(n,73341)),Promise.resolve().then(n.bind(n,34125)),Promise.resolve().then(n.bind(n,99398)),Promise.resolve().then(n.bind(n,68516)),Promise.resolve().then(n.bind(n,85862)),Promise.resolve().then(n.bind(n,94449))},73341:(e,t,n)=>{"use strict";n.d(t,{Main:()=>x});var r=n(70691),i=n(49797),s=n(12719),o=n(64028),a=n(84306),l=n(25809),c=n(56647),u=n(9723),h=n(87381),d=n(36508);class f extends i.YJl{onTick(e){let{sphere:t,pivot:n,position:r}=this.parts,s=e.lerpSin01Time(.5,1.5,{frequency:.2}),o=new i.Pq0().copy(n.position).addScaledVector(n.position,-s);t.matrixAutoUpdate=!1,t.matrix.makeScale(s,s,s).setPosition(o.add(r.position))}constructor(...e){super(...e),this.parts={sphere:(0,h.mj)(new i.eaF(new i.WBB(1,8),new u.Y),{name:"sphere",parent:this}),circle:(0,h.mj)(new c.R().circle({radius:.5}).circle({radius:1}).circle({radius:1.5}).draw(),{name:"circle",parent:this}),pivot:(0,h.mj)(new i.YJl,{name:"pivot",parent:this}),position:(0,h.mj)(new i.YJl,{name:"position",parent:this}),grid:(0,h.mj)(new l.P,{name:"grid",parent:this,rotationX:"90deg"})}}}function m(){let e=(0,a.hG)();return(0,a.yk)(function*(t){t.scene.background=new i.Q1f("#345");let n=new f;t.scene.add(n),yield(0,d.xy)("three",e=>n.onTick(e)),e.sceneSelection.set("Hop!",[n.parts.pivot]),e.toolType.set(s.pv.Move),(0,o._t)(e,n.parts.pivot),yield()=>n.removeFromParent()},[]),null}function x(){return(0,r.jsxs)(a.YV,{children:[(0,r.jsx)(m,{}),(0,r.jsxs)("div",{className:"flex flex-col p-4 gap-2",children:[(0,r.jsx)("p",{children:"Pivot offset to perform translate and scale is quite straightforward:"}),(0,r.jsx)("pre",{className:"bg-[#fff1] rounded px-2 py-1",children:"\nconst scale = ... // some value\nconst translate = new Vector3()\n  .copy(pivot.position)\n  .addScaledVector(pivot.position, -scale)\n\nmatrix\n  .makeScale(scale, scale, scale)\n  .setPosition(translate)\n".trim()})]})]})}},76033:(e,t,n)=>{"use strict";n.d(t,{Client:()=>d});var r=n(70691),i=n(53097),s=n(50926),o=n(87381),a=n(69621),l=n(16219),c=n(67235);function u(){return(0,r.jsxs)("div",{className:"ui layer thru p-8 flex flex-col gap-4 items-start",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-8",children:"Matrix with Shear"}),(0,r.jsx)("button",{className:"btn border rounded px-4 py-2",onClick:()=>{c.Q.send(l.n).assertPayload().vertigo.set({perspective:0,zoom:1,rotation:[0,0,0]})},children:"Orthographic (reset)"}),(0,r.jsx)("button",{className:"btn border rounded px-4 py-2",onClick:()=>{c.Q.send(l.n).assertPayload().vertigo.set({perspective:1})},children:"Perspective"}),(0,r.jsxs)("p",{className:"flex w-[400px]",children:["The problem:",(0,r.jsx)("br",{}),"Linear interpolation of matrix columns produces weird intermediate states."]}),(0,r.jsxs)("p",{className:"flex w-[400px]",children:["Conclusion:",(0,r.jsx)("br",{}),"The matrices should be decomposed to position, rotation, scale, shear, interpolated, then recomposed."]}),(0,r.jsx)("p",{className:"flex w-[400px]",children:"But shear is tricky..."})]})}function h(){return(0,i.Fw)(function*(e){e.pipeline.basicPasses.fxaa.enabled=!1}),(0,i.dB)("my-scene",function*(e,t){(0,o.mj)(new s.u,e).regularGrid({size:12,subdivisions:[2,6],opacity:[1,.1]});let n=(0,o.mj)(new a.Yr,e);(0,o.mj)(n.objA,{x:1,y:4}),(0,o.mj)(n.objB,{x:-1,y:4,rotation:["0deg","180deg","0deg"]});let r=(0,o.mj)(new a.Yr,e);(0,o.mj)(r.objA,{x:1,y:2}),(0,o.mj)(r.objB,{x:-1,y:2,rotation:["90deg","90deg","0deg"]})},[]),null}function d(){return(0,r.jsxs)(i.uB,{vertigoControls:{eventTarget:"canvas",size:12,zoom:1,rotation:["0deg","0deg","0deg"],focus:[0,0,.5]},children:[(0,r.jsx)(h,{}),(0,r.jsx)(u,{})]})}},80446:(e,t,n)=>{"use strict";n.d(t,{n:()=>i});var r=n(79105);let i=function e(){let t=Math.random,n=()=>{};function i(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)|0;return t}function s(e){let{weightsAreNormalized:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===e.length)throw Error("Weights array is empty");if(!1===n){let n=e.reduce((e,t)=>e+t,0),r=t()*n,i=0;for(let t=0;t<e.length;t++)if(r<(i+=e[t]))return t;return e.length-1}{let n=t(),r=0;for(let t=0;t<e.length;t++)if(n<(r+=e[t]))return t;return e.length-1}}let o={new:function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e().setRandom(...n)},setRandom:function(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];let[l,c=0]=s,u="string"==typeof c?i(c):c;if("parkmiller"===l){let e=r.Ts(u);t=()=>(e=r.K2(e),r.Tj(e)),n=t=>{e=r.Ts(t)}}else{if(void 0!==l&&"function"!=typeof l)throw Error("Invalid random function");t=null!=l?l:Math.random,n=()=>{}}return n(u),o},seed:function(e){return n("string"==typeof e?i(e):null!=e?e:0),o},get random(){return t},chance:function(e){return t()<e},number:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];if(0===n.length)return t();if(1===n.length)return t()*n[0];if(2===n.length)return t()*(n[1]-n[0])+n[0];throw Error("Invalid arguments")},sign:function(){return .5>t()?-1:1},int:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];if(1===n.length)return Math.floor(t()*n[0]);if(2===n.length)return Math.floor(t()*(n[1]-n[0]))+n[0];throw Error("Invalid arguments")},hexColor:function(){let e=Math.floor(0xffffff*t());return"#".concat(e.toString(16).padStart(6,"0"))},pickIndex:s,pick:function(e,n){if(0===e.length)throw Error("Array is empty");if(n)return e[s(n)];let r=Math.floor(t()*e.length);return e[r]},createPicker:function(e){let t=e.map(e=>e[0]),n=e.map(e=>e[1]),r=t.reduce((e,t)=>e+t,0);for(let e=0;e<t.length;e++)t[e]/=r;return()=>n[s(t,{weightsAreNormalized:!0})]},direction2:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},n=t()*Math.PI*2;return e.x=Math.cos(n),e.y=Math.sin(n),e},direction3:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},n=t(),r=t(),i=2*Math.PI*n,s=Math.acos(1-2*r);return e.x=Math.sin(s)*Math.cos(i),e.y=Math.sin(s)*Math.sin(i),e.z=Math.cos(s),e},quaternion:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0,w:1},n=t(),r=t(),i=t(),s=Math.sqrt(1-n),o=Math.sqrt(n);return e.x=s*Math.sin(2*Math.PI*r),e.y=s*Math.cos(2*Math.PI*r),e.z=o*Math.sin(2*Math.PI*i),e.w=o*Math.cos(2*Math.PI*i),e},shuffleIndexes:function*(e){if(e<=0)throw Error("N must be greater than 0");let n=0,r=Math.floor((2+2*t())*e);for(;1!==function(e,t){for(;0!==t;)[e,t]=[t,e%t];return e}(e,r);){if(++n>1e3)throw Error("Failed to find a suitable a value after 1000 attempts");r=e+Math.floor(t()*e)}let i=Math.floor(t()*e);for(let t=0;t<e;t++)yield(i+t*r)%e}};return o}()},85862:(e,t,n)=>{"use strict";n.d(t,{SafeClient:()=>s});var r=n(70691),i=n(67203);function s(){let[e,t]=(0,i.useState)(null);return(0,i.useEffect)(()=>{Promise.all([n.e(5611),n.e(7190),n.e(6564),n.e(7953),n.e(4638),n.e(6726),n.e(3231),n.e(9303),n.e(7456),n.e(6219),n.e(1080)]).then(n.bind(n,92622)).then(e=>t(e))},[]),e?(0,r.jsx)(e.Client,{}):(0,r.jsx)("div",{className:"layer col-center",children:"loading..."})}},94449:(e,t,n)=>{"use strict";n.d(t,{SafeClient:()=>s});var r=n(70691),i=n(67203);function s(){let[e,t]=(0,i.useState)(null);return(0,i.useEffect)(()=>{Promise.all([n.e(5611),n.e(7190),n.e(6564),n.e(7953),n.e(4638),n.e(6726),n.e(3231),n.e(9303),n.e(7456),n.e(6219),n.e(8413)]).then(n.bind(n,71237)).then(e=>t(e))},[]),e?(0,r.jsx)(e.Client,{}):(0,r.jsx)("div",{className:"layer col-center",children:"loading..."})}},99398:(e,t,n)=>{"use strict";n.d(t,{SafeClient:()=>s});var r=n(70691),i=n(67203);function s(){let[e,t]=(0,i.useState)(null);return(0,i.useEffect)(()=>{Promise.all([n.e(5611),n.e(7190),n.e(6564),n.e(7953),n.e(4638),n.e(6726),n.e(3231),n.e(9303),n.e(7456),n.e(6219),n.e(6224)]).then(n.bind(n,92358)).then(e=>t(e))},[]),e?(0,r.jsx)(e.Client,{}):(0,r.jsx)("div",{className:"layer col-center",children:"loading..."})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2193,5611,7190,6564,7962,9635,8921,7953,4512,7775,7436,7706,9294,4638,6726,3231,9303,7456,6219,8803,3097,7558,6647,7938,1319,6852,7358],()=>t(70574)),_N_E=e.O()}]);
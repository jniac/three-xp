(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3404],{16465:(t,i,e)=>{"use strict";e.d(i,{Y:()=>r});var s=e(49797),o=e(7147);let n={shadowColor:"#808080",luminosity:1,rampPower:1,onBeforeCompile:void 0};class r extends s.V9B{constructor(t){let{rampPower:i,shadowColor:e,luminosity:r,onBeforeCompile:a,...l}={...n,...t},h={uSunPosition:{value:new s.Pq0(.5,.7,.3)},uShadowColor:{value:new s.Q1f(e)},uRampPower:{value:i},uLuminosity:{value:r}};super(l),this.onBeforeCompile=t=>{o.bI.with(t).uniforms(h).varying({vAutoLitWorldNormal:"vec3"}).vertex.mainAfterAll("\n          vAutoLitWorldNormal = mat3(modelMatrix) * normal;\n          #ifdef USE_INSTANCING\n            vAutoLitWorldNormal = mat3(instanceMatrix) * vAutoLitWorldNormal;\n          #endif\n        ").fragment.after("map_fragment","\n          vec3 normal = normalize(vAutoLitWorldNormal);\n          vec3 lightDirection = normalize(uSunPosition);\n          float light = dot(normal, lightDirection) * 0.5 + 0.5;\n          light = pow(light, uRampPower);\n          diffuseColor.rgb *= mix(uShadowColor * uLuminosity, vec3(1.0), light);\n        "),null==a||a(t)},this.sunPosition=h.uSunPosition.value}}},18461:(t,i,e)=>{"use strict";e.d(i,{$:()=>s});class s{set(){let{position:t=this.position,velocity:i=this.velocity,drag:e=this.drag}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.position=t,this.velocity=i,this.drag=e,this}copy(t){return this.position=t.position,this.velocity=t.velocity,this.drag=t.drag,this}clone(){return new s().copy(this)}setDrag(t){let{timeSpan:i=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.drag=Math.pow(t,i),this}update(t){if(!(t<=0)){var i,e;this.positionOld=this.position,this.velocityOld=this.velocity,this.position+=(i=this.velocity,i*(Math.pow(e=1-this.drag,t)-1)/Math.log(e)),this.velocity*=Math.pow(1-this.drag,t)}}getDestination(){return this.position+-this.velocity/Math.log(1-this.drag)}getDragForDestination(t){let i=Math.exp(-this.velocity/(t-this.position));return{drag:1-i,valid:i>0&&i<1}}setDragForDestination(t){let{drag:i}=this.getDragForDestination(t);return this.drag=i,this}getVelocityForDestination(t){var i;return{velocity:(i=1-this.drag,-(t-this.position)*Math.log(i))}}setVelocityForDestination(t){return this.velocity=this.getVelocityForDestination(t).velocity,this}constructor(t){this.position=0,this.velocity=0,this.drag=.75,this.positionOld=0,this.velocityOld=0,t&&this.set(t)}}},45369:(t,i,e)=>{Promise.resolve().then(e.bind(e,48937))},48937:(t,i,e)=>{"use strict";e.d(i,{PageClient:()=>D});var s=e(70691),o=e(33540),n=e(77794),r=e(79911),a=e(72612),l=e(49797),h=e(99332),g=e(31763),p=e(16465),u=e(18461),d=e(67235),c=e(53245);function m(t){let i=(0,o.Fw)();return(0,o.dB)("basic-demo",t,function*(t){let e=d.Q.send(g.n).assertPayload();(0,r.mj)(new l.eaF(new l.O3Y(1.2,.05),new p.Y({color:"yellow"})),t);let s=(0,r.mj)(new l.eaF(new l.WBB(1,12),new p.Y({})),t),o=(0,r.mj)(new l.eaF(new l.O3Y(1.2,.05),new p.Y({})),t),n=new u.$({drag:.999999}),a=new c.r(8,0),m=!1,v=()=>e.dampedVertigo.state.realSize.y/i.domElement.clientHeight;yield(0,h.s)(i.domElement,{onVerticalDragStart:()=>{m=!0},onVerticalDrag:t=>{let e=-t.delta.y*v()*1;a.setValue(e/i.ticker.deltaTime,!0),n.position+=e},onVerticalDragStop:()=>{m=!1,n.velocity=a.average;let t=n.getDestination();o.position.y=t}}),yield i.ticker.onTick(()=>{m||n.update(i.ticker.deltaTime),s.position.y=n.position})},[]),null}var v=e(63106),y=e(91255);function f(t){let{dragDamping:i,...e}=t,s=(0,o.Fw)();return(0,o.dB)("toggle-demo",e,function*(t){let e=d.Q.send(g.n).assertPayload();(0,r.mj)(new n.u,t).text([0,-12,0],"d: ".concat((null==i?void 0:i.toPrecision(3).replace(/0+$/,""))||"default"),{size:1,color:"white"});let o=(0,r.mj)(new l.eaF(new l.WBB(1,12),new p.Y({})),t),a=(0,r.mj)(new n.u,o),u=new y.l({dragDamping:i,positions:[-10,-1.5,1.5,10],overshootLimit:3});for(let i of u.props.positions)(0,r.mj)(new l.eaF(new l.O3Y(1.2,.05),new p.Y({})),t).position.y=i;let c=(0,r.mj)(new l.eaF(new l.tcD(1.6,32),new p.Y({color:"#022c14"})),{parent:t,z:-.1}),m=(0,r.mj)(new l.eaF(new l.O3Y(1.4,.05),new p.Y({color:"#7636c9"})),{parent:t,z:-.1}),f=()=>e.dampedVertigo.state.realSize.y/s.domElement.clientHeight;yield(0,h.s)(s.domElement,{onVerticalDragStart:()=>{u.dragStart()},onVerticalDrag:t=>{let i=-(f()*t.delta.y);u.drag(i)},onVerticalDragStop:()=>{u.dragStop()},onWheel:t=>{let i=f()*t.delta.y*1;u.autoDrag(i)}}),yield(0,v.a)([[" ",()=>{c.visible=!c.visible,m.visible=!m.visible}]]),yield s.ticker.onTick(()=>{u.update(s.ticker.deltaTime),o.position.y=u.position,c.position.y=u.state.inputPosition,m.position.y=u.state.naturalDestination,a.textAt(0,"".concat(u.state.positionIndex),{position:[0,0,1],size:4,color:"blue"})})},[]),null}function w(){let t=(0,o.Fw)();return(0,o.dB)("my-scene",function*(i){t.pipeline.basicPasses.fxaa.enabled=!1,(0,r.mj)(new n.u,i).regularGrid()}),null}function D(){return(0,s.jsxs)(o.uB,{vertigoControls:{fixed:!0,size:32,perspective:0},children:[(0,s.jsxs)("div",{className:"layer thru p-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Decay"}),(0,s.jsx)("p",{className:"mt-4 max-w-md",children:"Trying to combine mouse drag & mouse wheel to control a single object with multiple stop positions and decay."})]}),(0,s.jsx)(w,{}),(0,s.jsx)(m,{x:-5}),(0,a.loopArray)(4,t=>{let i=.001**(1+t.i/3);return(0,s.jsx)(f,{x:5+3*t.i,dragDamping:i},t.i)})]})}},66620:(t,i,e)=>{"use strict";e.d(i,{_:()=>n});var s=e(89868),o=e(44138);function n(t,i){var e=(0,o._)(t,i,"update");return(0,s._)(t,e)}},72612:(t,i,e)=>{"use strict";function*s(t){let i=0,e={get i(){return i},get t(){return i/t},get p(){return i/(t-1)},get size(){return t},clone(){return{...this}}};for(i=0;i<t;i++)yield e}function o(t,i){let e=[];for(let o of s(t)){let t=o.clone();e.push(i?i(t):t)}return e}function*n(){for(var t=arguments.length,i=Array(t),e=0;e<t;e++)i[e]=arguments[e];let s=0,o=0;2===i.length?(s=i[0],o=i[1]):Array.isArray(i[0])?(s=i[0][0],o=i[0][1]):(s=i[0].x,o=i[0].y);let n=0,r=0,a=0,l={get i(){return n},get x(){return r},get y(){return a},get tx(){return r/s},get ty(){return a/o},get px(){return r/(s-1)},get py(){return a/(o-1)},get sizeX(){return s},get sizeY(){return o},clone(){return{...this}}};for(a=0;a<o;a++)for(r=0;r<s;r++)yield l,n++}function r(){let t;for(var i=arguments.length,e=Array(i),s=0;s<i;s++)e[s]=arguments[s];let o=0,r=0;"number"==typeof e[0]?(o=e[0],r=e[1],t=e[2]):(Array.isArray(e[0])?(o=e[0][0],r=e[0][1]):(o=e[0].x,r=e[0].y),t=e[1]);let a=[];for(let i of n(o,r)){let e=i.clone();a.push(t?t(e):e)}return a}function*a(){for(var t=arguments.length,i=Array(t),e=0;e<t;e++)i[e]=arguments[e];let s=0,o=0,n=0;3===i.length?(s=i[0],o=i[1],n=i[2]):Array.isArray(i[0])?(s=i[0][0],o=i[0][1],n=i[0][2]):(s=i[0].x,o=i[0].y,n=i[0].z);let r=0,a=0,l=0,h=0,g={get i(){return r},get x(){return a},get y(){return l},get z(){return h},get tx(){return a/s},get ty(){return l/o},get tz(){return h/n},get px(){return a/(s-1)},get py(){return l/(o-1)},get pz(){return h/(n-1)},clone(){return{...this}}};for(h=0;h<n;h++)for(l=0;l<o;l++)for(a=0;a<s;a++)yield g,r++}function l(){for(var t=arguments.length,i=Array(t),e=0;e<t;e++)i[e]=arguments[e];let s=[];for(let t of a(...i))s.push(t.clone());return s}e.r(i),e.d(i,{loop:()=>s,loop2:()=>n,loop2Array:()=>r,loop3:()=>a,loop3Array:()=>l,loopArray:()=>o})},91255:(t,i,e)=>{"use strict";e.d(i,{l:()=>g});var s=e(79285),o=e(18461),n=e(63126),r=e(53245);class a{add(t,i){this.map.has(t)||this.map.set(t,new Set),this.map.get(t).add(i);let e=()=>this.unsubscribe(t,i);return{unsubscribe:e,destroy:e}}addOnce(t,i){return this.add(t,function(){for(var t=arguments.length,e=Array(t),s=0;s<t;s++)e[s]=arguments[s];return i(...e),"unsubscribe"})}dispatch(t){for(var i=arguments.length,e=Array(i>1?i-1:0),s=1;s<i;s++)e[s-1]=arguments[s];let o=this.map.get("*");if(o){for(let i of o)"unsubscribe"===i(t,...e)&&o.delete(i);0===o.size&&this.map.delete("*")}let n=this.map.get(t);if(n){for(let i of n)"unsubscribe"===i(t,...e)&&n.delete(i);0===n.size&&this.map.delete(t)}return this}unsubscribe(t,i){let e=this.map.get(t);if(!e)return!1;let s=e.delete(i);return 0===e.size&&this.map.delete(t),s}constructor(){this.map=new Map}}function l(t,i){let e=0,s=Math.abs(i-t[0]);for(let o=1;o<t.length;o++){let n=Math.abs(i-t[o]);n<s&&(e=o,s=n)}return e}class h{input(t){this.inputDelta+=t}update(t,i){this.deltaTime=t,this.time+=t;let e=this.inputPosition+this.inputDelta,o=this.inputDelta/t;this.inputVelocityMem.setValue(o,!0),this.inputDelta=0,this.dragMobile.set({position:e,velocity:this.inputVelocityMem.average,drag:1-i});let n=this.dragMobile.getDestination();this.naturalDestination=n;let r=l(this.positions,n),a=this.positions[r];this.targetPosition!==a&&(this.targetPosition=a,this.targetTime=this.time);let h=Math.min((this.time-this.targetTime)/.2,1);this.dragMobile.set({position:this.position}).setVelocityForDestination(a).update(t);let g=this.dragMobile.position,p=(0,s.lerp)(e,g,h),u=p-this.position;this.inputPosition=p,this.position=p,this.velocity=u/t}constructor(){this.dragMobile=new o.$,this.time=0,this.deltaTime=0,this.inputDelta=0,this.inputPosition=0,this.inputVelocityMem=new r.r(10,0),this.naturalDestination=0,this.targetPosition=0,this.targetTime=0,this.position=0,this.velocity=0,this.positions=[]}}class g{get firstPosition(){return this.props.positions[0]}get lastPosition(){return this.props.positions[this.props.positions.length-1]}get position(){return this.state.position}get isMoving(){return this.state.moving}get isDragging(){return this.state.dragging}get movingStartDuration(){return this.state.moving?this.state.time-this.state.movingStartTime:0}get movingStopDuration(){return this.state.moving?0:this.state.time-this.state.movingStopTime}on(t,i){return this.state.callbacks.add(t,i)}computeClosestPositionIndex(t){return l(this.props.positions,t)}inverseLerpPosition(t){let i=this.props.positions[0];return(t-i)/(this.props.positions[this.props.positions.length-1]-i)}goto(t){let{positions:i}=this.props;return t<0&&(t+=i.length),this.dragStop(),this.dragMobile.set({drag:1-1e-6}),this.dragMobile.setVelocityForDestination(i[t]),this.state.destination=i[t],this.state.naturalDestination=i[t],this.state.inputPosition=this.state.position,this}gotoPrevious(){let{loop:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=this.state.positionIndex-1;return i<0&&(i=t?this.props.positions.length-1:0),this.goto(i)}gotoNext(){let{loop:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=this.state.positionIndex+1;return i>=this.props.positions.length&&(i=t?0:this.props.positions.length-1),this.goto(i)}dragStart(){return this.state.dragging||(this.state.dragStartTime=this.state.time,this.state.dragging=!0,this.state.dragState=g.DragState.Dragging,this.state.callbacks.dispatch(g.Events.DragStart,this)),this}dragStop(){if(!this.state.dragging)return this;this.state.dragging=!1,this.state.dragState=g.DragState.None,this.state.dragStopTime=this.state.time,this.dragMobile.set({position:this.state.position,velocity:this.state.velocity,drag:1-this.props.dragDamping});let t=this.dragMobile.getDestination(),i=this.props.positions[0],e=Math.abs(t-i);for(let s=1;s<this.props.positions.length;s++){let o=this.props.positions[s],n=Math.abs(t-o);n<e&&(i=o,e=n)}return this.state.naturalDestination=t,this.state.destination=i,this.state.inputPosition=this.state.position,this.dragMobile.setVelocityForDestination(i),this.state.callbacks.dispatch(g.Events.DragStop,this),this}drag(t){this.state.dragging&&(this.state.inputPosition+=t)}autoDrag(t){return this.state.autoDragging=!0,this.state.autoDrag.input(t),this}update(t){if(this.state.deltaTime=t,this.state.time+=t,this.state.dragging){let{overshootLimit:i}=this.props,e=this.firstPosition,o=this.lastPosition,r=(0,s.limitedClamp)(this.state.inputPosition,e,e-i,o,o+i),a=(0,n.calculateExponentialDecayLerpRatio)(this.props.dragDamping,t),l=this.state.position,h=(0,s.lerp)(l,r,a),p=h-l;this.state.position=h,this.state.velocity=p/t,this.state.dragState=g.DragState.Dragging,this.dragMobile.set({position:this.state.position,velocity:this.state.velocity,drag:1-this.props.dragDamping}),this.state.naturalDestination=this.dragMobile.getDestination()}else if(this.state.autoDragging){this.state.autoDrag.update(t,this.props.dragDamping);let{position:i,velocity:e}=this.state.autoDrag;this.state.position=i,this.state.velocity=e,1e-5>Math.abs(e)&&(this.state.autoDragging=!1,this.dragMobile.set({position:i,velocity:0}))}else this.dragMobile.update(t),this.state.position=this.dragMobile.position,this.state.velocity=this.dragMobile.velocity;this.state.positionIndex=this.computeClosestPositionIndex(this.state.position),this.state.positionMem.setValue(this.state.position,!0),this.state.velocityMem.setValue(this.state.velocity,!0);let i=Math.abs(this.state.velocityMem.average)>1e-5,e=this.state.moving;if(this.state.moving=i,i!==e){i?this.state.movingStartTime=this.state.time:this.state.movingStopTime=this.state.time;let t=i?g.Events.MovingStart:g.Events.MovingStop;this.state.callbacks.dispatch(t,this)}return this}svgRepresentation(){let{svg:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t||((t=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("viewBox","-30 -30 100 500"),t.setAttribute("width","100"),t.setAttribute("height","500"));let i=t.querySelector("circle.head");i||((i=document.createElementNS("http://www.w3.org/2000/svg","circle")).classList.add("head"),i.setAttribute("r","5"),i.setAttribute("fill","none"),i.setAttribute("stroke","white"),t.appendChild(i));let e=[...t.querySelectorAll("circle.stop")];for(;e.length<this.props.positions.length;){let i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.classList.add("stop"),i.setAttribute("r","3"),i.setAttribute("fill","white"),t.appendChild(i),e.push(i)}for(;e.length>this.props.positions.length;){let t=e.pop();t&&t.parentNode&&t.parentNode.removeChild(t)}let s=t=>200*this.inverseLerpPosition(t)+10;for(let t=0;t<this.props.positions.length;t++){let i=s(this.props.positions[t]);e[t].setAttribute("cy","".concat(i))}return i.setAttribute("cy","".concat(s(this.state.position))),t}constructor(t){this.state={positionIndex:0,position:0,time:0,deltaTime:0,moving:!1,movingStartTime:-1/0,movingStopTime:-1/0,positionMem:new r.r(10,0),velocityMem:new r.r(10,0),dragging:!1,velocity:0,dragStartTime:-1/0,dragStopTime:-1/0,dragState:g.DragState.None,inputPosition:0,naturalDestination:0,destination:0,autoDragging:!1,autoDrag:new h,callbacks:new a},this.dragMobile=new o.$,this.props={...g.defaultProps,...t},this.state.position=this.firstPosition,this.state.inputPosition=this.firstPosition,this.state.destination=this.firstPosition,this.state.naturalDestination=this.firstPosition,this.dragMobile.set({position:this.firstPosition}),this.state.autoDrag.positions=this.props.positions}}g.DragState={None:0,Dragging:1,AutoDragging:2},g.Events={MovingStart:"moving-start",MovingStop:"moving-stop",DragStart:"drag-start",DragStop:"drag-stop",DragAutoLockEnd:"drag-auto-lock-end"},g.defaultProps={positions:[0,100],overshootLimit:20,dragDamping:1e-5}}},t=>{var i=i=>t(t.s=i);t.O(0,[5611,7190,6564,7962,9635,8921,7953,4512,7775,7436,146,487,9332,3445,3414,9717,1763,2143,3540,1319,6852,7358],()=>i(45369)),_N_E=t.O()}]);
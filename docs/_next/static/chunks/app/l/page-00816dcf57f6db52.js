(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6449,8181],{4076:(e,t,r)=>{"use strict";r.d(t,{Client:()=>P,X:()=>y});var n=r(70691),o=r(33540),i=r(77794),s=r(79911),a=r(67235),l=r(28737),c=r(79285),h=r(4941),u=r(38062),d=r(49797),f=r(69621),m=r(12033),p=r(31763);function x(){return(0,n.jsxs)(f.kE,{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-8",children:"Decompose Matrix4 with Shear"}),(0,n.jsx)(f.$n,{label:"Orthographic (reset)",onClick:()=>{a.Q.send(p.n).assertPayload().vertigo.set({perspective:0,zoom:1,focus:0,rotation:[0,0,0]})}}),(0,n.jsx)(f.$n,{label:"Perspective",onClick:()=>{a.Q.send(p.n).assertPayload().vertigo.set({perspective:1})}}),(0,n.jsx)(f.$n,{label:"Toggle Rotation",onClick:()=>{let e=a.Q.send(y).payload;e&&(e.rotate=!e.rotate)}})]})}class y{constructor(){this.rotate=!1,a.Q.on(y,e=>e.setPayload(this))}}function g(){return(0,o.dB)("my-test-1",function*(e,t){let r=(0,m.l1)({position:[-2,4,0],scale:[1,2,3],shear:[.1,.2,.3]}),n=m.W.transformToTransform(r),o=(0,s.mj)(new f.QT(n?"white":"red"),e);o.matrixAutoUpdate=!1,(0,m.Nb)(r,o.matrix);let i=(0,m.Ez)(o.matrix);console.log(i.position),console.log(i.scale),console.log(new d.O9p().setFromQuaternion(i.rotation)),console.log(i.shear);let a=(0,s.mj)(new f.QT("yellow"),e);a.matrixAutoUpdate=!1,(0,m.Nb)(i,a.matrix)},[]),null}function w(){return(0,o.dB)("my-test-2",function*(e,t){let r=[(0,m.l1)({position:[-2,-4,0],scale:[2,4,1],euler:[1,0,2],shear:[1,.5,.1]}),(0,m.l1)({position:[2,-4,0],scale:[4,1,2],euler:[0,1,-1],shear:[-.5,1,.25]})],n=new y,[o,i]=r.map(t=>{let r=(0,s.mj)(new f.QT,e);r.matrixAutoUpdate=!1;let o=1,i=()=>{(0,m.Nb)(t,r.matrix)};return i(),r.onTick=e=>{n.rotate&&(o+=e.deltaTime),i()},r}),a=(0,s.mj)(new f.QT("yellow"),e),l=(0,m.Ez)(o.matrix),d=(0,m.Ez)(i.matrix),p=(0,m.Ez)(a.matrix);yield t.ticker.onTick(e=>{let t=u.o.triangle(e.time,{frequency:1/4});t=(0,c.inverseLerp)(.05,.95,t),t=h.kY.inOut2(t),(0,m.$N)(l,d,t,p),a.matrixAutoUpdate=!1,a.matrix=(0,m.Nb)(p,a.matrix)})},[]),null}function v(){return(0,o.Fw)(function*(e){e.pipeline.basicPasses.fxaa.enabled=!1}),(0,o.dB)("my-settings",function*(e,t){(0,s.mj)(new i.u,e).regularGrid({size:12,subdivisions:[2,6],opacity:[1,.1]})},[]),null}function P(){return(0,n.jsxs)(o.uB,{vertigoControls:{eventTarget:"canvas",size:12,zoom:.7,rotation:["8deg","12deg","0deg"],focus:[0,0,.5]},children:[(0,n.jsx)(l.Leak,{}),(0,n.jsx)(v,{}),(0,n.jsx)(g,{}),(0,n.jsx)(w,{}),(0,n.jsx)(x,{})]})}},12033:(e,t,r)=>{"use strict";r.d(t,{$N:()=>a,Ez:()=>s,Nb:()=>i,W:()=>c,l1:()=>l});var n=r(94065),o=r(49797);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.kn4,{position:r,rotation:n,scale:i,shear:s}=e,a=new o.kn4().makeScale(i.x,i.y,i.z),l=new o.kn4().set(1,s.xy,s.xz,0,0,1,s.yz,0,0,0,1,0,0,0,0,1),c=new o.kn4().makeRotationFromQuaternion(n),h=new o.kn4().makeTranslation(r.x,r.y,r.z);return t.identity(),t.multiply(c),t.multiply(l),t.multiply(a),t.premultiply(h),t}function s(e){let t=e.elements,r=new o.Pq0(t[12],t[13],t[14]);new o.kn4().set(t[0],t[4],t[8],0,t[1],t[5],t[9],0,t[2],t[6],t[10],0,0,0,0,1);let n=new o.Pq0(t[0],t[1],t[2]),i=new o.Pq0(t[4],t[5],t[6]),s=new o.Pq0(t[8],t[9],t[10]),a=0>n.dot(new o.Pq0().crossVectors(i,s))?-1:1,l=n.length(),c=n.clone().divideScalar(l),h=c.dot(i),u=i.clone().addScaledVector(c,-h),d=u.length(),f=u.divideScalar(d),m=c.dot(s),p=f.dot(s),x=s.clone().addScaledVector(c,-m).addScaledVector(f,-p),y=x.length(),g=x.divideScalar(y);a<0&&c.negate();let w=new o.kn4().makeBasis(c,f,g);return{position:r,rotation:new o.PTz().setFromRotationMatrix(w),scale:new o.Pq0(a*l,d,y),shear:{xy:h/d,xz:m/y,yz:p/y}}}function a(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{position:new o.Pq0,rotation:new o.PTz,scale:new o.Pq0,shear:{xy:0,xz:0,yz:0}};return n.position.lerpVectors(e.position,t.position,r),n.rotation.slerpQuaternions(e.rotation,t.rotation,r),n.scale.lerpVectors(e.scale,t.scale,r),n.shear.xy=e.shear.xy+(t.shear.xy-e.shear.xy)*r,n.shear.xz=e.shear.xz+(t.shear.xz-e.shear.xz)*r,n.shear.yz=e.shear.yz+(t.shear.yz-e.shear.yz)*r,n}function l(){let{position:e=0,euler:t=[0,0,0],scale:r=1,shear:i=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[s,a,l]=(0,n.jj)(i);return{position:(0,n.jj)(e),rotation:new o.PTz().setFromEuler((0,n.if)(t)),scale:(0,n.jj)(r),shear:{xy:s,xz:a,yz:l}}}class c{static matrixToMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-12,r=i(s(e));for(let n=0;n<16;n++)if(Math.abs(e.elements[n]-r.elements[n])>t)return!1;return!0}static transformToTransform(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-12,r=s(i(e));return!(e.position.distanceTo(r.position)>t||1-Math.abs(e.rotation.dot(r.rotation))>t||e.scale.distanceTo(r.scale)>t||Math.abs(e.shear.xy-r.shear.xy)>t||Math.abs(e.shear.xz-r.shear.xz)>t||Math.abs(e.shear.yz-r.shear.yz)>t)}}},15931:(e,t,r)=>{"use strict";r.d(t,{P:()=>a});var n=r(49797),o=r(94065),i=r(7147);let s={color:"white",opacity:.5,plane:"XY",size:[8,8],step:1,frame:!0,depthOffset:0};class a extends n.DXC{set(e){let{color:t,opacity:r,size:i,step:a,frame:l,plane:c,depthOffset:h}={...s,...e},u=(0,o.wX)(i),d=(0,o.wX)(null!=a?a:u),f=[],m=(e,t)=>f.push(new n.Pq0(e,t,0));l&&(m(-u.x/2,u.y/2),m(u.x/2,u.y/2),m(u.x/2,u.y/2),m(u.x/2,-u.y/2),m(u.x/2,-u.y/2),m(-u.x/2,-u.y/2),m(-u.x/2,-u.y/2),m(-u.x/2,u.y/2));let p=Math.ceil(-u.x/2/d.x)*d.x;p===-u.x/2&&(p+=d.x);do m(p,-u.y/2),m(p,u.y/2),p+=d.x;while(p<u.x/2);let x=Math.ceil(-u.y/2/d.y)*d.y;x===-u.y/2&&(x+=d.y);do m(-u.x/2,x),m(u.x/2,x),x+=d.y;while(x<u.y/2);switch(this.geometry.setFromPoints(f),c){case"XZ":this.geometry.rotateX(Math.PI/2);break;case"YZ":this.geometry.rotateY(Math.PI/2)}return this.uniforms.uDepthOffset.value=h,this.material.color.set(t),this.material.opacity=r,this.material.transparent=r<1,this}constructor(e){let t=new n.mrM,r={uDepthOffset:{value:0}};t.onBeforeCompile=e=>i.bI.with(e).uniforms(r).vertex.mainAfterAll("\n        gl_Position.w += uDepthOffset;\n      "),super(void 0,t),this.uniforms=r,this.set(null!=e?e:s)}}},18397:(e,t,r)=>{"use strict";r.d(t,{Client:()=>p});var n=r(70691),o=r(49797),i=r(33540),s=r(77794),a=r(79911),l=r(80446),c=r(69621),h=r(12033),u=r(31763),d=r(67235);function f(){return(0,n.jsxs)(c.kE,{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-8",children:"Some Shear Examples"}),(0,n.jsx)(c.$n,{label:"Orthographic (reset)",onClick:()=>{d.Q.send(u.n).assertPayload().vertigo.set({perspective:0,zoom:1,rotation:[0,0,0]})}}),(0,n.jsx)(c.$n,{label:"Perspective",onClick:()=>{d.Q.send(u.n).assertPayload().vertigo.set({perspective:1})}}),(0,n.jsxs)("p",{className:"max-w-sm",children:["Using ",(0,n.jsx)("code",{children:"TransformWithShear"})," from ",(0,n.jsx)("code",{children:"some-utils-three/experimental/transform-with-shear"}),"."]})]})}function m(){return(0,i.Fw)(function*(e){e.pipeline.basicPasses.fxaa.enabled=!1}),(0,i.dB)("my-scene",function*(e,t){(0,a.mj)(new s.u,e).regularGrid({size:12,subdivisions:[2,6],opacity:[1,.1]});let r=[{x:-5,y:3,z:0,xy:1,xz:0,yz:0},{x:-2,y:3,z:0,xy:0,xz:1,yz:0},{x:-3,y:1,z:0,xy:0,xz:0,yz:1},{x:1,y:4,z:0,xy:1,xz:1,yz:0},{x:4,y:3,z:0,xy:0,xz:1,yz:1},{x:1,y:1,z:0,xy:1,xz:0,yz:1}];for(let{x:t,y:n,z:i,xy:s,xz:l,yz:u}of r){let r={position:new o.Pq0(t,n,i),scale:new o.Pq0(1,1,1),rotation:new o.PTz,shear:{xy:s,xz:l,yz:u}},d=h.W.transformToTransform(r),f=(0,a.mj)(new c.QT(d?"white":"red"),e);f.matrixAutoUpdate=!1,(0,h.Nb)(r,f.matrix)}for(let{x:t,y:n,z:i,xy:s,xz:u,yz:d}of(l.n.setRandom("parkmiller",5678),r)){let r={position:new o.Pq0(t,n-6,i),scale:new o.Pq0(l.n.number(.1,2),l.n.number(.1,2),l.n.number(.1,2)),rotation:l.n.quaternion(new o.PTz),shear:{xy:s,xz:u,yz:d}},f=h.W.transformToTransform(r),m=(0,a.mj)(new c.QT(f?"white":"red"),e);m.matrixAutoUpdate=!1,(0,h.Nb)(r,m.matrix)}},[]),null}function p(){return(0,n.jsxs)(i.uB,{vertigoControls:{eventTarget:"canvas",size:12,zoom:.7,rotation:["15deg","20deg","0deg"],focus:[0,0,.5]},children:[(0,n.jsx)(m,{}),(0,n.jsx)(f,{})]})}},34125:(e,t,r)=>{"use strict";r.d(t,{ServerProof:()=>s});var n=r(70691),o=r(67203);let i=function(){return(0,n.jsx)("div",{className:"w-full h-full flex flex-col items-center justify-center",children:"loading..."})};function s(){let[,e]=(0,o.useState)(0);return(0,o.useEffect)(()=>{let t=!0;return Promise.all([r.e(5611),r.e(6564),r.e(7962),r.e(7953),r.e(146),r.e(2294)]).then(r.bind(r,52294)).then(r=>{t&&(i=r.ChooseOne,e(Math.random()))}),()=>{t=!1}},[]),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:(0,n.jsx)("div",{className:"absolute-through",children:(0,n.jsx)(i,{})})})}},48181:(e,t,r)=>{"use strict";r.d(t,{R:()=>d});var n=r(49797),o=r(20487),i=r(72612),s=r(94065);let a=new n.I9Y,l=new n.Pq0,c=new n.kn4;function*h(e){let t=new WeakSet;for(let r of e)t.has(r)||(t.add(r),yield r)}function u(e,t,r,n,o){if(null==r?void 0:r.transform)for(let e of((0,s.vl)(r.transform,c),h(t)))e.applyMatrix4(c);if((null==r?void 0:r.color)!==void 0&&e.color(r.color),n){for(let r=0;r<t.length-1;r++)e.points.push(t[r],t[r+1]);o&&e.points.push(t[t.length-1],t[0])}else e.points.push(...t)}class d extends n.DXC{addTo(e){return e?e.add(this):this.removeFromParent(),this}*uniquePoints(){yield*h(this.points)}opacity(e){return this.material.opacity=e,this.material.transparent=this.state.forceTransparent||e<1,this.material.depthWrite=e>=1,this.material.needsUpdate=!0,this}color(e){return this.colors.set(this.points.length,new n.Q1f(e)),this}forceTransparent(){return this.state.forceTransparent=!0,this.material.transparent=!0,this}translate(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[n,o,i]=1===t.length?(0,s.jj)(t[0],l):t;for(let e of this.uniquePoints())e.x+=n,e.y+=o,e.z+=i;return this}rescale(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[n,o,i]=1===t.length?(0,s.jj)(t[0],l):t;for(let e of this.uniquePoints())e.x*=n,e.y*=o,e.z*=i;return this}showOccludedLines(){let{opacity:e=.2}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new n.mrM({color:this.material.color,transparent:!0,depthFunc:n.K52,opacity:e}),r=new n.DXC(this.geometry,t);return this.add(r),this}clear(){return this.points.length=0,this.colors.clear(),this.geometry.setDrawRange(0,0),this}draw(){if(!1===this.state.hasAlreadyBeenRendered&&-1===this.state.reservePoints)this.geometry.setFromPoints(this.points),this.geometry.setDrawRange(0,this.points.length),this.state.reservePoints=this.points.length;else{let{position:e}=this.geometry.attributes;e||(e=new n.THS(new Float32Array(3*this.state.reservePoints),3),this.geometry.setAttribute("position",e));let t=this.points.length;t>e.count&&(console.warn("LineHelper: The number of points (".concat(t,") is greater than the reserved points (").concat(e.count,").")),t=e.count),this.geometry.setDrawRange(0,t);for(let r=0;r<t;r++){let{x:t,y:n,z:o}=this.points[r];e.setXYZ(r,t,n,o)}e.needsUpdate=!0}if(this.geometry.computeBoundingSphere(),this.material.vertexColors=this.colors.size>0,this.material.needsUpdate=!0,this.colors.size>0){var e;let{color:t}=this.geometry.attributes;t||(t=new n.THS(new Float32Array(3*this.geometry.attributes.position.count),3),this.geometry.setAttribute("color",t));let r=new n.Q1f(null!=(e=this.colors.get(0))?e:"white"),o=this.points.length;for(let e=0;e<o;e++){let n=this.colors.get(e);n&&r.copy(n),t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}return this}line(e,t,r){return u(this,[(0,s.jj)(e),(0,s.jj)(t)],r),this}capsule2(e,t,r,o){let a=(0,s.jj)(e),l=(0,s.jj)(t),c=new n.Pq0().subVectors(l,a),h=c.length(),d=c.clone().divideScalar(h),f=new n.Pq0(-d.y,d.x);return u(this,[...(0,i.loopArray)(24,e=>{let t=e.p*Math.PI;return a.clone().addScaledVector(f,r*Math.cos(t)).addScaledVector(d,-r*Math.sin(t))}),...(0,i.loopArray)(24,e=>{let t=e.p*Math.PI;return l.clone().addScaledVector(f,-r*Math.cos(t)).addScaledVector(d,r*Math.sin(t))})],o,!0,!0),this}polygon(e,t){let r=e.map(e=>(0,s.jj)(e)),n=[];for(let e=0;e<r.length;e++)n.push(r[e],r[(e+1)%r.length]);return u(this,n,t),this}polyline(e,t){let r=e.map(e=>(0,s.jj)(e)),n=[];for(let e=0;e<r.length-1;e++)n.push(r[e],r[e+1]);return u(this,n,t),this}circle(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let{x:o,y:i,z:l,radius:c,segments:h,plane:f,...m}={...d.circleDefaultOptions,...(()=>{if(t.length>1){let[e,r,n]=t,{x:o,y:i}=(0,s.wX)(e,a);return{x:o,y:i,radius:r,...n}}return t[0]})()},p=new n.Pq0(1,0,0),x=new n.Pq0(0,1,0),y=[];for(let e=0;e<h;e++){let t=e/h*Math.PI*2,r=(e+1)/h*Math.PI*2,s=Math.cos(t)*c,a=Math.sin(t)*c,u=Math.cos(r)*c,d=Math.sin(r)*c,f=new n.Pq0(o,i,l).addScaledVector(p,s).addScaledVector(x,a),m=new n.Pq0(o,i,l).addScaledVector(p,u).addScaledVector(x,d);y.push(f,m)}if("XZ"===f)for(let e of y)e.set(e.x,0,e.y);if("YZ"===f)for(let e of y)e.set(0,e.x,e.y);return u(this,y,m),this}sphere(e){return this.circle({...e,plane:"XY"}).circle({...e,plane:"XZ"}).circle({...e,plane:"YZ"})}rectangle(e,t){let{centerX:r,centerY:i,width:s,height:a}=o.M_.from(e),l=s/2,c=a/2,h=new n.Pq0(r-l,i-c,0),d=new n.Pq0(r+l,i-c,0),f=new n.Pq0(r+l,i+c,0),m=new n.Pq0(r-l,i+c,0);return u(this,[h,d,d,f,f,m,m,h],t),this}placeholder(e,t){let r=o.M_.from(e);return this.rectangle(r,t).line(r.fromRelativePoint(0,0),r.fromRelativePoint(1,1),t).line(r.fromRelativePoint(1,0),r.fromRelativePoint(0,1),t)}grid2(e){let{plane:t,x:r,y:o,z:i,size:l,subdivisions:c,width:h,height:f,widthSubdivisions:m,heightSubdivisions:p,...x}={...d.grid2DefaultOptions,...e},{x:y,y:g}=(0,s.wX)(l,a),{x:w,y:v}=(0,s.wX)(null!=c?c:l);h&&(y=h),f&&(g=f),m&&(w=m),p&&(v=p);let P=y/2,j=g/2,b=[];for(let e=0;e<=w;e++){let t=e/w*y-P;b.push(new n.Pq0(t,-j,0),new n.Pq0(t,j,0))}for(let e=0;e<=v;e++){let t=e/v*g-j;b.push(new n.Pq0(-P,t,0),new n.Pq0(P,t,0))}let z=new n.Pq0(r,o,i);for(let e of b)e.add(z);if("XZ"===t)for(let e of b)e.set(e.x,0,e.y);if("YZ"===t)for(let e of b)e.set(0,e.x,e.y);return u(this,b,x),this}box(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0,r=0,o=0,i=1,a=1,c=1,{center:h,size:u,box3:d}=e;if(void 0!==h&&({x:t,y:r,z:o}=(0,s.jj)(h,l)),void 0!==u&&({x:i,y:a,z:c}=(0,s.jj)(u,l)),void 0!==d){let{min:n,max:s}=d,{x:l,y:h,z:u}=n,{x:f,y:m,z:p}=s;e.asIntBox3&&(f+=1,m+=1,p+=1),t=(l+f)/2,r=(h+m)/2,o=(u+p)/2,i=f-l,a=m-h,c=p-u}let f=i/2,m=a/2,p=c/2,x=new n.Pq0(t-f,r-m,o-p),y=new n.Pq0(t+f,r-m,o-p),g=new n.Pq0(t+f,r+m,o-p),w=new n.Pq0(t-f,r+m,o-p),v=new n.Pq0(t-f,r-m,o+p),P=new n.Pq0(t+f,r-m,o+p),j=new n.Pq0(t+f,r+m,o+p),b=new n.Pq0(t-f,r+m,o+p);return this.points.push(x,y,y,g,g,w,w,x),this.points.push(v,P,P,j,j,b,b,v),this.points.push(x,v,y,P,g,j,w,b),this}plus(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0,o=t/2,{x:i,y:l}=(0,s.wX)(e,a),c=new n.Pq0(i-o,l,0),h=new n.Pq0(i+o,l,0);return u(this,[c,h,new n.Pq0(i,l-o,0),new n.Pq0(i,l+o,0)],r),this}cross(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0,o=t/2,{x:i,y:l}=(0,s.wX)(e,a),c=new n.Pq0(i-o,l-o,0),h=new n.Pq0(i+o,l+o,0);return u(this,[c,h,new n.Pq0(i-o,l+o,0),new n.Pq0(i+o,l-o,0)],r),this}constructor(e=-1,t=new n.mrM({vertexColors:!0})){super(new n.LoY,t),this.points=[],this.colors=new Map,this.state={forceTransparent:!1,hasAlreadyBeenRendered:!1,reservePoints:-1},this.state.reservePoints=e,this.onBeforeRender=()=>{this.state.hasAlreadyBeenRendered=!0}}}d.circleDefaultOptions={plane:"XY",x:0,y:0,z:0,radius:.5,segments:96},d.grid2DefaultOptions={plane:"XY",x:0,y:0,z:0,size:8,width:void 0,height:void 0,subdivisions:void 0,widthSubdivisions:void 0,heightSubdivisions:void 0}},59481:(e,t,r)=>{"use strict";r.d(t,{Main:()=>m});var n=r(70691),o=r(49797),i=r(84306),s=r(31763),a=r(48181),l=r(16465),c=r(79911),h=r(36508);class u extends o.eaF{constructor(){super(new o.bdM(4,.2),new l.Y({color:"#ff9900"}))}}class d extends o.eaF{constructor(){super(new o.bdM(4,.2),new o.BKk({uniforms:{uColor:{value:new o.Q1f("#ff9900")},uSunPosition:{value:new o.Pq0(.5,.7,.3)},uLuminosity:{value:.5}},vertexShader:"\n      varying vec3 vWorldNormal;\n      \n      void main() {\n        vWorldNormal = mat3(modelMatrix) * normal;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        gl_Position.z += -0.01;\n      }\n    ",fragmentShader:"\n      varying vec3 vWorldNormal;\n      varying vec3 vColor;\n      \n      uniform vec3 uSunPosition;\n      uniform vec3 uColor;\n      uniform float uLuminosity;\n      \n      void main() {\n        vec3 lightDirection = normalize(uSunPosition);\n        float light = dot(vWorldNormal, lightDirection) * 0.5 + 0.5;\n        light = pow(light, 2.0);\n        light = mix(uLuminosity, 1.0, light);\n        gl_FragColor = vec4(uColor * light, 1.0);\n      }\n    "}))}}function f(){return(0,i.hG)(function*(e){e.useOrbitControls=!1;let t=new s.n({size:[8,8]});t.start(e.three.renderer.domElement),yield(0,h.xy)("three",r=>{t.update(e.three.camera,e.three.aspect)})}),(0,i.yk)(function*(e){e.scene.background=new o.Q1f("#6699cc"),(0,c.mj)(new o.eaF(new o.WBB(1,4),new l.Y({color:"red"})),e.scene),(0,c.mj)(new a.R,e.scene).box({size:2}).draw().showOccludedLines(),(0,c.mj)(new u,{parent:e.scene,position:[0,.5,0]}),(0,c.mj)(new d,{parent:e.scene,position:[0,-.5,0]}),yield()=>e.scene.clear()},[]),null}function m(){return(0,n.jsx)(i.YV,{children:(0,n.jsx)(f,{})})}},66209:(e,t,r)=>{"use strict";r.d(t,{Main:()=>m});var n=r(70691),o=r(49797),i=r(84306),s=r(16465),a=r(7147),l=r(3293),c=r(79911),h=r(72612),u=r(17099);class d extends o.YJl{constructor(){super(),(0,c.mj)(new o.eaF(new o.WBB(1,12),new s.Y),this),(0,c.mj)(new o.eaF(new o.UPV(2,.1,256,16),new s.Y({color:"red"})),this);let e=new o.uWO(new Float32Array(100),4),t=new o.bdM;t.setAttribute("aRand",e);let r=new o.V9B({side:o.$EB});r.onBeforeCompile=e=>a.bI.with(e).vertex.top("\n        attribute vec4 aRand;\n      ").vertex.after("project_vertex","\n        // Move the vertex a bit based on aRand, and that's all!!!!\n        gl_Position.z += aRand.x * .1;\n      ");let n=(0,c.mj)(new o.ZLX(t,r,25),this);u.c.reset();let i=Array.from({length:25},()=>0xffffff*u.c.random());for(let t of(0,h.loop2)(5,5)){let r=(t.px-.5)*4,o=(t.py-.5)*4,s=(t.px+t.py)*.4;n.setMatrixAt(t.i,(0,l.w)({x:r,y:o,z:s,scaleScalar:1.25})),n.setColorAt(t.i,(0,l._)(u.c.pick(i))),e.setXYZW(t.i,u.c.random(),u.c.random(),u.c.random(),u.c.random())}}}function f(){return(0,i.yk)(function*(e){e.useOrbitControls(),e.scene.background=new o.Q1f("#345");let t=new d;e.scene.add(t),yield()=>t.removeFromParent()},[]),null}function m(){return(0,n.jsx)(i.YV,{children:(0,n.jsx)(f,{})})}},68516:(e,t,r)=>{"use strict";r.d(t,{SafeClient:()=>i});var n=r(70691),o=r(67203);function i(){let[e,t]=(0,o.useState)(null);return(0,o.useEffect)(()=>{Promise.all([r.e(5500),r.e(5611),r.e(7190),r.e(6564),r.e(7953),r.e(146),r.e(487),r.e(3445),r.e(9332),r.e(3414),r.e(9717),r.e(1763),r.e(7215)]).then(r.bind(r,51571)).then(e=>t(e))},[]),e?(0,n.jsx)(e.Client,{}):(0,n.jsx)("div",{className:"layer col-center",children:"loading..."})}},70574:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,89294,23)),Promise.resolve().then(r.bind(r,66209)),Promise.resolve().then(r.bind(r,59481)),Promise.resolve().then(r.bind(r,76033)),Promise.resolve().then(r.bind(r,18397)),Promise.resolve().then(r.bind(r,4076)),Promise.resolve().then(r.bind(r,37833)),Promise.resolve().then(r.bind(r,73341)),Promise.resolve().then(r.bind(r,34125)),Promise.resolve().then(r.bind(r,99398)),Promise.resolve().then(r.bind(r,68516)),Promise.resolve().then(r.bind(r,85862)),Promise.resolve().then(r.bind(r,94449))},72612:(e,t,r)=>{"use strict";function*n(e){let t=0,r={get i(){return t},get t(){return t/e},get p(){return t/(e-1)},get size(){return e},clone(){return{...this}}};for(t=0;t<e;t++)yield r}function o(e,t){let r=[];for(let o of n(e)){let e=o.clone();r.push(t?t(e):e)}return r}function*i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=0,o=0;2===t.length?(n=t[0],o=t[1]):Array.isArray(t[0])?(n=t[0][0],o=t[0][1]):(n=t[0].x,o=t[0].y);let i=0,s=0,a=0,l={get i(){return i},get x(){return s},get y(){return a},get tx(){return s/n},get ty(){return a/o},get px(){return s/(n-1)},get py(){return a/(o-1)},get sizeX(){return n},get sizeY(){return o},clone(){return{...this}}};for(a=0;a<o;a++)for(s=0;s<n;s++)yield l,i++}function s(){let e;for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];let o=0,s=0;"number"==typeof r[0]?(o=r[0],s=r[1],e=r[2]):(Array.isArray(r[0])?(o=r[0][0],s=r[0][1]):(o=r[0].x,s=r[0].y),e=r[1]);let a=[];for(let t of i(o,s)){let r=t.clone();a.push(e?e(r):r)}return a}function*a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=0,o=0,i=0;3===t.length?(n=t[0],o=t[1],i=t[2]):Array.isArray(t[0])?(n=t[0][0],o=t[0][1],i=t[0][2]):(n=t[0].x,o=t[0].y,i=t[0].z);let s=0,a=0,l=0,c=0,h={get i(){return s},get x(){return a},get y(){return l},get z(){return c},get tx(){return a/n},get ty(){return l/o},get tz(){return c/i},get px(){return a/(n-1)},get py(){return l/(o-1)},get pz(){return c/(i-1)},clone(){return{...this}}};for(c=0;c<i;c++)for(l=0;l<o;l++)for(a=0;a<n;a++)yield h,s++}function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=[];for(let e of a(...t))n.push(e.clone());return n}r.r(t),r.d(t,{loop:()=>n,loop2:()=>i,loop2Array:()=>s,loop3:()=>a,loop3Array:()=>l,loopArray:()=>o})},73341:(e,t,r)=>{"use strict";r.d(t,{Main:()=>p});var n=r(70691),o=r(49797),i=r(12719),s=r(64028),a=r(84306),l=r(15931),c=r(48181),h=r(16465),u=r(79911),d=r(36508);class f extends o.YJl{onTick(e){let{sphere:t,pivot:r,position:n}=this.parts,i=e.lerpSin01Time(.5,1.5,{frequency:.2}),s=new o.Pq0().copy(r.position).addScaledVector(r.position,-i);t.matrixAutoUpdate=!1,t.matrix.makeScale(i,i,i).setPosition(s.add(n.position))}constructor(...e){super(...e),this.parts={sphere:(0,u.mj)(new o.eaF(new o.WBB(1,8),new h.Y),{name:"sphere",parent:this}),circle:(0,u.mj)(new c.R().circle({radius:.5}).circle({radius:1}).circle({radius:1.5}).draw(),{name:"circle",parent:this}),pivot:(0,u.mj)(new o.YJl,{name:"pivot",parent:this}),position:(0,u.mj)(new o.YJl,{name:"position",parent:this}),grid:(0,u.mj)(new l.P,{name:"grid",parent:this,rotationX:"90deg"})}}}function m(){let e=(0,a.hG)();return(0,a.yk)(function*(t){t.scene.background=new o.Q1f("#345");let r=new f;t.scene.add(r),yield(0,d.xy)("three",e=>r.onTick(e)),e.sceneSelection.set("Hop!",[r.parts.pivot]),e.toolType.set(i.pv.Move),(0,s._t)(e,r.parts.pivot),yield()=>r.removeFromParent()},[]),null}function p(){return(0,n.jsxs)(a.YV,{children:[(0,n.jsx)(m,{}),(0,n.jsxs)("div",{className:"flex flex-col p-4 gap-2",children:[(0,n.jsx)("p",{children:"Pivot offset to perform translate and scale is quite straightforward:"}),(0,n.jsx)("pre",{className:"bg-[#fff1] rounded px-2 py-1",children:"\nconst scale = ... // some value\nconst translate = new Vector3()\n  .copy(pivot.position)\n  .addScaledVector(pivot.position, -scale)\n\nmatrix\n  .makeScale(scale, scale, scale)\n  .setPosition(translate)\n".trim()})]})]})}},76033:(e,t,r)=>{"use strict";r.d(t,{Client:()=>d});var n=r(70691),o=r(33540),i=r(77794),s=r(79911),a=r(69621),l=r(31763),c=r(67235);function h(){return(0,n.jsxs)("div",{className:"ui layer thru p-8 flex flex-col gap-4 items-start",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-8",children:"Matrix with Shear"}),(0,n.jsx)("button",{className:"btn border rounded px-4 py-2",onClick:()=>{c.Q.send(l.n).assertPayload().vertigo.set({perspective:0,zoom:1,rotation:[0,0,0]})},children:"Orthographic (reset)"}),(0,n.jsx)("button",{className:"btn border rounded px-4 py-2",onClick:()=>{c.Q.send(l.n).assertPayload().vertigo.set({perspective:1})},children:"Perspective"}),(0,n.jsxs)("p",{className:"flex w-[400px]",children:["The problem:",(0,n.jsx)("br",{}),"Linear interpolation of matrix columns produces weird intermediate states."]}),(0,n.jsxs)("p",{className:"flex w-[400px]",children:["Conclusion:",(0,n.jsx)("br",{}),"The matrices should be decomposed to position, rotation, scale, shear, interpolated, then recomposed."]}),(0,n.jsx)("p",{className:"flex w-[400px]",children:"But shear is tricky..."})]})}function u(){return(0,o.Fw)(function*(e){e.pipeline.basicPasses.fxaa.enabled=!1}),(0,o.dB)("my-scene",function*(e,t){(0,s.mj)(new i.u,e).regularGrid({size:12,subdivisions:[2,6],opacity:[1,.1]});let r=(0,s.mj)(new a.Yr,e);(0,s.mj)(r.objA,{x:1,y:4}),(0,s.mj)(r.objB,{x:-1,y:4,rotation:["0deg","180deg","0deg"]});let n=(0,s.mj)(new a.Yr,e);(0,s.mj)(n.objA,{x:1,y:2}),(0,s.mj)(n.objB,{x:-1,y:2,rotation:["90deg","90deg","0deg"]})},[]),null}function d(){return(0,n.jsxs)(o.uB,{vertigoControls:{eventTarget:"canvas",size:12,zoom:1,rotation:["0deg","0deg","0deg"],focus:[0,0,.5]},children:[(0,n.jsx)(u,{}),(0,n.jsx)(h,{})]})}},80446:(e,t,r)=>{"use strict";r.d(t,{n:()=>o});var n=r(79105);let o=function e(){let t=Math.random,r=()=>{};function o(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return t}function i(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];if(0===r.length)return t();if(1===r.length)return t()*r[0];if(2===r.length)return t()*(r[1]-r[0])+r[0];throw Error("Invalid arguments")}function s(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];if(1===r.length)return Math.floor(t()*r[0]);if(2===r.length)return Math.floor(t()*(r[1]-r[0]))+r[0];throw Error("Invalid arguments")}function a(e){let{weightsAreNormalized:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===e.length)throw Error("Weights array is empty");if(!1===r){let r=e.reduce((e,t)=>e+t,0),n=t()*r,o=0;for(let t=0;t<e.length;t++)if(n<(o+=e[t]))return t;return e.length-1}{let r=t(),n=0;for(let t=0;t<e.length;t++)if(r<(n+=e[t]))return t;return e.length-1}}let l={new:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return e().setRandom(...r)},setRandom:function(){for(var e=arguments.length,i=Array(e),s=0;s<e;s++)i[s]=arguments[s];let[a,c=0]=i,h="string"==typeof c?o(c):c;if("parkmiller"===a){let e=n.Ts(h);t=()=>(e=n.K2(e),n.Tj(e)),r=t=>{e=n.Ts(t)}}else{if(void 0!==a&&"function"!=typeof a)throw Error("Invalid random function");t=null!=a?a:Math.random,r=()=>{}}return r(h),l},seed:function(e){return r("string"==typeof e?o(e):null!=e?e:0),l},get random(){return t},chance:function(e){return t()<e},number:i,float:i,f:i,sign:function(){return .5>t()?-1:1},int:s,i:s,hexColor:function(){let e=Math.floor(0xffffff*t());return"#".concat(e.toString(16).padStart(6,"0"))},pickIndex:a,pick:function(e,r){if(0===e.length)throw Error("Array is empty");if(r)return e[a(r)];let n=Math.floor(t()*e.length);return e[n]},createPicker:function(e){let t=e.map(e=>e[0]),r=e.map(e=>e[1]),n=t.reduce((e,t)=>e+t,0);for(let e=0;e<t.length;e++)t[e]/=n;return()=>r[a(t,{weightsAreNormalized:!0})]},direction2:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},r=t()*Math.PI*2;return e.x=Math.cos(r),e.y=Math.sin(r),e},direction3:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},r=t(),n=t(),o=2*Math.PI*r,i=Math.acos(1-2*n);return e.x=Math.sin(i)*Math.cos(o),e.y=Math.sin(i)*Math.sin(o),e.z=Math.cos(i),e},quaternion:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0,w:1},r=t(),n=t(),o=t(),i=Math.sqrt(1-r),s=Math.sqrt(r);return e.x=i*Math.sin(2*Math.PI*n),e.y=i*Math.cos(2*Math.PI*n),e.z=s*Math.sin(2*Math.PI*o),e.w=s*Math.cos(2*Math.PI*o),e},shuffleIndexes:function*(e){if(e<=0)throw Error("N must be greater than 0");let r=0,n=Math.floor((2+2*t())*e);for(;1!==function(e,t){for(;0!==t;)[e,t]=[t,e%t];return e}(e,n);){if(++r>1e3)throw Error("Failed to find a suitable a value after 1000 attempts");n=e+Math.floor(t()*e)}let o=Math.floor(t()*e);for(let t=0;t<e;t++)yield(o+t*n)%e}};return l}()},85862:(e,t,r)=>{"use strict";r.d(t,{SafeClient:()=>i});var n=r(70691),o=r(67203);function i(){let[e,t]=(0,o.useState)(null);return(0,o.useEffect)(()=>{Promise.all([r.e(5611),r.e(7190),r.e(6564),r.e(7953),r.e(146),r.e(487),r.e(3445),r.e(9332),r.e(3414),r.e(9717),r.e(1763),r.e(1080)]).then(r.bind(r,92622)).then(e=>t(e))},[]),e?(0,n.jsx)(e.Client,{}):(0,n.jsx)("div",{className:"layer col-center",children:"loading..."})}},94449:(e,t,r)=>{"use strict";r.d(t,{SafeClient:()=>i});var n=r(70691),o=r(67203);function i(){let[e,t]=(0,o.useState)(null);return(0,o.useEffect)(()=>{Promise.all([r.e(5611),r.e(7190),r.e(6564),r.e(7953),r.e(146),r.e(487),r.e(3445),r.e(9332),r.e(3414),r.e(9717),r.e(1763),r.e(8413)]).then(r.bind(r,71237)).then(e=>t(e))},[]),e?(0,n.jsx)(e.Client,{}):(0,n.jsx)("div",{className:"layer col-center",children:"loading..."})}},99398:(e,t,r)=>{"use strict";r.d(t,{SafeClient:()=>i});var n=r(70691),o=r(67203);function i(){let[e,t]=(0,o.useState)(null);return(0,o.useEffect)(()=>{Promise.all([r.e(5611),r.e(7190),r.e(6564),r.e(7953),r.e(146),r.e(487),r.e(3445),r.e(9332),r.e(3414),r.e(9717),r.e(1763),r.e(6224)]).then(r.bind(r,92358)).then(e=>t(e))},[]),e?(0,n.jsx)(e.Client,{}):(0,n.jsx)("div",{className:"layer col-center",children:"loading..."})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2193,5611,7190,6564,7962,9635,8921,7953,4512,7775,7436,7706,9294,146,487,3445,9332,3414,9717,1763,2143,3540,2206,7558,8132,1319,6852,7358],()=>t(70574)),_N_E=e.O()}]);